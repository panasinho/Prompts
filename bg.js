(()=>{const e=!1,t="_actors_ifdt";let n=globalThis[t];var a;(()=>{if(n)return;const a={};n=function t(n){const o={},r=new Proxy(n,{get:(i,s)=>"assign"===s?e=>{Object.assign(r,e)}:(s in n||(n[s]={},o[s]=t(n[s]),n===a&&e&&(globalThis[s]=n[s])),s in o?o[s]:n[s]),set:(t,r,i)=>(n[r]=i,o[r]=i,n===a&&e&&(globalThis[r]=n[r]),!0)});return r}(a),globalThis[t]=n,e&&(globalThis.app=a)})(),(()=>{var e=Object.defineProperty,t={};((t,n)=>{for(var a in(t=>{e(t,"__esModule",{value:!0})})(t),n)e(t,a,{get:n[a],enumerable:!0})})(t,{$mobx:()=>z,FlowCancellationError:()=>bn,ObservableMap:()=>Pa,ObservableSet:()=>Oa,Reaction:()=>Ot,_allowStateChanges:()=>We,_allowStateChangesInsideComputed:()=>en,_allowStateReadsEnd:()=>mt,_allowStateReadsStart:()=>ht,_autoAction:()=>Xt,_endAction:()=>Ge,_getAdministration:()=>Qa,_getGlobalState:()=>kt,_interceptReads:()=>In,_isComputingDerivation:()=>it,_resetGlobalState:()=>_t,_startAction:()=>He,action:()=>Qt,autorun:()=>nn,comparer:()=>J,computed:()=>Me,configure:()=>dn,createAtom:()=>V,defineProperty:()=>Bn,entries:()=>Ln,extendObservable:()=>pn,flow:()=>_n,flowResult:()=>Tn,get:()=>Un,getAtom:()=>Za,getDebugName:()=>Xa,getDependencyTree:()=>hn,getObserverTree:()=>gn,has:()=>qn,intercept:()=>Sn,isAction:()=>tn,isBoxedObservable:()=>Je,isComputed:()=>Pn,isComputedProp:()=>En,isFlow:()=>An,isFlowCancellationError:()=>wn,isObservable:()=>On,isObservableArray:()=>xa,isObservableMap:()=>Ea,isObservableObject:()=>Ua,isObservableProp:()=>Rn,isObservableSet:()=>Ra,keys:()=>Nn,makeAutoObservable:()=>ca,makeObservable:()=>sa,observable:()=>$e,observe:()=>Hn,onBecomeObserved:()=>sn,onBecomeUnobserved:()=>ln,onReactionError:()=>Rt,override:()=>ee,ownKeys:()=>Fn,reaction:()=>rn,remove:()=>jn,runInAction:()=>en,set:()=>Dn,spy:()=>Ht,toJS:()=>zn,trace:()=>Yn,transaction:()=>Vn,untracked:()=>ut,values:()=>Mn,when:()=>Jn});var a={0:"Invalid value for configuration 'enforceActions', expected 'never', 'always' or 'observed'",1:function(e,t){return"Cannot apply '"+e+"' to '"+t.toString()+"': Field not found."},5:"'keys()' can only be used on observable objects, arrays, sets and maps",6:"'values()' can only be used on observable objects, arrays, sets and maps",7:"'entries()' can only be used on observable objects, arrays and maps",8:"'set()' can only be used on observable objects, arrays and maps",9:"'remove()' can only be used on observable objects, arrays and maps",10:"'has()' can only be used on observable objects, arrays and maps",11:"'get()' can only be used on observable objects, arrays and maps",12:"Invalid annotation",13:"Dynamic observable objects cannot be frozen",14:"Intercept handlers should return nothing or a change object",15:"Observable arrays cannot be frozen",16:"Modification exception: the internal structure of an observable array was changed.",17:function(e,t){return"[mobx.array] Index out of bounds, "+e+" is larger than "+t},18:"mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js",19:function(e){return"Cannot initialize from classes that inherit from Map: "+e.constructor.name},20:function(e){return"Cannot initialize map from "+e},21:function(e){return"Cannot convert to map from '"+e+"'"},22:"mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js",23:"It is not possible to get index atoms from arrays",24:function(e){return"Cannot obtain administration from "+e},25:function(e,t){return"the entry '"+e+"' does not exist in the observable map '"+t+"'"},26:"please specify a property",27:function(e,t){return"no observable property '"+e.toString()+"' found on the observable object '"+t+"'"},28:function(e){return"Cannot obtain atom from "+e},29:"Expecting some object",30:"invalid action stack. did you forget to finish an action?",31:"missing option for computed: get",32:function(e,t){return"Cycle detected in computation "+e+": "+t},33:function(e){return"The setter of computed value '"+e+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"},34:function(e){return"[ComputedValue '"+e+"'] It is not possible to assign a new value to a computed value."},35:"There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`",36:"isolateGlobalState should be called before MobX is running any reactions",37:function(e){return"[mobx] `observableArray."+e+"()` mutates the array in-place, which is not allowed inside a derivation. Use `array.slice()."+e+"()` instead"},38:"'ownKeys()' can only be used on observable objects",39:"'defineProperty()' can only be used on observable objects"};function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r="string"==typeof e?e:a[e];throw"function"==typeof r&&(r=r.apply(null,n)),new Error("[MobX] "+r)}var r={};function i(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:r}var s=Object.assign,l=Object.getOwnPropertyDescriptor,c=Object.defineProperty,u=Object.prototype,d=[];Object.freeze(d);var p={};Object.freeze(p);var h="undefined"!=typeof Proxy,m=Object.toString();function g(){h||o("`Proxy` objects are not available in the current environment. Please configure MobX to enable a fallback implementation.`")}function f(e){vt.verifyProxies&&o("MobX is currently configured to be able to run in ES5 mode, but in ES5 MobX won't be able to "+e)}function y(){return++vt.mobxGuid}function b(e){var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}}var w=function(){};function v(e){return"function"==typeof e}function k(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function _(e){return null!==e&&"object"==typeof e}function x(e){var t;if(!_(e))return!1;var n=Object.getPrototypeOf(e);return null==n||(null==(t=n.constructor)?void 0:t.toString())===m}function T(e){var t=null==e?void 0:e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName)}function A(e,t,n){c(e,t,{enumerable:!1,writable:!0,configurable:!0,value:n})}function I(e,t,n){c(e,t,{enumerable:!1,writable:!1,configurable:!0,value:n})}function S(e,t){var n="isMobX"+e;return t.prototype[n]=!0,function(e){return _(e)&&!0===e[n]}}function C(e){return e instanceof Map}function P(e){return e instanceof Set}var E=void 0!==Object.getOwnPropertySymbols,$="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:E?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function O(e){return"string"==typeof e?e:"symbol"==typeof e?e.toString():new String(e).toString()}function R(e){return null===e?null:"object"==typeof e?""+e:e}function N(e,t){return u.hasOwnProperty.call(e,t)}var M=Object.getOwnPropertyDescriptors||function(e){var t={};return $(e).forEach((function(n){t[n]=l(e,n)})),t};function L(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function D(e,t,n){return t&&L(e.prototype,t),n&&L(e,n),e}function j(){return j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},j.apply(this,arguments)}function q(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function F(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var H=Symbol("mobx-stored-annotations");function G(e){return Object.assign((function(t,n){W(t,n,e)}),e)}function W(e,t,n){N(e,H)||A(e,H,j({},e[H])),te(n)&&!N(e[H],t)&&o("'"+e.constructor.name+".prototype."+t.toString()+"' is decorated with 'override', but no such decorated member was found on prototype."),function(e,t,n){if(!te(t)&&N(e[H],n)){var a=e.constructor.name+".prototype."+n.toString(),r=e[H][n].annotationType_;o("Cannot apply '@"+t.annotationType_+"' to '"+a+"':\nThe field is already decorated with '@"+r+"'.\nRe-decorating fields is not allowed.\nUse '@override' decorator for methods overriden by subclass.")}}(e,n,t),te(n)||(e[H][t]=n)}var z=Symbol("mobx administration"),Y=function(){function e(e){void 0===e&&(e="Atom@"+y()),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Ze.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e}var t=e.prototype;return t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.reportObserved=function(){return Ct(this)},t.reportChanged=function(){It(),Pt(this),St()},t.toString=function(){return this.name_},e}(),K=S("Atom",Y);function V(e,t,n){void 0===t&&(t=w),void 0===n&&(n=w);var a=new Y(e);return t!==w&&sn(a,t),n!==w&&ln(a,n),a}var J={identity:function(e,t){return e===t},structural:function(e,t){return to(e,t)},default:function(e,t){return Object.is?Object.is(e,t):e===t?0!==e||1/e==1/t:e!=e&&t!=t},shallow:function(e,t){return to(e,t,1)}};function Z(e,t,n){return On(e)?e:Array.isArray(e)?$e.array(e,{name:n}):x(e)?$e.object(e,void 0,{name:n}):C(e)?$e.map(e,{name:n}):P(e)?$e.set(e,{name:n}):"function"!=typeof e||tn(e)||An(e)?e:T(e)?_n(e):Xt(n,e)}function Q(e){return e}var X="override",ee=G({annotationType_:X,make_:function(e,t){return e.isPlainObject_&&o("Cannot apply '"+this.annotationType_+"' to '"+e.name_+"."+t.toString()+"':\n'"+this.annotationType_+"' cannot be used on plain objects."),N(e.appliedAnnotations_,t)||o("'"+e.name_+"."+t.toString()+"' is annotated with '"+this.annotationType_+"', but no such annotated member was found on prototype."),0},extend_:function(e,t,n,a){o("'"+this.annotationType_+"' can only be used with 'makeObservable'")}});function te(e){return e.annotationType_===X}function ne(e,t){return{annotationType_:e,options_:t,make_:ae,extend_:oe}}function ae(e,t,n,a){var o;if(null==(o=this.options_)?void 0:o.bound)return null===this.extend_(e,t,n,!1)?0:1;if(a===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(tn(n.value))return 1;var r=re(e,this,t,n,!1);return c(a,t,r),2}function oe(e,t,n,a){var o=re(e,this,t,n);return e.defineProperty_(t,o,a)}function re(e,t,n,a,r){var i,s,l,c,u;void 0===r&&(r=vt.safeDescriptors),function(e,t,n,a){var r=t.annotationType_;v(a.value)||o("Cannot apply '"+r+"' to '"+e.name_+"."+n.toString()+"':\n'"+r+"' can only be used on properties with a function value.")}(e,t,n,a);var d,p=a.value;return(null==(i=t.options_)?void 0:i.bound)&&(p=p.bind(null!=(d=e.proxy_)?d:e.target_)),{value:Be(null!=(s=null==(l=t.options_)?void 0:l.name)?s:n.toString(),p,null!=(c=null==(u=t.options_)?void 0:u.autoAction)&&c),configurable:!r||e.isPlainObject_,enumerable:!1,writable:!r}}function ie(e,t){return{annotationType_:e,options_:t,make_:se,extend_:le}}function se(e,t,n,a){var o;if(a===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if((null==(o=this.options_)?void 0:o.bound)&&!An(e.target_[t])&&null===this.extend_(e,t,n,!1))return 0;if(An(n.value))return 1;var r=ce(e,this,t,n,!1,!1);return c(a,t,r),2}function le(e,t,n,a){var o,r=ce(e,this,t,n,null==(o=this.options_)?void 0:o.bound);return e.defineProperty_(t,r,a)}function ce(e,t,n,a,r,i){void 0===i&&(i=vt.safeDescriptors),function(e,t,n,a){var r=t.annotationType_;v(a.value)||o("Cannot apply '"+r+"' to '"+e.name_+"."+n.toString()+"':\n'"+r+"' can only be used on properties with a generator function value.")}(e,t,n,a);var s,l=a.value;return r&&(l=l.bind(null!=(s=e.proxy_)?s:e.target_)),{value:_n(l),configurable:!i||e.isPlainObject_,enumerable:!1,writable:!i}}function ue(e,t){return{annotationType_:e,options_:t,make_:de,extend_:pe}}function de(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function pe(e,t,n,a){return function(e,t,n,a){var r=t.annotationType_;a.get||o("Cannot apply '"+r+"' to '"+e.name_+"."+n.toString()+"':\n'"+r+"' can only be used on getter(+setter) properties.")}(e,this,t,n),e.defineComputedProperty_(t,j({},this.options_,{get:n.get,set:n.set}),a)}function he(e,t){return{annotationType_:e,options_:t,make_:me,extend_:ge}}function me(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function ge(e,t,n,a){var r,i;return function(e,t,n,a){var r=t.annotationType_;"value"in a||o("Cannot apply '"+r+"' to '"+e.name_+"."+n.toString()+"':\n'"+r+"' cannot be used on getter/setter properties")}(e,this,t,n),e.defineObservableProperty_(t,n.value,null!=(r=null==(i=this.options_)?void 0:i.enhancer)?r:Z,a)}var fe=ye();function ye(e){return{annotationType_:"true",options_:e,make_:be,extend_:we}}function be(e,t,n,a){var o,r,i,s;if(n.get)return Me.make_(e,t,n,a);if(n.set){var l=Be(t.toString(),n.set);return a===e.target_?null===e.defineProperty_(t,{configurable:!vt.safeDescriptors||e.isPlainObject_,set:l})?0:2:(c(a,t,{configurable:!0,set:l}),2)}if(a!==e.target_&&"function"==typeof n.value)return T(n.value)?((null==(s=this.options_)?void 0:s.autoBind)?_n.bound:_n).make_(e,t,n,a):((null==(i=this.options_)?void 0:i.autoBind)?Xt.bound:Xt).make_(e,t,n,a);var u,d=!1===(null==(o=this.options_)?void 0:o.deep)?$e.ref:$e;return"function"==typeof n.value&&(null==(r=this.options_)?void 0:r.autoBind)&&(n.value=n.value.bind(null!=(u=e.proxy_)?u:e.target_)),d.make_(e,t,n,a)}function we(e,t,n,a){var o,r,i;return n.get?Me.extend_(e,t,n,a):n.set?e.defineProperty_(t,{configurable:!vt.safeDescriptors||e.isPlainObject_,set:Be(t.toString(),n.set)},a):("function"==typeof n.value&&(null==(o=this.options_)?void 0:o.autoBind)&&(n.value=n.value.bind(null!=(i=e.proxy_)?i:e.target_)),(!1===(null==(r=this.options_)?void 0:r.deep)?$e.ref:$e).extend_(e,t,n,a))}var ve={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function ke(e){return e||ve}Object.freeze(ve);var _e=he("observable"),xe=he("observable.ref",{enhancer:Q}),Te=he("observable.shallow",{enhancer:function(e,t,n){return null==e||Ua(e)||xa(e)||Ea(e)||Ra(e)?e:Array.isArray(e)?$e.array(e,{name:n,deep:!1}):x(e)?$e.object(e,void 0,{name:n,deep:!1}):C(e)?$e.map(e,{name:n,deep:!1}):P(e)?$e.set(e,{name:n,deep:!1}):void o("The shallow modifier / decorator can only used in combination with arrays, objects, maps and sets")}}),Ae=he("observable.struct",{enhancer:function(e,t){return On(e)&&o("observable.struct should not be used with observable values"),to(e,t)?t:e}}),Ie=G(_e);function Se(e){return!0===e.deep?Z:!1===e.deep?Q:(t=e.defaultDecorator)&&null!=(n=null==(a=t.options_)?void 0:a.enhancer)?n:Z;var t,n,a}function Ce(e,t,n){if(!k(t))return On(e)?e:x(e)?$e.object(e,t,n):Array.isArray(e)?$e.array(e,t):C(e)?$e.map(e,t):P(e)?$e.set(e,t):"object"==typeof e&&null!==e?e:$e.box(e,t);W(e,t,_e)}Object.assign(Ce,Ie);var Pe,Ee,$e=s(Ce,{box:function(e,t){var n=ke(t);return new Ve(e,Se(n),n.name,!0,n.equals)},array:function(e,t){var n=ke(t);return(!1===vt.useProxies||!1===n.proxy?Ja:ma)(e,Se(n),n.name)},map:function(e,t){var n=ke(t);return new Pa(e,Se(n),n.name)},set:function(e,t){var n=ke(t);return new Oa(e,Se(n),n.name)},object:function(e,t,n){return pn(!1===vt.useProxies||!1===(null==n?void 0:n.proxy)?Da({},n):function(e,t){var n,a;return g(),e=Da(e,t),null!=(a=(n=e[z]).proxy_)?a:n.proxy_=new Proxy(e,ea)}({},n),e,t)},ref:G(xe),shallow:G(Te),deep:Ie,struct:G(Ae)}),Oe="computed",Re=ue(Oe),Ne=ue("computed.struct",{equals:J.structural}),Me=function(e,t){if(k(t))return W(e,t,Re);if(x(e))return G(ue(Oe,e));v(e)||o("First argument to `computed` should be an expression."),v(t)&&o("A setter as second argument is no longer supported, use `{ set: fn }` option instead");var n=x(t)?t:{};return n.get=e,n.name||(n.name=e.name||""),new tt(n)};Object.assign(Me,Re),Me.struct=G(Ne);var Le,De=0,je=1,qe=null!=(Pe=null==(Ee=l((function(){}),"name"))?void 0:Ee.configurable)&&Pe,Ue={value:"action",configurable:!0,writable:!1,enumerable:!1};function Be(e,t,n,a){function r(){return Fe(e,n,t,a||this,arguments)}return void 0===n&&(n=!1),v(t)||o("`action` can only be invoked on functions"),"string"==typeof e&&e||o("actions should have valid names, got: '"+e+"'"),r.isMobxAction=!0,qe&&(Ue.value=e,Object.defineProperty(r,"name",Ue)),r}function Fe(e,t,n,a,o){var r=He(e,t,a,o);try{return n.apply(a,o)}catch(e){throw r.error_=e,e}finally{Ge(r)}}function He(e,t,n,a){var o=jt()&&!!e,r=0;if(o){r=Date.now();var i=a?Array.from(a):d;Ut({type:Gt,name:e,object:n,arguments:i})}var s=vt.trackingDerivation,l=!t||!s;It();var c=vt.allowStateChanges;l&&(dt(),c=ze(!0));var u={runAsAction_:l,prevDerivation_:s,prevAllowStateChanges_:c,prevAllowStateReads_:ht(!0),notifySpy_:o,startTime_:r,actionId_:je++,parentActionId_:De};return De=u.actionId_,u}function Ge(e){De!==e.actionId_&&o(30),De=e.parentActionId_,void 0!==e.error_&&(vt.suppressReactionErrors=!0),Ye(e.prevAllowStateChanges_),mt(e.prevAllowStateReads_),St(),e.runAsAction_&&pt(e.prevDerivation_),e.notifySpy_&&Ft({time:Date.now()-e.startTime_}),vt.suppressReactionErrors=!1}function We(e,t){var n=ze(e);try{return t()}finally{Ye(n)}}function ze(e){var t=vt.allowStateChanges;return vt.allowStateChanges=e,t}function Ye(e){vt.allowStateChanges=e}Le=Symbol.toPrimitive;var Ke,Ve=function(e){function t(t,n,a,o,r){var i;return void 0===a&&(a="ObservableValue@"+y()),void 0===o&&(o=!0),void 0===r&&(r=J.default),(i=e.call(this,a)||this).enhancer=void 0,i.name_=void 0,i.equals=void 0,i.hasUnreportedChange_=!1,i.interceptors_=void 0,i.changeListeners_=void 0,i.value_=void 0,i.dehancer=void 0,i.enhancer=n,i.name_=a,i.equals=r,i.value_=n(t,void 0,a),o&&jt()&&qt({type:"create",object:U(i),observableKind:"value",debugObjectName:i.name_,newValue:""+i.value_}),i}q(t,e);var n=t.prototype;return n.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},n.set=function(e){var t=this.value_;if((e=this.prepareNewValue_(e))!==vt.UNCHANGED){var n=jt();n&&Ut({type:da,object:this,observableKind:"value",debugObjectName:this.name_,newValue:e,oldValue:t}),this.setNewValue_(e),n&&Ft()}},n.prepareNewValue_=function(e){if(st(this),ta(this)){var t=aa(this,{object:this,type:da,newValue:e});if(!t)return vt.UNCHANGED;e=t.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?vt.UNCHANGED:e},n.setNewValue_=function(e){var t=this.value_;this.value_=e,this.reportChanged(),oa(this)&&ia(this,{type:da,object:this,newValue:e,oldValue:t})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(e){return na(this,e)},n.observe_=function(e,t){return t&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:da,newValue:this.value_,oldValue:void 0}),ra(this,e)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return R(this.get())},n[Le]=function(){return this.valueOf()},t}(Y),Je=S("ObservableValue",Ve);Ke=Symbol.toPrimitive;var Ze,Qe,Xe,et,tt=function(){function e(e){this.dependenciesState_=Ze.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Ze.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new at(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Xe.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||o(31),this.derivation=e.get,this.name_=e.name||"ComputedValue@"+y(),e.set&&(this.setter_=Be(this.name_+"-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?J.structural:J.default),this.scope_=e.context,this.requiresReaction_=!!e.requiresReaction,this.keepAlive_=!!e.keepAlive}var t=e.prototype;return t.onBecomeStale_=function(){var e;(e=this).lowestObserverState_===Ze.UP_TO_DATE_&&(e.lowestObserverState_=Ze.POSSIBLY_STALE_,e.observers_.forEach((function(e){e.dependenciesState_===Ze.UP_TO_DATE_&&(e.dependenciesState_=Ze.POSSIBLY_STALE_,e.onBecomeStale_())})))},t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.get=function(){if(this.isComputing_&&o(32,this.name_,this.derivation),0!==vt.inBatch||0!==this.observers_.size||this.keepAlive_){if(Ct(this),rt(this)){var e=vt.trackingContext;this.keepAlive_&&!e&&(vt.trackingContext=this),this.trackAndCompute()&&((t=this).lowestObserverState_!==Ze.STALE_&&(t.lowestObserverState_=Ze.STALE_,t.observers_.forEach((function(e){e.dependenciesState_===Ze.POSSIBLY_STALE_?(e.dependenciesState_=Ze.STALE_,e.isTracing_!==Xe.NONE&&Et(e,t)):e.dependenciesState_===Ze.UP_TO_DATE_&&(t.lowestObserverState_=Ze.UP_TO_DATE_)})))),vt.trackingContext=e}}else rt(this)&&(this.warnAboutUntrackedRead_(),It(),this.value_=this.computeValue_(!1),St());var t,n=this.value_;if(ot(n))throw n.cause;return n},t.set=function(e){if(this.setter_){this.isRunningSetter_&&o(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter_=!1}}else o(34,this.name_)},t.trackAndCompute=function(){var e=this.value_,t=this.dependenciesState_===Ze.NOT_TRACKING_,n=this.computeValue_(!0);jt()&&qt({observableKind:"computed",debugObjectName:this.name_,object:this.scope_,type:"update",oldValue:this.value_,newValue:n});var a=t||ot(e)||ot(n)||!this.equals_(e,n);return a&&(this.value_=n),a},t.computeValue_=function(e){this.isComputing_=!0;var t,n=ze(!1);if(e)t=lt(this,this.derivation,this.scope_);else if(!0===vt.disableErrorBoundaries)t=this.derivation.call(this.scope_);else try{t=this.derivation.call(this.scope_)}catch(e){t=new at(e)}return Ye(n),this.isComputing_=!1,t},t.suspend_=function(){this.keepAlive_||(ct(this),this.value_=void 0,this.isTracing_!==Xe.NONE&&console.log("[mobx.trace] Computed value '"+this.name_+"' was suspended and it will recompute on the next access."))},t.observe_=function(e,t){var n=this,a=!0,o=void 0;return nn((function(){var r=n.get();if(!a||t){var i=dt();e({observableKind:"computed",debugObjectName:n.name_,type:da,object:n,newValue:r,oldValue:o}),pt(i)}a=!1,o=r}))},t.warnAboutUntrackedRead_=function(){this.isTracing_!==Xe.NONE&&console.log("[mobx.trace] Computed value '"+this.name_+"' is being read outside a reactive context. Doing a full recompute."),(vt.computedRequiresReaction||this.requiresReaction_)&&console.warn("[mobx] Computed value '"+this.name_+"' is being read outside a reactive context. Doing a full recompute.")},t.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},t.valueOf=function(){return R(this.get())},t[Ke]=function(){return this.valueOf()},e}(),nt=S("ComputedValue",tt);(Qe=Ze||(Ze={}))[Qe.NOT_TRACKING_=-1]="NOT_TRACKING_",Qe[Qe.UP_TO_DATE_=0]="UP_TO_DATE_",Qe[Qe.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",Qe[Qe.STALE_=2]="STALE_",(et=Xe||(Xe={}))[et.NONE=0]="NONE",et[et.LOG=1]="LOG",et[et.BREAK=2]="BREAK";var at=function(e){this.cause=void 0,this.cause=e};function ot(e){return e instanceof at}function rt(e){switch(e.dependenciesState_){case Ze.UP_TO_DATE_:return!1;case Ze.NOT_TRACKING_:case Ze.STALE_:return!0;case Ze.POSSIBLY_STALE_:for(var t=ht(!0),n=dt(),a=e.observing_,o=a.length,r=0;r<o;r++){var i=a[r];if(nt(i)){if(vt.disableErrorBoundaries)i.get();else try{i.get()}catch(e){return pt(n),mt(t),!0}if(e.dependenciesState_===Ze.STALE_)return pt(n),mt(t),!0}}return gt(e),pt(n),mt(t),!1}}function it(){return null!==vt.trackingDerivation}function st(e){var t=e.observers_.size>0;vt.allowStateChanges||!t&&"always"!==vt.enforceActions||console.warn("[MobX] "+(vt.enforceActions?"Since strict-mode is enabled, changing (observed) observable values without using an action is not allowed. Tried to modify: ":"Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, a computed value or the render function of a React component? You can wrap side effects in 'runInAction' (or decorate functions with 'action') if needed. Tried to modify: ")+e.name_)}function lt(e,t,n){var a=ht(!0);gt(e),e.newObserving_=new Array(e.observing_.length+100),e.unboundDepsCount_=0,e.runId_=++vt.runId;var o,r=vt.trackingDerivation;if(vt.trackingDerivation=e,vt.inBatch++,!0===vt.disableErrorBoundaries)o=t.call(n);else try{o=t.call(n)}catch(e){o=new at(e)}return vt.inBatch--,vt.trackingDerivation=r,function(e){for(var t=e.observing_,n=e.observing_=e.newObserving_,a=Ze.UP_TO_DATE_,o=0,r=e.unboundDepsCount_,i=0;i<r;i++){var s=n[i];0===s.diffValue_&&(s.diffValue_=1,o!==i&&(n[o]=s),o++),s.dependenciesState_>a&&(a=s.dependenciesState_)}for(n.length=o,e.newObserving_=null,r=t.length;r--;){var l=t[r];0===l.diffValue_&&Tt(l,e),l.diffValue_=0}for(;o--;){var c=n[o];1===c.diffValue_&&(c.diffValue_=0,xt(c,e))}a!==Ze.UP_TO_DATE_&&(e.dependenciesState_=a,e.onBecomeStale_())}(e),function(e){0===e.observing_.length&&(vt.reactionRequiresObservable||e.requiresObservable_)&&console.warn("[mobx] Derivation '"+e.name_+"' is created/updated without reading any observable value.")}(e),mt(a),o}function ct(e){var t=e.observing_;e.observing_=[];for(var n=t.length;n--;)Tt(t[n],e);e.dependenciesState_=Ze.NOT_TRACKING_}function ut(e){var t=dt();try{return e()}finally{pt(t)}}function dt(){var e=vt.trackingDerivation;return vt.trackingDerivation=null,e}function pt(e){vt.trackingDerivation=e}function ht(e){var t=vt.allowStateReads;return vt.allowStateReads=e,t}function mt(e){vt.allowStateReads=e}function gt(e){if(e.dependenciesState_!==Ze.UP_TO_DATE_){e.dependenciesState_=Ze.UP_TO_DATE_;for(var t=e.observing_,n=t.length;n--;)t[n].lowestObserverState_=Ze.UP_TO_DATE_}}var ft=["mobxGuid","spyListeners","enforceActions","computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","allowStateReads","disableErrorBoundaries","runId","UNCHANGED","useProxies"],yt=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},bt=!0,wt=!1,vt=function(){var e=i();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(bt=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new yt).version&&(bt=!1),bt?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new yt):(setTimeout((function(){wt||o(35)}),1),new yt)}();function kt(){return vt}function _t(){var e=new yt;for(var t in e)-1===ft.indexOf(t)&&(vt[t]=e[t]);vt.allowStateChanges=!vt.enforceActions}function xt(e,t){e.observers_.add(t),e.lowestObserverState_>t.dependenciesState_&&(e.lowestObserverState_=t.dependenciesState_)}function Tt(e,t){e.observers_.delete(t),0===e.observers_.size&&At(e)}function At(e){!1===e.isPendingUnobservation_&&(e.isPendingUnobservation_=!0,vt.pendingUnobservations.push(e))}function It(){vt.inBatch++}function St(){if(0==--vt.inBatch){Mt();for(var e=vt.pendingUnobservations,t=0;t<e.length;t++){var n=e[t];n.isPendingUnobservation_=!1,0===n.observers_.size&&(n.isBeingObserved_&&(n.isBeingObserved_=!1,n.onBUO()),n instanceof tt&&n.suspend_())}vt.pendingUnobservations=[]}}function Ct(e){!function(e){!vt.allowStateReads&&vt.observableRequiresReaction&&console.warn("[mobx] Observable '"+e.name_+"' being read outside a reactive context.")}(e);var t=vt.trackingDerivation;return null!==t?(t.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=t.runId_,t.newObserving_[t.unboundDepsCount_++]=e,!e.isBeingObserved_&&vt.trackingContext&&(e.isBeingObserved_=!0,e.onBO())),!0):(0===e.observers_.size&&vt.inBatch>0&&At(e),!1)}function Pt(e){e.lowestObserverState_!==Ze.STALE_&&(e.lowestObserverState_=Ze.STALE_,e.observers_.forEach((function(t){t.dependenciesState_===Ze.UP_TO_DATE_&&(t.isTracing_!==Xe.NONE&&Et(t,e),t.onBecomeStale_()),t.dependenciesState_=Ze.STALE_})))}function Et(e,t){if(console.log("[mobx.trace] '"+e.name_+"' is invalidated due to a change in: '"+t.name_+"'"),e.isTracing_===Xe.BREAK){var n=[];$t(hn(e),n,1),new Function("debugger;\n/*\nTracing '"+e.name_+"'\n\nYou are entering this break point because derivation '"+e.name_+"' is being traced and '"+t.name_+"' is now forcing it to update.\nJust follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update\nThe stackframe you are looking for is at least ~6-8 stack-frames up.\n\n"+(e instanceof tt?e.derivation.toString().replace(/[*]\//g,"/"):"")+"\n\nThe dependencies for this derivation are:\n\n"+n.join("\n")+"\n*/\n    ")()}}function $t(e,t,n){t.length>=1e3?t.push("(and many more)"):(t.push(""+new Array(n).join("\t")+e.name),e.dependencies&&e.dependencies.forEach((function(e){return $t(e,t,n+1)})))}var Ot=function(){function e(e,t,n,a){void 0===e&&(e="Reaction@"+y()),void 0===a&&(a=!1),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=Ze.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=Xe.NONE,this.name_=e,this.onInvalidate_=t,this.errorHandler_=n,this.requiresObservable_=a}var t=e.prototype;return t.onBecomeStale_=function(){this.schedule_()},t.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,vt.pendingReactions.push(this),Mt())},t.isScheduled=function(){return this.isScheduled_},t.runReaction_=function(){if(!this.isDisposed_){It(),this.isScheduled_=!1;var e=vt.trackingContext;if(vt.trackingContext=this,rt(this)){this.isTrackPending_=!0;try{this.onInvalidate_(),this.isTrackPending_&&jt()&&qt({name:this.name_,type:"scheduled-reaction"})}catch(e){this.reportExceptionInDerivation_(e)}}vt.trackingContext=e,St()}},t.track=function(e){if(!this.isDisposed_){It();var t,n=jt();n&&(t=Date.now(),Ut({name:this.name_,type:"reaction"})),this.isRunning_=!0;var a=vt.trackingContext;vt.trackingContext=this;var o=lt(this,e,void 0);vt.trackingContext=a,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&ct(this),ot(o)&&this.reportExceptionInDerivation_(o.cause),n&&Ft({time:Date.now()-t}),St()}},t.reportExceptionInDerivation_=function(e){var t=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(vt.disableErrorBoundaries)throw e;var n="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";vt.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name_+"' suppressed, fix error of causing action below)"):console.error(n,e),jt()&&qt({type:"error",name:this.name_,message:n,error:""+e}),vt.globalReactionErrorHandlers.forEach((function(n){return n(e,t)}))}},t.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(It(),ct(this),St()))},t.getDisposer_=function(){var e=this.dispose.bind(this);return e[z]=this,e},t.toString=function(){return"Reaction["+this.name_+"]"},t.trace=function(e){void 0===e&&(e=!1),Yn(this,e)},e}();function Rt(e){return vt.globalReactionErrorHandlers.push(e),function(){var t=vt.globalReactionErrorHandlers.indexOf(e);t>=0&&vt.globalReactionErrorHandlers.splice(t,1)}}var Nt=function(e){return e()};function Mt(){vt.inBatch>0||vt.isRunningReactions||Nt(Lt)}function Lt(){vt.isRunningReactions=!0;for(var e=vt.pendingReactions,t=0;e.length>0;){100==++t&&(console.error("Reaction doesn't converge to a stable state after 100 iterations. Probably there is a cycle in the reactive function: "+e[0]),e.splice(0));for(var n=e.splice(0),a=0,o=n.length;a<o;a++)n[a].runReaction_()}vt.isRunningReactions=!1}var Dt=S("Reaction",Ot);function jt(){return!!vt.spyListeners.length}function qt(e){if(vt.spyListeners.length)for(var t=vt.spyListeners,n=0,a=t.length;n<a;n++)t[n](e)}function Ut(e){qt(j({},e,{spyReportStart:!0}))}var Bt={type:"report-end",spyReportEnd:!0};function Ft(e){qt(e?j({},e,{type:"report-end",spyReportEnd:!0}):Bt)}function Ht(e){return vt.spyListeners.push(e),b((function(){vt.spyListeners=vt.spyListeners.filter((function(t){return t!==e}))}))}var Gt="action",Wt="autoAction",zt="<unnamed action>",Yt=ne(Gt),Kt=ne("action.bound",{bound:!0}),Vt=ne(Wt,{autoAction:!0}),Jt=ne("autoAction.bound",{autoAction:!0,bound:!0});function Zt(e){return function(t,n){return v(t)?Be(t.name||zt,t,e):v(n)?Be(t,n,e):k(n)?W(t,n,e?Vt:Yt):k(t)?G(ne(e?Wt:Gt,{name:t,autoAction:e})):void o("Invalid arguments for `action`")}}var Qt=Zt(!1);Object.assign(Qt,Yt);var Xt=Zt(!0);function en(e){return Fe(e.name||zt,!1,e,this,void 0)}function tn(e){return v(e)&&!0===e.isMobxAction}function nn(e,t){var n,a;void 0===t&&(t=p),v(e)||o("Autorun expects a function as first argument"),tn(e)&&o("Autorun does not accept actions since actions are untrackable");var r,i=null!=(n=null==(a=t)?void 0:a.name)?n:e.name||"Autorun@"+y();if(t.scheduler||t.delay){var s=on(t),l=!1;r=new Ot(i,(function(){l||(l=!0,s((function(){l=!1,r.isDisposed_||r.track(c)})))}),t.onError,t.requiresObservable)}else r=new Ot(i,(function(){this.track(c)}),t.onError,t.requiresObservable);function c(){e(r)}return r.schedule_(),r.getDisposer_()}Object.assign(Xt,Vt),Qt.bound=G(Kt),Xt.bound=G(Jt);var an=function(e){return e()};function on(e){return e.scheduler?e.scheduler:e.delay?function(t){return setTimeout(t,e.delay)}:an}function rn(e,t,n){var a;void 0===n&&(n=p),v(e)&&v(t)||o("First and second argument to reaction should be functions"),x(n)||o("Third argument of reactions should be an object");var r,i,s,l=null!=(a=n.name)?a:"Reaction@"+y(),c=Qt(l,n.onError?(r=n.onError,i=t,function(){try{return i.apply(this,arguments)}catch(e){r.call(this,e)}}):t),u=!n.scheduler&&!n.delay,d=on(n),h=!0,m=!1,g=void 0,f=n.compareStructural?J.structural:n.equals||J.default,b=new Ot(l,(function(){h||u?w():m||(m=!0,d(w))}),n.onError,n.requiresObservable);function w(){if(m=!1,!b.isDisposed_){var t=!1;b.track((function(){var n=We(!1,(function(){return e(b)}));t=h||!f(s,n),g=s,s=n})),(h&&n.fireImmediately||!h&&t)&&c(s,g,b),h=!1}}return b.schedule_(),b.getDisposer_()}function sn(e,t,n){return cn("onBO",e,t,n)}function ln(e,t,n){return cn("onBUO",e,t,n)}function cn(e,t,n,a){var o="function"==typeof a?Za(t,n):Za(t),r=v(a)?a:n,i=e+"L";return o[i]?o[i].add(r):o[i]=new Set([r]),function(){var e=o[i];e&&(e.delete(r),0===e.size&&delete o[i])}}var un="always";function dn(e){!0===e.isolateGlobalState&&function(){if((vt.pendingReactions.length||vt.inBatch||vt.isRunningReactions)&&o(36),wt=!0,bt){var e=i();0==--e.__mobxInstanceCount&&(e.__mobxGlobals=void 0),vt=new yt}}();var t,n,a=e.useProxies,r=e.enforceActions;if(void 0!==a&&(vt.useProxies=a===un||"never"!==a&&"undefined"!=typeof Proxy),"ifavailable"===a&&(vt.verifyProxies=!0),void 0!==r){var s=r===un?un:"observed"===r;vt.enforceActions=s,vt.allowStateChanges=!0!==s&&s!==un}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach((function(t){t in e&&(vt[t]=!!e[t])})),vt.allowStateReads=!vt.observableRequiresReaction,!0===vt.disableErrorBoundaries&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),e.reactionScheduler&&(t=e.reactionScheduler,n=Nt,Nt=function(e){return t((function(){return n(e)}))})}function pn(e,t,n,a){arguments.length>4&&o("'extendObservable' expected 2-4 arguments"),"object"!=typeof e&&o("'extendObservable' expects an object as first argument"),Ea(e)&&o("'extendObservable' should not be used on maps, use map.merge instead"),x(t)||o("'extendObservabe' only accepts plain objects as second argument"),(On(t)||On(n))&&o("Extending an object with another observable (object) is not supported");var r=M(t),i=Da(e,a)[z];It();try{$(r).forEach((function(e){i.extend_(e,r[e],!n||!(e in n)||n[e])}))}finally{St()}return e}function hn(e,t){return mn(Za(e,t))}function mn(e){var t,n={name:e.name_};return e.observing_&&e.observing_.length>0&&(n.dependencies=(t=e.observing_,Array.from(new Set(t))).map(mn)),n}function gn(e,t){return fn(Za(e,t))}function fn(e){var t,n={name:e.name_};return(t=e).observers_&&t.observers_.size>0&&(n.observers=Array.from(function(e){return e.observers_}(e)).map(fn)),n}var yn=0;function bn(){this.message="FLOW_CANCELLED"}function wn(e){return e instanceof bn}bn.prototype=Object.create(Error.prototype);var vn=ie("flow"),kn=ie("flow.bound",{bound:!0}),_n=Object.assign((function(e,t){if(k(t))return W(e,t,vn);1!==arguments.length&&o("Flow expects single argument with generator function");var n=e,a=n.name||"<unnamed flow>",r=function(){var e,t=this,o=arguments,r=++yn,i=Qt(a+" - runid: "+r+" - init",n).apply(t,o),s=void 0,l=new Promise((function(t,n){var o=0;function l(e){var t;s=void 0;try{t=Qt(a+" - runid: "+r+" - yield "+o++,i.next).call(i,e)}catch(e){return n(e)}u(t)}function c(e){var t;s=void 0;try{t=Qt(a+" - runid: "+r+" - yield "+o++,i.throw).call(i,e)}catch(e){return n(e)}u(t)}function u(e){if(!v(null==e?void 0:e.then))return e.done?t(e.value):(s=Promise.resolve(e.value)).then(l,c);e.then(u,n)}e=n,l(void 0)}));return l.cancel=Qt(a+" - runid: "+r+" - cancel",(function(){try{s&&xn(s);var t=i.return(void 0),n=Promise.resolve(t.value);n.then(w,w),xn(n),e(new bn)}catch(t){e(t)}})),l};return r.isMobXFlow=!0,r}),vn);function xn(e){v(e.cancel)&&e.cancel()}function Tn(e){return e}function An(e){return!0===(null==e?void 0:e.isMobXFlow)}function In(e,t,n){var a;if(Ea(e)||xa(e)||Je(e))a=Qa(e);else{if(!Ua(e))return o("Expected observable map, object or array as first array");if(!k(t))return o("InterceptReads can only be used with a specific property, not with an object in general");a=Qa(e,t)}return void 0!==a.dehancer?o("An intercept reader was already established"):(a.dehancer="function"==typeof t?t:n,function(){a.dehancer=void 0})}function Sn(e,t,n){return v(n)?function(e,t,n){return Qa(e,t).intercept_(n)}(e,t,n):function(e,t){return Qa(e).intercept_(t)}(e,t)}function Cn(e,t){if(void 0!==t){if(!1===Ua(e))return!1;if(!e[z].values_.has(t))return!1;var n=Za(e,t);return nt(n)}return nt(e)}function Pn(e){return arguments.length>1?o("isComputed expects only 1 argument. Use isComputedProp to inspect the observability of a property"):Cn(e)}function En(e,t){return k(t)?Cn(e,t):o("isComputed expected a property name as second argument")}function $n(e,t){return!!e&&(void 0!==t?Ea(e)||xa(e)?o("isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead."):!!Ua(e)&&e[z].values_.has(t):Ua(e)||!!e[z]||K(e)||Dt(e)||nt(e))}function On(e){return 1!==arguments.length&&o("isObservable expects only 1 argument. Use isObservableProp to inspect the observability of a property"),$n(e)}function Rn(e,t){return k(t)?$n(e,t):o("expected a property name as second argument")}function Nn(e){return Ua(e)?e[z].keys_():Ea(e)||Ra(e)?Array.from(e.keys()):xa(e)?e.map((function(e,t){return t})):void o(5)}function Mn(e){return Ua(e)?Nn(e).map((function(t){return e[t]})):Ea(e)?Nn(e).map((function(t){return e.get(t)})):Ra(e)?Array.from(e.values()):xa(e)?e.slice():void o(6)}function Ln(e){return Ua(e)?Nn(e).map((function(t){return[t,e[t]]})):Ea(e)?Nn(e).map((function(t){return[t,e.get(t)]})):Ra(e)?Array.from(e.entries()):xa(e)?e.map((function(e,t){return[t,e]})):void o(7)}function Dn(e,t,n){if(2!==arguments.length||Ra(e))Ua(e)?e[z].set_(t,n):Ea(e)?e.set(t,n):Ra(e)?e.add(t):xa(e)?("number"!=typeof t&&(t=parseInt(t,10)),t<0&&o("Invalid index: '"+t+"'"),It(),t>=e.length&&(e.length=t+1),e[t]=n,St()):o(8);else{It();var a=t;try{for(var r in a)Dn(e,r,a[r])}finally{St()}}}function jn(e,t){Ua(e)?e[z].delete_(t):Ea(e)||Ra(e)?e.delete(t):xa(e)?("number"!=typeof t&&(t=parseInt(t,10)),e.splice(t,1)):o(9)}function qn(e,t){return Ua(e)?e[z].has_(t):Ea(e)||Ra(e)?e.has(t):xa(e)?t>=0&&t<e.length:void o(10)}function Un(e,t){if(qn(e,t))return Ua(e)?e[z].get_(t):Ea(e)?e.get(t):xa(e)?e[t]:void o(11)}function Bn(e,t,n){if(Ua(e))return e[z].defineProperty_(t,n);o(39)}function Fn(e){if(Ua(e))return e[z].ownKeys_();o(38)}function Hn(e,t,n,a){return v(n)?function(e,t,n,a){return Qa(e,t).observe_(n,a)}(e,t,n,a):function(e,t,n){return Qa(e).observe_(t,n)}(e,t,n)}function Gn(e,t,n){return e.set(t,n),n}function Wn(e,t){if(null==e||"object"!=typeof e||e instanceof Date||!On(e))return e;if(Je(e)||nt(e))return Wn(e.get(),t);if(t.has(e))return t.get(e);if(xa(e)){var n=Gn(t,e,new Array(e.length));return e.forEach((function(e,a){n[a]=Wn(e,t)})),n}if(Ra(e)){var a=Gn(t,e,new Set);return e.forEach((function(e){a.add(Wn(e,t))})),a}if(Ea(e)){var o=Gn(t,e,new Map);return e.forEach((function(e,n){o.set(n,Wn(e,t))})),o}var r=Gn(t,e,{});return Fn(e).forEach((function(n){u.propertyIsEnumerable.call(e,n)&&(r[n]=Wn(e[n],t))})),r}function zn(e,t){return t&&o("toJS no longer supports options"),Wn(e,new Map)}function Yn(){for(var e=!1,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];"boolean"==typeof n[n.length-1]&&(e=n.pop());var r=Kn(n);if(!r)return o("'trace(break?)' can only be used inside a tracked computed value or a Reaction. Consider passing in the computed value or reaction explicitly");r.isTracing_===Xe.NONE&&console.log("[mobx.trace] '"+r.name_+"' tracing enabled"),r.isTracing_=e?Xe.BREAK:Xe.LOG}function Kn(e){switch(e.length){case 0:return vt.trackingDerivation;case 1:return Za(e[0]);case 2:return Za(e[0],e[1])}}function Vn(e,t){void 0===t&&(t=void 0),It();try{return e.apply(t)}finally{St()}}function Jn(e,t,n){return 1===arguments.length||t&&"object"==typeof t?Qn(e,t):Zn(e,t,n||{})}function Zn(e,t,n){var a;if("number"==typeof n.timeout){var o=new Error("WHEN_TIMEOUT");a=setTimeout((function(){if(!i[z].isDisposed_){if(i(),!n.onError)throw o;n.onError(o)}}),n.timeout)}n.name=n.name||"When@"+y();var r=Be(n.name+"-effect",t),i=nn((function(t){We(!1,e)&&(t.dispose(),a&&clearTimeout(a),r())}),n);return i}function Qn(e,t){if(t&&t.onError)return o("the options 'onError' and 'promise' cannot be combined");var n,a=new Promise((function(a,o){var r=Zn(e,a,j({},t,{onError:o}));n=function(){r(),o("WHEN_CANCELLED")}}));return a.cancel=n,a}function Xn(e){return e[z]}_n.bound=G(kn);var ea={has:function(e,t){return vt.trackingDerivation&&f("detect new properties using the 'in' operator. Use 'has' from 'mobx' instead."),Xn(e).has_(t)},get:function(e,t){return Xn(e).get_(t)},set:function(e,t,n){var a;return!!k(t)&&(Xn(e).values_.has(t)||f("add a new observable property through direct assignment. Use 'set' from 'mobx' instead."),null==(a=Xn(e).set_(t,n,!0))||a)},deleteProperty:function(e,t){var n;return f("delete properties from an observable object. Use 'remove' from 'mobx' instead."),!!k(t)&&(null==(n=Xn(e).delete_(t,!0))||n)},defineProperty:function(e,t,n){var a;return f("define property on an observable object. Use 'defineProperty' from 'mobx' instead."),null==(a=Xn(e).defineProperty_(t,n))||a},ownKeys:function(e){return vt.trackingDerivation&&f("iterate keys to detect added / removed properties. Use 'keys' from 'mobx' instead."),Xn(e).ownKeys_()},preventExtensions:function(e){o(13)}};function ta(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function na(e,t){var n=e.interceptors_||(e.interceptors_=[]);return n.push(t),b((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function aa(e,t){var n=dt();try{for(var a=[].concat(e.interceptors_||[]),r=0,i=a.length;r<i&&((t=a[r](t))&&!t.type&&o(14),t);r++);return t}finally{pt(n)}}function oa(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function ra(e,t){var n=e.changeListeners_||(e.changeListeners_=[]);return n.push(t),b((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function ia(e,t){var n=dt(),a=e.changeListeners_;if(a){for(var o=0,r=(a=a.slice()).length;o<r;o++)a[o](t);pt(n)}}function sa(e,t,n){var a=Da(e,n)[z];It();try{null!=t||(t=function(e){return N(e,H)||(e[H]||o("No annotations were passed to makeObservable, but no decorated members have been found either"),A(e,H,j({},e[H]))),e[H]}(e)),$(t).forEach((function(e){return a.make_(e,t[e])}))}finally{St()}return e}var la=Symbol("mobx-keys");function ca(e,t,n){if(x(e)||x(Object.getPrototypeOf(e))||o("'makeAutoObservable' can only be used for classes that don't have a superclass"),Ua(e)&&o("makeAutoObservable can only be used on objects not already made observable"),x(e))return pn(e,e,t,n);var a=Da(e,n)[z];if(!e[la]){var r=Object.getPrototypeOf(e),i=new Set([].concat($(e),$(r)));i.delete("constructor"),i.delete(z),A(r,la,i)}It();try{e[la].forEach((function(e){return a.make_(e,!t||!(e in t)||t[e])}))}finally{St()}return e}var ua="splice",da="update",pa={get:function(e,t){var n=e[z];return t===z?n:"length"===t?n.getArrayLength_():"string"!=typeof t||isNaN(t)?N(ga,t)?ga[t]:e[t]:n.get_(parseInt(t))},set:function(e,t,n){var a=e[z];return"length"===t&&a.setArrayLength_(n),"symbol"==typeof t||isNaN(t)?e[t]=n:a.set_(parseInt(t),n),!0},preventExtensions:function(){o(15)}},ha=function(){function e(e,t,n,a){void 0===e&&(e="ObservableArray@"+y()),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=n,this.legacyMode_=a,this.atom_=new Y(e),this.enhancer_=function(n,a){return t(n,a,e+"[..]")}}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},t.intercept_=function(e){return na(this,e)},t.observe_=function(e,t){return void 0===t&&(t=!1),t&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),ra(this,e)},t.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},t.setArrayLength_=function(e){("number"!=typeof e||e<0)&&o("Out of range: "+e);var t=this.values_.length;if(e!==t)if(e>t){for(var n=new Array(e-t),a=0;a<e-t;a++)n[a]=void 0;this.spliceWithArray_(t,0,n)}else this.spliceWithArray_(e,t-e)},t.updateArrayLength_=function(e,t){e!==this.lastKnownLength_&&o(16),this.lastKnownLength_+=t,this.legacyMode_&&t>0&&Va(e+t+1)},t.spliceWithArray_=function(e,t,n){var a=this;st(this.atom_);var o=this.values_.length;if(void 0===e?e=0:e>o?e=o:e<0&&(e=Math.max(0,o+e)),t=1===arguments.length?o-e:null==t?0:Math.max(0,Math.min(t,o-e)),void 0===n&&(n=d),ta(this)){var r=aa(this,{object:this.proxy_,type:ua,index:e,removedCount:t,added:n});if(!r)return d;t=r.removedCount,n=r.added}n=0===n.length?n:n.map((function(e){return a.enhancer_(e,void 0)})),this.legacyMode_;var i=n.length-t;this.updateArrayLength_(o,i);var s=this.spliceItemsIntoValues_(e,t,n);return 0===t&&0===n.length||this.notifyArraySplice_(e,n,s),this.dehanceValues_(s)},t.spliceItemsIntoValues_=function(e,t,n){var a;if(n.length<1e4)return(a=this.values_).splice.apply(a,[e,t].concat(n));var o=this.values_.slice(e,e+t),r=this.values_.slice(e+t);this.values_.length=e+n.length-t;for(var i=0;i<n.length;i++)this.values_[e+i]=n[i];for(var s=0;s<r.length;s++)this.values_[e+n.length+s]=r[s];return o},t.notifyArrayChildUpdate_=function(e,t,n){var a=!this.owned_&&jt(),o=oa(this),r=o||a?{observableKind:"array",object:this.proxy_,type:da,debugObjectName:this.atom_.name_,index:e,newValue:t,oldValue:n}:null;a&&Ut(r),this.atom_.reportChanged(),o&&ia(this,r),a&&Ft()},t.notifyArraySplice_=function(e,t,n){var a=!this.owned_&&jt(),o=oa(this),r=o||a?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:ua,index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;a&&Ut(r),this.atom_.reportChanged(),o&&ia(this,r),a&&Ft()},t.get_=function(e){if(e<this.values_.length)return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},t.set_=function(e,t){var n=this.values_;if(e<n.length){st(this.atom_);var a=n[e];if(ta(this)){var r=aa(this,{type:da,object:this.proxy_,index:e,newValue:t});if(!r)return;t=r.newValue}(t=this.enhancer_(t,a))!==a&&(n[e]=t,this.notifyArrayChildUpdate_(e,t,a))}else e===n.length?this.spliceWithArray_(e,0,[t]):o(17,e,n.length)},e}();function ma(e,t,n,a){void 0===n&&(n="ObservableArray@"+y()),void 0===a&&(a=!1),g();var o=new ha(n,t,a,!1);I(o.values_,z,o);var r=new Proxy(o.values_,pa);if(o.proxy_=r,e&&e.length){var i=ze(!0);o.spliceWithArray_(0,0,e),Ye(i)}return r}var ga={clear:function(){return this.splice(0)},replace:function(e){var t=this[z];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];var r=this[z];switch(arguments.length){case 0:return[];case 1:return r.spliceWithArray_(e);case 2:return r.spliceWithArray_(e,t)}return r.spliceWithArray_(e,t,a)},spliceWithArray:function(e,t,n){return this[z].spliceWithArray_(e,t,n)},push:function(){for(var e=this[z],t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[z].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[z],t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return vt.trackingDerivation&&o(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){vt.trackingDerivation&&o(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[z],n=t.dehanceValues_(t.values_).indexOf(e);return n>-1&&(this.splice(n,1),!0)}};function fa(e,t){"function"==typeof Array.prototype[e]&&(ga[e]=t(e))}function ya(e){return function(){var t=this[z];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_);return n[e].apply(n,arguments)}}function ba(e){return function(t,n){var a=this,o=this[z];return o.atom_.reportObserved(),o.dehanceValues_(o.values_)[e]((function(e,o){return t.call(n,e,o,a)}))}}function wa(e){return function(){var t=this,n=this[z];n.atom_.reportObserved();var a=n.dehanceValues_(n.values_),o=arguments[0];return arguments[0]=function(e,n,a){return o(e,n,a,t)},a[e].apply(a,arguments)}}fa("concat",ya),fa("flat",ya),fa("includes",ya),fa("indexOf",ya),fa("join",ya),fa("lastIndexOf",ya),fa("slice",ya),fa("toString",ya),fa("toLocaleString",ya),fa("every",ba),fa("filter",ba),fa("find",ba),fa("findIndex",ba),fa("flatMap",ba),fa("forEach",ba),fa("map",ba),fa("some",ba),fa("reduce",wa),fa("reduceRight",wa);var va,ka,_a=S("ObservableArrayAdministration",ha);function xa(e){return _(e)&&_a(e[z])}var Ta={},Aa="add",Ia="delete";va=Symbol.iterator,ka=Symbol.toStringTag;var Sa,Ca,Pa=function(){function e(e,t,n){void 0===t&&(t=Z),void 0===n&&(n="ObservableMap@"+y()),this.enhancer_=void 0,this.name_=void 0,this[z]=Ta,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=t,this.name_=n,v(Map)||o(18),this.keysAtom_=V(this.name_+".keys()"),this.data_=new Map,this.hasMap_=new Map,this.merge(e)}var t=e.prototype;return t.has_=function(e){return this.data_.has(e)},t.has=function(e){var t=this;if(!vt.trackingDerivation)return this.has_(e);var n=this.hasMap_.get(e);if(!n){var a=n=new Ve(this.has_(e),Q,this.name_+"."+O(e)+"?",!1);this.hasMap_.set(e,a),ln(a,(function(){return t.hasMap_.delete(e)}))}return n.get()},t.set=function(e,t){var n=this.has_(e);if(ta(this)){var a=aa(this,{type:n?da:Aa,object:this,newValue:t,name:e});if(!a)return this;t=a.newValue}return n?this.updateValue_(e,t):this.addValue_(e,t),this},t.delete=function(e){var t=this;if(st(this.keysAtom_),ta(this)&&!aa(this,{type:Ia,object:this,name:e}))return!1;if(this.has_(e)){var n=jt(),a=oa(this),o=a||n?{observableKind:"map",debugObjectName:this.name_,type:Ia,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return n&&Ut(o),Vn((function(){t.keysAtom_.reportChanged(),t.updateHasMapEntry_(e,!1),t.data_.get(e).setNewValue_(void 0),t.data_.delete(e)})),a&&ia(this,o),n&&Ft(),!0}return!1},t.updateHasMapEntry_=function(e,t){var n=this.hasMap_.get(e);n&&n.setNewValue_(t)},t.updateValue_=function(e,t){var n=this.data_.get(e);if((t=n.prepareNewValue_(t))!==vt.UNCHANGED){var a=jt(),o=oa(this),r=o||a?{observableKind:"map",debugObjectName:this.name_,type:da,object:this,oldValue:n.value_,name:e,newValue:t}:null;a&&Ut(r),n.setNewValue_(t),o&&ia(this,r),a&&Ft()}},t.addValue_=function(e,t){var n=this;st(this.keysAtom_),Vn((function(){var a=new Ve(t,n.enhancer_,n.name_+"."+O(e),!1);n.data_.set(e,a),t=a.value_,n.updateHasMapEntry_(e,!0),n.keysAtom_.reportChanged()}));var a=jt(),o=oa(this),r=o||a?{observableKind:"map",debugObjectName:this.name_,type:Aa,object:this,name:e,newValue:t}:null;a&&Ut(r),o&&ia(this,r),a&&Ft()},t.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},t.values=function(){var e=this,t=this.keys();return oo({next:function(){var n=t.next(),a=n.done,o=n.value;return{done:a,value:a?void 0:e.get(o)}}})},t.entries=function(){var e=this,t=this.keys();return oo({next:function(){var n=t.next(),a=n.done,o=n.value;return{done:a,value:a?void 0:[o,e.get(o)]}}})},t[va]=function(){return this.entries()},t.forEach=function(e,t){for(var n,a=F(this);!(n=a()).done;){var o=n.value,r=o[0],i=o[1];e.call(t,i,r,this)}},t.merge=function(e){var t=this;return Ea(e)&&(e=new Map(e)),Vn((function(){x(e)?function(e){var t=Object.keys(e);if(!E)return t;var n=Object.getOwnPropertySymbols(e);return n.length?[].concat(t,n.filter((function(t){return u.propertyIsEnumerable.call(e,t)}))):t}(e).forEach((function(n){return t.set(n,e[n])})):Array.isArray(e)?e.forEach((function(e){var n=e[0],a=e[1];return t.set(n,a)})):C(e)?(e.constructor!==Map&&o(19,e),e.forEach((function(e,n){return t.set(n,e)}))):null!=e&&o(20,e)})),this},t.clear=function(){var e=this;Vn((function(){ut((function(){for(var t,n=F(e.keys());!(t=n()).done;){var a=t.value;e.delete(a)}}))}))},t.replace=function(e){var t=this;return Vn((function(){for(var n,a=function(e){if(C(e)||Ea(e))return e;if(Array.isArray(e))return new Map(e);if(x(e)){var t=new Map;for(var n in e)t.set(n,e[n]);return t}return o(21,e)}(e),r=new Map,i=!1,s=F(t.data_.keys());!(n=s()).done;){var l=n.value;if(!a.has(l))if(t.delete(l))i=!0;else{var c=t.data_.get(l);r.set(l,c)}}for(var u,d=F(a.entries());!(u=d()).done;){var p=u.value,h=p[0],m=p[1],g=t.data_.has(h);if(t.set(h,m),t.data_.has(h)){var f=t.data_.get(h);r.set(h,f),g||(i=!0)}}if(!i)if(t.data_.size!==r.size)t.keysAtom_.reportChanged();else for(var y=t.data_.keys(),b=r.keys(),w=y.next(),v=b.next();!w.done;){if(w.value!==v.value){t.keysAtom_.reportChanged();break}w=y.next(),v=b.next()}t.data_=r})),this},t.toString=function(){return"[object ObservableMap]"},t.toJSON=function(){return Array.from(this)},t.observe_=function(e,t){return!0===t&&o("`observe` doesn't support fireImmediately=true in combination with maps."),ra(this,e)},t.intercept_=function(e){return na(this,e)},D(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:ka,get:function(){return"Map"}}]),e}(),Ea=S("ObservableMap",Pa),$a={};Sa=Symbol.iterator,Ca=Symbol.toStringTag;var Oa=function(){function e(e,t,n){void 0===t&&(t=Z),void 0===n&&(n="ObservableSet@"+y()),this.name_=void 0,this[z]=$a,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=n,v(Set)||o(22),this.atom_=V(this.name_),this.enhancer_=function(e,a){return t(e,a,n)},e&&this.replace(e)}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.clear=function(){var e=this;Vn((function(){ut((function(){for(var t,n=F(e.data_.values());!(t=n()).done;){var a=t.value;e.delete(a)}}))}))},t.forEach=function(e,t){for(var n,a=F(this);!(n=a()).done;){var o=n.value;e.call(t,o,o,this)}},t.add=function(e){var t=this;if(st(this.atom_),ta(this)&&!aa(this,{type:Aa,object:this,newValue:e}))return this;if(!this.has(e)){Vn((function(){t.data_.add(t.enhancer_(e,void 0)),t.atom_.reportChanged()}));var n=jt(),a=oa(this),o=a||n?{observableKind:"set",debugObjectName:this.name_,type:Aa,object:this,newValue:e}:null;n&&Ut(o),a&&ia(this,o),n&&Ft()}return this},t.delete=function(e){var t=this;if(ta(this)&&!aa(this,{type:Ia,object:this,oldValue:e}))return!1;if(this.has(e)){var n=jt(),a=oa(this),o=a||n?{observableKind:"set",debugObjectName:this.name_,type:Ia,object:this,oldValue:e}:null;return n&&Ut(o),Vn((function(){t.atom_.reportChanged(),t.data_.delete(e)})),a&&ia(this,o),n&&Ft(),!0}return!1},t.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},t.entries=function(){var e=0,t=Array.from(this.keys()),n=Array.from(this.values());return oo({next:function(){var a=e;return e+=1,a<n.length?{value:[t[a],n[a]],done:!1}:{done:!0}}})},t.keys=function(){return this.values()},t.values=function(){this.atom_.reportObserved();var e=this,t=0,n=Array.from(this.data_.values());return oo({next:function(){return t<n.length?{value:e.dehanceValue_(n[t++]),done:!1}:{done:!0}}})},t.replace=function(e){var t=this;return Ra(e)&&(e=new Set(e)),Vn((function(){Array.isArray(e)||P(e)?(t.clear(),e.forEach((function(e){return t.add(e)}))):null!=e&&o("Cannot initialize set from "+e)})),this},t.observe_=function(e,t){return!0===t&&o("`observe` doesn't support fireImmediately=true in combination with sets."),ra(this,e)},t.intercept_=function(e){return na(this,e)},t.toJSON=function(){return Array.from(this)},t.toString=function(){return"[object ObservableSet]"},t[Sa]=function(){return this.values()},D(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Ca,get:function(){return"Set"}}]),e}(),Ra=S("ObservableSet",Oa),Na=Object.create(null),Ma="remove",La=function(){function e(e,t,n,a){void 0===t&&(t=new Map),void 0===a&&(a=fe),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=t,this.name_=n,this.defaultAnnotation_=a,this.keysAtom_=new Y(this.name_+".keys"),this.isPlainObject_=x(this.target_),io(this.defaultAnnotation_)||o("defaultAnnotation must be valid annotation"),this.appliedAnnotations_={}}var t=e.prototype;return t.getObservablePropValue_=function(e){return this.values_.get(e).get()},t.setObservablePropValue_=function(e,t){var n=this.values_.get(e);if(n instanceof tt)return n.set(t),!0;if(ta(this)){var a=aa(this,{type:da,object:this.proxy_||this.target_,name:e,newValue:t});if(!a)return null;t=a.newValue}if((t=n.prepareNewValue_(t))!==vt.UNCHANGED){var o=oa(this),r=jt(),i=o||r?{type:da,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:n.value_,name:e,newValue:t}:null;r&&Ut(i),n.setNewValue_(t),o&&ia(this,i),r&&Ft()}return!0},t.get_=function(e){return vt.trackingDerivation&&!N(this.target_,e)&&this.has_(e),this.target_[e]},t.set_=function(e,t,n){return void 0===n&&(n=!1),N(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,t):n?Reflect.set(this.target_,e,t):(this.target_[e]=t,!0):this.extend_(e,{value:t,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,n)},t.has_=function(e){if(!vt.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var t=this.pendingKeys_.get(e);return t||(t=new Ve(e in this.target_,Q,this.name_+"."+O(e)+"?",!1),this.pendingKeys_.set(e,t)),t.get()},t.make_=function(e,t){if(!0===t&&(t=this.defaultAnnotation_),!1!==t){if(Fa(this,t,e),!(e in this.target_)){var n;if(null==(n=this.target_[H])?void 0:n[e])return;o(1,t.annotationType_,this.name_+"."+e.toString())}for(var a=this.target_;a&&a!==u;){var r=l(a,e);if(r){var i=t.make_(this,e,r,a);if(0===i)return;if(1===i)break}a=Object.getPrototypeOf(a)}Ba(this,t,e)}},t.extend_=function(e,t,n,a){if(void 0===a&&(a=!1),!0===n&&(n=this.defaultAnnotation_),!1===n)return this.defineProperty_(e,t,a);Fa(this,n,e);var o=n.extend_(this,e,t,a);return o&&Ba(this,n,e),o},t.defineProperty_=function(e,t,n){void 0===n&&(n=!1);try{It();var a=this.delete_(e);if(!a)return a;if(ta(this)){var o=aa(this,{object:this.proxy_||this.target_,name:e,type:Aa,newValue:t.value});if(!o)return null;var r=o.newValue;t.value!==r&&(t=j({},t,{value:r}))}if(n){if(!Reflect.defineProperty(this.target_,e,t))return!1}else c(this.target_,e,t);this.notifyPropertyAddition_(e,t.value)}finally{St()}return!0},t.defineObservableProperty_=function(e,t,n,a){void 0===a&&(a=!1);try{It();var o=this.delete_(e);if(!o)return o;if(ta(this)){var r=aa(this,{object:this.proxy_||this.target_,name:e,type:Aa,newValue:t});if(!r)return null;t=r.newValue}var i=qa(e),s={configurable:!vt.safeDescriptors||this.isPlainObject_,enumerable:!0,get:i.get,set:i.set};if(a){if(!Reflect.defineProperty(this.target_,e,s))return!1}else c(this.target_,e,s);var l=new Ve(t,n,this.name_+"."+e.toString(),!1);this.values_.set(e,l),this.notifyPropertyAddition_(e,l.value_)}finally{St()}return!0},t.defineComputedProperty_=function(e,t,n){void 0===n&&(n=!1);try{It();var a=this.delete_(e);if(!a)return a;if(ta(this)&&!aa(this,{object:this.proxy_||this.target_,name:e,type:Aa,newValue:void 0}))return null;t.name||(t.name=this.name_+"."+e.toString()),t.context=this.proxy_||this.target_;var o=qa(e),r={configurable:!vt.safeDescriptors||this.isPlainObject_,enumerable:!1,get:o.get,set:o.set};if(n){if(!Reflect.defineProperty(this.target_,e,r))return!1}else c(this.target_,e,r);this.values_.set(e,new tt(t)),this.notifyPropertyAddition_(e,void 0)}finally{St()}return!0},t.delete_=function(e,t){if(void 0===t&&(t=!1),!N(this.target_,e))return!0;if(ta(this)&&!aa(this,{object:this.proxy_||this.target_,name:e,type:Ma}))return null;try{var n,a;It();var o,r=oa(this),i=jt(),s=this.values_.get(e),c=void 0;if(s||!r&&!i||(c=null==(o=l(this.target_,e))?void 0:o.value),t){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(delete this.appliedAnnotations_[e],s&&(this.values_.delete(e),s instanceof Ve&&(c=s.value_),Pt(s)),this.keysAtom_.reportChanged(),null==(n=this.pendingKeys_)||null==(a=n.get(e))||a.set(e in this.target_),r||i){var u={type:Ma,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:c,name:e};i&&Ut(u),r&&ia(this,u),i&&Ft()}}finally{St()}return!0},t.observe_=function(e,t){return!0===t&&o("`observe` doesn't support the fire immediately property for observable objects."),ra(this,e)},t.intercept_=function(e){return na(this,e)},t.notifyPropertyAddition_=function(e,t){var n,a,o=oa(this),r=jt();if(o||r){var i=o||r?{type:Aa,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:t}:null;r&&Ut(i),o&&ia(this,i),r&&Ft()}null==(n=this.pendingKeys_)||null==(a=n.get(e))||a.set(!0),this.keysAtom_.reportChanged()},t.ownKeys_=function(){return this.keysAtom_.reportObserved(),$(this.target_)},t.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function Da(e,t){var n;if(t&&Ua(e)&&o("Options can't be provided for already observable objects."),N(e,z))return Qa(e)instanceof La||o("Cannot convert '"+Xa(e)+"' into observable object:\nThe target is already observable of different type.\nExtending builtins is not supported."),e;Object.isExtensible(e)||o("Cannot make the designated object observable; it is not extensible");var a=null!=(n=null==t?void 0:t.name)?n:(x(e)?"ObservableObject":e.constructor.name)+"@"+y(),r=new La(e,new Map,String(a),function(e){var t;return e?null!=(t=e.defaultDecorator)?t:ye(e):void 0}(t));return A(e,z,r),e}var ja=S("ObservableObjectAdministration",La);function qa(e){return Na[e]||(Na[e]={get:function(){return this[z].getObservablePropValue_(e)},set:function(t){return this[z].setObservablePropValue_(e,t)}})}function Ua(e){return!!_(e)&&ja(e[z])}function Ba(e,t,n){var a;e.appliedAnnotations_[n]=t,null==(a=e.target_[H])||delete a[n]}function Fa(e,t,n){if(io(t)||o("Cannot annotate '"+e.name_+"."+n.toString()+"': Invalid annotation."),!te(t)&&N(e.appliedAnnotations_,n)){var a=e.name_+"."+n.toString(),r=e.appliedAnnotations_[n].annotationType_;o("Cannot apply '"+t.annotationType_+"' to '"+a+"':\nThe field is already annotated with '"+r+"'.\nRe-annotating fields is not allowed.\nUse 'override' annotation for methods overriden by subclass.")}}var Ha,Ga,Wa=0,za=function(){};Ha=za,Ga=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(Ha.prototype,Ga):void 0!==Ha.prototype.__proto__?Ha.prototype.__proto__=Ga:Ha.prototype=Ga;var Ya=function(e){function t(t,n,a,o){var r;void 0===a&&(a="ObservableArray@"+y()),void 0===o&&(o=!1),r=e.call(this)||this;var i=new ha(a,n,o,!0);if(i.proxy_=U(r),I(U(r),z,i),t&&t.length){var s=ze(!0);r.spliceWithArray(0,0,t),Ye(s)}return r}q(t,e);var n=t.prototype;return n.concat=function(){this[z].atom_.reportObserved();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.prototype.concat.apply(this.slice(),t.map((function(e){return xa(e)?e.slice():e})))},n[Symbol.iterator]=function(){var e=this,t=0;return oo({next:function(){return t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}})},D(t,[{key:"length",get:function(){return this[z].getArrayLength_()},set:function(e){this[z].setArrayLength_(e)}},{key:Symbol.toStringTag,get:function(){return"Array"}}]),t}(za);function Ka(e){c(Ya.prototype,""+e,function(e){return{enumerable:!1,configurable:!0,get:function(){return this[z].get_(e)},set:function(t){this[z].set_(e,t)}}}(e))}function Va(e){if(e>Wa){for(var t=Wa;t<e+100;t++)Ka(t);Wa=e}}function Ja(e,t,n){return new Ya(e,t,n)}function Za(e,t){if("object"==typeof e&&null!==e){if(xa(e))return void 0!==t&&o(23),e[z].atom_;if(Ra(e))return e[z];if(Ea(e)){if(void 0===t)return e.keysAtom_;var n=e.data_.get(t)||e.hasMap_.get(t);return n||o(25,t,Xa(e)),n}if(Ua(e)){if(!t)return o(26);var a=e[z].values_.get(t);return a||o(27,t,Xa(e)),a}if(K(e)||nt(e)||Dt(e))return e}else if(v(e)&&Dt(e[z]))return e[z];o(28)}function Qa(e,t){return e||o(29),void 0!==t?Qa(Za(e,t)):K(e)||nt(e)||Dt(e)||Ea(e)||Ra(e)?e:e[z]?e[z]:void o(24,e)}function Xa(e,t){var n;if(void 0!==t)n=Za(e,t);else{if(tn(e))return e.name;n=Ua(e)||Ea(e)||Ra(e)?Qa(e):Za(e)}return n.name_}Object.entries(ga).forEach((function(e){var t=e[0],n=e[1];"concat"!==t&&A(Ya.prototype,t,n)})),Va(1e3);var eo=u.toString;function to(e,t,n){return void 0===n&&(n=-1),no(e,t,n)}function no(e,t,n,a,o){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var r=typeof e;if(!v(r)&&"object"!==r&&"object"!=typeof t)return!1;var i=eo.call(e);if(i!==eo.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":n>=0&&n++}e=ao(e),t=ao(t);var s="[object Array]"===i;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var l=e.constructor,c=t.constructor;if(l!==c&&!(v(l)&&l instanceof l&&v(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}if(0===n)return!1;n<0&&(n=-1),o=o||[];for(var u=(a=a||[]).length;u--;)if(a[u]===e)return o[u]===t;if(a.push(e),o.push(t),s){if((u=e.length)!==t.length)return!1;for(;u--;)if(!no(e[u],t[u],n-1,a,o))return!1}else{var d,p=Object.keys(e);if(u=p.length,Object.keys(t).length!==u)return!1;for(;u--;)if(!N(t,d=p[u])||!no(e[d],t[d],n-1,a,o))return!1}return a.pop(),o.pop(),!0}function ao(e){return xa(e)?e.slice():C(e)||Ea(e)||P(e)||Ra(e)?Array.from(e.entries()):e}function oo(e){return e[Symbol.iterator]=ro,e}function ro(){return this}function io(e){return e instanceof Object&&"string"==typeof e.annotationType_&&v(e.make_)&&v(e.extend_)}["Symbol","Map","Set"].forEach((function(e){void 0===i()[e]&&o("MobX requires global '"+e+"' to be available or polyfilled")})),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:Ht,extras:{getDebugName:Xa},$mobx:z}),n.$mobx=t})(),a=e=>crypto.getRandomValues(new Uint8Array(e)),n.$nanoid=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let a=63&n[e];t+=a<36?a.toString(36):a<62?(a-26).toString(36).toUpperCase():a<63?"_":"-"}return t},n.$nanoid.customAlphabet=(e,t)=>((e,t,n)=>{let a=(2<<Math.log(e.length-1)/Math.LN2)-1,o=-~(1.6*a*t/e.length);return()=>{let r="";for(;;){let i=n(o),s=o;for(;s--;)if(r+=e[i[s]&a]||"",r.length===t)return r}}})(e,t,a),(()=>{function e(e){return null==e}var t={isNothing:e,isObject:function(e){return"object"==typeof e&&null!==e},toArray:function(t){return Array.isArray(t)?t:e(t)?[]:[t]},repeat:function(e,t){var n,a="";for(n=0;n<t;n+=1)a+=e;return a},isNegativeZero:function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},extend:function(e,t){var n,a,o,r;if(t)for(n=0,a=(r=Object.keys(t)).length;n<a;n+=1)e[o=r[n]]=t[o];return e}};function a(e,t){var n="",a=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+="\n\n"+e.mark.snippet),a+" "+n):a}function o(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=a(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(e){return this.name+": "+a(this,e)};var r=o;function i(e,t,n,a,o){var r="",i="",s=Math.floor(o/2)-1;return a-t>s&&(t=a-s+(r=" ... ").length),n-a>s&&(n=a+s-(i=" ...").length),{str:r+e.slice(t,n).replace(/\t/g,"")+i,pos:a-t+r.length}}function s(e,n){return t.repeat(" ",n-e.length)+e}var l=function(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),"number"!=typeof n.indent&&(n.indent=1),"number"!=typeof n.linesBefore&&(n.linesBefore=3),"number"!=typeof n.linesAfter&&(n.linesAfter=2);for(var a,o=/\r?\n|\r|\0/g,r=[0],l=[],c=-1;a=o.exec(e.buffer);)l.push(a.index),r.push(a.index+a[0].length),e.position<=a.index&&c<0&&(c=r.length-2);c<0&&(c=r.length-1);var u,d,p="",h=Math.min(e.line+n.linesAfter,l.length).toString().length,m=n.maxLength-(n.indent+h+3);for(u=1;u<=n.linesBefore&&!(c-u<0);u++)d=i(e.buffer,r[c-u],l[c-u],e.position-(r[c]-r[c-u]),m),p=t.repeat(" ",n.indent)+s((e.line-u+1).toString(),h)+" | "+d.str+"\n"+p;for(d=i(e.buffer,r[c],l[c],e.position,m),p+=t.repeat(" ",n.indent)+s((e.line+1).toString(),h)+" | "+d.str+"\n",p+=t.repeat("-",n.indent+h+3+d.pos)+"^\n",u=1;u<=n.linesAfter&&!(c+u>=l.length);u++)d=i(e.buffer,r[c+u],l[c+u],e.position-(r[c]-r[c+u]),m),p+=t.repeat(" ",n.indent)+s((e.line+u+1).toString(),h)+" | "+d.str+"\n";return p.replace(/\n$/,"")},c=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],u=["scalar","sequence","mapping"],d=function(e,t){var n,a;if(t=t||{},Object.keys(t).forEach((function(t){if(-1===c.indexOf(t))throw new r('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=(n=t.styleAliases||null,a={},null!==n&&Object.keys(n).forEach((function(e){n[e].forEach((function(t){a[String(t)]=e}))})),a),-1===u.indexOf(this.kind))throw new r('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')};function p(e,t){var n=[];return e[t].forEach((function(e){var t=n.length;n.forEach((function(n,a){n.tag===e.tag&&n.kind===e.kind&&n.multi===e.multi&&(t=a)})),n[t]=e})),n}function h(e){return this.extend(e)}h.prototype.extend=function(e){var t=[],n=[];if(e instanceof d)n.push(e);else if(Array.isArray(e))n=n.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new r("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit))}t.forEach((function(e){if(!(e instanceof d))throw new r("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new r("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new r("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(e){if(!(e instanceof d))throw new r("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var a=Object.create(h.prototype);return a.implicit=(this.implicit||[]).concat(t),a.explicit=(this.explicit||[]).concat(n),a.compiledImplicit=p(a,"implicit"),a.compiledExplicit=p(a,"explicit"),a.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function a(e){e.multi?(n.multi[e.kind].push(e),n.multi.fallback.push(e)):n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(a);return n}(a.compiledImplicit,a.compiledExplicit),a};var m=h,g=new d("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),f=new d("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),y=new d("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}}),b=new m({explicit:[g,f,y]}),w=new d("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"}),v=new d("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function k(e){return 48<=e&&e<=55}function _(e){return 48<=e&&e<=57}var x=new d("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,a=e.length,o=0,r=!1;if(!a)return!1;if("-"!==(t=e[o])&&"+"!==t||(t=e[++o]),"0"===t){if(o+1===a)return!0;if("b"===(t=e[++o])){for(o++;o<a;o++)if("_"!==(t=e[o])){if("0"!==t&&"1"!==t)return!1;r=!0}return r&&"_"!==t}if("x"===t){for(o++;o<a;o++)if("_"!==(t=e[o])){if(!(48<=(n=e.charCodeAt(o))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;r=!0}return r&&"_"!==t}if("o"===t){for(o++;o<a;o++)if("_"!==(t=e[o])){if(!k(e.charCodeAt(o)))return!1;r=!0}return r&&"_"!==t}}if("_"===t)return!1;for(;o<a;o++)if("_"!==(t=e[o])){if(!_(e.charCodeAt(o)))return!1;r=!0}return!(!r||"_"===t)},construct:function(e){var t,n=e,a=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(t=n[0])&&"+"!==t||("-"===t&&(a=-1),t=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===t){if("b"===n[1])return a*parseInt(n.slice(2),2);if("x"===n[1])return a*parseInt(n.slice(2),16);if("o"===n[1])return a*parseInt(n.slice(2),8)}return a*parseInt(n,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!t.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),T=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),A=/^[-+]?[0-9]+e/,I=new d("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!T.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||t.isNegativeZero(e))},represent:function(e,n){var a;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(t.isNegativeZero(e))return"-0.0";return a=e.toString(10),A.test(a)?a.replace("e",".e"):a},defaultStyle:"lowercase"}),S=b.extend({implicit:[w,v,x,I]}),C=S,P=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),E=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$"),$=new d("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==P.exec(e)||null!==E.exec(e))},construct:function(e){var t,n,a,o,r,i,s,l,c=0,u=null;if(null===(t=P.exec(e))&&(t=E.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],a=+t[2]-1,o=+t[3],!t[4])return new Date(Date.UTC(n,a,o));if(r=+t[4],i=+t[5],s=+t[6],t[7]){for(c=t[7].slice(0,3);c.length<3;)c+="0";c=+c}return t[9]&&(u=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(u=-u)),l=new Date(Date.UTC(n,a,o,r,i,s,c)),u&&l.setTime(l.getTime()-u),l},instanceOf:Date,represent:function(e){return e.toISOString()}}),O=new d("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}}),R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r",N=new d("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,a=0,o=e.length,r=R;for(n=0;n<o;n++)if(!((t=r.indexOf(e.charAt(n)))>64)){if(t<0)return!1;a+=6}return a%8==0},construct:function(e){var t,n,a=e.replace(/[\r\n=]/g,""),o=a.length,r=R,i=0,s=[];for(t=0;t<o;t++)t%4==0&&t&&(s.push(i>>16&255),s.push(i>>8&255),s.push(255&i)),i=i<<6|r.indexOf(a.charAt(t));return 0==(n=o%4*6)?(s.push(i>>16&255),s.push(i>>8&255),s.push(255&i)):18===n?(s.push(i>>10&255),s.push(i>>2&255)):12===n&&s.push(i>>4&255),new Uint8Array(s)},predicate:function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},represent:function(e){var t,n,a="",o=0,r=e.length,i=R;for(t=0;t<r;t++)t%3==0&&t&&(a+=i[o>>18&63],a+=i[o>>12&63],a+=i[o>>6&63],a+=i[63&o]),o=(o<<8)+e[t];return 0==(n=r%3)?(a+=i[o>>18&63],a+=i[o>>12&63],a+=i[o>>6&63],a+=i[63&o]):2===n?(a+=i[o>>10&63],a+=i[o>>4&63],a+=i[o<<2&63],a+=i[64]):1===n&&(a+=i[o>>2&63],a+=i[o<<4&63],a+=i[64],a+=i[64]),a}}),M=Object.prototype.hasOwnProperty,L=Object.prototype.toString,D=new d("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,a,o,r,i=[],s=e;for(t=0,n=s.length;t<n;t+=1){if(a=s[t],r=!1,"[object Object]"!==L.call(a))return!1;for(o in a)if(M.call(a,o)){if(r)return!1;r=!0}if(!r)return!1;if(-1!==i.indexOf(o))return!1;i.push(o)}return!0},construct:function(e){return null!==e?e:[]}}),j=Object.prototype.toString,q=new d("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,a,o,r,i=e;for(r=new Array(i.length),t=0,n=i.length;t<n;t+=1){if(a=i[t],"[object Object]"!==j.call(a))return!1;if(1!==(o=Object.keys(a)).length)return!1;r[t]=[o[0],a[o[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,a,o,r,i=e;for(r=new Array(i.length),t=0,n=i.length;t<n;t+=1)a=i[t],o=Object.keys(a),r[t]=[o[0],a[o[0]]];return r}}),U=Object.prototype.hasOwnProperty,B=new d("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(U.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}}),F=C.extend({implicit:[$,O],explicit:[N,D,q,B]}),H=Object.prototype.hasOwnProperty,G=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,W=/[\x85\u2028\u2029]/,z=/[,\[\]\{\}]/,Y=/^(?:!|!!|![a-z\-]+!)$/i,K=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function V(e){return Object.prototype.toString.call(e)}function J(e){return 10===e||13===e}function Z(e){return 9===e||32===e}function Q(e){return 9===e||32===e||10===e||13===e}function X(e){return 44===e||91===e||93===e||123===e||125===e}function ee(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function te(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?"":76===e?"\u2028":80===e?"\u2029":""}function ne(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var ae=new Array(256),oe=new Array(256),re=0;re<256;re++)ae[re]=te(re)?1:0,oe[re]=te(re);function ie(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||F,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function se(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=l(n),new r(t,n)}function le(e,t){throw se(e,t)}function ce(e,t){e.onWarning&&e.onWarning.call(null,se(e,t))}var ue={YAML:function(e,t,n){var a,o,r;null!==e.version&&le(e,"duplication of %YAML directive"),1!==n.length&&le(e,"YAML directive accepts exactly one argument"),null===(a=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&le(e,"ill-formed argument of the YAML directive"),o=parseInt(a[1],10),r=parseInt(a[2],10),1!==o&&le(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=r<2,1!==r&&2!==r&&ce(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var a,o;2!==n.length&&le(e,"TAG directive accepts exactly two arguments"),a=n[0],o=n[1],Y.test(a)||le(e,"ill-formed tag handle (first argument) of the TAG directive"),H.call(e.tagMap,a)&&le(e,'there is a previously declared suffix for "'+a+'" tag handle'),K.test(o)||le(e,"ill-formed tag prefix (second argument) of the TAG directive");try{o=decodeURIComponent(o)}catch(t){le(e,"tag prefix is malformed: "+o)}e.tagMap[a]=o}};function de(e,t,n,a){var o,r,i,s;if(t<n){if(s=e.input.slice(t,n),a)for(o=0,r=s.length;o<r;o+=1)9===(i=s.charCodeAt(o))||32<=i&&i<=1114111||le(e,"expected valid JSON character");else G.test(s)&&le(e,"the stream contains non-printable characters");e.result+=s}}function pe(e,n,a,o){var r,i,s,l;for(t.isObject(a)||le(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,l=(r=Object.keys(a)).length;s<l;s+=1)i=r[s],H.call(n,i)||(n[i]=a[i],o[i]=!0)}function he(e,t,n,a,o,r,i,s,l){var c,u;if(Array.isArray(o))for(c=0,u=(o=Array.prototype.slice.call(o)).length;c<u;c+=1)Array.isArray(o[c])&&le(e,"nested arrays are not supported inside keys"),"object"==typeof o&&"[object Object]"===V(o[c])&&(o[c]="[object Object]");if("object"==typeof o&&"[object Object]"===V(o)&&(o="[object Object]"),o=String(o),null===t&&(t={}),"tag:yaml.org,2002:merge"===a)if(Array.isArray(r))for(c=0,u=r.length;c<u;c+=1)pe(e,t,r[c],n);else pe(e,t,r,n);else e.json||H.call(n,o)||!H.call(t,o)||(e.line=i||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,le(e,"duplicated mapping key")),"__proto__"===o?Object.defineProperty(t,o,{configurable:!0,enumerable:!0,writable:!0,value:r}):t[o]=r,delete n[o];return t}function me(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):le(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function ge(e,t,n){for(var a=0,o=e.input.charCodeAt(e.position);0!==o;){for(;Z(o);)9===o&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),o=e.input.charCodeAt(++e.position);if(t&&35===o)do{o=e.input.charCodeAt(++e.position)}while(10!==o&&13!==o&&0!==o);if(!J(o))break;for(me(e),o=e.input.charCodeAt(e.position),a++,e.lineIndent=0;32===o;)e.lineIndent++,o=e.input.charCodeAt(++e.position)}return-1!==n&&0!==a&&e.lineIndent<n&&ce(e,"deficient indentation"),a}function fe(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!Q(t)))}function ye(e,n){1===n?e.result+=" ":n>1&&(e.result+=t.repeat("\n",n-1))}function be(e,t){var n,a,o=e.tag,r=e.anchor,i=[],s=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=i),a=e.input.charCodeAt(e.position);0!==a&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,le(e,"tab characters must not be used in indentation")),45===a)&&Q(e.input.charCodeAt(e.position+1));)if(s=!0,e.position++,ge(e,!0,-1)&&e.lineIndent<=t)i.push(null),a=e.input.charCodeAt(e.position);else if(n=e.line,ke(e,t,3,!1,!0),i.push(e.result),ge(e,!0,-1),a=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==a)le(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!s&&(e.tag=o,e.anchor=r,e.kind="sequence",e.result=i,!0)}function we(e){var t,n,a,o,r=!1,i=!1;if(33!==(o=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&le(e,"duplication of a tag property"),60===(o=e.input.charCodeAt(++e.position))?(r=!0,o=e.input.charCodeAt(++e.position)):33===o?(i=!0,n="!!",o=e.input.charCodeAt(++e.position)):n="!",t=e.position,r){do{o=e.input.charCodeAt(++e.position)}while(0!==o&&62!==o);e.position<e.length?(a=e.input.slice(t,e.position),o=e.input.charCodeAt(++e.position)):le(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==o&&!Q(o);)33===o&&(i?le(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),Y.test(n)||le(e,"named tag handle cannot contain such characters"),i=!0,t=e.position+1)),o=e.input.charCodeAt(++e.position);a=e.input.slice(t,e.position),z.test(a)&&le(e,"tag suffix cannot contain flow indicator characters")}a&&!K.test(a)&&le(e,"tag name cannot contain such characters: "+a);try{a=decodeURIComponent(a)}catch(t){le(e,"tag name is malformed: "+a)}return r?e.tag=a:H.call(e.tagMap,n)?e.tag=e.tagMap[n]+a:"!"===n?e.tag="!"+a:"!!"===n?e.tag="tag:yaml.org,2002:"+a:le(e,'undeclared tag handle "'+n+'"'),!0}function ve(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&le(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!Q(n)&&!X(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&le(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function ke(e,n,a,o,r){var i,s,l,c,u,d,p,h,m,g=1,f=!1,y=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,i=s=l=4===a||3===a,o&&ge(e,!0,-1)&&(f=!0,e.lineIndent>n?g=1:e.lineIndent===n?g=0:e.lineIndent<n&&(g=-1)),1===g)for(;we(e)||ve(e);)ge(e,!0,-1)?(f=!0,l=i,e.lineIndent>n?g=1:e.lineIndent===n?g=0:e.lineIndent<n&&(g=-1)):l=!1;if(l&&(l=f||r),1!==g&&4!==a||(h=1===a||2===a?n:n+1,m=e.position-e.lineStart,1===g?l&&(be(e,m)||function(e,t,n){var a,o,r,i,s,l,c,u=e.tag,d=e.anchor,p={},h=Object.create(null),m=null,g=null,f=null,y=!1,b=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=p),c=e.input.charCodeAt(e.position);0!==c;){if(y||-1===e.firstTabInLine||(e.position=e.firstTabInLine,le(e,"tab characters must not be used in indentation")),a=e.input.charCodeAt(e.position+1),r=e.line,63!==c&&58!==c||!Q(a)){if(i=e.line,s=e.lineStart,l=e.position,!ke(e,n,2,!1,!0))break;if(e.line===r){for(c=e.input.charCodeAt(e.position);Z(c);)c=e.input.charCodeAt(++e.position);if(58===c)Q(c=e.input.charCodeAt(++e.position))||le(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(he(e,p,h,m,g,null,i,s,l),m=g=f=null),b=!0,y=!1,o=!1,m=e.tag,g=e.result;else{if(!b)return e.tag=u,e.anchor=d,!0;le(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!b)return e.tag=u,e.anchor=d,!0;le(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===c?(y&&(he(e,p,h,m,g,null,i,s,l),m=g=f=null),b=!0,y=!0,o=!0):y?(y=!1,o=!0):le(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,c=a;if((e.line===r||e.lineIndent>t)&&(y&&(i=e.line,s=e.lineStart,l=e.position),ke(e,t,4,!0,o)&&(y?g=e.result:f=e.result),y||(he(e,p,h,m,g,f,i,s,l),m=g=f=null),ge(e,!0,-1),c=e.input.charCodeAt(e.position)),(e.line===r||e.lineIndent>t)&&0!==c)le(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return y&&he(e,p,h,m,g,null,i,s,l),b&&(e.tag=u,e.anchor=d,e.kind="mapping",e.result=p),b}(e,m,h))||function(e,t){var n,a,o,r,i,s,l,c,u,d,p,h,m=!0,g=e.tag,f=e.anchor,y=Object.create(null);if(91===(h=e.input.charCodeAt(e.position)))i=93,c=!1,r=[];else{if(123!==h)return!1;i=125,c=!0,r={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=r),h=e.input.charCodeAt(++e.position);0!==h;){if(ge(e,!0,t),(h=e.input.charCodeAt(e.position))===i)return e.position++,e.tag=g,e.anchor=f,e.kind=c?"mapping":"sequence",e.result=r,!0;m?44===h&&le(e,"expected the node content, but found ','"):le(e,"missed comma between flow collection entries"),p=null,s=l=!1,63===h&&Q(e.input.charCodeAt(e.position+1))&&(s=l=!0,e.position++,ge(e,!0,t)),n=e.line,a=e.lineStart,o=e.position,ke(e,t,1,!1,!0),d=e.tag,u=e.result,ge(e,!0,t),h=e.input.charCodeAt(e.position),!l&&e.line!==n||58!==h||(s=!0,h=e.input.charCodeAt(++e.position),ge(e,!0,t),ke(e,t,1,!1,!0),p=e.result),c?he(e,r,y,d,u,p,n,a,o):s?r.push(he(e,null,y,d,u,p,n,a,o)):r.push(u),ge(e,!0,t),44===(h=e.input.charCodeAt(e.position))?(m=!0,h=e.input.charCodeAt(++e.position)):m=!1}le(e,"unexpected end of the stream within a flow collection")}(e,h)?y=!0:(s&&function(e,n){var a,o,r,i,s,l=1,c=!1,u=!1,d=n,p=0,h=!1;if(124===(i=e.input.charCodeAt(e.position)))o=!1;else{if(62!==i)return!1;o=!0}for(e.kind="scalar",e.result="";0!==i;)if(43===(i=e.input.charCodeAt(++e.position))||45===i)1===l?l=43===i?3:2:le(e,"repeat of a chomping mode identifier");else{if(!((r=48<=(s=i)&&s<=57?s-48:-1)>=0))break;0===r?le(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?le(e,"repeat of an indentation width identifier"):(d=n+r-1,u=!0)}if(Z(i)){do{i=e.input.charCodeAt(++e.position)}while(Z(i));if(35===i)do{i=e.input.charCodeAt(++e.position)}while(!J(i)&&0!==i)}for(;0!==i;){for(me(e),e.lineIndent=0,i=e.input.charCodeAt(e.position);(!u||e.lineIndent<d)&&32===i;)e.lineIndent++,i=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>d&&(d=e.lineIndent),J(i))p++;else{if(e.lineIndent<d){3===l?e.result+=t.repeat("\n",c?1+p:p):1===l&&c&&(e.result+="\n");break}for(o?Z(i)?(h=!0,e.result+=t.repeat("\n",c?1+p:p)):h?(h=!1,e.result+=t.repeat("\n",p+1)):0===p?c&&(e.result+=" "):e.result+=t.repeat("\n",p):e.result+=t.repeat("\n",c?1+p:p),c=!0,u=!0,p=0,a=e.position;!J(i)&&0!==i;)i=e.input.charCodeAt(++e.position);de(e,a,e.position,!1)}}return!0}(e,h)||function(e,t){var n,a,o;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,a=o=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(de(e,a,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;a=e.position,e.position++,o=e.position}else J(n)?(de(e,a,o,!0),ye(e,ge(e,!1,t)),a=o=e.position):e.position===e.lineStart&&fe(e)?le(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);le(e,"unexpected end of the stream within a single quoted scalar")}(e,h)||function(e,t){var n,a,o,r,i,s,l;if(34!==(s=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=a=e.position;0!==(s=e.input.charCodeAt(e.position));){if(34===s)return de(e,n,e.position,!0),e.position++,!0;if(92===s){if(de(e,n,e.position,!0),J(s=e.input.charCodeAt(++e.position)))ge(e,!1,t);else if(s<256&&ae[s])e.result+=oe[s],e.position++;else if((i=120===(l=s)?2:117===l?4:85===l?8:0)>0){for(o=i,r=0;o>0;o--)(i=ee(s=e.input.charCodeAt(++e.position)))>=0?r=(r<<4)+i:le(e,"expected hexadecimal character");e.result+=ne(r),e.position++}else le(e,"unknown escape sequence");n=a=e.position}else J(s)?(de(e,n,a,!0),ye(e,ge(e,!1,t)),n=a=e.position):e.position===e.lineStart&&fe(e)?le(e,"unexpected end of the document within a double quoted scalar"):(e.position++,a=e.position)}le(e,"unexpected end of the stream within a double quoted scalar")}(e,h)?y=!0:function(e){var t,n,a;if(42!==(a=e.input.charCodeAt(e.position)))return!1;for(a=e.input.charCodeAt(++e.position),t=e.position;0!==a&&!Q(a)&&!X(a);)a=e.input.charCodeAt(++e.position);return e.position===t&&le(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),H.call(e.anchorMap,n)||le(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],ge(e,!0,-1),!0}(e)?(y=!0,null===e.tag&&null===e.anchor||le(e,"alias node should not have any properties")):function(e,t,n){var a,o,r,i,s,l,c,u,d=e.kind,p=e.result;if(Q(u=e.input.charCodeAt(e.position))||X(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(Q(a=e.input.charCodeAt(e.position+1))||n&&X(a)))return!1;for(e.kind="scalar",e.result="",o=r=e.position,i=!1;0!==u;){if(58===u){if(Q(a=e.input.charCodeAt(e.position+1))||n&&X(a))break}else if(35===u){if(Q(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&fe(e)||n&&X(u))break;if(J(u)){if(s=e.line,l=e.lineStart,c=e.lineIndent,ge(e,!1,-1),e.lineIndent>=t){i=!0,u=e.input.charCodeAt(e.position);continue}e.position=r,e.line=s,e.lineStart=l,e.lineIndent=c;break}}i&&(de(e,o,r,!1),ye(e,e.line-s),o=r=e.position,i=!1),Z(u)||(r=e.position+1),u=e.input.charCodeAt(++e.position)}return de(e,o,r,!1),!!e.result||(e.kind=d,e.result=p,!1)}(e,h,1===a)&&(y=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===g&&(y=l&&be(e,m))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&le(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),c=0,u=e.implicitTypes.length;c<u;c+=1)if((p=e.implicitTypes[c]).resolve(e.result)){e.result=p.construct(e.result),e.tag=p.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(H.call(e.typeMap[e.kind||"fallback"],e.tag))p=e.typeMap[e.kind||"fallback"][e.tag];else for(p=null,c=0,u=(d=e.typeMap.multi[e.kind||"fallback"]).length;c<u;c+=1)if(e.tag.slice(0,d[c].tag.length)===d[c].tag){p=d[c];break}p||le(e,"unknown tag !<"+e.tag+">"),null!==e.result&&p.kind!==e.kind&&le(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+p.kind+'", not "'+e.kind+'"'),p.resolve(e.result,e.tag)?(e.result=p.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):le(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||y}function _e(e){var t,n,a,o,r=e.position,i=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(o=e.input.charCodeAt(e.position))&&(ge(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==o));){for(i=!0,o=e.input.charCodeAt(++e.position),t=e.position;0!==o&&!Q(o);)o=e.input.charCodeAt(++e.position);for(a=[],(n=e.input.slice(t,e.position)).length<1&&le(e,"directive name must not be less than one character in length");0!==o;){for(;Z(o);)o=e.input.charCodeAt(++e.position);if(35===o){do{o=e.input.charCodeAt(++e.position)}while(0!==o&&!J(o));break}if(J(o))break;for(t=e.position;0!==o&&!Q(o);)o=e.input.charCodeAt(++e.position);a.push(e.input.slice(t,e.position))}0!==o&&me(e),H.call(ue,n)?ue[n](e,n,a):ce(e,'unknown document directive "'+n+'"')}ge(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,ge(e,!0,-1)):i&&le(e,"directives end mark is expected"),ke(e,e.lineIndent-1,4,!1,!0),ge(e,!0,-1),e.checkLineBreaks&&W.test(e.input.slice(r,e.position))&&ce(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&fe(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,ge(e,!0,-1)):e.position<e.length-1&&le(e,"end of the stream or a document separator is expected")}function xe(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new ie(e,t),a=e.indexOf("\0");for(-1!==a&&(n.position=a,le(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)_e(n);return n.documents}var Te={loadAll:function(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var a=xe(e,n);if("function"!=typeof t)return a;for(var o=0,r=a.length;o<r;o+=1)t(a[o])},load:function(e,t){var n=xe(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new r("expected a single document in the stream, but found more")}}},Ae=Object.prototype.toString,Ie=Object.prototype.hasOwnProperty,Se=65279,Ce={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},Pe=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ee=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function $e(e){var n,a,o;if(n=e.toString(16).toUpperCase(),e<=255)a="x",o=2;else if(e<=65535)a="u",o=4;else{if(!(e<=4294967295))throw new r("code point within a string may not be greater than 0xFFFFFFFF");a="U",o=8}return"\\"+a+t.repeat("0",o-n.length)+n}function Oe(e){this.schema=e.schema||F,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=t.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,a,o,r,i,s,l;if(null===t)return{};for(n={},o=0,r=(a=Object.keys(t)).length;o<r;o+=1)i=a[o],s=String(t[i]),"!!"===i.slice(0,2)&&(i="tag:yaml.org,2002:"+i.slice(2)),(l=e.compiledTypeMap.fallback[i])&&Ie.call(l.styleAliases,s)&&(s=l.styleAliases[s]),n[i]=s;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?2:1,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Re(e,n){for(var a,o=t.repeat(" ",n),r=0,i=-1,s="",l=e.length;r<l;)-1===(i=e.indexOf("\n",r))?(a=e.slice(r),r=l):(a=e.slice(r,i+1),r=i+1),a.length&&"\n"!==a&&(s+=o),s+=a;return s}function Ne(e,n){return"\n"+t.repeat(" ",e.indent*n)}function Me(e){return 32===e||9===e}function Le(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==Se||65536<=e&&e<=1114111}function De(e){return Le(e)&&e!==Se&&13!==e&&10!==e}function je(e,t,n){var a=De(e),o=a&&!Me(e);return(n?a:a&&44!==e&&91!==e&&93!==e&&123!==e&&125!==e)&&35!==e&&!(58===t&&!o)||De(t)&&!Me(t)&&35===e||58===t&&o}function qe(e,t){var n,a=e.charCodeAt(t);return a>=55296&&a<=56319&&t+1<e.length&&(n=e.charCodeAt(t+1))>=56320&&n<=57343?1024*(a-55296)+n-56320+65536:a}function Ue(e){return/^\n* /.test(e)}function Be(e,t,n,a,o,r,i,s){var l,c,u=0,d=null,p=!1,h=!1,m=-1!==a,g=-1,f=Le(c=qe(e,0))&&c!==Se&&!Me(c)&&45!==c&&63!==c&&58!==c&&44!==c&&91!==c&&93!==c&&123!==c&&125!==c&&35!==c&&38!==c&&42!==c&&33!==c&&124!==c&&61!==c&&62!==c&&39!==c&&34!==c&&37!==c&&64!==c&&96!==c&&function(e){return!Me(e)&&58!==e}(qe(e,e.length-1));if(t||i)for(l=0;l<e.length;u>=65536?l+=2:l++){if(!Le(u=qe(e,l)))return 5;f=f&&je(u,d,s),d=u}else{for(l=0;l<e.length;u>=65536?l+=2:l++){if(10===(u=qe(e,l)))p=!0,m&&(h=h||l-g-1>a&&" "!==e[g+1],g=l);else if(!Le(u))return 5;f=f&&je(u,d,s),d=u}h=h||m&&l-g-1>a&&" "!==e[g+1]}return p||h?n>9&&Ue(e)?5:i?2===r?5:2:h?4:3:!f||i||o(e)?2===r?5:2:1}function Fe(e,t,n,a,o){e.dump=function(){if(0===t.length)return 2===e.quotingType?'""':"''";if(!e.noCompatMode&&(-1!==Pe.indexOf(t)||Ee.test(t)))return 2===e.quotingType?'"'+t+'"':"'"+t+"'";var i=e.indent*Math.max(1,n),s=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-i),l=a||e.flowLevel>-1&&n>=e.flowLevel;switch(Be(t,l,e.indent,s,(function(t){return function(e,t){var n,a;for(n=0,a=e.implicitTypes.length;n<a;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)}),e.quotingType,e.forceQuotes&&!a,o)){case 1:return t;case 2:return"'"+t.replace(/'/g,"''")+"'";case 3:return"|"+He(t,e.indent)+Ge(Re(t,i));case 4:return">"+He(t,e.indent)+Ge(Re(function(e,t){for(var n,a,o,r=/(\n+)([^\n]*)/g,i=(o=-1!==(o=e.indexOf("\n"))?o:e.length,r.lastIndex=o,We(e.slice(0,o),t)),s="\n"===e[0]||" "===e[0];a=r.exec(e);){var l=a[1],c=a[2];n=" "===c[0],i+=l+(s||n||""===c?"":"\n")+We(c,t),s=n}return i}(t,s),i));case 5:return'"'+function(e){for(var t,n="",a=0,o=0;o<e.length;a>=65536?o+=2:o++)a=qe(e,o),!(t=Ce[a])&&Le(a)?(n+=e[o],a>=65536&&(n+=e[o+1])):n+=t||$e(a);return n}(t)+'"';default:throw new r("impossible error: invalid scalar style")}}()}function He(e,t){var n=Ue(e)?String(t):"",a="\n"===e[e.length-1];return n+(!a||"\n"!==e[e.length-2]&&"\n"!==e?a?"":"-":"+")+"\n"}function Ge(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function We(e,t){if(""===e||" "===e[0])return e;for(var n,a,o=/ [^ ]/g,r=0,i=0,s=0,l="";n=o.exec(e);)(s=n.index)-r>t&&(a=i>r?i:s,l+="\n"+e.slice(r,a),r=a+1),i=s;return l+="\n",e.length-r>t&&i>r?l+=e.slice(r,i)+"\n"+e.slice(i+1):l+=e.slice(r),l.slice(1)}function ze(e,t,n,a){var o,r,i,s="",l=e.tag;for(o=0,r=n.length;o<r;o+=1)i=n[o],e.replacer&&(i=e.replacer.call(n,String(o),i)),(Ke(e,t+1,i,!0,!0,!1,!0)||void 0===i&&Ke(e,t+1,null,!0,!0,!1,!0))&&(a&&""===s||(s+=Ne(e,t)),e.dump&&10===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=l,e.dump=s||"[]"}function Ye(e,t,n){var a,o,i,s,l,c;for(i=0,s=(o=n?e.explicitTypes:e.implicitTypes).length;i<s;i+=1)if(((l=o[i]).instanceOf||l.predicate)&&(!l.instanceOf||"object"==typeof t&&t instanceof l.instanceOf)&&(!l.predicate||l.predicate(t))){if(n?l.multi&&l.representName?e.tag=l.representName(t):e.tag=l.tag:e.tag="?",l.represent){if(c=e.styleMap[l.tag]||l.defaultStyle,"[object Function]"===Ae.call(l.represent))a=l.represent(t,c);else{if(!Ie.call(l.represent,c))throw new r("!<"+l.tag+'> tag resolver accepts not "'+c+'" style');a=l.represent[c](t,c)}e.dump=a}return!0}return!1}function Ke(e,t,n,a,o,i,s){e.tag=null,e.dump=n,Ye(e,n,!1)||Ye(e,n,!0);var l,c=Ae.call(e.dump),u=a;a&&(a=e.flowLevel<0||e.flowLevel>t);var d,p,h="[object Object]"===c||"[object Array]"===c;if(h&&(p=-1!==(d=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||p||2!==e.indent&&t>0)&&(o=!1),p&&e.usedDuplicates[d])e.dump="*ref_"+d;else{if(h&&p&&!e.usedDuplicates[d]&&(e.usedDuplicates[d]=!0),"[object Object]"===c)a&&0!==Object.keys(e.dump).length?(function(e,t,n,a){var o,i,s,l,c,u,d="",p=e.tag,h=Object.keys(n);if(!0===e.sortKeys)h.sort();else if("function"==typeof e.sortKeys)h.sort(e.sortKeys);else if(e.sortKeys)throw new r("sortKeys must be a boolean or a function");for(o=0,i=h.length;o<i;o+=1)u="",a&&""===d||(u+=Ne(e,t)),l=n[s=h[o]],e.replacer&&(l=e.replacer.call(n,s,l)),Ke(e,t+1,s,!0,!0,!0)&&((c=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&10===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,c&&(u+=Ne(e,t)),Ke(e,t+1,l,!0,c)&&(e.dump&&10===e.dump.charCodeAt(0)?u+=":":u+=": ",d+=u+=e.dump));e.tag=p,e.dump=d||"{}"}(e,t,e.dump,o),p&&(e.dump="&ref_"+d+e.dump)):(function(e,t,n){var a,o,r,i,s,l="",c=e.tag,u=Object.keys(n);for(a=0,o=u.length;a<o;a+=1)s="",""!==l&&(s+=", "),e.condenseFlow&&(s+='"'),i=n[r=u[a]],e.replacer&&(i=e.replacer.call(n,r,i)),Ke(e,t,r,!1,!1)&&(e.dump.length>1024&&(s+="? "),s+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Ke(e,t,i,!1,!1)&&(l+=s+=e.dump));e.tag=c,e.dump="{"+l+"}"}(e,t,e.dump),p&&(e.dump="&ref_"+d+" "+e.dump));else if("[object Array]"===c)a&&0!==e.dump.length?(e.noArrayIndent&&!s&&t>0?ze(e,t-1,e.dump,o):ze(e,t,e.dump,o),p&&(e.dump="&ref_"+d+e.dump)):(function(e,t,n){var a,o,r,i="",s=e.tag;for(a=0,o=n.length;a<o;a+=1)r=n[a],e.replacer&&(r=e.replacer.call(n,String(a),r)),(Ke(e,t,r,!1,!1)||void 0===r&&Ke(e,t,null,!1,!1))&&(""!==i&&(i+=","+(e.condenseFlow?"":" ")),i+=e.dump);e.tag=s,e.dump="["+i+"]"}(e,t,e.dump),p&&(e.dump="&ref_"+d+" "+e.dump));else{if("[object String]"!==c){if("[object Undefined]"===c)return!1;if(e.skipInvalid)return!1;throw new r("unacceptable kind of an object to dump "+c)}"?"!==e.tag&&Fe(e,e.dump,t,i,u)}null!==e.tag&&"?"!==e.tag&&(l=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),l="!"===e.tag[0]?"!"+l:"tag:yaml.org,2002:"===l.slice(0,18)?"!!"+l.slice(18):"!<"+l+">",e.dump=l+" "+e.dump)}return!0}function Ve(e,t){var n,a,o=[],r=[];for(Je(e,o,r),n=0,a=r.length;n<a;n+=1)t.duplicates.push(o[r[n]]);t.usedDuplicates=new Array(a)}function Je(e,t,n){var a,o,r;if(null!==e&&"object"==typeof e)if(-1!==(o=t.indexOf(e)))-1===n.indexOf(o)&&n.push(o);else if(t.push(e),Array.isArray(e))for(o=0,r=e.length;o<r;o+=1)Je(e[o],t,n);else for(o=0,r=(a=Object.keys(e)).length;o<r;o+=1)Je(e[a[o]],t,n)}function Ze(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Qe={Type:d,Schema:m,FAILSAFE_SCHEMA:b,JSON_SCHEMA:S,CORE_SCHEMA:C,DEFAULT_SCHEMA:F,load:Te.load,loadAll:Te.loadAll,dump:function(e,t){var n=new Oe(t=t||{});n.noRefs||Ve(e,n);var a=e;return n.replacer&&(a=n.replacer.call({"":a},"",a)),Ke(n,0,a,!0,!0)?n.dump+"\n":""},YAMLException:r,types:{binary:N,float:I,map:y,null:w,pairs:q,set:B,timestamp:$,bool:v,int:x,merge:O,omap:D,seq:f,str:g},safeLoad:Ze("safeLoad","load"),safeLoadAll:Ze("safeLoadAll","loadAll"),safeDump:Ze("safeDump","dump")};n.$jsyaml=Qe})(),(()=>{const{$utils:e}=n;e.aggregation={aggregate(e,t="daily"){if(!e||0===e.length||"none"===t)return e;const n=this.aggregators[t];if(!n)throw new Error(`not supported aggregation period ${t}`);const a=[];let o=null;e.forEach((e=>{const t=new Date(e.ms);if(n.toStartOfPeriod(t),!o)return a.push(e),void(o=t);if(t.getTime()!==o.getTime()){do{n.advance(o),a.push({ms:o.getTime()})}while(o.getTime()<t.getTime());a[a.length-1]=e,o=t}else a[a.length-1]=e}));const r=new Date;for(n.toStartOfPeriod(r),n.advance(o);o.getTime()<=r.getTime();)a.push({ms:o.getTime()}),n.advance(o);return a},aggregators:{hourly:{toStartOfPeriod:e=>e.setMinutes(0,0,0),advance:e=>e.setHours(e.getHours()+1)},daily:{toStartOfPeriod:e=>e.setHours(0,0,0,0),advance:e=>e.setDate(e.getDate()+1)},weekly:{toStartOfPeriod:e=>{e.setHours(0,0,0,0);const t=e.getDay()||7;return 1!==t&&e.setHours(-24*(t-1)),e},advance:e=>e.setDate(e.getDate()+7)},monthly:{toStartOfPeriod:e=>{e.setHours(0,0,0,0);const t=e.getDate();return 1!==t&&e.setHours(-24*(t-1)),e},advance:e=>e.setMonth(e.getMonth()+1)}}}})(),(()=>{const{$utils:e}=n;e.array={remove(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)},toggle(t,n,a=!0){if(!e.is.array(t))throw new Error("$utils.array.toggle expects an array as a parameter");if(a){let e=t.indexOf(n);if(-1===e)return[...t,n];do{t=[...t.slice(0,e),...t.slice(e+1)]}while(-1!==(e=t.indexOf(n)));return t}{let e=t.indexOf(n);if(-1===e)return t.push(n),t;do{t.splice(e,1)}while(-1!==(e=t.indexOf(n)));return t}}}})(),(()=>{const{$utils:e}=n;e.bindMethods=t=>{if(!e.is.object(t))throw new Error("$utils.bindMethods accepts object as a parameter");Object.keys(t).forEach((e=>{"function"==typeof t[e]&&(t[e]=t[e].bind(t))}))}})(),(()=>{const{$utils:e}=n;e.byteSizeOf=t=>{let n=new Set,a=[t],o=0;for(;a.length;){let t=a.pop();if("boolean"==typeof t)o+=4;else if("string"==typeof t)o+=2*t.length;else if("number"==typeof t)o+=8;else if(e.is.blob(t))o+=t.size;else if("object"==typeof t&&!n.has(t)){n.add(t);for(let e in t)t.hasOwnProperty(e)&&(o+=2*e.length,a.push(t[e]))}}return o}})(),(()=>{const{$utils:e}=n;e.canvasToBlob=async(e,t="image/webp",n=.9)=>await new Promise(((a,o)=>{try{e.toBlob((t=>{t?a(t):0===e.width||0===e.height?o("canvas.toBlob failed, canvas has no dimensions"):o("canvas.toBlob failed")}),t,n)}catch(e){o(e)}}))})(),(()=>{const{$utils:e,$chrome:t,$nanoid:a}=n;e.chrome={tabs:{remove:async function(e){if(!e)return;await t.tabs.get(e)&&await t.tabs.remove(e)}},alarms:{run:(e,t={})=>{const n={name:t.name||a(),once:t.once||!1,immediately:t.immediately||!1,delayInMinutes:t.delayInMinutes||1,periodInMinutes:t.once?null:t.periodInMinutes||1,listener:t=>{t.name===n.name&&(n.once&&(chrome.alarms.onAlarm.removeListener(n.listener),chrome.alarms.clear(n.name)),e())}};return chrome.alarms.onAlarm.addListener(n.listener),chrome.alarms.create(n.name,{delayInMinutes:n.delayInMinutes,periodInMinutes:n.periodInMinutes}),n.immediately&&e(),n},off:e=>{e&&("string"==typeof e?chrome.alarms.clear(e):(chrome.alarms.onAlarm.removeListener(e.listener),chrome.alarms.clear(e.name)))}}}})(),(()=>{const{$utils:e}=n;e.chunkify=function(e,n){if(null==e)return[];if(""===e)return[""];let a=e.match(/.*?[.!?][\s\n\t]+|.*$/gs).filter((e=>e.length>0));a=a?a.filter(Boolean):[e];for(let e=0;e<a.length;e++){if(n(a[e]))continue;const o=t(a[e],n,"\n");o.length>1&&a.splice(e,1,...o)}for(let e=0;e<a.length;e++){if(n(a[e]))continue;const o=t(a[e],n," ");o.length>1&&a.splice(e,1,...o)}const o=[];for(let e=0;e<a.length-1;e++)n(a[e]+a[e+1])?(o.push(a[e]+a[e+1]),e++):o.push(a[e]);return o};const t=function(e,t,n=" "){const a=e.split(n);if(0===a.length)return[];let o=[],r=a[0];for(let e=1;e<a.length;e++){const i=r+n+a[e];t(i)?r=i:(o.push(r+n),r=a[e])}return r&&o.push(r),o}})(),(()=>{const{$utils:e}=n;e.clearFromTags=t=>t?(e.is.string(t)||(t=String(t)),t.replaceAll(/<\w+>/g,"").replaceAll(/<\/\w+>/g,"").replaceAll(/<\w+\/>/g,"")):t})(),(()=>{const{$utils:e}=n;function t(e,n,a,o){if(o&&(e=o(e)),!e)return e;if("object"!=typeof e)return e;let r,i=Array.isArray(e)?[]:{};for(const s in e)e.hasOwnProperty(s)&&(r=e[s],n.has(r)?a.push({clone:i,key:s,value:r}):(n.set(r,!0),i[s]=t(r,n,a,o),n.set(r,i[s])));return i}e.cloneDeep=(e,n=null)=>{if(!n&&globalThis.structuredClone)return structuredClone(e);const a=new Map,o=[],r=t(e,a,o,n);return o.forEach((({clone:e,key:t,value:n})=>{e[t]=a.get(n)})),r}})(),(()=>{const{$utils:e}=n;e.containsBlob=t=>e.is.array(t)?t.some(e.containsBlob):e.is.object(t)?Object.values(t).some(e.containsBlob):t instanceof Blob})(),(()=>{const{$utils:e}=n;e.copyright={formatCopyright:(e,t,n)=>["",e,t,n].filter((e=>Boolean(e))).join(" ")}})(),(()=>{const{$utils:e}=n;e.createCsv=(e,n)=>[n.map((e=>e[0])),...e.map((e=>n.map((n=>t(n[1](e))))))].map((e=>e.join(","))).join("\n");const t=e=>((e=String(e).replace(/\n/g," ").replace(/"/g,'""')).includes(",")&&(e=`"${e}"`),e)})(),(()=>{const{$utils:e}=n;e.createPromise=()=>{let e=null,t=null;const n=new Promise(((n,a)=>{e=n,t=a}));return n.__defineGetter__("resolve",(()=>e)),n.__defineGetter__("reject",(()=>t)),n}})(),(()=>{const{$utils:e}=n,t=[{name:"US Dollar",symbol:"$",symbolNative:"$",code:"USD",namePlural:"US dollars",alt:["US$","US $"]},{name:"Canadian Dollar",symbol:"CA$",symbolNative:"$",code:"CAD",namePlural:"Canadian dollars",alt:["CA $","CAN$","CAN $","C$"]},{name:"Euro",symbol:"",symbolNative:"",code:"EUR",namePlural:"euros"},{name:"United Arab Emirates Dirham",symbol:"AED",symbolNative:"..",code:"AED",namePlural:"UAE dirhams"},{name:"Afghan Afghani",symbol:"Af",symbolNative:"",code:"AFN",namePlural:"Afghan Afghanis"},{name:"Albanian Lek",symbol:"ALL",symbolNative:"Lek",code:"ALL",namePlural:"Albanian lek"},{name:"Armenian Dram",symbol:"AMD",symbolNative:".",code:"AMD",namePlural:"Armenian drams"},{name:"Argentine Peso",symbol:"AR$",symbolNative:"$",code:"ARS",namePlural:"Argentine pesos",alt:["AR $"]},{name:"Australian Dollar",symbol:"AU$",symbolNative:"$",code:"AUD",namePlural:"Australian dollars",alt:["AU $"]},{name:"Azerbaijani Manat",symbol:"",symbolNative:".",code:"AZN",namePlural:"Azerbaijani manats"},{name:"Bosnia-Herzegovina Convertible Mark",symbol:"KM",symbolNative:"KM",code:"BAM",namePlural:"Bosnia-Herzegovina convertible marks"},{name:"Bangladeshi Taka",symbol:"Tk",symbolNative:"",code:"BDT",namePlural:"Bangladeshi takas"},{name:"Bulgarian Lev",symbol:"BGN",symbolNative:".",code:"BGN",namePlural:"Bulgarian leva"},{name:"Bahraini Dinar",symbol:"BD",symbolNative:"..",code:"BHD",namePlural:"Bahraini dinars"},{name:"Burundian Franc",symbol:"FBu",symbolNative:"FBu",code:"BIF",namePlural:"Burundian francs"},{name:"Brunei Dollar",symbol:"BN$",symbolNative:"$",code:"BND",namePlural:"Brunei dollars",alt:["BN $"]},{name:"Bolivian Boliviano",symbol:"Bs",symbolNative:"Bs",code:"BOB",namePlural:"Bolivian bolivianos"},{name:"Brazilian Real",symbol:"R$",symbolNative:"R$",code:"BRL",namePlural:"Brazilian reals"},{name:"Botswanan Pula",symbol:"BWP",symbolNative:"P",code:"BWP",namePlural:"Botswanan pulas"},{name:"Belarusian Ruble",symbol:"Br",symbolNative:".",code:"BYN",namePlural:"Belarusian rubles"},{name:"Belize Dollar",symbol:"BZ$",symbolNative:"$",code:"BZD",namePlural:"Belize dollars",alt:["BZ $"]},{name:"Congolese Franc",symbol:"CDF",symbolNative:"FrCD",code:"CDF",namePlural:"Congolese francs"},{name:"Swiss Franc",symbol:"CHF",symbolNative:"CHF",code:"CHF",namePlural:"Swiss francs"},{name:"Chilean Peso",symbol:"CL$",symbolNative:"$",code:"CLP",namePlural:"Chilean pesos",alt:["CL $"]},{name:"Chinese Yuan",symbol:"CN",symbolNative:"CN",code:"CNY",namePlural:"Chinese yuan"},{name:"Colombian Peso",symbol:"CO$",symbolNative:"$",code:"COP",namePlural:"Colombian pesos",alt:["CO $"]},{name:"Costa Rican Coln",symbol:"",symbolNative:"",code:"CRC",namePlural:"Costa Rican colns"},{name:"Cape Verdean Escudo",symbol:"CV$",symbolNative:"CV$",code:"CVE",namePlural:"Cape Verdean escudos",alt:["CV $"]},{name:"Czech Republic Koruna",symbol:"K",symbolNative:"K",code:"CZK",namePlural:"Czech Republic korunas"},{name:"Djiboutian Franc",symbol:"Fdj",symbolNative:"Fdj",code:"DJF",namePlural:"Djiboutian francs"},{name:"Danish Krone",symbol:"Dkr",symbolNative:"kr",code:"DKK",namePlural:"Danish kroner"},{name:"Dominican Peso",symbol:"RD$",symbolNative:"RD$",code:"DOP",namePlural:"Dominican pesos",alt:["RD $"]},{name:"Algerian Dinar",symbol:"DA",symbolNative:"..",code:"DZD",namePlural:"Algerian dinars"},{name:"Estonian Kroon",symbol:"Ekr",symbolNative:"kr",code:"EEK",namePlural:"Estonian kroons"},{name:"Egyptian Pound",symbol:"EGP",symbolNative:"..",code:"EGP",namePlural:"Egyptian pounds"},{name:"Eritrean Nakfa",symbol:"Nfk",symbolNative:"Nfk",code:"ERN",namePlural:"Eritrean nakfas"},{name:"Ethiopian Birr",symbol:"Br",symbolNative:"Br",code:"ETB",namePlural:"Ethiopian birrs"},{name:"British Pound Sterling",symbol:"",symbolNative:"",code:"GBP",namePlural:"British pounds sterling"},{name:"Georgian Lari",symbol:"GEL",symbolNative:"GEL",code:"GEL",namePlural:"Georgian laris"},{name:"Ghanaian Cedi",symbol:"GH",symbolNative:"GH",code:"GHS",namePlural:"Ghanaian cedis"},{name:"Guinean Franc",symbol:"FG",symbolNative:"FG",code:"GNF",namePlural:"Guinean francs"},{name:"Guatemalan Quetzal",symbol:"GTQ",symbolNative:"Q",code:"GTQ",namePlural:"Guatemalan quetzals"},{name:"Hong Kong Dollar",symbol:"HK$",symbolNative:"$",code:"HKD",namePlural:"Hong Kong dollars",alt:["HK $"]},{name:"Honduran Lempira",symbol:"HNL",symbolNative:"L",code:"HNL",namePlural:"Honduran lempiras"},{name:"Croatian Kuna",symbol:"kn",symbolNative:"kn",code:"HRK",namePlural:"Croatian kunas"},{name:"Hungarian Forint",symbol:"Ft",symbolNative:"Ft",code:"HUF",namePlural:"Hungarian forints"},{name:"Indonesian Rupiah",symbol:"Rp",symbolNative:"Rp",code:"IDR",namePlural:"Indonesian rupiahs"},{name:"Israeli New Sheqel",symbol:"",symbolNative:"",code:"ILS",namePlural:"Israeli new sheqels"},{name:"Indian Rupee",symbol:"Rs",symbolNative:"",code:"INR",namePlural:"Indian rupees"},{name:"Iraqi Dinar",symbol:"IQD",symbolNative:"..",code:"IQD",namePlural:"Iraqi dinars"},{name:"Iranian Rial",symbol:"IRR",symbolNative:"",code:"IRR",namePlural:"Iranian rials"},{name:"Icelandic Krna",symbol:"Ikr",symbolNative:"kr",code:"ISK",namePlural:"Icelandic krnur"},{name:"Jamaican Dollar",symbol:"J$",symbolNative:"$",code:"JMD",namePlural:"Jamaican dollars"},{name:"Jordanian Dinar",symbol:"JD",symbolNative:"..",code:"JOD",namePlural:"Jordanian dinars"},{name:"Japanese Yen",symbol:"",symbolNative:"",code:"JPY",namePlural:"Japanese yen"},{name:"Kenyan Shilling",symbol:"Ksh",symbolNative:"Ksh",code:"KES",namePlural:"Kenyan shillings"},{name:"Cambodian Riel",symbol:"KHR",symbolNative:"",code:"KHR",namePlural:"Cambodian riels"},{name:"Comorian Franc",symbol:"CF",symbolNative:"FC",code:"KMF",namePlural:"Comorian francs"},{name:"South Korean Won",symbol:"",symbolNative:"",code:"KRW",namePlural:"South Korean won"},{name:"Kuwaiti Dinar",symbol:"KD",symbolNative:"..",code:"KWD",namePlural:"Kuwaiti dinars"},{name:"Kazakhstani Tenge",symbol:"KZT",symbolNative:".",code:"KZT",namePlural:"Kazakhstani tenges"},{name:"Lebanese Pound",symbol:"LB",symbolNative:"..",code:"LBP",namePlural:"Lebanese pounds"},{name:"Sri Lankan Rupee",symbol:"SLRs",symbolNative:"SL Re",code:"LKR",namePlural:"Sri Lankan rupees"},{name:"Lithuanian Litas",symbol:"Lt",symbolNative:"Lt",code:"LTL",namePlural:"Lithuanian litai"},{name:"Libyan Dinar",symbol:"LD",symbolNative:"..",code:"LYD",namePlural:"Libyan dinars"},{name:"Moroccan Dirham",symbol:"MAD",symbolNative:"..",code:"MAD",namePlural:"Moroccan dirhams"},{name:"Moldovan Leu",symbol:"MDL",symbolNative:"MDL",code:"MDL",namePlural:"Moldovan lei"},{name:"Malagasy Ariary",symbol:"MGA",symbolNative:"MGA",code:"MGA",namePlural:"Malagasy Ariaries"},{name:"Macedonian Denar",symbol:"MKD",symbolNative:"MKD",code:"MKD",namePlural:"Macedonian denari"},{name:"Myanma Kyat",symbol:"MMK",symbolNative:"K",code:"MMK",namePlural:"Myanma kyats"},{name:"Macanese Pataca",symbol:"MOP$",symbolNative:"MOP$",code:"MOP",namePlural:"Macanese patacas",alt:["MOP $"]},{name:"Mauritian Rupee",symbol:"MURs",symbolNative:"MURs",code:"MUR",namePlural:"Mauritian rupees"},{name:"Mexican Peso",symbol:"MX$",symbolNative:"$",code:"MXN",namePlural:"Mexican pesos",alt:["MX $"]},{name:"Malaysian Ringgit",symbol:"RM",symbolNative:"RM",code:"MYR",namePlural:"Malaysian ringgits"},{name:"Mozambican Metical",symbol:"MTn",symbolNative:"MTn",code:"MZN",namePlural:"Mozambican meticals"},{name:"Namibian Dollar",symbol:"N$",symbolNative:"N$",code:"NAD",namePlural:"Namibian dollars"},{name:"Nigerian Naira",symbol:"",symbolNative:"",code:"NGN",namePlural:"Nigerian nairas"},{name:"Nicaraguan Crdoba",symbol:"C$",symbolNative:"C$",code:"NIO",namePlural:"Nicaraguan crdobas"},{name:"Norwegian Krone",symbol:"Nkr",symbolNative:"kr",code:"NOK",namePlural:"Norwegian kroner"},{name:"Nepalese Rupee",symbol:"NPRs",symbolNative:"",code:"NPR",namePlural:"Nepalese rupees"},{name:"New Zealand Dollar",symbol:"NZ$",symbolNative:"$",code:"NZD",namePlural:"New Zealand dollars",alt:["NZ $"]},{name:"Omani Rial",symbol:"OMR",symbolNative:"..",code:"OMR",namePlural:"Omani rials"},{name:"Panamanian Balboa",symbol:"B/.",symbolNative:"B/.",code:"PAB",namePlural:"Panamanian balboas"},{name:"Peruvian Nuevo Sol",symbol:"S/.",symbolNative:"S/.",code:"PEN",namePlural:"Peruvian nuevos soles"},{name:"Philippine Peso",symbol:"",symbolNative:"",code:"PHP",namePlural:"Philippine pesos"},{name:"Pakistani Rupee",symbol:"PKRs",symbolNative:"",code:"PKR",namePlural:"Pakistani rupees"},{name:"Polish Zloty",symbol:"z",symbolNative:"z",code:"PLN",namePlural:"Polish zlotys"},{name:"Paraguayan Guarani",symbol:"",symbolNative:"",code:"PYG",namePlural:"Paraguayan guaranis"},{name:"Qatari Rial",symbol:"QR",symbolNative:"..",code:"QAR",namePlural:"Qatari rials"},{name:"Romanian Leu",symbol:"RON",symbolNative:"RON",code:"RON",namePlural:"Romanian lei"},{name:"Serbian Dinar",symbol:"din.",symbolNative:".",code:"RSD",namePlural:"Serbian dinars"},{name:"Russian Ruble",symbol:"RUB",symbolNative:".",code:"RUB",namePlural:"Russian rubles"},{name:"Rwandan Franc",symbol:"RWF",symbolNative:"FR",code:"RWF",namePlural:"Rwandan francs"},{name:"Saudi Riyal",symbol:"SR",symbolNative:"..",code:"SAR",namePlural:"Saudi riyals"},{name:"Sudanese Pound",symbol:"SDG",symbolNative:"SDG",code:"SDG",namePlural:"Sudanese pounds"},{name:"Swedish Krona",symbol:"Skr",symbolNative:"kr",code:"SEK",namePlural:"Swedish kronor"},{name:"Singapore Dollar",symbol:"S$",symbolNative:"$",code:"SGD",namePlural:"Singapore dollars"},{name:"Somali Shilling",symbol:"Ssh",symbolNative:"Ssh",code:"SOS",namePlural:"Somali shillings"},{name:"Syrian Pound",symbol:"SY",symbolNative:"..",code:"SYP",namePlural:"Syrian pounds"},{name:"Thai Baht",symbol:"",symbolNative:"",code:"THB",namePlural:"Thai baht"},{name:"Tunisian Dinar",symbol:"DT",symbolNative:"..",code:"TND",namePlural:"Tunisian dinars"},{name:"Tongan Paanga",symbol:"T$",symbolNative:"T$",code:"TOP",namePlural:"Tongan paanga",alt:["T $"]},{name:"Turkish Lira",symbol:"",symbolNative:"",code:"TRY",namePlural:"Turkish Lira"},{name:"Trinidad and Tobago Dollar",symbol:"TT$",symbolNative:"$",code:"TTD",namePlural:"Trinidad and Tobago dollars",alt:["TT $"]},{name:"New Taiwan Dollar",symbol:"NT$",symbolNative:"NT$",code:"TWD",namePlural:"New Taiwan dollars",alt:["NT $"]},{name:"Tanzanian Shilling",symbol:"TSh",symbolNative:"TSh",code:"TZS",namePlural:"Tanzanian shillings"},{name:"Ukrainian Hryvnia",symbol:"",symbolNative:"",code:"UAH",namePlural:"Ukrainian hryvnias"},{name:"Ugandan Shilling",symbol:"USh",symbolNative:"USh",code:"UGX",namePlural:"Ugandan shillings"},{name:"Uruguayan Peso",symbol:"$U",symbolNative:"$",code:"UYU",namePlural:"Uruguayan pesos"},{name:"Uzbekistan Som",symbol:"UZS",symbolNative:"UZS",code:"UZS",namePlural:"Uzbekistan som"},{name:"Venezuelan Bolvar",symbol:"Bs.F.",symbolNative:"Bs.F.",code:"VEF",namePlural:"Venezuelan bolvars"},{name:"Vietnamese Dong",symbol:"",symbolNative:"",code:"VND",namePlural:"Vietnamese dong"},{name:"CFA Franc BEAC",symbol:"FCFA",symbolNative:"FCFA",code:"XAF",namePlural:"CFA francs BEAC"},{name:"CFA Franc BCEAO",symbol:"CFA",symbolNative:"CFA",code:"XOF",namePlural:"CFA francs BCEAO"},{name:"Yemeni Rial",symbol:"YR",symbolNative:"..",code:"YER",namePlural:"Yemeni rials"},{name:"South African Rand",symbol:"R",symbolNative:"R",code:"ZAR",namePlural:"South African rand"},{name:"Zambian Kwacha",symbol:"ZK",symbolNative:"ZK",code:"ZMK",namePlural:"Zambian kwachas"},{name:"Zimbabwean Dollar",symbol:"ZWL$",symbolNative:"ZWL$",code:"ZWL",namePlural:"Zimbabwean Dollar",alt:["ZWL $"]}],a={};t.forEach((e=>{const t=e.symbolNative;t.endsWith(".")&&(e.symbolNative=t.substr(0,t.length-1)),a[e.code]=e}));e.currency={list:t,byCode:a,formatCurrency:(t,n="name")=>{const a=t.indexOf(":"),o=-1===a?t:t.substr(a+1);return e.currency.byCode[o]?.[n]||t}}})(),(()=>{const{$utils:e}=n;function t(e){return!e||e!==Object(e)}e.deepEqual=function(n,a){if(n===a)return!0;if(t(n))return!!t(a)&&n===a;if(t(a))return!1;if(Object.keys(n).length!==Object.keys(a).length)return!1;for(const t in n){if(!(t in a))return!1;if(!e.deepEqual(n[t],a[t]))return!1}return!0}})(),(()=>{const{$utils:e}=n;e.delete=(e,t)=>{const n=(t||"").split(".");let a=e;for(let e=0;e<n.length-1;e++){let t=n[e];if(void 0===a)return!1;if(null===a)return!1;if(Array.isArray(a)&&(t=Number(t),Number.isNaN(t)||t<0||t>=a.length))return!1;a=a[t]}if(void 0===a)return!1;if(null===a)return!1;let o=n.at(-1);if(Array.isArray(a)){if(o=Number(o),Number.isNaN(o)||o<0||o>=a.length)return!1;a.splice(o,1)}else{if(!(o in a))return!1;delete a[o]}return!0}})(),(()=>{const{$utils:e}=n,t={html:/[:=[\](){};,<>/"\s]+/g,text:/\s+/g},a=(e,t)=>{const n=new Map;return e.split(t).filter((e=>e.length>0)).forEach((e=>{const t=n.get(e);n.set(e,(t||0)+1)})),n};e.diff=(e,n,o)=>{if(e===n)return 0;e=e||"",n=n||"";const r=t[o];if(!r){const e=Object.keys(t).join(", ");throw new Error(`$utils.diff type argument must be one of: ${e}`)}e=a(e,r),n=a(n,r);let i=0,s=0;return e.forEach(((e,t)=>{const a=n.get(t)||0;s+=t.length*Math.abs(e-a),i+=t.length*Math.max(e,a),n.set(t,0)})),n.forEach(((e,t)=>{0!==e&&(s+=t.length*e,i+=t.length*e)})),0!==i?s/i:0}})(),(()=>{const{$utils:e}=n;e.durationOf=async function(e,t){t={catch:!0,...t};const n=Date.now(),a={};if(t.catch)try{a.result=await e(),a.hasResult=!0}catch(e){a.error=e,a.hasError=!0}else a.result=await e();return a.ms=Date.now()-n,a.s=Number(((Date.now()-n)/1e3).toFixed(1)),a}})(),(()=>{const{$utils:e}=n;function t(e,t,n){if(n={minLength:2,...n},t.length<=n.minLength)return"";if(e.includes(t))return"";for(let n=1;n<t.length;n++){const a=t.substring(0,n),o=t.substring(n),r=new RegExp(`${a}.${o.substring(1)}`);if(r.test(e))return e.replace(r,t);const i=new RegExp(`${a}.${o}`);if(i.test(e))return e.replace(i,t);if("mail"!==o){const n=new RegExp(`${a}{0}${o}`);if(n.test(e))return e.replace(n,t)}const s=[t.substring(0,n-1),t.charAt(n),t.charAt(n-1),t.substring(n+1)].join("");if(e.includes(s))return e.replace(s,t)}return null}function a(e,n){const[a,o]=e.split("@"),r=t(a,n,{minLength:3});return r?`${r}@${o}`:null}e.email={regex:/("[^"]+"\s+)?<?(?<email>[^\s,]+@[^\s,>]+)>?/gm,check:e=>{if(!e)return{status:"error",error:"email is required"};let n,o,r;if("string"==typeof e?n=(e||"").trim().toLowerCase():(n=(e.email||"").trim().toLowerCase(),o=e.firstName,r=e.lastName),!n)return{status:"error",error:"email is required"};if(2!==n.split("@").length)return{status:"error",error:"unsupported email format"};const i=function(e){const t=[{pattern:/,com$/,fix:e=>e.replace(/,com$/,".com")},{pattern:/,\w\w\w?$/,fix:e=>e.replace(/,(\w\w\w?)/,".$1")},{pattern:/,co\.\w{2}$/,fix:e=>e.replace(/,(co\.\w{2}$)/,".$1")},{pattern:/@\w*$/,fix:e=>e+".com"}].find((t=>t.pattern.test(e)));if(t)return t.fix(e);return null}(n)||function(e){const n=["gmail","hotmail","outlook","yahoo","icloud","zoho","yandex","mail","msn"],[a,o]=e.split("@");for(let e=0;e<n.length;e++){const r=t(o,n[e],{minLength:0});if(r)return`${a}@${r}`}return null}(n)||o&&a(n,o.trim().toLowerCase())||r&&a(n,r.trim().toLowerCase());return i?{status:"typo",fix:i}:{status:"ok"}},parse:t=>e.unique(Array.from((t||"").matchAll(e.email.regex)).map((e=>e.groups?.email?.trim())).filter((e=>Boolean(e))))}})(),(()=>{const{$utils:e}=n;e.enqueue=(t,n)=>{let a;return async(...o)=>{const r=a,i=e.createPromise();a=i,r&&await r;try{const e=await t.call(n,...o);return i.resolve(),e}catch(e){throw i.resolve(),e}}}})(),(()=>{const{$utils:e}=n;e.ensureArray=e=>Array.isArray(e)?e:[e]})(),(()=>{const{$utils:e}=n,t=e=>0===e?{value:0,metric:"meters"}:1===e?{value:1,metric:"meter"}:e<.001?{value:1e6*e,metric:"m"}:e<1?{value:1e3*e,metric:"mm"}:e<1e3?{value:e,metric:"meters"}:{value:e/1e3,metric:"km"},a=e=>0===e?{value:0,metric:"grams"}:1===e?{value:1,metric:"gram"}:e<.001?{value:1e6*e,metric:"g"}:e<1?{value:1e3*e,metric:"mg"}:e<1e3?{value:e,metric:"grams"}:{value:e/1e3,metric:"kg"},o=e=>0===e?{value:0,metric:"bytes"}:1===e?{value:1,metric:"byte"}:e<1e3?{value:e,metric:"bytes"}:e<1e6?{value:e/1e3,metric:"kB"}:e<1e9?{value:e/1e6,metric:"MB"}:e<1e12?{value:e/1e9,metric:"GB"}:e<1e15?{value:e/1e12,metric:"TB"}:{value:e/1e15,metric:"PB"},r=(e,t=45)=>{if(e.length<=t)return e;const n=e.split("/");let a=n.at(-1);if(a.length>t)return`...${a.substr(a.length-t,t)}`;for(let e=n.length-2;e>0;e--){if(a.length+n[e].length+1>t)return`.../${a}`;a=`${n[e]}/${a}`}return`.../${a}`};e.formatter={format:(n,i,s={})=>{if(null==n)return n;const l=s.format||"string",c=s.long||!1,u=s.maxInt||1e3;let d="";if("text"===(i="number"===i?"":i||"")||"element"===i)return"string"===l?n:{value:n};if("link"===i||"image"===i||"icon"===i||"video"===i)return n=r(n),"string"===l?n:{value:n};if("currency"===i){const t=s.currencyFormat||"name";return n=e.currency.formatCurrency(n,t),"string"===l?n:{value:n}}if("date"===i)return n=e.time.formatDate(n),"string"===l?n:{value:n};if("time"===i)return n=e.time.formatTime(n),"string"===l?n:{value:n};if("copyright"===i)return n=e.copyright.formatCopyright(n),"string"===l?n:{value:n};if("duration"===i||"ms"===i)return n=e.time.formatDuration(n),"string"===l?n:{value:n};if("distance"===i||"meters"===i){const e=t(n);n=e.value,i=e.metric}if("matches"===i&&(0===n?(n="No",i=""):i=1===n?"match":"matches"),"weight"===i||"grams"===i){const e=a(n);n=e.value,i=e.metric}if("information"===i||"bytes"===i){const e=o(n);n=e.value,i=e.metric}if(i?.startsWith("CUR:")){const t=s.currencyFormat||"symbolNative";"symbolNative"!==t||"CUR:USD"!==i&&"CUR:EUR"!==i?(i=i.substr(4),i=e.currency.byCode[i]?.[t]||i):(d=i.substr(4),d=e.currency.byCode[d]?.[t]||d,i="")}const p=c?{sign:"",value:n,suffix:""}:e.number.toShort(n,{maxInt:u,format:"object"});let h={prefix:d,sign:p.sign,value:"number"==typeof p.value?p.value.toLocaleString("en-US",s).replaceAll(",",""):p.value,suffix:p.suffix,metric:i||""};return"string"===l?`${h.prefix}${h.sign}${h.value}${h.suffix} ${h.metric}`.trim():h},formatDistance:t,formatWeight:a,formatInformation:o}})(),(()=>{const{$utils:e}=n;e.frequency=(t,n)=>{const a=new Map;if(!t)return;let o=null;if(e.is.object(t))o=Object.values(t);else{if(!e.is.array(t))throw new Error("$utils.frequency works for Arrays and Object sources");o=t}return"function"==typeof n?o.forEach((e=>{const t=n(e),o=a.get(t);a.set(t,(o||0)+1)})):o.forEach((e=>{const t=e[n],o=a.get(t);a.set(t,(o||0)+1)})),a}})(),(()=>{const{$utils:e}=n;e.get=(e,t)=>{const n=(t||"").split(".");let a=e;for(let e of n){if(void 0===a)return;if(null===a)return;if(Array.isArray(a)&&(e=Number(e),Number.isNaN(e)||e<0||e>=a.length))return;a=a[e]}return a}})(),(()=>{const{$utils:e}=n;e.hasExtraKeys=(e,t)=>!!e&&(t=t instanceof Set?t:new Set(t),0!==(t=Object.keys(e).filter((e=>!t.has(e)))).length&&t)})(),(()=>{const{$utils:e}=n;e.is={undefined:e=>void 0===e,defined:e=>void 0!==e,null:e=>null===e,nil:e=>null==e,array:e=>Array.isArray(e),object:e=>"[object Object]"===Object.prototype.toString.call(e),nan:e=>Number.isNaN(e),number:e=>"number"==typeof e,function:e=>"function"==typeof e,set:e=>e instanceof Set,map:e=>e instanceof Map,url:e=>e instanceof URL,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,symbol:e=>"symbol"==typeof e,regexp:e=>e instanceof RegExp,blob:e=>e instanceof Blob}})(),(()=>{const{$utils:e}=n;e.ls={get(e,t){if(!this._isSupported())return null;if(!this.has(e))return t;const n=localStorage.getItem(e);if("undefined"===n)return;if("null"===n)return null;if("true"===n)return!0;if("false"===n)return!1;if(n.startsWith("[")||n.startsWith("{"))return JSON.parse(n);const a=Number(n);return Number.isNaN(a)?n:a},set(e,t){if(this._isSupported())try{"string"==typeof t?localStorage.setItem(e,t):localStorage.setItem(e,JSON.stringify(t))}catch(n){console.error("$utils.ls.set failed to store the given value",{key:e,value:t,error:n})}},has(e){return!!this._isSupported()&&e in localStorage},remove(e){this._isSupported()&&localStorage.removeItem(e)},_isSupported(){if(void 0!==this._isSupportedCache)return this._isSupportedCache;try{globalThis.localStorage;return this._isSupportedCache=!0}catch{return this._isSupportedCache=!1}}}})(),(()=>{const{$utils:e}=n;e.mapBy=(e,t,n="object")=>{if(!e||0===e.length)return{};if("object"===n){const n={};return"function"==typeof t?e.forEach((e=>n[t(e)]=e)):e.forEach((e=>n[e[t]]=e)),n}if("map"===n){const n=new Map;return"function"==typeof t?e.forEach((e=>{n.set(t(e),e)})):e.forEach((e=>{n.set(e[t],e)})),n}throw new Error("$utils.mapBy format is not supported",n)}})(),(()=>{const{$utils:e}=n;e.memoize=function(e,t={}){const n=new Map,a=async function(...a){const o=a.length;if(o>1)throw new Error(`memoized function received ${o} arguments`);const r=Date.now();t.ttl&&n.forEach(((e,a)=>{r-e.ts>=t.ttl&&n.delete(a)}));const i=t.resolver?t.resolver.call(this,...a):a[0],s=n.get(i);if(void 0!==s)return s.value;const l=await e.call(this,...a);return n.set(i,{ts:r,value:l}),l};return a.cache=n,a}})(),(()=>{const{$utils:e}=n;e.noThrow=(e,t=null)=>{if(!e)return;let n;try{n=e()}catch{n=t}return n instanceof Promise?new Promise((async e=>{try{n=await n}catch{n=t}e(n)})):n}})(),(()=>{const{$utils:e}=n;e.number={minmax:(t,n,a)=>{if(!e.is.number(t))throw new Error("$utils.number.minmax expects a numeric value");return null!==n&&t<n?n:null!==a&&t>a?a:t},toShort:(e,t={})=>{const n=t.format||"string",a=t.maxInt||1e3,o="string"===n?({sign:e,value:t,suffix:n})=>`${e||""}${String(t)}${n||""}`:e=>e;if("number"!=typeof e)return o({sign:"",value:e,suffix:""});let r="",i="";if(e<0&&(r="-",e=-e),e<10)return o({sign:r,value:Number(Number.isInteger(e)?e:e.toFixed(3)),suffix:i});if(e<100)return o({sign:r,value:Number(Number.isInteger(e)?e:e.toFixed(2)),suffix:i});if(e<1e3)return o({sign:r,value:Number(Number.isInteger(e)?e:e.toFixed(2)),suffix:i});if(e<1e4)return o({sign:r,value:Number(Number.isInteger(e)?e:e.toFixed(1)),suffix:i});const s=["k","m","b","t"];let l=null;for(let t=0;t<s.length;t++){if(e<a){l=e;break}e/=1e3,i=s[t]}return null===l&&(l=e,e>999)?o({sign:r,value:"999",suffix:"t+"}):(l=Math.round(10*l)/10,o({sign:r,value:l,suffix:i}))}}})(),(()=>{const{$utils:e}=n;e.occurrences={regex:(t,n)=>("string"==typeof n&&(n=n.split("\n")),0===(n=e.ensureArray(n)).length?0:(n=n.map((t=>e.string.toRegex(t))).filter((e=>!!e))).reduce(((e,n)=>e+(t.match(n)||[]).length),0)),string(e,t,n=!1){if(t.length<=0)return e.length+1;let a=0,o=0,r=n?1:t.length;for(;o=e.indexOf(t,o),o>=0;)++a,o+=r;return a}}})(),Array.prototype.at||(Array.prototype.at=function(e){return this[e>=0?e:this.length+e]}),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.split(e).join(t)}),Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e,t){for(let n=this.length-1;n>=0;n--)if(e.call(t,this[n],n,this))return n;return-1}),(()=>{const{$utils:e}=n;e.raf=async(t=1)=>{0!==t&&(await new Promise((e=>requestAnimationFrame(e))),await e.raf(t-1))}})(),(()=>{const{$utils:e}=n;e.range=(e,t=0)=>Array.from({length:e},((e,n)=>n+t))})(),(()=>{const{$utils:e}=n;e.removeKeys=(t,n=null)=>{if(!t||!e.is.object(t))throw new Error("$utils.removeKeys accepts non-null objects");return n=n||((t,n)=>e.is.nil(n)),Object.getOwnPropertyNames(t).forEach((a=>{const o=t[a];e.is.object(o)?e.removeKeys(t[a],n):n(a,o)&&delete t[a]})),t}})(),(()=>{const{$utils:e}=n;e.set=(e,t,n,a={})=>{const{flatten:o,create:r}={flatten:!1,create:!1,...a},i=(t||"").split(".");let s=e;for(let e=0;e<i.length-1;e++){let t=i[e];if(void 0===s)return!1;if(null===s)return!1;if(Array.isArray(s)&&(t=Number(t),Number.isNaN(t)||t<0||t>=s.length))return!1;r&&!s.hasOwnProperty(t)&&(s[t]={}),s=s[t]}if(void 0===s)return!1;if(null===s)return!1;let l=i.at(-1);if(Array.isArray(s)){if(l=Number(l),Number.isNaN(l)||l<0||l>=s.length)return!1;o?(Array.isArray(n)||(n=[n]),s.splice(l,1,...n)):s[l]=n}else s[l]=n;return!0}})(),(()=>{const{$utils:e}=n;e.sleep=async e=>new Promise((t=>{setTimeout(t,e)}))})(),(()=>{const{$utils:e}=n;e.stringSimilarity=(e,t)=>{if((e=e.replace(/\s+/g,""))===(t=t.replace(/\s+/g,"")))return 1;if(e.length<2||t.length<2)return 0;let n=new Map;for(let t=0;t<e.length-1;t++){const a=e.substring(t,t+2),o=n.has(a)?n.get(a)+1:1;n.set(a,o)}let a=0;for(let e=0;e<t.length-1;e++){const o=t.substring(e,e+2),r=n.has(o)?n.get(o):0;r>0&&(n.set(o,r-1),a++)}return 2*a/(e.length+t.length-2)}})(),(()=>{const{$utils:e}=n,t=e=>{if(null==e)return e;return("string"!=typeof e?String(e):e).length>0?`${e[0].toLowerCase()}${e.substring(1)}`:""},a=e=>{if(null==e)return e;return("string"!=typeof e?String(e):e).replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};e.string={shorten:(e,t=40,n="",a="")=>{if(null==e)return n;const o="string"!=typeof e?String(e):e;return o.length>t?o.substr(0,t)+a:o},toCamelCase:(e,n=" -_")=>{if(null==e)return e;n=a(n);const o=new RegExp(`[${n}]+`,"g");let r="string"!=typeof e?String(e):e;return r=r.split(o).map((e=>e[0].toUpperCase()+e.substr(1))).join(""),r=t(r),r},toKebabCase:(e,t="-_",n=!1)=>{let a=String(e);return n||(a=a.replace(/(\p{Ll})(\p{Lu})/gu,"$1-$2")),a.toLowerCase().replace(new RegExp(`[${t}]+`,"g")," ").trim().replaceAll(" ","-")},toCapitalFirst:e=>{if(null==e)return e;return("string"!=typeof e?String(e):e).length>0?`${e[0].toUpperCase()}${e.substring(1)}`:""},toLowerFirst:t,containsInMiddle:(e,t)=>{const n=e.indexOf(t);return-1!==n&&0!==n&&n!==e.length-t.length},escapeRegExp:a,toRegex:(e,t="gi")=>{if(null==e)return e;if(e instanceof RegExp)return e;if("string"!=typeof e||0===e.length)return null;if(e.startsWith("/")&&-1!==e.indexOf("/",2))try{const t=e.replace(/.*\/([gimy]*)$/,"$1"),n=e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1");return RegExp(n,t)}catch(e){}return e=a(e),new RegExp(e,t)},incrementNumberSuffix:e=>{if(null==e)return e;const t="string"!=typeof e?String(e):e;let n=t.match(/ #(\d+)$/)||t.match(/ (\d+)$/);if(!n)return`${t} #2`;const a=Number(n[1])||1,o=n[0].includes("#")?"#":"";return`${t.substr(0,n.index)} ${o}${a+1}`},empty:e=>0===e.trim().length,rotate:(e,t=1)=>{const n=e.length;return t>0?e.substring(t,n)+e.substring(0,t):e.substring(n+t,n)+e.substring(0,n+t)}}})(),(()=>{const{$utils:e}=n;e.systemTheme={get value(){return window?.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"night":"day"},onChange(e,t=!1){window?.matchMedia&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{e(this.value)})),t&&e(this.value))}}})(),(()=>{const{$utils:e}=n;e.TempMap=class{constructor(t=e.time.MINUTE){this._timeout=t,this._map=new Map,this._usages=new Map,this._setupCleanup()}get(e){if(this._map.has(e))return this._updateUsage(e),this._map.get(e)}has(e){return!!this._map.has(e)&&(this._updateUsage(e),!0)}set(e,t){this._updateUsage(e),this._map.set(e,t)}delete(e){this._map.delete(e),this._usages.delete(e)}_updateUsage(e){this._usages.set(e,Date.now())}_setupCleanup(){e.chrome.alarms.run((()=>this._cleanup()),{periodInMinutes:this._timeout/e.time.MINUTE})}_cleanup(){const e=Date.now();for(const t of this._usages){const[n,a]=t;e-a<this._timeout||this.delete(n)}}}})(),(()=>{const{$utils:e}=n,t=36e5,a=24*t,o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=e=>{if(!e)return null;if("string"==typeof e)return"string";const t=new Date;if(e>t.getTime()){if(t.setHours(0,0,0,0),e<=t.getTime()+a)return"today";if(e<=t.getTime()+2*a)return"tomorrow";if(t.setHours(23,59,59,999),t.setMonth(11,31),e<=t)return"year"}else{if(t.setHours(0,0,0,0),e>=t.getTime())return"today";if(e>=t.getTime()-a)return"yesterday";if(t.setMonth(0,1),e>=t.getTime())return"year"}return"other"};e.time={SECOND:1e3,MINUTE:6e4,HOUR:t,DAY:a,WEEK:6048e5,MONTH:26784e5,months:o,fullMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],relativeDateType:r,formatTime:(e,t)=>(t=t||{hour12:!1,timeZone:"UTC"},(e=(e=e||new Date)instanceof Date?e:new Date(e)).toLocaleTimeString("en-UK",t)),formatDate:(e,t)=>e?(e=e instanceof Date?e:new Date(e),t={day:"numeric",month:"short",year:"numeric",hour12:!1,...t},0===e.getUTCHours()&&0===e.getUTCMinutes()&&0===e.getUTCSeconds()?e.toLocaleDateString("en-UK",t):e.toLocaleTimeString("en-UK",t)):null,formatRelativeDate:(e,t=!1)=>{if(!e)return null;const n=r(e);if("string"===n)return e;function a(e){return e<10?`0${e}`:e}const i=new Date(e),s=(!t||0!==i.getHours()||0!==i.getMinutes())&&`${a(i.getHours())}:${a(i.getMinutes())}`;if("tomorrow"===n)return s?`Tomorrow ${s}`:"Tomorrow";if("today"===n)return s?`${s}, Today`:"Today";if("yesterday"===n)return s?`Yesterday ${s}`:"Yesterday";const l=i.getDate(),c=o[i.getMonth()];if("year"===n)return s?`${l} ${c} ${s}`:`${l} ${c}`;const u=i.getFullYear();return"other"===n?s?`${l} ${c} ${u}, ${s}`:`${l} ${c} ${u}`:e},formatDuration:e=>{if(0===e)return"0s";const t=Math.abs(e/1e3);let n=1e3*t%1e3;n=n&&`${n}ms`;let a=Math.floor(t%60);a=a&&`${a}s`;let o=Math.floor(t/60)%60;o=o&&`${o}m`;let r=Math.floor(t/3600)%24;r=r&&`${r}h`;let i=Math.floor(t/86400);return i=i&&`${i}d`,[i,r,o,a,n].filter((e=>Boolean(e))).join(" ")},frequencyToMs:t=>{const n={s:e.time.SECOND,m:e.time.MINUTE,h:e.time.HOUR,d:e.time.DAY,w:e.time.WEEK,mo:e.time.MONTH},a=parseInt(t.match(/\d+/));if(!a)return 0;const o=n[t.match(/\D+/)]||0;return o&&a*o||0}}})(),(()=>{const{$utils:e}=n;e.toSafeHtml=e=>e.replaceAll("&","&amp;").replaceAll('"',"&quot;").replaceAll("'","&#39").replaceAll("<","&lt;").replaceAll(">","&gt;")})(),(()=>{const{$utils:e}=n;e.unique=e=>Array.from(new Set(e))})(),(()=>{const{$utils:e}=n,t="aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,arab,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,charity,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,doosan,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,etisalat,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,flsmidth,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,grocery,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotels,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,iinet,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,llc,loan,loans,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,map,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,merckmsd,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mutuelle,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,phd,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,rugby,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,search,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,sport,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,vermgensberater,vermgensberatung,,,,,,,,,,,,,,,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw";e.url={get tlds(){return this._tlds||(this._tlds=t.split(",")),this._tlds},ext(e,t={}){e.startsWith("/")&&(e=e.slice(1));const n=chrome.runtime.getURL("/");return this.create(n+e,t)},create(t,n={}){const a=this.parse(t);if(!a)return null;const o=[];Object.entries(n).forEach((([t,n])=>{if(e.is.nil(n))return null;!0===n?o.push(t):((e.is.object(n)||e.is.array(n))&&(n=JSON.stringify(n)),t=this.toSafeSearchPart(t),n=this.toSafeSearchPart(n),o.push(`${t}=${n}`))}));const r=o.join("&");return this.build({protocol:a.protocol,domain:a.domain,port:a.port,path:a.path,search:a.search?a.search+(r?`&${r}`:""):r,hash:a.hash})},check(e){return!!this.parse(e)},getDomain(e,t={}){const{canonical:n,noTld:a,anyTld:o,keepWww:r}={canonical:!1,noTld:!1,anyTld:!1,keepWww:!1,...t},i=this.parse(e,{anyTld:o});if(!i)return null;let s=r?i.domain:i.domain.replace(/^www\./,"");if(!a&&!n)return s;let l=s.split("."),c=l.length;for(;c>1&&!(l[c-1].length>3);c--);return a&&(l=l.slice(0,Math.max(0,c))),n&&(l=l.slice(c-1)),l.join(".")},parse(t,n={}){const{defaultProtocol:a,anyTld:o}={defaultProtocol:"https",anyTld:!1,...n};if(!t)return null;let r,i,s,l,c,u;if(t.startsWith("//")&&(t=`${a}:${t}`),e.string.containsInMiddle(t,":/")){const e=t.split(":/");r=e[0],t=e.slice(1).join(":/").replace(/^\/*/,"")}{const e=/^([^/?]+)(\/?\??.*)?$/,n=t.match(e);if(!n)return null;let a;a=(n[1]||"").split(":"),i=a[0],s=a[1]||"",a=(n[2]||"").split("?"),l=a[0]||"/",a=(a[1]||"").split("#"),c=a[0],u=a[1]||""}{const t=e.string.containsInMiddle(i,".");if(/[!#$%^&*()-+=,/'";~` ]/.test(i))return null;if(!t&&!r&&!s)return null;if(!t&&/^\d+$/.test(i))return null}{const e=i.split(".");if(e.length>1&&e.some((e=>!/^\d+$/.test(e)))){const t=e.at(-1);if(t.includes(","))return null;if(!o&&!this.tlds.includes(t))return null}}r||(r=a);const d=this.build({protocol:r,domain:i,port:s,path:l,search:c,hash:u});try{new URL(d)}catch{return null}return{href:d,protocol:r,domain:i,port:s,path:l,search:c,hash:u}},build:({protocol:e,domain:t,port:n="",path:a="/",search:o="",hash:r=""})=>e+"://"+t+(n?`:${n}`:"")+a+(o?`?${o}`:"")+(r?`#${r}`:""),dropProtocol(e){return this.check(e)&&e.includes(":")?e.split(":").slice(1).join(":").replace(/^\/*/,""):e},dropTrailingSlash(e){return this.check(e)?e.includes("?")||e.includes("#")?e:e.endsWith("/")?e.substr(0,e.length-1):e:e},toSafeSearchPart:e=>String(e).replaceAll("?","%3F").replaceAll("=","%3D").replaceAll("&","%26").replaceAll("+","%2B").replaceAll(" ","%20").replaceAll("#","%23").replaceAll("{","%7B").replaceAll("}","%7D").replaceAll("\n","%0A").replaceAll("`","%60"),hostname(e){if(e instanceof URL)return e.hostname;try{return new URL(e).hostname}catch(e){return null}}}})(),(()=>{const{$critical:e}=n;e.isAutomatable=e=>{try{const t=new URL(e.url);return!!["http:","https:"].includes(t.protocol)&&(!["chrome.google.com"].includes(t.host)&&!t.href.startsWith("https://harpa.ai/automation"))}catch(e){return!1}}})(),(()=>{const{$critical:e}=n;e.proxy={get pageType(){return void 0!==this._pageType||(this._pageType="chrome-extension:"!==location.protocol?null:location.search.includes("?sandbox")?"sandbox":location.search.includes("?popup")?"popup":location.search.includes("?offscreen")?"offscreen":location.search.includes("?shell-header")?"shell-header":location.search.includes("?shell-error")?"shell-error":location.search.includes("?shell-new-tab")?"shell-new-tab":location.search.includes("?shell-omnibox")?"shell-omnibox":location.search.includes("?shell-find")?"shell-find":location.search.includes("?")?null:"main"),this._pageType},get tabId(){return this._chromeTabId||null},set tabId(e){this._chromeTabId=e},get taskId(){return new URLSearchParams(location.search).get("task-id")}}})(),(()=>{const{$store:e,$utils:t}=n;e.adapter={_TTL:5*t.time.MINUTE,_bound_:Symbol("bound"),create(n){let a=!1;if(t.is.object(n)){a=!0;const e=n;n=()=>e}const o=new t.TempMap(this._TTL),r=(t=null)=>{if(o.has(t))return o.get(t);const a=n(t),r=()=>a.get(e.state),i=r();if(!this._wrappable(i))return i;const s=this._wrap(i,r,a);return o.set(t,s),s};return a?r():r},_wrap(n,a,o={}){o.update=function(n){e.transaction((()=>{if(t.is.object(n))Object.assign(a(),n);else{if(!t.is.function(n))throw new Error("invalid updater",{updater:n});n(a())}}))};const r=new Proxy(n,{get:(e,n)=>{if("$"===n)return a().$;const i=o.__lookupGetter__(n);if(i)return i.call(r);const s=o[n];return t.is.function(s)?s[this._bound_]?s:(o[n]=o[n].bind(r),o[n][this._bound_]=!0,o[n]):(t.is.string(n)&&n.startsWith("$")&&(n=n.slice(1)),a()[n])},set:(t,n,i)=>{const s=o.__lookupSetter__(n);return s?(e.transaction((()=>s.call(r,i))),!0):(a()[n]=i,!0)},deleteProperty:(t,n)=>(e.transaction((()=>delete a()[n])),!0)});return r},_wrappable:e=>t.is.object(e)||t.is.array(e)}})(),(()=>{const{$store:e,$utils:t,$mobx:a}=n;e.createProxy=n=>{if(!t.is.object(n))throw new Error("$store.createProxy can only accept Objects");const o={};for(const e in n){const t=n.__lookupGetter__(e);t&&(o[e]=t)}const r=a.makeAutoObservable(n);return new Proxy({},{get(t,n){if(e.controller?.isInTransaction){const e=o[n];return e?e.call(r):r[n]||void 0}return r[n]},set:(e,t,n)=>(r[t]=n,!0)})}})(),(()=>{const{$store:e,$mobx:t,$bus:a,$env:o,$shell:r,$task:i,$logger:s,$idb:l,$utils:c,$chrome:u}=n,d=[e=>t.toJS(e)];e.controller={DEBUG_ACTIONS:!1,async init(){o.is.bg?await this.initBgState():await this.initPpState(),this.isInTransaction=!1,e.state=this.state,e.commit=this.commit.bind(this),e.transaction=this.transaction.bind(this),a.on("store.applyState",this.applyState.bind(this)),a.on("store.applyActions",this.applyActions.bind(this)),a.on("store.resetState",this.resetState.bind(this)),this.setupDevState(),o.is.bg&&await e.versioner.init()},async initBgState(){const n=await u.tabs.query({}),o=c.url.ext("/harpa.html");let r;!!n.find((e=>e.url===o))&&(r=await a.send("store.getPpState")),r||(r=await this.readStateFromIdb()),r||(r=e.template.state()),this.state=t.observable(r),a.on("store.getBgState",(()=>t.toJS(this.state))),a.on("store.saveStateToIdb",(()=>this.saveStateToIdb(0)))},async initPpState(){const e=await a.send("store.getBgState");this.state=t.observable(e),a.on("store.getPpState",(()=>t.toJS(this.state)))},transaction(n){if(this.isInTransaction)return n(e.deducer.getCurrentProxy()),Promise.resolve();let o=[];try{this.isInTransaction=!0,t.runInAction((()=>{o=e.deducer.modify(this.state,(t=>{e.state=t,n(t),e.state=this.state})),this.isInTransaction=!1}))}finally{this.isInTransaction=!1}return this.debugActions(o),this.saveStateToIdb(),a.send("store.applyActions",o)},applyActions(t){this.modifyState((()=>{e.deducer.applyActions(this.state,t)}))},async applyState(e){this.modifyState((()=>{Object.keys(this.state).forEach((e=>delete this.state[e])),Object.assign(this.state,e)}))},modifyState(e){t.runInAction(e),this.saveStateToIdb()},async readStateFromIdb(){try{return await l.read("store.state")}catch(e){throw s.critical("[$store] failed to read state from idb",e),e}},debugActions(n){e.controller.DEBUG_ACTIONS&&console.warn("action applied",n.map((e=>({...e,value:t.toJS(e.value)}))))},saveStateToIdb(e=2e3){if(!o.is.bg)return;const t=this.saveStateToIdb;t.saving?t.pending=!0:(0===e&&(t.saving=!0),clearTimeout(t.timeout),t.timeout=setTimeout((async()=>{t.saving=!0;try{const e={catch:!1},t=await c.durationOf((()=>d.reduce(((e,t)=>t(e)),this.state)),e),n=await c.durationOf((()=>l.write("store.state",t.result)),e);s.dev(`[$store] state saved in prep = ${t.ms}ms and write = ${n.ms}ms`)}catch(e){s.warn("[$store] saving state failed",e)}t.saving=!1,t.pending&&(t.pending=!1,this.saveStateToIdb())}),e))},async commit(){a.send("store.applyState",e.state)},setupDevState(){o.is.development&&Object.defineProperty(globalThis,"state",{get:()=>t.toJS(e.state)})},async resetState(){let t;if(o.is.desktop){const e=r.proxy.tabs;t=e.find((e=>e.fixed)),chrome.tabs.update(t.id,{active:!0});for(const t of e)t.closed||t.fixed||await u.tabs.remove(t.id)}e.transaction((t=>{const n=e.template.state();for(const e in t)delete t[e];for(const e in n)t[e]=n[e]})),await l.clear(),o.is.desktop&&e.transaction((e=>{e.shell.tabs.push(t),e.shell.activeTabId=t.id})),await i.recipeLoader.readAllRecipes()}}})(),(()=>{const{$store:e,$utils:t,$mobx:a}=n;e.deducer={_replicaKey:Symbol("replica"),_currentProxy:null,_arrayMethods:new Set(["pop","push","shift","unshift","splice","reverse"]),modify(e,t){const n=[],a=this._proxify(e,n);return this._currentProxy=a,t(a),this._currentProxy=null,n},applyActions(e,t=[]){for(const n of t){const t=this._get(e,n.getter);"call"===n.type?t[n.method](...n.args):"set"===n.type?t[n.key]=n.value:"delete"===n.type&&delete t[n.key]}},getCurrentProxy(){return this._currentProxy},_proxify(e,n=[],o=[]){if(this._isProxy(e))return e;const r=t.is.array(e),i=t.is.object(e);if(!r&&!i)return e;const s=r?[...e]:{...e};return new Proxy(s,{get:(t,a)=>a===this._replicaKey?s:a in s?r&&this._isArrayMethod(a)?(...t)=>(n.push({type:"call",method:a,getter:o,args:t}),e[a](...t),s[a](...t)):(s[a]=this._proxify(s[a],n,[...o,a]),s[a]):void 0,set:(r,i,l)=>(e[i]=this._deproxify(l),s[i]=this._proxify(e[i],n,[...o,i]),t.is.symbol(i)||n.push({type:"set",key:i,getter:o,value:a.toJS(e[i])}),!0),deleteProperty:(a,r)=>(delete e[r],delete s[r],t.is.symbol(r)||n.push({type:"delete",key:r,getter:o}),!0)})},_deproxify(e){if(!this._isProxy(e))return e;const t=e[this._replicaKey];for(const e in t)t[e]=this._deproxify(t[e]);return t},_isProxy(e){return!(!e||!e[this._replicaKey])},_get(e,t=[]){let n=e;for(const e of t)n=n[e];return n},_isArrayMethod(e){return this._arrayMethods.has(e)}}})(),(()=>{const{$store:e,$idb:t}=n;e.patcher={async createPatch(n={}){const{stateMutator:a,dataMutator:o,dataTransformer:r}=n,i={};return a&&(i.stateActions=e.deducer.modify(e.template.state(),a)),o&&(i.dataActions={},await Promise.all(Object.keys(o).map((async e=>{if("command:copy"===o[e]){const n=await t.read(e);i.dataActions[e]=r?r(n):n}else i.dataActions[e]=o[e]})))),i},async applyPatch(n){const{stateActions:a,dataActions:o}=n;o&&await Promise.all(Object.keys(o).map((e=>{const n=o[e];return"command:delete"===n?t.delete(e):t.write(e,n)}))),a&&e.transaction((t=>{e.deducer.applyActions(t,a)}))}}})(),(()=>{const{$store:e}=n;e.portal={create(n,a={}){const o=(t=e.controller.state)=>n(t),r={get self(){return o()},transaction(t){e.transaction((e=>t(o(e))))},close(){l()}},i=new Set([...Object.keys(r),...Object.keys(a)]),{proxy:s,revoke:l}=Proxy.revocable({},{get(e,t){if(r.hasOwnProperty(t))return r[t];if(a.hasOwnProperty(t)){const e=a[t];return"function"==typeof e?e(o()):e}return o()[t]},set:(e,n,a)=>(t(i,n,"set"),o()[n]=a,!0),deleteProperty:(e,n)=>(t(i,n,"deleteProperty"),delete o()[n],!0),defineProperty:(e,n,a)=>(t(i,n,"defineProperty"),Object.defineProperty(o(),n,a),!0),preventExtensions:e=>(Object.preventExtensions(o()),!0),setPrototypeOf:(e,t)=>(Object.setPrototypeOf(o(),t),!0),apply:(e,t,n)=>o().apply(t,n),construct:(e,t)=>new(o())(...t),getOwnPropertyDescriptor:(e,t)=>Object.getOwnPropertyDescriptor(o(),t),getPrototypeOf:e=>Object.getPrototypeOf(o()),has:(e,t)=>!(t in a)&&t in o(),isExtensible:e=>Object.isExtensible(o()),ownKeys(e){const t=o();return[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)]}});return s}};const t=(e,t,n)=>{if(e.has(t))throw new Error(`$store.portal can not call ${n} operation on immutable key ${t}`)}})(),(()=>{const{$store:e,$env:t,$utils:a}=n;e.versioner={async init(){await this.upgradeState()},async upgradeState(){const t=e.version;for(let n=0;n<=t;n++){if(!(n in e.versions))continue;const t=e.versions[n];a.is.function(t)&&await this._patchFunction(n,t),a.is.function(t.patchState)&&this._patchState(n,(e=>t.patchState(e))),a.is.function(t.patchTask)&&this._patchTasks(n,(e=>t.patchTask(e))),a.is.function(t.patchTab)&&this._patchTabs(n,(e=>t.patchTab(e)))}e.transaction((e=>{e.version=t,e.tasks.forEach((e=>e.version=t))}))},async upgradeTaskPatch(n){const o=n.stateActions.filter((e=>"call"===e.type&&"push"===e.method&&1===e.getter.length&&"tasks"===e.getter[0])).map((e=>e.args[0]));if(0===o.length)return;const r=o.find((t=>t.version>e.version));if(r)throw new Error(`Task ${(r.name||r.id).toUpperCase()} is not compatible with HARPA version ${t.version}. Please update HARPA client.`);const i=e.version;for(let t=0;t<=i;t++){if(!(t in e.versions))continue;const n=e.versions[t];a.is.function(n.patchTask)&&o.forEach((e=>n.patchTask(e)))}o.forEach((e=>e.version=i))},async _patchFunction(t,n){e.state.version>=t||await n()},_patchState(t,n){e.state.version>=t||e.transaction((e=>n(e)))},_patchTasks(t,n){e.transaction((e=>{e.tasks.filter((e=>e.version<t)).forEach((e=>n(e)))}))},_patchTabs(t,n){e.state.version>=t||e.transaction((e=>{Object.values(e.tab).forEach((e=>n(e)))}))}}})(),(()=>{const{$store:e,$nanoid:t}=n,a="1234567890abcdefghijklmnopqrstuvwxyz",o=t.customAlphabet(a,16),r=t.customAlphabet(a,12);e.idGenerator={agent:()=>`agent-${o()}`,task:()=>`task-${r()}`,job:()=>`job-${r()}`}})(),(()=>{const{$store:e,$ai:t}=n;e.template.ai=()=>({presetConnectionDone:!1,connections:[{id:"openai-session:text-davinci-002-render-sha",type:"openai-session",slug:"text-davinci-002-render-sha",title:"GPT-3.5",maxTokens:8191},{id:"openai-license",type:"openai-license",slug:t.proxy.openaiLicenseDefaultModel.slug,apiKey:"",showAdvanced:!1,temperature:null,presencePenalty:null,frequencyPenalty:null,systemPrompt:null,proxyUrl:null},{id:"bard-session",type:"bard-session",token:null}],openaiSession:{status:null,loading:!1,accessToken:null,help:{useTab:!1,verify:!1}}})})(),(()=>{const{$store:e,$nanoid:t}=n;e.template.chat=({tabId:n=null,connectionId:a=null}={})=>({id:t(),tabId:n,connectionId:a,bardCursor:null,openaiChatId:null,running:!1,input:"",command:null,params:{},memory:Boolean(e.state?.settings?.enableChatContext),explorer:{show:!1,category:null,commandName:null,editCommandName:null},messages:[]})})(),(()=>{const{$store:e}=n;e.template.commands=()=>({list:[{version:1,meta:{name:"MwNwg0uWG8rt8E6-X0mKV",title:"Sample custom command: 5 facts",description:"This is a sample GPT-powered command. Use it as a reference, feel free to edit or remove.",category:"User"},steps:[{type:"ask",selected:!1,param:"p1",message:" This is a sample command. Enter a country name or a topic, and I will provide 5 surprising facts.",default:"Finland"},{type:"gpt",selected:!1,prompt:"Please ignore all previous instructions. Please provide 5 not so well known / surprising facts about {{p1}}. Format every fact:\n\n- [relevant fact emoji] [fact]\n\nFacts:"}]}],favouriteCommandNames:[],selectedCommandNames:[]})})(),(()=>{const{$store:e}=n;e.template.creator=()=>({pageUrl:null,parseStatus:null,parseError:null,screen:"templates",editingTaskId:null,templateIndex:-1,configMode:"simple",templates:[],frame:{wide:!1,open:!1,collapsed:!1},trapper:{data:[],grabbing:!1,text:""}})})(),(()=>{const{$store:e}=n;e.template.dashboard=()=>({aggregation:"none",stoppedTasks:[],selectedTasks:[],predefinedImportedAt:null})})(),(()=>{const{$store:e}=n;e.template.journal=()=>({filters:{period:"all-time",filterString:"",types:["task-management","task-results","action","system"]},events:[{ms:Date.now(),type:"system",code:"ok",content:"HARPA agent is installed and ready to run automations",taskName:"SYSTEM"}]})})(),(()=>{const{$store:e,$library:t}=n;e.template.library=()=>({recipesUpdateAt:null,recipes:[],recipeIdeas:[],upvotedRecipes:[],recipeIdeaCard:t.recipeIdeaCardModel(),domains:{}})})(),(()=>{const{$store:e}=n;e.template.news=()=>({show:!1,rated:null,reviewed:!1,feedbackMessage:"",feedbackEmail:"",feedbackStatus:null,lastSeenVersion:null,lastSeenAnno:null})})(),(()=>{const{$store:e}=n;e.template.peeker=()=>({show:!1,fixed:!1,taskId:null,recordMs:null,steps:null,screenshot:null,stepsCollapsed:!1,widgetCollapsed:!1,screenshotCollapsed:!1})})(),(()=>{const{$store:e}=n;e.template.record=()=>({ms:null,value:null,metric:null,status:null,color:null,triggered:!1,dispatched:null,info:null})})(),(()=>{const{$store:e}=n;e.template.runner=()=>({netStable:navigator.onLine,queue:[],actions:{notification:{testStatus:null},sound:{testStatus:null,voices:[]},email:{testStatus:null,testMessage:null},webhook:{testStatus:null,testMessage:null},make:{testStatus:null,testMessage:null}}})})(),(()=>{const{$store:e}=n;e.template.settings=()=>({show:!1,showContext:!0,promptLanguage:"english",connectionId:null,autoClearDialogs:!0,storageLimit:5e3,scheduledTimeframe:{enabled:!1,from:"18:00",till:"8:00"},silenceActions:{enabled:!1},maxParallelTasks:1,autoCloseHiddenWindow:!1,serpTemplate:"smart",serpTemplateCustom:'I am searching for "{{query}}" online. Can you give me info on the topic or answer the question? If possible, give me some relevant links as well. If it is a code related question, please only output the code:',enableChatContext:!0,showScrollbars:!1,sendOnEnter:!0})})(),(()=>{const{$store:e}=n;e.template.shortcut=()=>{const e=navigator.platform.toLowerCase();return{enabled:!0,key:"A",code:65,label:e.startsWith("mac")?" A":"Alt + A",ctrlKey:e.startsWith("mac"),altKey:!e.startsWith("mac"),metaKey:!1,hint:!0,commands:[{id:"rephrase",label:"Improve & rephrase"},{id:"shorten",label:"Shorten"},{id:"expand",label:"Expand"},{id:"rewrite",label:"Rewrite"},{id:"fix-grammar",label:"Fix grammar"},{id:"translate",label:"Translate"},{id:"reply",label:"Reply"},{id:"favourites",label:"Favourites"}]}}})(),(()=>{const{$store:e,$env:t}=n;e.template.state=()=>({version:e.version,agentId:e.idGenerator.agent(),installedMs:null,theme:"day",mainScreen:"dashboard",ai:e.template.ai(),news:e.template.news(),settings:e.template.settings(),shortcut:e.template.shortcut(),commands:e.template.commands(),dashboard:e.template.dashboard(),peeker:e.template.peeker(),runner:e.template.runner(),library:e.template.library(),journal:e.template.journal(),tab:{},chats:[],tasks:[],global:{},billing:{hrpCookie:null},feature:{updatedAt:-1,hash:null},recipes:{},redactor:{show:!1,taskId:null},sandbox:{isRunning:!1,tests:[]},welcome:{shown:!1,step:1,stepsSubtitle:"AI agent is missing",guidesSubtitle:"COMING SOON"},stats:{taskRuns:0,clickedJoinDiscord:!1},...t.is.desktop&&{shell:e.template.shell()}})})(),(()=>{const{$store:e}=n;e.template.tab=()=>({screen:"ai",creator:e.template.creator(),shortcutCommand:null})})(),(()=>{const{$store:e}=n;e.template.task=({id:t}={})=>({id:t||e.idGenerator.task(),version:e.version,createdMs:Date.now(),recipeId:"watcher.monitorChanges",name:"",enabled:!0,inputScreen:"overview",inputs:{},widgets:{},records:[],state:{}})})(),(()=>{const{$store:e,$env:t}=n;e.__defineGetter__("version",(()=>t.is.bg?Math.max(...Object.keys(e.versions).map(Number)):e.state.version))})(),(()=>{const{$store:e,$nanoid:t}=n;e.versions={139:{patchState:e=>{e.commands.list.forEach((e=>{e.steps.filter((e=>"paste"===e.type||"click"===e.type)).forEach((e=>{e.showMore=!1,e.waitFor="idle",e.onFailure="skip",e.closeFrame=e.close||!1,delete e.close}))}))}},138:{patchTab:e=>{delete e.grabber,e.creator.trapper.text=""}},137:{patchState:e=>{for(const t of e.ai.connections)"openai-license"===t.type&&(t.showAdvanced=!1,t.temperature=null,t.presencePenalty=null,t.frequencyPenalty=null,t.systemPrompt=null,t.proxyUrl=null)}},136:{patchState:e=>{e.global={};for(const t of e.chats)t.params={}}},135:{patchState:e=>{e.feature.updatedAt=-1}},134:{patchState:e=>{e.ai.presetConnectionDone=!0}},133:{patchTab:e=>{e.grabber={text:e.dialog.context.custom,grabbing:e.dialog.context.grabbing},delete e.dialog}},132:{patchState:e=>{e.ai.connections.find((e=>"bard-session"===e.id)).token=null}},131:{patchState:e=>{for(const t of e.ai.connections)"openai-license"===t.type&&(t.slug=t.modelSlug,delete t.modelSlug)}},130:{patchState:e=>{const t=e.ai.connections.find((e=>"openai-session"===e.id)).modelSlug,n=e.ai.openaiSession.models.map((e=>({id:`openai-session:${e.slug}`,type:"openai-session",slug:e.slug,title:e.title,description:e.description,maxTokens:e.maxTokens})));if(0===n.length&&n.push({id:"openai-session:text-davinci-002-render-sha",type:"openai-session",slug:"text-davinci-002-render-sha",title:"GPT-3.5",maxTokens:8191}),e.ai.connections=[...n,...e.ai.connections.filter((e=>"openai-session"!==e.type))],delete e.ai.openaiSession.models,"openai-session"===e.settings.connectionId){const a=t||n[0].slug;e.settings.connectionId=`openai-session:${a}`}for(const a of e.chats){if("openai-session"!==a.connectionId)continue;const e=t||n[0].slug;a.connectionId=`openai-session:${e}`}}},129:{patchState:e=>{const t=e.ai.connections.find((e=>"openai-session"===e.id));e.ai.openaiSession={status:t.status,loading:t.loading,accessToken:t.accessToken,help:t.help,models:e.ai.openaiSessionModels},delete t.status,delete t.loading,delete t.accessToken,delete t.help,delete e.ai.openaiSessionModels}},128:{patchState:e=>{{const t=e.ai.connections.find((e=>"openai-session"===e.id));t.modelSlug=t.model,delete t.model}{const t=e.ai.connections.find((e=>"openai-license"===e.id));t.modelSlug=t.model,delete t.model}}},127:{patchState:e=>{const t=e.ai.connections.find((e=>"openai-session"===e.id));e.ai.openaiSessionModels=t.models||[],delete t.models}},126:{patchState:e=>{e.chats=e.ai.chats,delete e.ai.chats}},125:{patchState:e=>{for(const t of e.ai.chats){t.bardCursor=t.cursor,t.openaiChatId=null,delete t.cursor;const n=e.tab[t.tabId]?.dialog;n&&(t.openaiChatId=n.chatId||null,delete n.chatId)}}},124:{patchState:e=>{const t=e.ai.connections.find((e=>"openai-session"===e.id));Object.assign(t,e.openai.session),delete e.openai}},123:{patchState:e=>{for(const t in e.tab){const n=Number(t),a=e.ai.chats.find((e=>e.tabId===n)),o=e.tab[n].dialog;a&&o&&(a.explorer={show:o.explorer.show,category:o.explorer.category,commandName:o.explorer.commandName,editCommandName:o.explorer.editCommandName},delete o.explorer)}}},122:{patchTab:e=>{e.dialog.explorer.editCommandName=e.dialog.explorer.editCommandId,delete e.dialog.explorer.editCommandId}},121:{patchState:e=>{for(const t in e.tab){const n=Number(t),a=e.ai.chats.find((e=>e.tabId===n)),o=e.tab[n].dialog;a&&o&&(a.memory=o.memory,delete o.memory)}}},120:{patchState:e=>{for(const t in e.tab){const n=Number(t),a=e.ai.chats.find((e=>e.tabId===n)),o=e.tab[n].dialog;a&&o&&(a.command=o.command,delete o.command)}}},119:{patchState:e=>{for(const t in e.tab){const n=Number(t),a=e.ai.chats.find((e=>e.tabId===n)),o=e.tab[n].dialog;a&&o&&(a.running=o.running,delete o.started,delete o.running)}}},118:{patchState:e=>{for(const t of e.ai.chats)t.connectionId=e.settings.connectionId}},117:{patchState:e=>{e.settings.connectionId=e.ai.connectionId,delete e.ai.connectionId}},116:{patchState:e=>{e.ai.connections=[{id:"openai-session",type:"openai-session",model:e.settings.chatGptModel},{id:"openai-license",type:"openai-license",model:e.openai.license.modelSlug,apiKey:e.openai.license.apiKey},{id:"bard-session",type:"bard-session"}],delete e.settings.chatGptModel,delete e.openai.license}},115:{patchState:e=>{e.ai.chats=[];for(const n in e.tab){const a=e.tab[n];e.ai.chats.push({id:t(),tabId:Number(n),messages:a.dialog.messages}),delete a.dialog.messages}}},114:{patchTab:e=>{e.dialog.messages=e.dialog.chat,delete e.dialog.chat}},113:{patchState:e=>{e.ai={connectionId:"license"===e.settings.connection?"openai-license":"openai-session"},delete e.settings.connection}},112:{patchState:e=>{const t=e.openai.license.model||{slug:"gpt-3.5-turbo"};e.openai.license.modelSlug=t.slug,delete e.openai.license.model}},111:{patchState:e=>{Object.keys(e.tab).forEach((t=>{t.includes("-")&&delete e.tab[t]}))}},110:{patchState:e=>{e.shortcut.enabled=!0,e.settings.showScrollbars=!1,e.settings.sendOnEnter=!0}},109:{patchState:e=>{e.feature={updatedAt:-1,hash:null}}},108:{patchState:e=>{e.settings.enableChatContext=!0}},107:{patchState:t=>{t.shortcut.commands=e.template.shortcut().commands}},106:{patchState:e=>{e.settings.autoClearDialogs=!0}},105:{patchState:e=>{e.gaia={}}},104:{patchState:e=>{e.openai.license.model={slug:"gpt-3.5-turbo",maxTokens:4096}}},103:{patchState:e=>{delete e.openai.session.help.show}},102:{patchTab:e=>{delete e.dialog.connection}},101:{patchTab:e=>{e.dialog.connection="session"}},100:{patchState:e=>{e.settings.connection="session",delete e.settings.connectionType}},99:{patchState:e=>{e.openai.session.models=e.openai.session.models.map((e=>({slug:e.slug,title:e.title,description:e.description,maxTokens:e.max_tokens})))}},98:{patchState:e=>{e.settings={...e.settings,serpTemplate:"smart",serpTemplateCustom:'I am searching for "{{query}}" online. Can you give me info on the topic or answer the question? If possible, give me some relevant links as well. If it is a code related question, please only output the code:'}}},97:{patchState:e=>{e.shortcut.hint=!0}},96:{patchState:e=>{e.openai={session:e.openai,license:{apiKey:null}}}},95:{patchState:e=>{e.settings.connectionType="session"}},94:{patchState:t=>{t.commands.list=[...e.template.commands().list,...t.commands.list]}},93:{patchState:e=>{Object.keys(e.tab).forEach((t=>{e.tab[t].dialog.chat.forEach((e=>{e.commandName=e.commandId,delete e.commandId}))}))}},92:{patchState:e=>{e.commands.favouriteCommandNames=e.commands.favouriteCommandIds,delete e.commands.favouriteCommandIds,e.commands.selectedCommandNames=e.commands.selectedCommandIds,delete e.commands.selectedCommandIds}},91:{patchState:e=>{e.commands.favouriteCommandIds=(e.commands.favouriteCommandIds||[]).filter((e=>"extended-summary"!==e))}},90:{patchState:e=>{e.commands.selectedCommandIds=[]}}}})(),(()=>{const{$welcome:e,$env:t,$browser:a}=n;e.controller={init(){this._listenToWelcomeEvents()},patchTemplate(e){this.isWelcomeTask(e)&&e.inputs?.schedule&&(e.inputs.schedule.mediumType="tab",e.inputs.schedule.autoCloseTab=!1,e.inputs.schedule.type="periodical",e.inputs.schedule.periodical.frequency="15m")},isWelcomeTask:e=>e.inputs.page?.url===t.welcomeUrl,_listenToWelcomeEvents(){chrome.runtime.onMessage.addListener(((t,n)=>{const o=t?.type;if(!o)return;const r=n?.tab?.id;r&&("welcome.fetchState"===o?(this._updatePageState(),chrome.tabs.sendMessage(r,{type:"welcome.setState",state:e.proxy.state})):"welcome.showPopup"===o&&a.controller.toggleFrame(r))}))},_updatePageState(){e.proxy.update({stepsSubtitle:"Follow these steps to set up a page monitor",dashboardLink:chrome.runtime.getURL("/harpa.html")})}}})(),(()=>{const{$welcome:e,$store:t}=n;e.proxy=t.adapter.create({get:e=>e.welcome,get state(){return t.state.welcome}})})(),(()=>{const{$uninstall:e,$store:t,$env:a}=n;e.controller={init(){const e=t.state.agentId||"";chrome.runtime.setUninstallURL(`${a.apiUrl}/uninstall?uid=${e}`)}}})(),(()=>{const{$timer:e,$utils:t,$bus:a}=n;e.aliveController={init(){this.startedAt=Date.now(),this.alarmsReceived=0,this.eventsReceived=0,this.setupAlarmAlive(),this.setupBusAlive(),this.setupAutoreload()},setupAlarmAlive(){t.chrome.alarms.run((()=>this.alarmsReceived++),{name:"timer.alive",delayInMinutes:1,periodInMinutes:1})},setupAutoreload(){const e=chrome.storage.local,t=()=>{new Promise((t=>{let n=!1;const a=()=>{e.onChanged.removeListener(a),n=!0};e.onChanged.addListener(a),e.set({testEventDispatching:Math.random()}),setTimeout((()=>t(!n)),100)})).then((e=>{e?chrome.runtime.reload():setTimeout(t,1e4)}))};t()},setupBusAlive(){a.on("timer.keepBgAlive",(()=>this.eventsReceived++))},logStats(){const e=Date.now(),n=Math.floor((e-this.startedAt)/t.time.MINUTE),a=`${Math.floor(n/60)}h ${n%60}m`,o=`${this.alarmsReceived} alarms`,r=`${this.eventsReceived} events`;console.log(`[$timer] alive for: ${a}, ${o}, ${r}`)}}})(),(()=>{const{$timer:e,$env:t}=n;e.controller={init(){chrome.alarms.clearAll(),3===t.manifestVersion&&(e.offscreenController.init(),e.aliveController.init()),2===t.manifestVersion&&e.workerController.init()}}})(),(()=>{const{$timer:e,$offscreen:t,$bus:a}=n;e.offscreenController={init(){this._MAX_ID=2147483647,this._lastId=0,this._timerIds=new Set,this._setup()},_setup(){globalThis.setTimeout=(e,n,...a)=>{const o=this._generateId();return this._timerIds.add(o),t.controller.send("setTimeout",o,n).then((()=>{this._timerIds.has(o)&&e(...a)})),o},globalThis.clearTimeout=e=>{this._timerIds.delete(e),t.controller.send("clearTimeout",e)},globalThis.setInterval=(e,n,...o)=>{const r=this._generateId();return this._timerIds.add(r),t.controller.send("setInterval",r,n),a.on(`offscreen.setIntervalCall:${r}`,(()=>e(...o))),r},globalThis.clearInterval=e=>{this._timerIds.delete(e),a.off(`offscreen.setIntervalCall:${e}`),t.controller.send("clearInterval",e)}},_generateId(){return this._lastId+=1,this._lastId===this._MAX_ID&&(this._lastId=1),this._lastId}}})(),(()=>{const{$timer:e,$logger:t}=n;e.workerController={init(){this.MAX_ID=2147483647,this.lastId=0,this.idToCallback={},this._setupWorker("/js/timer-worker.min.js")},_generateId(){do{this.lastId===this.MAX_ID?this.lastId=0:this.lastId++}while(this.idToCallback.hasOwnProperty(this.lastId));return this.lastId},_setupWorker(e){const n=this.idToCallback;try{const a=new Worker(e);window.setInterval=(e,t)=>{const o=this._generateId();return n[o]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},a.postMessage({name:"setInterval",id:o,time:t}),o},window.clearInterval=e=>{n.hasOwnProperty(e)&&(delete n[e],a.postMessage({name:"clearInterval",id:e}))},window.setTimeout=(e,t)=>{const o=this._generateId();return n[o]={callback:e,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},a.postMessage({name:"setTimeout",id:o,time:t}),o},window.clearTimeout=e=>{n.hasOwnProperty(e)&&(delete n[e],a.postMessage({name:"clearTimeout",id:e}))},a.onmessage=e=>{const a=e.data.id;if(!a||!n.hasOwnProperty(a))return;const o=n[a],r=o.parameters;let i=o.callback;if(o.isTimeout&&delete n[a],"string"==typeof i)try{i=new Function(i)}catch(e){t.error("[$timer] error parsing callback code string",e)}"function"==typeof i&&i.apply(window,r)},a.onerror=e=>{t.error("[$timer] worker posted an error event",e)}}catch(e){t.error("[$timer] failed setting up timer worker",e)}}}})(),(()=>{const{$task:e}=n;e.languages={auto:"Do not force language",en_US:"English (United States)",en_GB:"English (United Kingdom)",af:"Afrikaans",af_NA:"Afrikaans (Namibia)",af_ZA:"Afrikaans (South Africa)",ak:"Akan",ak_GH:"Akan (Ghana)",sq:"Albanian",sq_AL:"Albanian (Albania)",am:"Amharic",ar:"Arabic",am_ET:"Amharic (Ethiopia)",ar_DZ:"Arabic (Algeria)",ar_BH:"Arabic (Bahrain)",ar_EG:"Arabic (Egypt)",ar_IQ:"Arabic (Iraq)",ar_JO:"Arabic (Jordan)",ar_KW:"Arabic (Kuwait)",ar_LB:"Arabic (Lebanon)",ar_LY:"Arabic (Libya)",ar_MA:"Arabic (Morocco)",ar_OM:"Arabic (Oman)",ar_QA:"Arabic (Qatar)",ar_SA:"Arabic (Saudi Arabia)",ar_SD:"Arabic (Sudan)",ar_SY:"Arabic (Syria)",ar_TN:"Arabic (Tunisia)",ar_AE:"Arabic (United Arab Emirates)",ar_YE:"Arabic (Yemen)",hy:"Armenian",hy_AM:"Armenian (Armenia)",as:"Assamese",as_IN:"Assamese (India)",asa:"Asu",asa_TZ:"Asu (Tanzania)",az:"Azerbaijani",az_Cyrl:"Azerbaijani (Cyrillic)",az_Cyrl_AZ:"Azerbaijani (Cyrillic, Azerbaijan)",az_Latn:"Azerbaijani (Latin)",az_Latn_AZ:"Azerbaijani (Latin, Azerbaijan)",bm:"Bambara",bm_ML:"Bambara (Mali)",eu:"Basque",eu_ES:"Basque (Spain)",be:"Belarusian",be_BY:"Belarusian (Belarus)",bem:"Bemba",bem_ZM:"Bemba (Zambia)",bez:"Bena",bez_TZ:"Bena (Tanzania)",bn:"Bengali",bn_BD:"Bengali (Bangladesh)",bn_IN:"Bengali (India)",bs:"Bosnian",bs_BA:"Bosnian (Bosnia and Herzegovina)",bg:"Bulgarian",bg_BG:"Bulgarian (Bulgaria)",my:"Burmese",my_MM:"Burmese (Myanmar [Burma])",yue_Hant_HK:"Cantonese (Traditional, Hong Kong SAR China)",ca:"Catalan",ca_ES:"Catalan (Spain)",tzm:"Central Morocco Tamazight",tzm_Latn:"Central Morocco Tamazight (Latin)",tzm_Latn_MA:"Central Morocco Tamazight (Latin, Morocco)",chr:"Cherokee",chr_US:"Cherokee (United States)",cgg:"Chiga",cgg_UG:"Chiga (Uganda)",zh:"Chinese",zh_Hans:"Chinese (Simplified Han)",zh_Hans_CN:"Chinese (Simplified Han, China)",zh_Hans_HK:"Chinese (Simplified Han, Hong Kong SAR China)",zh_Hans_MO:"Chinese (Simplified Han, Macau SAR China)",zh_Hans_SG:"Chinese (Simplified Han, Singapore)",zh_Hant:"Chinese (Traditional Han)",zh_Hant_HK:"Chinese (Traditional Han, Hong Kong SAR China)",zh_Hant_MO:"Chinese (Traditional Han, Macau SAR China)",zh_Hant_TW:"Chinese (Traditional Han, Taiwan)",kw:"Cornish",kw_GB:"Cornish (United Kingdom)",hr:"Croatian",hr_HR:"Croatian (Croatia)",cs:"Czech",cs_CZ:"Czech (Czech Republic)",da:"Danish",da_DK:"Danish (Denmark)",nl:"Dutch",nl_BE:"Dutch (Belgium)",nl_NL:"Dutch (Netherlands)",ebu:"Embu",ebu_KE:"Embu (Kenya)",en:"English",en_AS:"English (American Samoa)",en_AU:"English (Australia)",en_BE:"English (Belgium)",en_BZ:"English (Belize)",en_BW:"English (Botswana)",en_CA:"English (Canada)",en_GU:"English (Guam)",en_HK:"English (Hong Kong SAR China)",en_IN:"English (India)",en_IE:"English (Ireland)",en_IL:"English (Israel)",en_JM:"English (Jamaica)",en_MT:"English (Malta)",en_MH:"English (Marshall Islands)",en_MU:"English (Mauritius)",en_NA:"English (Namibia)",en_NZ:"English (New Zealand)",en_MP:"English (Northern Mariana Islands)",en_PK:"English (Pakistan)",en_PH:"English (Philippines)",en_SG:"English (Singapore)",en_ZA:"English (South Africa)",en_TT:"English (Trinidad and Tobago)",en_UM:"English (U.S. Minor Outlying Islands)",en_VI:"English (U.S. Virgin Islands)",en_ZW:"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",et_EE:"Estonian (Estonia)",ee:"Ewe",ee_GH:"Ewe (Ghana)",ee_TG:"Ewe (Togo)",fo:"Faroese",fo_FO:"Faroese (Faroe Islands)",fil:"Filipino",fil_PH:"Filipino (Philippines)",fi:"Finnish",fi_FI:"Finnish (Finland)",fr:"French",fr_BE:"French (Belgium)",fr_BJ:"French (Benin)",fr_BF:"French (Burkina Faso)",fr_BI:"French (Burundi)",fr_CM:"French (Cameroon)",fr_CA:"French (Canada)",fr_CF:"French (Central African Republic)",fr_TD:"French (Chad)",fr_KM:"French (Comoros)",fr_CG:"French (Congo - Brazzaville)",fr_CD:"French (Congo - Kinshasa)",fr_CI:"French (Cte dIvoire)",fr_DJ:"French (Djibouti)",fr_GQ:"French (Equatorial Guinea)",fr_FR:"French (France)",fr_GA:"French (Gabon)",fr_GP:"French (Guadeloupe)",fr_GN:"French (Guinea)",fr_LU:"French (Luxembourg)",fr_MG:"French (Madagascar)",fr_ML:"French (Mali)",fr_MQ:"French (Martinique)",fr_MC:"French (Monaco)",fr_NE:"French (Niger)",fr_RW:"French (Rwanda)",fr_RE:"French (Runion)",fr_BL:"French (Saint Barthlemy)",fr_MF:"French (Saint Martin)",fr_SN:"French (Senegal)",fr_CH:"French (Switzerland)",fr_TG:"French (Togo)",ff_SN:"Fulah (Senegal)",ff:"Fulah",gl:"Galician",gl_ES:"Galician (Spain)",lg:"Ganda",lg_UG:"Ganda (Uganda)",ka:"Georgian",ka_GE:"Georgian (Georgia)",de:"German",de_AT:"German (Austria)",de_BE:"German (Belgium)",de_DE:"German (Germany)",de_LI:"German (Liechtenstein)",de_LU:"German (Luxembourg)",de_CH:"German (Switzerland)",el:"Greek",el_CY:"Greek (Cyprus)",el_GR:"Greek (Greece)",gu:"Gujarati",gu_IN:"Gujarati (India)",guz:"Gusii",guz_KE:"Gusii (Kenya)",ha:"Hausa",ha_Latn:"Hausa (Latin)",ha_Latn_GH:"Hausa (Latin, Ghana)",ha_Latn_NE:"Hausa (Latin, Niger)",ha_Latn_NG:"Hausa (Latin, Nigeria)",haw:"Hawaiian",haw_US:"Hawaiian (United States)",he:"Hebrew",he_IL:"Hebrew (Israel)",hi:"Hindi",hi_IN:"Hindi (India)",hu:"Hungarian",hu_HU:"Hungarian (Hungary)",is:"Icelandic",is_IS:"Icelandic (Iceland)",ig:"Igbo",ig_NG:"Igbo (Nigeria)",id:"Indonesian",id_ID:"Indonesian (Indonesia)",ga:"Irish",ga_IE:"Irish (Ireland)",it:"Italian",it_IT:"Italian (Italy)",it_CH:"Italian (Switzerland)",ja:"Japanese",ja_JP:"Japanese (Japan)",kea:"Kabuverdianu",kea_CV:"Kabuverdianu (Cape Verde)",kab:"Kabyle",kab_DZ:"Kabyle (Algeria)",kl:"Kalaallisut",kl_GL:"Kalaallisut (Greenland)",kln:"Kalenjin",kln_KE:"Kalenjin (Kenya)",kam:"Kamba",kam_KE:"Kamba (Kenya)",kn:"Kannada",kn_IN:"Kannada (India)",kk:"Kazakh",kk_Cyrl:"Kazakh (Cyrillic)",kk_Cyrl_KZ:"Kazakh (Cyrillic, Kazakhstan)",km:"Khmer",km_KH:"Khmer (Cambodia)",ki:"Kikuyu",ki_KE:"Kikuyu (Kenya)",rw:"Kinyarwanda",rw_RW:"Kinyarwanda (Rwanda)",kok:"Konkani",kok_IN:"Konkani (India)",ko:"Korean",ko_KR:"Korean (South Korea)",khq:"Koyra Chiini",khq_ML:"Koyra Chiini (Mali)",ses:"Koyraboro Senni",ses_ML:"Koyraboro Senni (Mali)",lag:"Langi",lag_TZ:"Langi (Tanzania)",lv:"Latvian",lv_LV:"Latvian (Latvia)",lt:"Lithuanian",lt_LT:"Lithuanian (Lithuania)",luo:"Luo",luo_KE:"Luo (Kenya)",luy:"Luyia",luy_KE:"Luyia (Kenya)",mk:"Macedonian",mk_MK:"Macedonian (Macedonia)",jmc:"Machame",jmc_TZ:"Machame (Tanzania)",kde:"Makonde",kde_TZ:"Makonde (Tanzania)",mg:"Malagasy",mg_MG:"Malagasy (Madagascar)",ms:"Malay",ms_BN:"Malay (Brunei)",ms_MY:"Malay (Malaysia)",ml:"Malayalam",ml_IN:"Malayalam (India)",mt:"Maltese",mt_MT:"Maltese (Malta)",gv:"Manx",gv_GB:"Manx (United Kingdom)",mr:"Marathi",mr_IN:"Marathi (India)",mas:"Masai",mas_KE:"Masai (Kenya)",mas_TZ:"Masai (Tanzania)",mer:"Meru",mer_KE:"Meru (Kenya)",mfe:"Morisyen",mfe_MU:"Morisyen (Mauritius)",naq:"Nama",naq_NA:"Nama (Namibia)",ne:"Nepali",ne_IN:"Nepali (India)",ne_NP:"Nepali (Nepal)",nd:"North Ndebele",nd_ZW:"North Ndebele (Zimbabwe)",nb:"Norwegian Bokml",nb_NO:"Norwegian Bokml (Norway)",nn:"Norwegian Nynorsk",nn_NO:"Norwegian Nynorsk (Norway)",nyn:"Nyankole",nyn_UG:"Nyankole (Uganda)",or:"Oriya",or_IN:"Oriya (India)",om:"Oromo",om_ET:"Oromo (Ethiopia)",om_KE:"Oromo (Kenya)",ps:"Pashto",ps_AF:"Pashto (Afghanistan)",fa:"Persian",fa_AF:"Persian (Afghanistan)",fa_IR:"Persian (Iran)",pl:"Polish",pl_PL:"Polish (Poland)",pt:"Portuguese",pt_BR:"Portuguese (Brazil)",pt_GW:"Portuguese (Guinea-Bissau)",pt_MZ:"Portuguese (Mozambique)",pt_PT:"Portuguese (Portugal)",pa:"Punjabi",pa_Arab:"Punjabi (Arabic)",pa_Arab_PK:"Punjabi (Arabic, Pakistan)",pa_Guru:"Punjabi (Gurmukhi)",pa_Guru_IN:"Punjabi (Gurmukhi, India)",ro:"Romanian",ro_MD:"Romanian (Moldova)",ro_RO:"Romanian (Romania)",rm:"Romansh",rm_CH:"Romansh (Switzerland)",rof:"Rombo",rof_TZ:"Rombo (Tanzania)",ru:"Russian",ru_MD:"Russian (Moldova)",ru_RU:"Russian (Russia)",ru_UA:"Russian (Ukraine)",rwk:"Rwa",rwk_TZ:"Rwa (Tanzania)",saq:"Samburu",saq_KE:"Samburu (Kenya)",sg:"Sango",sg_CF:"Sango (Central African Republic)",seh:"Sena",seh_MZ:"Sena (Mozambique)",sr:"Serbian",sr_Cyrl:"Serbian (Cyrillic)",sr_Cyrl_BA:"Serbian (Cyrillic, Bosnia and Herzegovina)",sr_Cyrl_ME:"Serbian (Cyrillic, Montenegro)",sr_Cyrl_RS:"Serbian (Cyrillic, Serbia)",sr_Latn:"Serbian (Latin)",sr_Latn_BA:"Serbian (Latin, Bosnia and Herzegovina)",sr_Latn_ME:"Serbian (Latin, Montenegro)",sr_Latn_RS:"Serbian (Latin, Serbia)",sn:"Shona",sn_ZW:"Shona (Zimbabwe)",ii:"Sichuan Yi",ii_CN:"Sichuan Yi (China)",si:"Sinhala",si_LK:"Sinhala (Sri Lanka)",sk:"Slovak",sk_SK:"Slovak (Slovakia)",sl:"Slovenian",sl_SI:"Slovenian (Slovenia)",xog:"Soga",xog_UG:"Soga (Uganda)",so:"Somali",so_DJ:"Somali (Djibouti)",so_ET:"Somali (Ethiopia)",so_KE:"Somali (Kenya)",so_SO:"Somali (Somalia)",es:"Spanish",es_AR:"Spanish (Argentina)",es_BO:"Spanish (Bolivia)",es_CL:"Spanish (Chile)",es_CO:"Spanish (Colombia)",es_CR:"Spanish (Costa Rica)",es_DO:"Spanish (Dominican Republic)",es_EC:"Spanish (Ecuador)",es_SV:"Spanish (El Salvador)",es_GQ:"Spanish (Equatorial Guinea)",es_GT:"Spanish (Guatemala)",es_HN:"Spanish (Honduras)",es_419:"Spanish (Latin America)",es_MX:"Spanish (Mexico)",es_NI:"Spanish (Nicaragua)",es_PA:"Spanish (Panama)",es_PY:"Spanish (Paraguay)",es_PE:"Spanish (Peru)",es_PR:"Spanish (Puerto Rico)",es_ES:"Spanish (Spain)",es_US:"Spanish (United States)",es_UY:"Spanish (Uruguay)",es_VE:"Spanish (Venezuela)",sw:"Swahili",sw_KE:"Swahili (Kenya)",sw_TZ:"Swahili (Tanzania)",sv:"Swedish",sv_FI:"Swedish (Finland)",sv_SE:"Swedish (Sweden)",gsw:"Swiss German",gsw_CH:"Swiss German (Switzerland)",shi:"Tachelhit",shi_Latn:"Tachelhit (Latin)",shi_Latn_MA:"Tachelhit (Latin, Morocco)",shi_Tfng:"Tachelhit (Tifinagh)",shi_Tfng_MA:"Tachelhit (Tifinagh, Morocco)",dav:"Taita",dav_KE:"Taita (Kenya)",ta:"Tamil",ta_IN:"Tamil (India)",ta_LK:"Tamil (Sri Lanka)",te:"Telugu",te_IN:"Telugu (India)",teo:"Teso",teo_KE:"Teso (Kenya)",teo_UG:"Teso (Uganda)",th:"Thai",th_TH:"Thai (Thailand)",bo:"Tibetan",bo_CN:"Tibetan (China)",bo_IN:"Tibetan (India)",ti:"Tigrinya",ti_ER:"Tigrinya (Eritrea)",ti_ET:"Tigrinya (Ethiopia)",to:"Tonga",to_TO:"Tonga (Tonga)",tr:"Turkish",tr_TR:"Turkish (Turkey)",uk:"Ukrainian",uk_UA:"Ukrainian (Ukraine)",ur:"Urdu",ur_IN:"Urdu (India)",ur_PK:"Urdu (Pakistan)",uz_Arab:"Uzbek (Arabic)",uz_Arab_AF:"Uzbek (Arabic, Afghanistan)",uz:"Uzbek",uz_Cyrl:"Uzbek (Cyrillic)",uz_Cyrl_UZ:"Uzbek (Cyrillic, Uzbekistan)",uz_Latn:"Uzbek (Latin)",uz_Latn_UZ:"Uzbek (Latin, Uzbekistan)",vi:"Vietnamese",vi_VN:"Vietnamese (Vietnam)",vun:"Vunjo",vun_TZ:"Vunjo (Tanzania)",cy:"Welsh",cy_GB:"Welsh (United Kingdom)",yo:"Yoruba",yo_NG:"Yoruba (Nigeria)",zu:"Zulu",zu_ZA:"Zulu (South Africa)"}})(),(()=>{const{$task:e}=n;e.mediumTypes=[{id:"tab",name:"tab",label:"Tab"},{id:"pinned-tab",name:"pinned tab",label:"Pinned Tab"},{id:"hidden-tab",name:"hidden frame",label:"Hidden Frame"}],e.mediumTypesWithAutoClosing=e.mediumTypes.map((e=>[{id:`t:${e.id}`,name:`${e.name} (auto-close)`,label:`${e.label} (auto-close)`},{id:`p:${e.id}`,name:`${e.name} (persistent)`,label:`${e.label} (persistent)`}])).flat()})(),(()=>{const{$task:e,$store:t,$library:a,$utils:o,$ui:r}=n;e.proxy=t.createProxy({get recipes(){return t.state.recipes},set recipes(e){t.transaction((t=>{t.recipes=e||{}}))},recipeById(e){return this.recipes[e]},recipeName(e){return this._computeMetaValue("name",e)},recipeIcon(e){const t=this._computeMetaValue("icon",e);return r.Icon.icons[t]},recipeTitle(e){return this._computeMetaValue("title",e)},recipeUnderDevelopment(e){return this._computeMetaValue("underDevelopment",e)},recipeShowGrabber(e){return this._computeMetaValue("showGrabber",e)},_computeMetaValue(t,n){const a="string"==typeof n?e.proxy.recipeById(n):e.proxy.recipeById(n.recipeId),o="string"!=typeof n&&n;return e.evaluate(a.meta[t],{recipe:a,task:o})},get tasks(){return t.state.tasks},set tasks(e){t.transaction((t=>{t.tasks=e||[]}))},taskById(e){return e?this.tasks.find((t=>t.id===e)):null},taskByTabId(e){return e?this.tasks.find((t=>t.inputs.schedule?.mediumId===e)):null},taskIndex(e){return e?this.tasks.findIndex((t=>t.id===e)):null},get taskIds(){return this.tasks.map((e=>e.id))},taskDomain(e){const t=e.inputs?.page?.url;return t?o.url.getDomain(t,{canonical:!0,noTld:!0}):null},get taskMediumIds(){return this.tasks.map((e=>e.inputs.schedule?.mediumId)).filter((e=>!!e))},taskLastRecord:e=>e.records.at(-1),updateFavicons(t,n){t=o.ensureArray(t);const r=n&&e.proxy.taskDomain(n);0!==t.length&&(t.map((e=>"string"==typeof e?{favicon:e,hq:!0}:e)).map((e=>(e.domain||(e.domain=r),e))).filter((e=>Boolean(e.domain))),a.proxy.setDomainFavicons(t))},updateTask(e,n={},a=null){const o=this.taskIndex(e);if(-1===o)throw new Error(`no task found for id ${e}`);t.transaction((e=>{let t=e.tasks[o];a&&(t=t[a]),"function"==typeof n?n(t):Object.assign(t,n)}))},removeRecords(e){t.transaction((t=>{for(const n in e){const a=t.tasks.find((e=>e.id===n));a&&(a.records=a.records.filter((t=>!e[n].has(t.ms))))}}))}})})(),(()=>{const{$task:e}=n;e.scheduleFrequencies=[{id:"15s",label:"Every 15 seconds",selectedLabel:"15 seconds"},{id:"1m",label:"Every minute",selectedLabel:"1 minute"},{id:"5m",label:"Every 5 minutes",selectedLabel:"5 mins"},{id:"15m",label:"Every 15 minutes",selectedLabel:"15 mins"},{id:"1h",label:"Every hour",selectedLabel:"1 hour"},{id:"3h",label:"Every 3 hours",selectedLabel:"3 hours"},{id:"12h",label:"Every 12 hours",selectedLabel:"12 hours"},{id:"1d",label:"Every day",selectedLabel:"1 day"},{id:"1w",label:"Every week",selectedLabel:"1 week"},{id:"1mo",label:"Every month",selectedLabel:"1 month"}]})(),(()=>{const{$task:e}=n;e.trackingItems=[{id:"between-checks",label:"between checks"},{id:"to-first-check",label:"to the first check made"}]})(),(()=>{const{$task:e}=n;e.userAgents={"macbook-13.4":{name:"MacBook 13.4'",icon:"mac",viewportWidth:1366,viewportHeight:768,userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36"},"windows-pc":{name:"Windows PC",icon:"win",viewportWidth:1600,viewportHeight:900,userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"},"galaxy-s5":{name:"Galaxy S5",icon:"android",viewportWidth:360,viewportHeight:480,userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Mobile Safari/537.36"},"iphone-x":{name:"iPhone X",icon:"iphone",viewportWidth:375,viewportHeight:812,userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.5 Mobile/15E148 Safari/604.1"}}})(),(()=>{const{$task:e,$recipe:t,$store:a,$mobx:o,$utils:r,$critical:i,$env:s}=n;e.Adapter=class{static ofTask(t){return t?new e.Adapter(t):null}constructor(e){if(!e)throw new Error("$task.Adapter task argument must be defined");this._task=e}get taskProxy(){return this._task}get taskObject(){return o.toJS(this._task)}transaction(e){const t=this._task.id;a.transaction((n=>{const a=(s.is.pp?n.tab[i.proxy.tabId]?.creator:null)?.templates.find((e=>e.id===t))||n.tasks.find((e=>e.id===t));a&&e(a,n)}))}resetTaskState(e=!0){const n=a.template.task({id:this.id});e&&Object.entries(t.inputs).forEach((([e,t])=>{const a=this._task.inputs[e];n.inputs[e]=a&&t.persistState?a:t.state})),this.transaction((e=>{Object.keys(n).forEach((t=>{e[t]=n[t]})),Object.keys(e).filter((e=>!n.hasOwnProperty(e))).forEach((t=>delete e[t]))}))}get id(){return this._task.id}set id(e){this.transaction((t=>t.id=e))}get name(){return this._task.name}set name(e){this.transaction((t=>t.name=e))}get enabled(){return this._task.enabled}set enabled(e){this.transaction((t=>t.enabled=e))}toggleEnabled(){this.transaction((e=>e.enabled=!e.enabled))}get createdMs(){return this._task.createdMs}get recipeId(){return this._task.recipeId}set recipeId(e){this.transaction((t=>t.recipeId=e))}get recipe(){return e.proxy.recipeById(this.recipeId)}get state(){return this._task.state}updateState(e={}){this.transaction((t=>Object.assign(t.state,e)))}get inputScreen(){return this._task.inputScreen}set inputScreen(e){this.transaction((t=>t.inputScreen=e))}get records(){return this._task.records}resetRecords(){const e=a.template.task();this.transaction((t=>t.records=e.records))}get firstRecord(){return this.records[0]}set firstRecord(e){this.transaction((t=>t.records[0]=e))}get lastRecord(){return this.records.at(-1)||{}}set lastRecord(e){const t=this.records.length;this.transaction((n=>{0===t?n.records.push(e):n.records[t-1]=e}))}get previousRecord(){const e=this.trackingValue,t=this.records.filter((e=>"warning"!==e.status&&"error"!==e.status));return e&&"between-checks"!==e?"to-first-check"===e?t.length>1?t[0]:{}:null:t.length>1?t.at(-2):{}}dropToFirstRecord(){const e=this.firstRecord;e&&this.transaction((t=>t.records=[e]))}get inputs(){return this._task.inputs}input(e){return this.ensureInput(e),this._task.inputs[e]}ensureInput(e){this._task.inputs[e]||this.transaction((n=>n.inputs[e]=t.proxy.input(e).state))}updateInput(e,t){this.ensureInput(e),this.transaction((n=>Object.assign(n.inputs[e],t)))}get page(){return this.input("page")}updatePage(e){this.transaction((t=>Object.assign(t.inputs.page,e)))}get pageUrl(){return this.page.url}set pageUrl(e){this.updatePage({url:e})}get ua(){return this.input("ua")}updateUa(e){this.transaction((t=>Object.assign(t.inputs.ua,e)))}get uaVlang(){return this.input("ua").vlang}set uaVlang(e){this.updateUa({vlang:e})}get uaVua(){return this.input("ua").vua}set uaVua(e){this.updateUa({vua:e})}get uaCustomViewport(){return this.input("ua").customViewport}set uaCustomViewport(e){this.updateUa({customViewport:e})}get uaViewportWidth(){return this.input("ua").viewportWidth}set uaViewportWidth(e){this.updateUa({viewportWidth:e})}get uaViewportHeight(){return this.input("ua").viewportHeight}set uaViewportHeight(e){this.updateUa({viewportHeight:e})}get pageMediumSize(){const t=this.input("ua");return{width:t.customViewport?t.viewportWidth||"100%":e.userAgents[t.vua]?.viewportWidth||"100%",height:t.customViewport?t.viewportHeight||"100%":e.userAgents[t.vua]?.viewportHeight||"100%"}}get before(){return this.input("before")}updateBefore(e,t){"string"!=typeof e?(t=e,this.transaction((e=>Object.assign(e.inputs.before,t)))):this.transaction((n=>Object.assign(n.inputs.before[e],t)))}get beforeIdleCheckEnabled(){return this.before.idleCheck.enabled}set beforeIdleCheckEnabled(e){this.updateBefore("idleCheck",{enabled:e})}get beforeIdleCheckTimeout(){return this.before.idleCheck.timeout}set beforeIdleCheckTimeout(e){this.updateBefore("idleCheck",{timeout:e})}get beforeIdleCheckOnTimeout(){return this.before.idleCheck.onTimeout}set beforeIdleCheckOnTimeout(e){this.updateBefore("idleCheck",{onTimeout:e})}get beforeTextCheckEnabled(){return this.before.textCheck.enabled}set beforeTextCheckEnabled(e){this.updateBefore("textCheck",{enabled:e})}get beforeTextCheckSearchText(){return this.before.textCheck.searchText}set beforeTextCheckSearchText(e){this.updateBefore("textCheck",{searchText:e})}get beforeTextCheckTimeout(){return this.before.textCheck.timeout}set beforeTextCheckTimeout(e){this.updateBefore("textCheck",{timeout:e})}get beforeTextCheckOnTimeout(){return this.before.textCheck.onTimeout}set beforeTextCheckOnTimeout(e){this.updateBefore("textCheck",{onTimeout:e})}get beforeDropBannersEnabled(){return this.before.dropBanners.enabled}set beforeDropBannersEnabled(e){this.updateBefore("dropBanners",{enabled:e})}get beforeDropBannersText(){return this.before.dropBanners.text}set beforeDropBannersText(e){this.updateBefore("dropBanners",{text:e})}get beforeScrollEnabled(){return this.before.scroll.enabled}set beforeScrollEnabled(e){this.updateBefore("scroll",{enabled:e})}get beforeScrollMaxDuration(){return this.before.scroll.maxDuration}set beforeScrollMaxDuration(e){this.updateBefore("scroll",{maxDuration:e})}get schedule(){return this.input("schedule")}updateSchedule(e,t){"string"!=typeof e?(t=e,this.transaction((e=>Object.assign(e.inputs.schedule,t)))):this.transaction((n=>Object.assign(n.inputs.schedule[e],t)))}get scheduleMediumType(){return this.schedule.mediumType}set scheduleMediumType(e){this.updateSchedule({mediumType:e})}get scheduleMediumId(){return this.schedule.mediumType}set scheduleMediumId(e){this.updateSchedule({mediumId:e})}get scheduleType(){return this.schedule.type}set scheduleType(e){this.updateSchedule({type:e})}get schedulePeriodicalFrequency(){return this.schedule.periodical.frequency}set schedulePeriodicalFrequency(e){this.updateSchedule("periodical",{frequency:e})}get scheduleAutoCloseTab(){return this.schedule.autoCloseTab}set scheduleAutoCloseTab(e){this.updateSchedule({autoCloseTab:e})}get tracking(){return this.input("tracking")}updateTracking(e){this.transaction((t=>Object.assign(t.inputs.tracking,e)))}get trackingValue(){return this.tracking.value}set trackingValue(e){this.updateTracking({value:e})}get actions(){return this.input("actions")}updateAction(e,t){this.transaction((n=>Object.assign(n.inputs.actions[e],t)))}actionEnabled(e){return this.input("actions")[e].enabled}toggleActionEnabled(e){this.transaction((t=>t.inputs.actions[e].enabled=!t.inputs.actions[e].enabled))}actionTestStatus(e){return a.state.runner.actions[e].testStatus}actionTestMessage(e){return a.state.runner.actions[e].testMessage}get actionSoundValue(){return this.input("actions").sound.value}set actionSoundValue(e){this.updateAction("sound",{value:e})}get actionSoundVolume(){return this.input("actions").sound.volume}set actionSoundVolume(e){this.updateAction("sound",{volume:e})}get actionSoundUtterance(){return this.input("actions").sound.utterance}set actionSoundUtterance(e){this.updateAction("sound",{utterance:e})}actionSendOn(e){return this.input("actions")[e].sendOn}setActionSendOn(e,t){this.transaction((n=>n.inputs.actions[e].sendOn=t))}actionLimitActions(e){return this.input("actions")[e].limitActions}setActionLimitActions(e,t){this.transaction((n=>n.inputs.actions[e].limitActions=t))}get changeUpIs(){return this.input("changeUpIs")}updateChangeUpIs(e){this.transaction((t=>Object.assign(t.inputs.changeUpIs,e)))}get changeUpIsValue(){return this.changeUpIs.value}set changeUpIsValue(e){this.updateChangeUpIs({value:e})}get trigger(){return this.input("trigger")}updateTrigger(e){this.transaction((t=>Object.assign(t.inputs.trigger,e)))}get triggerMinThreshold(){return this.trigger.minThreshold}set triggerMinThreshold(e){this.updateTrigger({minThreshold:e})}get triggerX(){return this.trigger.x}set triggerX(e){this.updateTrigger({x:e})}get triggerY(){return this.trigger.y}set triggerY(e){this.updateTrigger({y:e})}get triggerSearchText(){return this.trigger.searchText}set triggerSearchText(e){this.updateTrigger({searchText:e})}get triggerHttpCodes(){return this.trigger.httpCodes}set triggerHttpCodes(e){this.updateTrigger({httpCodes:e})}get triggerIcon(){return this.trigger.icon}set triggerIcon(e){this.updateTrigger({icon:e})}get triggerColor(){return this.trigger.color}set triggerColor(e){this.updateTrigger({color:e})}get lastRecordValue(){if(!this.lastRecord)return{value:"N/A"};let{value:e,metric:t,type:n,error:a,status:o}=this.lastRecord;return"error"===o?{value:e}:a?{value:a?.text||a}:null==e?{value:"N/A"}:r.formatter.format(e,t||n,{format:"object",maxInt:1e7})}get lastRecordValueText(){const e=this.lastRecordValue;return`${e.sign||""}${e.value}`}get lastRecordValuePrefix(){return this.lastRecordValue.prefix||""}get lastRecordValueSuffix(){const e=this.lastRecordValue;return`${e.suffix||""} ${e.metric||""}`.trim()}get lastRecordValueDimmed(){return!0===this.lastRecord.valueDimmed||null==this.lastRecord.value}get lastRecordMetric(){return this.lastRecord.metric}get lastRecordStatus(){return this.lastRecord.status}get lastRecordColor(){return this.lastRecord.color}get lastRecordTriggered(){return this.lastRecord.triggered}get lastRecordDispatched(){return this.lastRecord.dispatched}get lastRecordDelta(){return this.lastRecord&&this.lastRecord.hasOwnProperty("value")?"number"!=typeof this.lastRecord.value?null:this.previousRecord&&this.previousRecord.hasOwnProperty("value")?"number"!=typeof this.previousRecord.value?null:this.lastRecord.value-this.previousRecord.value:null:null}get lastRecordDeltaText(){const e=this.lastRecordDelta;return e?"number"==typeof e?r.formatter.format(e,this.lastRecord.metric):e:null}get lastRecordDeltaColor(){const e=this.lastRecordDelta;if(!e)return null;const t=this.changeUpIsValue;return t?"neutral"===t?"neutral":e>0?"good"===t?"positive":"negative":e<0?"bad"===t?"positive":"negative":"neutral":null}get lastRecordDeltaDirection(){const e=this.lastRecordDelta;return e?"number"!=typeof e?null:e<0?"down":"up":null}get lastRecordDeltaSymbol(){const e=this.lastRecordDeltaDirection;return null===e?"":e<0?"":""}get lastRecordDate(){const{ms:e}=this.lastRecord;return r.time.formatDate(e||Date.now(),{hour:"2-digit",minute:"2-digit"})}get lastRecordDescription(){const{ms:e}=this.lastRecord;return r.time.formatRelativeDate(e||Date.now())}get lastRecordInfo(){const{info:e}=this.lastRecord;return r.toElement(e)}get lastRecordInfoString(){const{info:e}=this.lastRecord;return r.clearFromTags(e)}get lastRecordStatusIcon(){const{status:e}=this.lastRecord;return e||"ok"}get lastRecordStatusIconColor(){const{color:e}=this.lastRecord;return e||"sublime"}set previewUrl(e){this.transaction((t=>t.previewUrl=e))}}})(),(()=>{const{$task:e,$engine:t,$mobx:a,$env:o,$recipe:r,$runner:i}=n;e.Context=class{async setup({task:n}){if(!n)throw new Error("task object must be supplied to context");const s=e.proxy.recipeById(n.recipeId);if(!s)throw new Error(`recipe not found for id ${n.recipeId}`);this.taskId=n.id,this.taskName=n.name,this.recipeId=s.id,this.adapters=r.adapters,this.api={Locator:t.Locator,Element:t.Element,TextExtractRule:t.TextExtractRule,browser:new t.Browser,runActions:async e=>i.actionController.runActions(e,n),updateFavicons:t=>e.proxy.updateFavicons(t,n),updateTask:t=>e.proxy.updateTask(this.taskId,t)};const l=e=>r.proxy.step(e.type),c=e=>{const t={...l(e).config,...e};return delete t.type,t},u=e=>({code:"run",content:l(e).config?.name||`run ${e.type}`});this.steps=s.steps.map((e=>({type:e.type,config:c(e),status:u(e),result:void 0,error:void 0})));const d=0===n.records.length,p=d?s:n;return this.state=a.toJS(p.state)||{},this.widgets=a.toJS(p.widgets)||{},this.inputs=a.toJS(n.inputs)||{},Object.entries(r.inputs).forEach((([e,t])=>{this.inputs[e]||(this.inputs[e]=a.toJS(t.state))})),this.storage={},d?this.storage=a.toJS(s.storage)||{}:o.is.bg&&(this.storage=await e.dataController.readTask(n.id)||{}),this.records=a.toJS(p.records)||[],this.record={},this.recordStorage={},delete this.storage.records,this}get page(){return this.api?.browser?.p1}step(e){return this.steps?"number"==typeof e?this.steps[e]||null:this.steps.find((t=>t.type===e))||null:null}input(e){return this.inputs?this.inputs[e]:null}widget(e){return this.widgets?this.widgets[e]:null}copyStepResults(e,t,n){if(n=n||this,!(e=this.step(e)))throw new Error(`step ${e} not found on context`);if(!(t=n.step(t)))throw new Error(`step ${e} not found on context`);e.result=t.result,e.error=t.error}async cleanup(){await(this.api?.browser?.close())}}})(),(()=>{const{$task:e,$recipe:t}=n;e.evaluate=(e,...n)=>{if(!e)return e;if("string"!=typeof e)return e;if(e.startsWith("=="))return e.substr(1);if(!e.startsWith("="))return e;let a=e.substr(1);if(a.startsWith("func(")&&a.endsWith(")")){a=a.substr(5),a=a.substr(0,a.length-1);const[e,o]=a.split("."),r=t.proxy.adapter(e);return r[o].call(r,...n)}return a}})(),(()=>{const{$task:e}=n;e.PREDEFINED_RECIPE_IDS=["watcher.monitorChanges","watcher.monitorElement","watcher.monitorPrice","watcher.monitorHealth"]})(),(()=>{const{$task:e,$analytics:t,$recipe:a,$utils:o,$env:r,$journal:i,$mobx:s}=n;e.Runner=class{constructor(e,t){if(this.options={autoCleanup:!0,...t},this.task=e,!e)throw new Error("$task.Runner expects a non-empty task");this.ctx=null,this.status="ready"}async run(n={}){if("running"===this.status)throw new Error("$task.Runner is already running");this.status="running";const{autoCleanup:r}={...this.options,...n},i=()=>{if("terminated"===this.status)throw new Error("terminated")},{task:s}=this;try{{const n=e.proxy.recipeTitle(s),a=(s?.inputs?.page?.url||"").split("?")[0];t.controller.sendMonitor(n,a)}this.ctx||(this.ctx=await(new e.Context).setup({task:s}),i());const n=this.ctx;this._runListeners("beforeRecipe"),this._runStepsHooks("beforeRecipe");for(let e=0;e<n.steps.length;e++){const t=n.steps[e],{code:r,color:s,content:l}=t.status;"run"===r&&(t.status.code="running"),this._runListeners("beforeStep",{step:t,stepIndex:e}),this._runStepHook("beforeStep",{step:t,stepIndex:e});const{s:c,result:u,error:d}=await o.durationOf((()=>a.proxy.step(t.type).run({ctx:n,step:t,stepIndex:e})));i();const p="running"!==t.status.code,h=t.status.color!==s,m=t.status.content!==l;if(void 0===t.result&&(t.result=u),void 0===t.error&&(t.error=d),d)throw p||(t.status.code="error"),h||(t.status.color="error"),d;this._runStepHook("afterStep",{step:t,stepIndex:e,s:c}),this._runListeners("afterStep",{step:t,stepIndex:e,s:c}),p||(t.status.code="ok"),h||(t.status.color="positive"),m||0===c||(t.status.content=`${l}, took <b>${c}</b> seconds`)}this._runStepsHooks("afterRecipe"),this._runListeners("afterRecipe"),this.ctx.record.ms=Date.now(),await this._updateStorage(),await this._saveTask(),this._logJobRecord(),this.status="success",this._runListeners("onSuccess")}catch(e){throw this.ctx.record.ms=Date.now(),this._handleError(e),await this._updateStorage(),await this._saveTask(),this._logJobRecord(),this.status="failed",this._runListeners("onFailure",{error:e}),e}finally{r&&await this.cleanup()}}async terminate(){this.status="terminated",await this.ctx.cleanup()}async cleanup(){this.ctx&&(await this.ctx.cleanup(),this.ctx=null)}_handleError(e){"terminated"===e.message?this.ctx.record=null:(this.ctx.record.info=e.hasOwnProperty("info")?e.info:`Task Failed: ${e.message||e.code}`,this.ctx.record.value=e.hasOwnProperty("value")?e.value:"Failed",this.ctx.record.valueDimmed=!e.hasOwnProperty("valueDimmed")||e.valueDimmed,this.ctx.record.status=e.hasOwnProperty("status")?e.status:"error",this.ctx.record.color=e.hasOwnProperty("color")?e.color:"error")}_logJobRecord(){this.ctx.record&&i.proxy.logJobFinished(this.task,this.ctx.record)}async _saveTask(){const e=s.toJS({...this._getTaskState(),records:[...this.ctx.records,this.ctx.record].filter(Boolean),state:this.ctx.state}),t=o.byteSizeOf(e);if(t>5e6)throw new Error(`${t} bytes task memory exceeds 5 MB limit`);this._updateTaskState(e)}async _updateStorage(){r.is.bg&&(await e.dataController.writeTask(this.task.id,s.toJS(this.ctx.storage)),this.ctx.recordStorage.steps=this.ctx.steps.filter((e=>!e.config.hideInJournal)).map((e=>e.status)),this.ctx.record&&await e.dataController.writeRecord(this.task.id,this.ctx.record.ms,this.ctx.recordStorage))}_runListeners(e,t){this.options[e]&&this.options[e]({name:e,ctx:this.ctx,...t})}_runStepsHooks(e){this.ctx.steps.forEach(((t,n)=>{this._runStepHook(e,{step:t,stepIndex:n})}))}_runStepHook(e,t){const n=a.proxy.step(t.step.type)[e];"function"==typeof n&&n({name:e,ctx:this.ctx,...t})}_getTaskState(){return e.proxy.taskById(this.task.id)}_updateTaskState(t={}){e.proxy.updateTask(this.task.id,t)}}})(),(()=>{const{$task:e}=n;e.controller={async init(){await e.recipeLoader.init(),await e.netRulesController.init(),e.dataController.init(),e.tabsController.init()}}})(),(()=>{const{$task:e,$utils:t,$idb:a,$bus:o,$settings:r,$logger:i}=n;e.dataController={init(){o.on("task.getTaskIdbKey",this._taskIdbKey,this),o.on("task.getRecordIdbKey",this._recordIdbKey,this),o.on("task.cloneTaskStorage",this._cloneTaskStorage,this),this._scheduleCleanupJob(),this._scheduleReduceStorageJob()},async readTask(e){const t=this._taskIdbKey(e);return await a.read(t)},async writeTask(e,t){const n=this._taskIdbKey(e);await a.write(n,t)},async writeRecord(e,t,n){const o=this._recordIdbKey(e,t);await a.write(o,n)},async _cloneTaskStorage(t){const[n,a]=t,o=await e.dataController.readTask(n.id);await e.dataController.writeTask(a.id,o)},_taskIdbKey:e=>`task:${e}`,_recordIdbKey:(e,t)=>`record:${e}:${t}`,_scheduleCleanupJob(){t.chrome.alarms.run(this._cleanUp.bind(this),{name:"task.cleanupStorageJob",delayInMinutes:1,periodInMinutes:t.time.HOUR/t.time.MINUTE})},_scheduleReduceStorageJob(){let e=null,n=!1;a.onWrite((()=>{n||(clearTimeout(e),e=setTimeout((()=>{t.chrome.alarms.run((()=>n=!1),{once:!0,delayInMinutes:10}),n=!0,this._reduceStorageUsage()}),10))})),a.onStorageExceeded(this._reduceStorageUsage.bind(this))},async _cleanUp(){await this._syncStorageWithState(),await this._reduceStorageUsage()},async _syncStorageWithState(){const t=await a.readAllKeys(),n=new Set(e.proxy.taskIds.map(this._taskIdbKey));await Promise.all(t.filter((e=>e.startsWith("task:"))).filter((e=>!n.has(e))).map((async e=>{i.log("[$task] dropping idb task storage",e),await a.delete(e)})));const o=new Set(e.proxy.tasks.map((e=>e.records.map((t=>this._recordIdbKey(e.id,t.ms))))).flat());await Promise.all(t.filter((e=>e.startsWith("record:"))).filter((e=>!o.has(e))).map((async e=>{i.log("[$task] dropping idb record storage",e),await a.delete(e)})))},async _reduceStorageUsage(){const n=this._reduceStorageUsage;if(n.running)return;n.running=!0;const o=1e3*r.proxy.storageLimit*1e3;let{usage:s}=await navigator.storage.estimate();if(s<=o)return void(n.running=!1);const l=.8*o,c=[];for(const t of e.proxy.tasks)for(const e of t.records)c.push({taskId:t.id,ms:e.ms});c.sort(((e,t)=>e.ms-t.ms));const u={};for(const e of c){u[e.taskId]||(u[e.taskId]=new Set),u[e.taskId].add(e.ms);const n=this._recordIdbKey(e.taskId,e.ms),o=await a.read(n);if(o&&(i.log("[$task] dropping record to reduce storage usage",n),await a.delete(n),s-=t.byteSizeOf(n),s-=t.byteSizeOf(o),s<=l))break}e.proxy.removeRecords(u),n.running=!1}}})(),(()=>{const{$task:e,$mobx:t,$runner:a,$stats:o}=n;e.JobPerformer=class{constructor(n){if(this.job=n,this.runner=null,this.isRunning=!1,this.task=e.proxy.taskById(n.taskId),!this.task)throw new Error(`no task found for job with ${n.taskId} task id`);this.task=t.toJS(this.task),this.updateProgress=this.updateProgress.bind(this)}async perform(){try{this.isRunning=!0,await this.runRecipe()}catch(e){"terminated"!==e.message&&"No Internet connection"!==e.message&&console.warn("task job failed:",e)}finally{this.terminate(),this.isRunning=!1}}async runRecipe(){this.isRunning&&(o.proxy.taskRunsAdd(),this.runner=new e.Runner(this.task,{beforeRecipe:this.updateProgress,beforeStep:this.updateProgress,afterRecipe:this.updateProgress}),await this.runner.run())}updateProgress(){const e=this.runner.ctx.steps,t=e.filter((e=>"ok"===e.status.code)),n=10+Math.floor(80*t.length/(e.length||1));a.proxy.setJobProgress(this.job.id,n)}terminate(){["ready","running"].includes(this.runner?.status)&&this.runner?.terminate()}}})(),(()=>{const{$task:e,$netRules:t}=n;e.netRulesController={async init(){const e=this._createUaRules(),n=this._createLangRules();await t.register([...e,...n])},_createUaRules(){const t=e=>`*://*/*_vua=${e}*`,n=t=>e.userAgents[t].userAgent;return Object.keys(e.userAgents).filter((e=>"auto"!==e)).map((e=>({condition:{urlFilter:t(e),resourceTypes:["main_frame","sub_frame"]},action:{type:"modifyHeaders",requestHeaders:[{header:"user-agent",operation:"set",value:n(e)}]}})))},_createLangRules(){const t=e=>`*://*/*_vlang=${e}*`,n=e=>e.includes("_")?`${e.replace("_","-")},${e.substr(0,e.indexOf("_"))};q=0.9`:`${e};q=0.9`;return Object.keys(e.languages).filter((e=>"auto"!==e)).map((e=>({condition:{urlFilter:t(e),resourceTypes:["main_frame","sub_frame"]},action:{type:"modifyHeaders",requestHeaders:[{header:"accept-language",operation:"set",value:n(e)}]}})))}}})(),(()=>{const{$task:e,$jsyaml:t,$utils:a}=n;e.recipeLoader={async init(){this.readRecipe=this.readRecipe.bind(this),this.recipeIds=e.PREDEFINED_RECIPE_IDS,await this.readAllRecipes()},async readAllRecipes(){if(!this.recipeIds)return;const t=await Promise.all(this.recipeIds.map(this.readRecipe));e.proxy.recipes=a.mapBy(t,"id")},async readRecipe(e){const n=a.string.toKebabCase(e),o=chrome.runtime.getURL(`/recipes/${n}.recipe`);try{const e=await fetch(o).then((e=>e.text())).then((e=>t.load(e)));return this.normalizeRecipe(e)}catch(t){console.error(`failed loading recipe ${e}`,t)}},normalizeRecipe(e){e={inputs:[],steps:[],widgets:{},...e};const t=e=>"string"==typeof e?{type:e}:e;return e.inputs=e.inputs.map(t),e.steps=e.steps.map(t),Object.keys(e.widgets).forEach((n=>{e.widgets[n]=t(e.widgets[n])})),e}}})(),(()=>{const{$task:e,$mobx:t,$chrome:a}=n;e.tabsController={init(){this.autoCleanupUnusedMediumTabs()},autoCleanupUnusedMediumTabs(){t.reaction((()=>e.proxy.taskMediumIds),((e=[],t=[])=>{const n=new Set(e);t.forEach((e=>{n.has(e)||a.tabs.remove(e).catch((()=>{}))}))}),{fireImmediately:!0})}}})(),(()=>{const{$tabs:e,$env:t,$chrome:a}=n;e.openAppTab=async(e=!0)=>{const n=chrome.runtime.getURL("/harpa.html");let o=(await a.tabs.query({})).find((e=>e.url===n));const r=!!o;r?await a.tabs.update(o.id,{active:!0}):o=await a.tabs.create({url:n,active:!0});const i=await a.windows.get(o.windowId);if(i){const e={focused:!0,state:"minimized"===i.state?"maximized":i.state};await a.windows.update(o.windowId,e)}if(!e||t.is.bg)return r;window.close()}})(),(()=>{const{$tabs:e,$tab:t,$bus:a}=n;e.controller={init(){a.on("tab.cleanupProxyCache",this._cleanupProxyCache,this)},_cleanupProxyCache(e){t.proxy.cleanupCache(e)}}})(),(()=>{const{$tab:e,$tabs:t,$env:a,$store:o,$creator:r}=n;e.proxy={get screen(){return this.of().screen},set screen(e){this.of().screen=e},get shortcutCommand(){return this.of().shortcutCommand},set shortcutCommand(e){this.of().shortcutCommand=e},get dialog(){return this.of().dialog},get creator(){return this.of().creator},of(n){if(a.is.pp&&!n&&(n=t.proxy.currentTabId),!n)return null;const o=this._cache||(this._cache={});return o[n]||(o[n]={get screen(){return e.proxy.getState(n).screen},set screen(t){e.proxy.transaction(n,(e=>e.screen=t))},get shortcutCommand(){return e.proxy.getState(n).shortcutCommand},set shortcutCommand(t){e.proxy.transaction(n,(e=>e.shortcutCommand=t))},creator:new r.Adapter(n)}),o[n]},cleanupCache(e=[]){this._cache&&e.forEach((e=>delete this._cache[e]))},getState(e){return this._ensureState(e),o.state.tab[e]},transaction(e,t){this._ensureState(e),o.transaction((n=>t(n.tab[e])))},_ensureState(e){let n=o.state.tab[e];if(n||(n=o.template.tab(),o.transaction((t=>t.tab[e]=n))),a.is.pp&&!n.creator.pageUrl){const n=t.proxy.currentTabUrl;o.transaction((t=>t.tab[e].creator.pageUrl=n))}}}})(),(()=>{const{$stats:e,$store:t}=n;e.proxy=t.createProxy({get value(){return t.state.stats},get clickedJoinDiscord(){return this.value.clickedJoinDiscord},set clickedJoinDiscord(e){this._update({clickedJoinDiscord:e})},get taskRuns(){return this.value.taskRuns||0},taskRunsAdd(){this._update({taskRuns:this.taskRuns+1})},_update(e={}){t.transaction((t=>{Object.assign(t.stats,e)}))}})})(),(()=>{const{$shortcut:e,$store:t,$env:a}=n;e.proxy=t.createProxy({get shortcut(){return t.state.shortcut},set shortcut(e){(e={...e}).label||(e.label=this.computeLabel(e)),t.transaction((t=>t.shortcut=e))},get enabled(){return this.shortcut.enabled},get hint(){return this.shortcut.hint},get label(){return this.shortcut.label},computeLabel(e){const{key:t,ctrlKey:n,metaKey:o,altKey:r}=e,i=a.platform;let s;return s="mac"===i?o?["",t]:n?["",t]:r?["",t]:[t]:"linux"===i?o?["",t]:n?["Ctrl",t]:r?["Alt",t]:[t]:o?["Win",t]:n?["Ctrl",t]:r?["Alt",t]:[t],s=s.filter(Boolean),s="win"===i?s.join(" + "):s.join(" "),s}})})(),(()=>{const{$shortcut:e,$bus:t,$commands:a,$mobx:o,$tab:r}=n;e.controller={init(){t.on("shortcut.getConfig",this.getConfig),t.on("shortcut.executeCommand",this.executeCommand),o.reaction((()=>e.proxy.shortcut),(()=>this.updateConfig()),{fireImmediately:!1}),o.reaction((()=>a.proxy.favouriteCommandNames),(()=>this.updateConfig()),{fireImmediately:!1})},executeCommand(...e){const n=t.getSender();r.proxy.of(n.tab.id).shortcutCommand=e},updateConfig(){t.send("cs:shortcut.updateConfig",this.getConfig())},getConfig:()=>({...o.toJS(e.proxy.shortcut),myCommands:a.proxy.favouriteCommandNames.map((e=>a.proxy.getCommand(e))).filter(Boolean).map((e=>({name:e.name,title:e.title})))})}})(),(()=>{const{$settings:e}=n,t=[{id:"chinese",label:" (Chinese)"},{id:"catalan",label:"Catalan"},{id:"korean",label:"Korean"},{id:"japanese",label:"Japanese"},{id:"spanish",label:"Spanish"},{id:"french",label:"French"},{id:"german",label:"German"},{id:"turkish",label:"Turkish"},{id:"italian",label:"Italian"},{id:"portuguese",label:"Portuguese"},{id:"polish",label:"Polish"},{id:"dutch",label:"Dutch"},{id:"czech",label:"Czech"},{id:"serbian",label:"Serbian"},{id:"slovak",label:"Slovak"},{id:"slovenian",label:"Slovenian"},{id:"georgian",label:"Georgian"},{id:"romanian",label:"Romanian"},{id:"croatian",label:"Croatian"},{id:"greek",label:"Greek"},{id:"russian",label:"Russian"},{id:"ukrainian",label:"Ukrainian"},{id:"belarusian",label:"Belarusian"},{id:"armenian",label:"Armenian"},{id:"swedish",label:"Swedish"},{id:"finnish",label:"Finnish"},{id:"hungarian",label:"Hungarian"},{id:"norwegian bokml",label:"Norwegian Bokml"},{id:"norwegian nynorsk",label:"Norwegian Nynorsk"},{id:"danish",label:"Danish"},{id:"hindi-urdu",label:"Hindi Urdu"},{id:"kannada",label:"Kannada"},{id:"indonesian",label:"Indonesian"},{id:"malay",label:"Malay"},{id:"arabic",label:"Arabic"},{id:"bengali",label:"Bengali"},{id:"marathi",label:"Marathi"},{id:"telugu",label:"Telugu"},{id:"vietnamese",label:"Vietnamese"},{id:"gujarati",label:"Gujarati"},{id:"persian",label:"Persian Farsi"},{id:"tamil",label:"Tamil"},{id:"burmese",label:"Burmese"},{id:"thai",label:"Thai"},{id:"lao",label:"Lao"},{id:"swahili",label:"Swahili"},{id:"punjabi",label:"Punjabi"},{id:"uzbek",label:"Uzbek"},{id:"azerbaijani",label:"Azerbaijani"},{id:"kirghiz",label:"Kirghiz"},{id:"mongolian",label:"Mongolian"},{id:"dari",label:"Dari"}].sort(((e,t)=>e.label>t.label?1:-1));t.unshift({id:"english",label:"English"});const a=new Set(t.map((e=>e.id))),o=t.reduce(((e,t)=>(e[t.id]=t,e)),{}),r={id:"custom",label:"Custom"};t.unshift(r),e.languages=t,e.languageIds=a,e.languageMap=o,e.customLanguage=r})(),(()=>{const{$settings:e,$store:t,$news:a,$peeker:o}=n;e.proxy=t.createProxy({get show(){return t.state.settings.show},set show(e){e&&(a.proxy.show=!1,o.proxy.show=!1,o.proxy.fixed=!1),t.transaction((t=>{t.settings.show=e}))},get showContext(){return t.state.settings.showContext},set showContext(e){t.transaction((t=>t.settings.showContext=e))},get showScrollbars(){return t.state.settings.showScrollbars},set showScrollbars(e){t.transaction((t=>t.settings.showScrollbars=e))},get sendOnEnter(){return t.state.settings.sendOnEnter},set sendOnEnter(e){t.transaction((t=>t.settings.sendOnEnter=e))},get promptLanguage(){return t.state.settings.promptLanguage||"english"},set promptLanguage(e){t.transaction((t=>{t.settings.promptLanguage=e}))},get connectionId(){return t.state.settings.connectionId},set connectionId(e){t.transaction((t=>{t.settings.connectionId=e}))},get promptLanguageValue(){const t=this.promptLanguage;return e.languageMap[t]?.label||t},get autoClearDialogs(){return t.state.settings.autoClearDialogs},set autoClearDialogs(e){t.transaction((t=>{t.settings.autoClearDialogs=e}))},get enableChatContext(){return t.state.settings.enableChatContext},set enableChatContext(e){t.transaction((t=>{t.settings.enableChatContext=e}))},get storageLimit(){return t.state.settings.storageLimit},get storageLimitDefault(){return t.template.state().settings.storageLimit},set storageLimit(e){t.transaction((t=>{t.settings.storageLimit=e}))},get scheduledTimeframeEnabled(){return t.state.settings.scheduledTimeframe.enabled},set scheduledTimeframeEnabled(e){t.transaction((t=>{t.settings.scheduledTimeframe.enabled=e}))},get scheduledTimeframeFrom(){return t.state.settings.scheduledTimeframe.from},set scheduledTimeframeFrom(e){t.transaction((t=>{t.settings.scheduledTimeframe.from=e}))},get scheduledTimeframeTill(){return t.state.settings.scheduledTimeframe.till},set scheduledTimeframeTill(e){t.transaction((t=>{t.settings.scheduledTimeframe.till=e}))},get scheduledTimeframe(){return this.scheduledTimeframeEnabled?{from:this.scheduledTimeframeFrom,till:this.scheduledTimeframeTill}:null},get silenceActionsEnabled(){return t.state.settings.silenceActions.enabled},set silenceActionsEnabled(e){t.transaction((t=>{t.settings.silenceActions.enabled=e}))},get autoCloseHiddenWindow(){return t.state.settings.autoCloseHiddenWindow},set autoCloseHiddenWindow(e){t.transaction((t=>{t.settings.autoCloseHiddenWindow=e}))},get maxParallelTasks(){return t.state.settings.maxParallelTasks},set maxParallelTasks(e){t.transaction((t=>{t.settings.maxParallelTasks=e}))},get serpTemplate(){return t.state.settings.serpTemplate},set serpTemplate(e){t.transaction((t=>t.settings.serpTemplate=e))},get serpTemplateCustom(){return t.state.settings.serpTemplateCustom},set serpTemplateCustom(e){t.transaction((t=>t.settings.serpTemplateCustom=e))},get serpTemplateValue(){const e=t.state.settings.serpTemplate;return"smart"===e?'I am searching for "{{query}}" on {{page.domain}}.\n\nCan you answer my search query and give me up to 5 paragraphs of information on the topic? If possible, please give me up to 5 related keywords or search queries I might be interested in, in a markdown numbered list format.\n\nPlease be factual. Do not hallucinate and do not apologise. Please reply in {{language}}. Please reply in the following format (do not echo search section names):\n\n[Answer or information on the topic of search]\n\n[Numbered list of related keywords or queries, if any]\n\nAs your knowledge is cut off by the mid 2021, you may also use information that Google Search has on the topic:\n\n{{page}}\n\nYour response:':"simple"===e?"{{query}}":"custom"===e?t.state.settings.serpTemplateCustom||"{{query}}":void 0}})})(),(()=>{const{$runner:e,$store:t}=n;e.emailProxy=t.createProxy({get uid(){return t.state.agentId},get testStatus(){return t.state.runner.actions.email.testStatus},set testStatus(e){t.transaction((t=>{t.runner.actions.email.testStatus=e}))},get testMessage(){return t.state.runner.actions.email.testMessage},set testMessage(e){t.transaction((t=>{t.runner.actions.email.testMessage=e}))}})})(),(()=>{const{$runner:e,$store:t}=n;e.makeProxy=t.createProxy({get uid(){return t.state.agentId},get testStatus(){return t.state.runner.actions.make.testStatus},set testStatus(e){t.transaction((t=>{t.runner.actions.make.testStatus=e}))},get testMessage(){return t.state.runner.actions.make.testMessage},set testMessage(e){t.transaction((t=>{t.runner.actions.make.testMessage=e}))}})})(),(()=>{const{$runner:e,$store:t}=n;e.notificationProxy=t.createProxy({get testStatus(){return t.state.runner.actions.notification.testStatus},set testStatus(e){t.transaction((t=>{t.runner.actions.notification.testStatus=e}))}})})(),(()=>{const{$runner:e,$store:t,$utils:a,$settings:o}=n;e.proxy=t.createProxy({get tasks(){return t.state.tasks},taskById(e){return this.tasks.find((t=>t.id===e))},taskIndex(e){return this.tasks.findIndex((t=>t.id===e))},get queue(){return t.state.runner.queue},set queue(e){t.transaction((t=>t.runner.queue=e))},generateJobId:()=>t.idGenerator.job(),jobById(e){return this.queue.find((t=>t.id===e))},jobByTaskId(e){return this.queue.find((t=>t.taskId===e))},setJobProgress(e,t){this.updateJob(e,{progress:t})},getJobProgress(e){return this.jobById(e)?.progress||0},addJob(e){e={id:this.generateJobId(),progress:1,by:"system",...e},t.transaction((()=>t.state.runner.queue.push(e)))},updateJob(e,n){t.transaction((()=>{const a=t.state.runner.queue.find((t=>t.id===e));a&&Object.assign(a,n)}))},deleteJob(e){this.queue=this.queue.filter((t=>t.id!==e))},get netStable(){return t.state.runner.netStable},set netStable(e){t.transaction((t=>t.runner.netStable=e))},get schedules(){return this.tasks.filter((e=>e.enabled)).map((e=>{const t=e.inputs.schedule.type;return{id:e.id,type:t,...e.inputs.schedule[t]}}))},computeNextRunMs(e){if(!e||!e.enabled)return-1;if("periodical"===e.inputs.schedule.type){const t=e.inputs.schedule.periodical.frequency,n=a.time.frequencyToMs(t),o=e.records.at(-1)?.ms||-1,r=Math.max(o+n,Date.now());return this._adjustNextRunMsToTimeframe(r)}return-1},_adjustNextRunMsToTimeframe(e){const t=o.proxy.scheduledTimeframe;if(!t)return e;let n=new Date(e);n=60*n.getHours()+n.getMinutes();let r=new Date(e);r.setHours(0,0,0,0),r=r.getTime();const i=60*(Number(t.from.split(":")[0])||0)+(Number(t.from.split(":")[1])||0),s=60*(Number(t.till.split(":")[0])||0)+(Number(t.till.split(":")[1])||0);if(i<=s){if(i<=n&&n<=s)return e;if(n<i)return r+i*a.time.MINUTE;if(n>s)return r+i*a.time.MINUTE+a.time.DAY}if(i>s)return n<=s||n>=i?e:r+i*a.time.MINUTE;throw new Error("unreachable code reached")}})})(),(()=>{const{$runner:e,$store:t,$utils:a}=n;e.soundProxy=t.createProxy({get voices(){return t.state.runner.actions.sound.voices},set voices(e){t.transaction((t=>{t.runner.actions.sound.voices=e}))},get sounds(){return e.sounds.map((({id:e,label:t})=>({id:`sound:${e}`,label:`Sound, ${t}`,src:`/sounds/${e}.mp3`})))},get items(){return[...this.sounds,...this.voices]},value(e){return e.inputs.actions.sound.value||this.items[0].id},volume:e=>a.number.minmax(e.inputs.actions.sound.volume||50,0,100),utterance:e=>e.inputs.actions.sound.utterance,utterancePlaceholder:()=>"Task triggered",get testStatus(){return t.state.runner.actions.sound.testStatus},set testStatus(e){t.transaction((t=>{t.runner.actions.sound.testStatus=e}))}})})(),(()=>{const{$runner:e,$store:t}=n;e.webhookProxy=t.createProxy({get uid(){return t.state.agentId},get testStatus(){return t.state.runner.actions.webhook.testStatus},set testStatus(e){t.transaction((t=>{t.runner.actions.webhook.testStatus=e}))},get testMessage(){return t.state.runner.actions.webhook.testMessage},set testMessage(e){t.transaction((t=>{t.runner.actions.webhook.testMessage=e}))}})})(),(()=>{const{$runner:e}=n;e.sounds=[{id:"pop",label:"Pop"},{id:"sonar",label:"Sonar Short"},{id:"sonar-2",label:"Sonar Long"},{id:"register",label:"Old Register"},{id:"banknotes",label:"Banknotes"},{id:"triangle",label:"Triangle"},{id:"wine",label:"Wine"}]})(),(()=>{const{$runner:e,$journal:t,$settings:a}=n;e.actionController={init(){e.actionNotificationController.init(),e.actionSoundController.init(),e.actionEmailController.init(),e.actionWebhookController.init(),e.actionMakeController.init()},async runActions(n,o){a.proxy.silenceActionsEnabled?t.proxy.logActionsRun(n,o,!0):(await Promise.all(n.map((t=>{if("notification"===t.type)return e.actionNotificationController.runAction(t,o);if("sound"===t.type)return e.actionSoundController.runAction(t,o);if("email"===t.type)return e.actionEmailController.runAction(t,o);if("webhook"===t.type)return e.actionWebhookController.runAction(t,o);if("make"===t.type)return e.actionMakeController.runAction(t,o);throw new Error(`unsupported action type: ${t.type}`)})).filter((e=>Boolean(e)))),t.proxy.logActionsRun(n,o))}}})(),(()=>{const{$runner:e,$task:t,$harpa:a,$bus:o,$utils:r}=n;e.actionEmailController={init(){this.uniqueTestId=null,o.on("runner.email.runActionTest",this.runActionTest.bind(this)),o.on("runner.email.stopActionTest",this.stopActionTest.bind(this))},async runAction(n,o){const i={type:"email",isTest:n.isTest||!1,taskName:o.name||t.proxy.recipeTitle(o)},s=o.inputs?.actions?.email;s&&(i.to=s.to,i.limitActions=s.limitActions);const l=o.inputs?.page?.url;l&&(i.url=l,i.domain=r.url.hostname(l)),s.customSmtpEnabled&&(i.customSmtp={from:s.customSmtpFrom,host:s.customSmtpHost,username:s.customSmtpUsername,password:s.customSmtpPassword});let c=n.records||[];c.length>0&&(i.lastRecord=this._toRecord(new t.Adapter({...o,records:c}))),c.length>1&&(c=c.slice(0,c.length-1),i.prevRecord=this._toRecord(new t.Adapter({...o,records:c})));let u,d=null;try{d=await a.api.action({uid:e.emailProxy.uid,tid:o.id,tzo:(new Date).getTimezoneOffset(),actions:[i]})}catch(e){return{status:"failure",message:"Failed to fetch"===e.message?"No Internet connection":`Network error: ${e.message}`}}if(!d.ok)return{status:"failure",message:`Error: ${d.status}`};try{u=await d.json()}catch(e){return{status:"failure",message:`Parsing error: ${e.message}`}}const p=u?.actions?.[0];return p?{status:"ok"===p.status?"success":"failure",message:r.string.toCapitalFirst(p.message)||`Status ${p.status||u.status}`}:{status:"failure",message:"Response error: action status not returned"}},async runActionTest(t){const n=this.uniqueTestId=Math.random();e.emailProxy.testStatus="running";const a={isTest:!0,records:t.records},o=await this.runAction(a,t);n===this.uniqueTestId&&(e.emailProxy.testStatus=o.status,e.emailProxy.testMessage=o.message)},stopActionTest(){this.uniqueTestId=null,e.emailProxy.testStatus=null},_toRecord:e=>({date:e.lastRecordDate,prefix:e.lastRecordValuePrefix,value:e.lastRecordValueText,suffix:e.lastRecordValueSuffix,info:e.lastRecordInfoString,status:e.lastRecordDeltaColor,delta:e.lastRecordDeltaSymbol})}})(),(()=>{const{$runner:e,$bus:t}=n;e.actionMakeController={init(){this.uniqueTestId=null,t.on("runner.make.runActionTest",this.runActionTest.bind(this)),t.on("runner.make.stopActionTest",this.stopActionTest.bind(this))},async runAction(t,n){const a={config:n.inputs?.actions?.make};return e.actionWebhookController.runAction(t,n,a)},async runActionTest(t){const n=this.uniqueTestId=Math.random();e.makeProxy.testStatus="running";const a={isTest:!0,records:t.records},o=await this.runAction(a,t);n===this.uniqueTestId&&(e.makeProxy.testStatus=o.status,e.makeProxy.testMessage=o.message)},stopActionTest(){this.uniqueTestId=null,e.makeProxy.testStatus=null}}})(),(()=>{const{$runner:e,$bus:t,$nanoid:a,$utils:o,$chrome:r}=n,i="test-notification";e.actionNotificationController={permissionLevel:null,actions:{},init(){chrome.notifications.getPermissionLevel((e=>{this.permissionLevel=e})),t.on("runner.notification.runActionTest",this.runActionTest.bind(this)),t.on("runner.notification.stopActionTest",this.stopActionTest.bind(this)),chrome.notifications.onClicked.addListener(this.onNotificationClicked.bind(this)),chrome.notifications.onClosed.addListener(this.onNotificationClosed.bind(this))},runAction(e){let{id:t,title:n,message:r,status:i,color:s,iconUrl:l}=e;t=t||a(),n=n||"HARPA.AI MONITOR TRIGGERED",i=i||"ok",s=s||"neutral",r=o.clearFromTags(r),l=l||`/img/notifications/notification-${i}-${s}.png`,this.actions[t]=e,chrome.notifications.clear(t),chrome.notifications.create(t,{type:"basic",priority:1,requireInteraction:!0,title:n,message:r,iconUrl:l})},runActionTest(){e.notificationProxy.testStatus="running",this.runAction({id:i,title:"HARPA.AI TEST NOTIFICATION",message:"This is a test notification. Please click it to verify it works.",status:"alert",onClick:()=>{e.notificationProxy.testStatus="success"},onClose:({byUser:t})=>{const n=t?"success":"failure";e.notificationProxy.testStatus=n}})},stopActionTest(){this.onNotificationClosed(i,!1),e.notificationProxy.testStatus=null},onNotificationClicked(e){chrome.notifications.clear(e);const t=this.actions[e];t&&(delete this.actions[e],this._handleActionListener(t.onClick,{id:e}))},onNotificationClosed(e,t){chrome.notifications.clear(e);const n=this.actions[e];n&&(delete this.actions[e],this._handleActionListener(n.onClose,{id:e,byUser:t}))},async _handleActionListener(e,t){if(!e)return;if("function"==typeof e)return void e(t);const{url:n,tabId:a}="string"==typeof e?{url:e}:e;if(a){if((await r.tabs.query({currentWindow:!0})).find((e=>e.id===a)))return void chrome.tabs.update(a,{active:!0})}chrome.tabs.create({url:n,active:!0})}}})(),(()=>{const{$runner:e,$bus:t,$utils:a,$env:o,$offscreen:r}=n;e.actionSoundController={init(){if(this._mv3=3===o.manifestVersion,this._mv3)return t.on("runner.sound.runActionTest",this._runActionTest,this),t.on("runner.sound.stopActionTest",this._stopActionTest,this),void t.on("runner.sound.validateActionTest",this._validateActionTest,this);this._synth=window.speechSynthesis,this._audio={},this._voices={},this._preloadAudio(),this._preloadVoices(),t.on("runner.sound.runActionTest",this._runActionTest,this),t.on("runner.sound.stopActionTest",this._stopActionTest,this),t.on("runner.sound.validateActionTest",this._validateActionTest,this)},runAction(e){const{id:t,volume:n,message:o}=e;if(this._mv3)return void r.controller.send("playAudio",{id:t,volume:n,message:o});const i=this._voices[t],s=this._audio[t];i?(this._synth.cancel(),setTimeout((()=>{const e=new window.SpeechSynthesisUtterance;e.text=a.clearFromTags(o),e.voice=i,e.volume=n/100,this._synth.speak(e)}))):s&&(s.pause(),s.currentTime=0,setTimeout((()=>{s.volume=n/100,s.play()})))},_preloadAudio(){for(const t of e.soundProxy.sounds)this._audio[t.id]=new Audio(t.src)},_preloadVoices(){const t=()=>{let t=this._synth.getVoices();t.forEach((e=>this._voices[e.name]=e));this._voices.Daniel&&this._voices.Samantha&&(t=t.filter((e=>["Daniel","Samantha"].includes(e.name)||!e.lang.startsWith("en"))));const n=new Intl.DisplayNames("en",{type:"language"}),a=e=>`${n.of(e.lang).split(" (")[0]}, ${e.name}`;t=t.map((e=>({id:e.name,lang:e.lang,label:a(e)}))).sort(((e,t)=>{if("Daniel"===e.id)return-1;if("Daniel"===t.id)return 1;if("en"===e.lang)return-1;if("en"===t.lang)return 1;if(e.lang.startsWith("en")){if(!t.lang.startsWith("en"))return-1}else if(t.lang.startsWith("en"))return 1;return e.label.localeCompare(t.label)})),e.soundProxy.voices=t};t(),void 0!==this._synth.onvoiceschanged&&(this._synth.onvoiceschanged=t)},_runActionTest(t){e.soundProxy.testStatus="running",this._mv3?r.controller.send("playAudio",{id:e.soundProxy.value(t),volume:e.soundProxy.volume(t),message:e.soundProxy.utterance(t)}):this.runAction({id:e.soundProxy.value(t),volume:e.soundProxy.volume(t),message:e.soundProxy.utterance(t)})},_stopActionTest(){e.soundProxy.testStatus="failure",this._mv3?r.controller.send("stopAudio"):this._synth.cancel()},_validateActionTest(){e.soundProxy.testStatus="success",this._mv3?r.controller.send("stopAudio"):this._synth.cancel()}}})(),(()=>{const{$runner:e,$task:t,$bus:a,$utils:o}=n;e.actionWebhookController={init(){this.uniqueTestId=null,a.on("runner.webhook.runActionTest",this.runActionTest.bind(this)),a.on("runner.webhook.stopActionTest",this.stopActionTest.bind(this))},async runAction(n,a,r={}){const i=r.config||a.inputs?.actions?.webhook;if(!i||!i.url)return{status:"failure",message:"Webhook URL not specified"};const s={ms:(new Date).getTime(),type:"task:task-run",sender:{id:e.webhookProxy.uid,type:"harpa-extension-agent"},task:{id:a.id,name:a.name||t.proxy.recipeTitle(a),createdMs:a.createdMs},record:null};a.state&&Object.keys(a.state).length>0&&(s.task.state=a.state);const l=a.inputs?.page?.url;l&&(s.task.url=l,s.task.domain=o.url.hostname(l));let c=n.records||[];c.length>0&&(s.record=c.at(-1));const u=s.record;s.csv={taskId:s.task.id,taskName:s.task.name,url:s.task.url,domain:s.task.domain,date:u?new Date(u.ms).toLocaleDateString():"",time:u?new Date(u.ms).toLocaleTimeString():"",value:u?.value??"",metric:u?.metric?u.metric.startsWith("CUR:")?u.metric.substr(4):u.metric:"",status:u?.status||"",color:u?.color||"",triggered:u?.triggered?"yes":"",dispatched:u?.dispatched?u?.dispatched.join(","):"",info:u?.info?u.info.replaceAll("<b>","").replaceAll("</b>",""):""},n.isTest&&(s.isTest=!0);let d=null;try{const e={method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}};if(i.basicAuthEnabled){const{basicAuthUsername:t,basicAuthPassword:n}=i;e.headers.Authorization="Basic "+btoa(`${t||""}:${n||""}`)}d=await fetch(i.url,e)}catch(e){return{status:"failure",message:"Failed to fetch"===e.message?"No Internet connection":`Network error: ${e.message}`}}return d.ok?{status:"success",message:`Status ${d.status}`}:{status:"failure",message:`Error: ${d.status} ${d.statusText||""}`}},async runActionTest(t){const n=this.uniqueTestId=Math.random();e.webhookProxy.testStatus="running";const a={isTest:!0,records:t.records},o=await this.runAction(a,t);n===this.uniqueTestId&&(e.webhookProxy.testStatus=o.status,e.webhookProxy.testMessage=o.message)},stopActionTest(){this.uniqueTestId=null,e.webhookProxy.testStatus=null}}})(),(()=>{const{$runner:e}=n;e.controller={async init(){e.onlineController.init(),e.actionController.init(),e.scheduleController.init()}}})(),(()=>{const{$runner:e,$utils:t}=n;e.onlineController={init(){this._markNetStableTimeout=null,this._sleepDetectionMs=Date.now(),this._launchSleepDetection(),this._watchOnlineStatus(),e.proxy.netStable=navigator.onLine},_launchSleepDetection(){setInterval((()=>{const e=Date.now();e-this._sleepDetectionMs>t.time.MINUTE&&this._onOnline(),this._sleepDetectionMs=e}),5*t.time.SECOND)},_watchOnlineStatus(){if(!navigator.connection)return;let e=navigator.onLine;navigator.connection.addEventListener("change",(()=>{navigator.onLine!==e&&(e=navigator.onLine,e?this._onOnline():this._onOffline())}))},_onOnline(){e.proxy.netStable=!1,clearTimeout(this._markNetStableTimeout),this._markNetStableTimeout=setTimeout((()=>{e.proxy.netStable=!0,this._markNetStableTimeout=null}),t.time.MINUTE)},_onOffline(){clearTimeout(this._markNetStableTimeout),this._markNetStableTimeout=null,e.proxy.netStable=!1}}})(),(()=>{const{$runner:e,$logger:t,$mobx:a,$bus:o,$utils:r,$task:i,$settings:s}=n;e.scheduleController={init(){this._sleepTimer=null,this._performers={},e.proxy.queue=[],this.enqueueTasks=this.enqueueTasks.bind(this),this.terminateTasks=this.terminateTasks.bind(this),this._runJobs=this._runJobs.bind(this),o.on("runner.enqueueTasks",this.enqueueTasks),o.on("runner.terminateTasks",this.terminateTasks),a.reaction((()=>e.proxy.schedules),((e={},t={})=>{r.deepEqual(e,t)||this._runJobs(e)}),{fireImmediately:!1}),a.reaction((()=>s.proxy.scheduledTimeframe),((e={},t={})=>{r.deepEqual(e,t)||this._runJobs()}),{fireImmediately:!1}),a.reaction((()=>s.proxy.maxParallelTasks),((e,t)=>{e!==t&&this._runJobs()}),{fireImmediately:!1}),a.reaction((()=>e.proxy.netStable),((e,t)=>{e!==t&&this._runJobs()})),r.chrome.alarms.run(this._runJobs.bind(this),{name:"runner.runJobs",delayInMinutes:1,periodInMinutes:1,immediately:!0})},enqueueTasks(t){t=new Set(t),e.proxy.queue=[...e.proxy.queue.map((e=>t.has(e.taskId)?(t.delete(e.taskId),{...e,by:"user"}):e)),...Array.from(t).map((t=>({id:e.proxy.generateJobId(),taskId:t,progress:1,by:"user"})))],this._runJobs()},terminateTasks(t){t=new Set(r.ensureArray(t)),e.proxy.queue=e.proxy.queue.filter((e=>!t.has(e.taskId))),t.forEach((e=>{const t=this._performers[e];t&&t.terminate()}))},_runJobs(t){this._updateJobsQueue(t);let n=null;for(;n=this._pickNextJob();){if("number"==typeof n){if(this._sleepTimer){if(this._sleepTimer.till===n)return;this._sleepTimer.clear()}return void(this._sleepTimer=new e.SleepTimer(this._runJobs,n))}this._performJob(n)}},_updateJobsQueue(t){t=t||e.proxy.schedules,e.proxy.queue=e.proxy.queue.filter((e=>e.running||"user"===e.by));const n=Date.now();t.forEach((t=>{if(e.proxy.jobByTaskId(t.id))return;const a=e.proxy.taskById(t.id),o=e.proxy.computeNextRunMs(a);-1===o||o>n||e.proxy.addJob({taskId:t.id})}))},_pickNextJob(){let t=e.proxy.queue.filter((e=>!e.running));if(e.proxy.netStable||(t=t.filter((e=>"user"===e.by))),0===t.length){const t=e.proxy.tasks.filter((e=>e.enabled)).filter((t=>!e.proxy.jobByTaskId(t.id))).map((t=>e.proxy.computeNextRunMs(t))).filter((e=>-1!==e));return 0===t.length?null:t.reduce(((e,t)=>e<t?e:t))}return e.proxy.queue.filter((e=>e.running)).length>=s.proxy.maxParallelTasks?null:t.reduce(((t,n)=>{if("user"===t.by&&"user"!==n.by)return t;if("user"!==t.by&&"user"===n.by)return n;return(e.proxy.taskById(t.taskId).records.at(-1)?.ms||-1)<(e.proxy.taskById(n.taskId).records.at(-1)?.ms||-1)?t:n}))},async _performJob(n){const{id:a,taskId:o}=n;e.proxy.updateJob(a,{running:!0});try{const t=this._performers[o]=new i.JobPerformer(n);await t.perform()}catch(e){t.error("[$runner] failed to run a job",n,e)}finally{delete this._performers[o],e.proxy.deleteJob(a)}setTimeout(this._runJobs)}}})(),(()=>{const{$runner:e}=n;e.SleepTimer=class{constructor(t,n){this.cb=t,this.till=n,this.timeoutId=null;const a=Date.now();this.till<=a?this.cb():(this.run=this.run.bind(this),e.sleepTimerController.addTimer(this),this.timeoutId=setTimeout(this.run,this.till-a+1))}run(){Date.now()<this.till||(this.clear(),this.cb())}clear(){e.sleepTimerController.removeTimer(this),clearTimeout(this.timeoutId)}},e.sleepTimerController={addTimer(e){if(!this.timers){this.timers=new Set,chrome.alarms.onAlarm.addListener(this._onAlarm),chrome.runtime.onMessage.addListener(this._onAlarm);const e={delayInMinutes:1,periodInMinutes:1};chrome.alarms.create("runner.sleepTimer.alarm",e)}this.timers.add(e)},removeTimer(e){this.timers&&0!==this.timers.size&&(this.timers.delete(e),0===this.timers.size&&(this.timers=null,chrome.alarms.onAlarm.removeListener(this._onAlarm),chrome.runtime.onMessage.removeListener(this._onAlarm),chrome.alarms.clear("runner.sleepTimer.alarm")))},_onAlarm({name:e}={}){"runner.sleepTimer.alarm"===e&&this.timers&&this.timers.forEach((e=>e.run()))}}})(),(()=>{const{$redactor:e,$store:t,$task:a}=n;e.proxy=t.createProxy({get show(){return t.state.redactor.show},set show(e){this._update({show:e})},get taskId(){return t.state.redactor.taskId},set taskId(e){this._update({taskId:e})},get task(){return a.proxy.taskById(this.taskId)},_update(e={}){t.transaction((t=>{Object.assign(t.redactor,e)}))}})})(),(()=>{const{$recipe:e,$engine:t,$jsyaml:a,$utils:o}=n;e.adapters.watcher={icon({task:e}){const{recipeId:t}=e;if("watcher.monitorChanges"===t){const t=e.inputs["watcher.changes"]?.whatToMonitor;switch(t){case"text":{const t=this._triggerCondition(e);return["contains-text","missing-text"].includes(t)?"recipe-watcher.monitorText":"recipe-watcher.monitorChanges"}case"html":return"recipe-watcher.monitorHtml";case"data":return"recipe-watcher.monitorData";default:return"recipe-watcher.monitorChanges"}}if("watcher.monitorElement"===t){const t=e.inputs["watcher.element"]?.selector?.at(-1)?.$parse;switch(t){case"text":return"recipe-watcher.monitorText";case"number":return"recipe-watcher.monitorNumber";case"price":case"currency":return"recipe-watcher.monitorPrice";case"time":return"recipe-watcher.monitorTime";case"copyright":case"date":return"recipe-watcher.monitorDate";default:return"recipe-watcher.monitorElement"}}return"watcher.monitorHealth"===t?"recipe-watcher.monitorHealth":"watcher.monitorPrice"===t?"recipe-watcher.monitorPrice":"recipe-watcher.monitorChanges"},title({task:e}){const{recipeId:t}=e;if("watcher.monitorChanges"===t){const t=this._triggerCondition(e);if("contains-text"===t){return`CONTAINS TEXT: ${(e.inputs.trigger.searchText.split("\n").filter((e=>!!e))[0]||"").toUpperCase()}`}if("missing-text"===t){return`TEXT REMOVED: ${(e.inputs.trigger.searchText.split("\n").filter((e=>!!e))[0]||"").toUpperCase()}`}return`PAGE ${e.inputs["watcher.changes"].whatToMonitor} CHANGES`.toUpperCase()}if("watcher.monitorElement"===t){let t=this._monitoredElementType(e);"number"===t&&(t="value");let n=this._triggerCondition(e);return n={"value-is-up":"INCREASES","value-is-down":"DROPS","value-contains-text":"CONTAINS TEXT","value-missing-text":"MISSING TEXT","item-is-removed":"REMOVED"}[n]||"changes",`${t} ${n}`.toUpperCase()}if("watcher.monitorHealth"===t){return{"web-page-is-down":"AUTO-REFRESH PAGE","web-page-is-up":"AUTO-REFRESH PAGE","web-page-returns-http-code":"HTTP STATUS CODE"}[this._triggerCondition(e)]||"PAGE STATUS"}return"watcher.monitorPrice"===t?"PRICE VALUE":"MONITOR PAGE"},async buildChangesTemplates(e){let{text:t,template:n}=e,a=[];t=t.toLowerCase();const r=["out of stock","not in stock","not available","unavailable"];for(const i of r){if(!o.occurrences.regex(t,i))continue;const r=n();r.inputs["watcher.changes"].whatToMonitor="text",r.inputs["watcher.trigger"].monitorChangesText="missing-text",r.inputs["watcher.trigger"].monitorChangesHtml="missing-text",r.inputs.trigger.color="positive",r.inputs.trigger.searchText=i,await this.updateChangesTemplate(r,e),a.push({priority:20,task:r});break}{const t=n();t.inputs["watcher.changes"].whatToMonitor="text",t.inputs["watcher.trigger"].monitorChangesText="contains-text",t.inputs["watcher.trigger"].monitorChangesHtml="contains-text",t.inputs.trigger.color="positive",t.inputs.trigger.searchText="discount\nrabatt\nrabat\nalennus\ndiskon\nsleva\nsconto\ndescuento",await this.updateChangesTemplate(t,e),a.push({priority:30,task:t})}{const t=n();t.inputs["watcher.changes"].whatToMonitor="text",t.inputs["watcher.trigger"].monitorChangesText="content-changes",t.inputs["watcher.trigger"].monitorChangesHtml="content-changes",t.inputs.trigger.color="positive",await this.updateChangesTemplate(t,e),a.push({priority:40,task:t})}{const t=n();t.inputs["watcher.changes"].whatToMonitor="text",t.inputs["watcher.trigger"].monitorChangesText="content-changes",t.inputs["watcher.trigger"].monitorChangesHtml="content-changes",t.inputs.trigger.color="positive",t.records.push(this.compare(t,null,e)),a.push({priority:20,dropdown:{icon:"recipe-watcher.monitorChanges",name:"MONITOR PAGE UPDATES"},task:t})}return a},async updateChangesTemplate(e,t){const n=this.compare(e,null,t);if(!e.dropdown){const t=this._triggerCondition(e);if("content-changes"===t||"none"===t)n.value=32,n.info="Reports if page content has changed";else if("contains-text"===t){const t=e.inputs.trigger.searchText.split("\n").filter((e=>!!e))[0]||"";n.info=`Monitors ${t.toUpperCase()} text, alerts if it is found on page`}else if("missing-text"===t){const t=e.inputs.trigger.searchText.split("\n").filter((e=>!!e))[0]||"";n.info=`Monitors ${t.toUpperCase()} text, alerts if it is missing`}}const a=0===e.records.length?0:e.records.length-1;e.records[a]=n},async buildElementTemplates(e){const{page:t,data:n,template:a}=e;let o=[];e:{const r=n.filter((e=>"price"===e.type)).filter((e=>0!==e.value)).sort(this._sortByVisibility);if(0===r.length)break e;const i=[],s=new Set;for(const e of r)if(!s.has(e.value)&&(s.add(e.value),i.push(e),i.length>=3))break;for(const n of i){e.item=n;const r=a();r.inputs["watcher.trigger"].monitorElement="value-is-down",r.inputs.trigger.color="positive",r.inputs.changeUpIs.value="bad",r.state.item=n;const i=await t.inspect(n.container,{computeAiLocator:!0,noIdle:!0});i.locator.selector.push({$parse:"price",at:n.at}),r.inputs["watcher.element"].selector=i.locator.selector,await this.updateElementTemplate(r,e),o.push({priority:10,task:r})}}e:{const r=new Set;n.filter((e=>"time"===e.type||"date"===e.type)).forEach((e=>e.elements.forEach((e=>r.add(e.id)))));const i=n.filter((e=>"number"===e.type)).filter((e=>0!==e.value)).filter((e=>!e.elements.some((e=>r.has(e.id))))).sort(this._sortByVisibility);if(0===i.length)break e;const s=new Set,l=[];for(const e of i)if(!s.has(e.value)&&(s.add(e.value),l.push(e),l.length>=3))break;for(const n of l){e.item=n;const r=a();r.inputs["watcher.trigger"].monitorElement="value-changes",r.inputs.trigger.color="positive",r.inputs.changeUpIs.value="good",r.state.item=n;const i=await t.inspect(n.container,{computeAiLocator:!0,noIdle:!0});i.locator.selector.push({$parse:"number",at:n.at}),r.inputs["watcher.element"].selector=i.locator.selector,await this.updateElementTemplate(r,e),o.push({priority:50,task:r})}}e:{const r=this.biggestItem(n);if(!r)break e;e.item=r;const i=a();i.inputs["watcher.trigger"].monitorElement="value-changes",i.inputs.trigger.color="positive",i.inputs.changeUpIs.value="good",i.state.item=r;const s=await t.inspect(r.container,{computeAiLocator:!0,noIdle:!0});s.locator.selector.push({$parse:"text",at:0}),i.inputs["watcher.element"].selector=s.locator.selector,i.records.push(this.compare(i,null,e)),o.push({priority:50,dropdown:{icon:"recipe-watcher.monitorElement",name:"MONITOR ELEMENT"},task:i})}return o},_sortByVisibility:(e,t)=>e.data.isVisible&&!t.data.isVisible?-1:!e.data.isVisible&&t.data.isVisible?1:e.data.isInViewport&&!t.data.isInViewport?-1:!e.data.isInViewport&&t.data.isInViewport?1:e.data.isInViewport?e.cr.top-t.cr.top:t.data.fontSize!==e.data.fontSize?t.data.fontSize-e.data.fontSize:e.cr.top-t.cr.top,async updateElementTemplate(e,t){t={...t,item:e.state.item};const n=this._monitoredElementType(e);let a=this._triggerCondition(e);a={"value-is-up":"increases","value-is-down":"drops","value-contains-text":"contains text","value-missing-text":"missing text","item-is-removed":"removed"}[a]||"changes";const o=this.compare(e,null,t);e.dropdown||(o.info=`Monitors ${n} and alerts if it ${a}`),e.records[0]=o},async storeElementTemplate(e){e.state?.item&&delete e.state.item},async buildPriceTemplates(e){const{template:t}=e,n=[];{const a=t();a.inputs["watcher.trigger"].monitorElement="value-changes",a.inputs.trigger.color="positive",a.inputs.changeUpIs.value="bad",await this.updatePriceTemplate(a,e),n.push({priority:10,dropdown:{icon:"recipe-watcher.monitorPrice",name:"MONITOR PRICE"},task:a})}return n},async updatePriceTemplate(e,t){e.records[0]=this.compare(e,null,t)},async buildHealthTemplates(e){const{template:t}=e,n=[];{const a=t();a.inputs.trigger.icon="alert",a.inputs.trigger.color="positive",a.inputs.schedule.mediumType="tab",a.inputs.schedule.periodical.frequency="5m",a.inputs.schedule.autoCloseTab=!1,a.records.push({...this.compare(a,null,e),info:"Auto-refreshes page and monitors it's status. Useful to auto-refresh data dashboards and manual monitoring."}),n.push({priority:60,task:a})}{const a=t();a.inputs.trigger.icon="alert",a.inputs.trigger.color="positive",a.inputs.schedule.mediumType="hidden-tab",a.records.push(this.compare(a,null,e)),n.push({priority:30,dropdown:{icon:"status-heart-ok",name:"MONITOR PAGE HEALTH"},task:a})}{const a=t();a.inputs.trigger.icon="alert",a.inputs.trigger.color="positive",a.inputs.schedule.mediumType="tab",a.inputs.schedule.periodical.frequency="5m",a.inputs.schedule.autoCloseTab=!1,a.records.push(this.compare(a,null,e)),n.push({priority:40,dropdown:{icon:"recipe-watcher.monitorHealth",name:"AUTO-REFRESH PAGE"},task:a})}return n},async updateHealthTemplate(e,t){const n=this.compare(e,null,t);e.dropdown||(n.info="Auto-refreshes page and monitors it's status. Useful to auto-refresh data dashboards and manual monitoring."),e.records[0]=n},biggestItem:e=>e.filter((e=>"text"===e.type)).sort(((e,t)=>e.data.isVisible&&!t.data.isVisible?-1:!e.data.isVisible&&t.data.isVisible?1:e.data.isInViewport&&!t.data.isInViewport?-1:!e.data.isInViewport&&t.data.isInViewport?1:"H1"===e.data.tag&&"H1"!==t.data.tag?-1:"H1"!==e.data.tag&&"H1"===t.data.tag?1:t.data.fontSize-e.data.fontSize))[0],async queryItem(e,n){if("string"==typeof n){if(0===n.trim().length)return{type:"warning",content:"Selector is empty"};try{n=a.load(n)}catch(e){return{type:"warning",content:"Selector is not a CSS / XPath / HARPA query"}}}let r=null;try{r=t.Locator.of(n,e)}catch(e){return{type:"warning",content:o.string.toCapitalFirst(e.message)}}let i=await e.query(r,{noIdle:!0,noThrow:!0,mult:!0});return i instanceof Error?{type:"warning",content:i.message}:0===i.length?null:i.length>1?{type:"warning",content:`Found ${i.length} elements matching selector`}:(i=i[0],i instanceof t.Element?{type:"element",value:await e.content(i,{noIdle:!0})}:o.removeKeys({type:i.type,value:i.value,metric:i.metric,content:i.content,context:i.context,index:i.index}))},findPrice(e,t,n=!1){t=t||[];const a=e=>{if(n)return null;throw new Error(e)};let r=this.filterItemsByType(t,"price");if(0===r.length)return a("No prices found on page");let{pickup:i,anchorText:s,n:l}=e.inputs["watcher.price"];if("visually-largest"===i){const e=e=>e.context.length/e.content.length>4?1.2*e.data.fontSize:e.cr.bottom-e.cr.top;return r.reduce(((t,n)=>e(t)>e(n)?t:n))}if("first"===i)return r[0];if("last"===i)return r.at(-1);if("nth"===i){if((!l||l<1)&&(l=1),l>r.length){const e=1===r.length?"price":"prices";return a(`Only ${r.length} ${e} found on page`)}return r[l-1]}if("lowest"===i||"highest"===i||"average"===i||"median"===i){const e=o.frequency(r,(e=>e.metric)),t=Array.from(e.entries()).reduce(((e,t)=>t[1]>e[1]?t:e))[0];if(r=r.filter((e=>e.metric===t)),"lowest"===i)return r.reduce(((e,t)=>e.value>t.value?t:e));if("highest"===i)return r.reduce(((e,t)=>e.value<t.value?t:e));if("average"===i)return{type:"price",value:r.reduce(((e,t)=>e+t.value),0)/r.length,metric:t};if("median"===i){const e=r.slice().sort(((e,t)=>e.value-t.value)),n=Math.floor(e.length/2);return{type:"price",value:e.length%2==0?(e[n-1].value+e[n].value)/2:e[n].value,metric:t}}}if("closest-to"===i){if(!s)return r[0];const e=this.filterItemsByType(t,"text").filter((e=>o.occurrences.regex(e.value,s)));if(0===e.length)return a("No elements found for anchor text");const n=e=>e.left+(e.right-e.left)/2,i=e=>e.top+(e.bottom-e.top)/2,c=(e,t)=>Math.pow(n(e)-n(t),2)+Math.pow(i(e)-i(t),2);let u=[];if(r.forEach((t=>u.push({p:t,d:e.reduce(((e,n)=>Math.min(e,c(n.cr,t.cr))),Number.MAX_VALUE)}))),u=u.sort(((e,t)=>e.d-t.d)),(!l||l<1)&&(l=1),l>u.length){const e=1===r.length?"price":"prices";return a(`Only ${r.length} ${e} found on page`)}return u[l-1].p}return a(`Pickup parameter ${i} not supported`)},filterItemsByType(e,t){const n=e||[];return t?n.filter((e=>e.type===t)):n},reduceTaskStorage(e,t){if(!e||!t)return;const n=t.first||{},a=t.last||{},{recipeId:o,inputs:r}=e;"watcher.monitorHealth"!==o&&(delete n.prefetch,delete a.prefetch),"watcher.monitorElement"!==o&&(delete n.item,delete a.item),"watcher.monitorChanges"===o&&"data"===r["watcher.changes"].whatToMonitor||(delete n.data,delete a.data),"watcher.monitorChanges"===o&&"html"===r["watcher.changes"].whatToMonitor||(delete n.html,delete a.html),"monitorChanges"!==o&&"text"!==r["watcher.changes"].whatToMonitor&&(delete n.text,delete a.text),n?.error||delete n.error,a?.error||delete a.error},_monitoredElementType:e=>{const t=e.inputs["watcher.element"]?.selector;if(!Array.isArray(t))return"element";return t.filter((e=>e.$parse)).at(-1)?.$parse||"element"},compare(e,t,n){try{const a={task:e,previous:t,current:n,trigger:this._trigger(e),condition:this._triggerCondition(e)};switch(e.recipeId){case"watcher.monitorHealth":return a.config=e.inputs["watcher.health"],this._compareHealth(a);case"watcher.monitorPrice":return a.config=e.inputs["watcher.price"],this._comparePrice(a);case"watcher.monitorElement":return a.config=e.inputs["watcher.element"],this._compareElement(a);case"watcher.monitorChanges":return a.config=e.inputs["watcher.changes"],this._compareChanges(a);default:return this._recordError("This automation task is under development","Under Dev")}}catch(e){return console.error("comparing watcher data failed:",e),this._recordError(e.message,e.value)}},_compareHealth({current:e,trigger:t,condition:n}){if(!e)return this._recordWarning("Could not fetch page status");const{statusCode:a,statusText:o}=e.prefetch,r=a>=200&&a<=299,i=`<b>${a||0} / ${o||"Unknown"}</b>`;let s=r?`Page is <b>UP</b> with status ${i}`:`Page is <b>DOWN</b> with status ${i}`,l=!1;if("web-page-is-down"===n&&(l=!r),"web-page-is-up"===n&&(l=r),"web-page-returns-http-code"===n){const e=String(a);l=t.httpCodes.some((t=>e.length===t.length&&[...e].every(((e,n)=>"x"===t[n]||t[n]===e))))}return this._recordValue(s,r?"Up":"Down",null,l?t.icon:r?"heart-ok":"heart-nok",l?t.color:null,l)},_comparePrice({task:e,current:t,trigger:n,condition:a}){if(!t)return this._recordWarning("Could not parse prices from page");let r=null;{const t=e.records.at(-1);t?.metric?.startsWith("CUR:")&&(r={value:t.value,metric:t.metric})}let i=null;try{i=this.findPrice(e,t?.data)}catch(e){return this._recordWarning(e.message)}const s=e.inputs.changeUpIs.value,{x:l,y:c}=n,u=`<b>${o.formatter.format(l,null,{long:!0})}</b>`,d=e=>{if(!e)return null;return`<b>${o.formatter.format(e.value,e.metric,{long:!0,currencyFormat:"namePlural"})}</b>`},p=d(r),h=d(i);let m=!1,g=`Parsed ${h}`;"price-changes"===a&&(m=Boolean(r&&r.value!==i.value),g=m?`Changed ${p}  ${h}`:`Parsed ${h}`),"price-is-up"===a&&(m=Boolean(r&&r.value<i.value),g=m?`Price UP ${p}  ${h}`:`Parsed ${h}`),"price-is-down"===a&&(m=Boolean(r&&r.value>i.value),g=m?`Price DOWN ${p}  ${h}`:`Parsed ${h}`),"price-is-over-x"===a&&(m=i.value>l,g=m?`Price ${h} is over ${u}`:`Parsed ${h}`),"price-is-under-x"===a&&(m=i.value<l,g=m?`Price ${h} is below ${u}`:`Parsed ${h}`),"price-is-within-x-y"===a&&(m=i.value>=l&&i.value<=c,g=m?`Price ${h} is in range`:`Parsed ${h}`),"price-is-outside-x-y"===a&&(m=i.value<l||i.value>c,g=m?`Price ${h} is not in range`:`Parsed ${h}`);return this._recordValue(g,i.value,i.metric,m?n.icon:r?r.value<i.value?"up":r.value>i.value?"down":"ok":"ok",m?n.color:s&&"neutral"!==s&&r?r.value<i.value?"good"===s?"positive":"negative":r.value>i.value?"good"===s?"negative":"positive":null:null,m)},_compareElement({task:e,previous:t,current:n,trigger:a,condition:r}){if(!n)return this._recordWarning("Could not parse elements from page");if("warning"===n?.item?.type)return this._recordWarning(n.item.content);if("error"===n?.item?.type)return this._recordError(n.item.content);const i=e.inputs.changeUpIs.value,{itemParameter:s,x:l,y:c,searchText:u}=a,d=`<b>${o.formatter.format(l,null,{long:!0})}</b>`,p=e=>{if(!e?.item)return{content:null,text:"N/A"};const t={content:e.item,type:e.item.type,metric:e.item.metric,value:e.item.value,text:`<b>${e.item.content||e.item.value}</b>`};return"link"===t.type&&"content"===s&&(t.value=t.content.content),"string"!=typeof t.value||["none","value-changes","value-missing-text","value-contains-text","item-is-removed"].includes(r)||(t.value=t.value?t.value.length:0),t.metric=t.metric||t.type,t};let h=!1;const m=p(t),g=p(n);if("item-is-removed"===r)return h=!n?.item,this._recordValue(h?`Item ${m.text} is removed from page`:`Item ${g.text} is found on page`,g.content?"Found":"Missing",null,h?a.icon:"ok",h?a.color:null,h);if(!g.content)return this._recordWarning("Could not find element on page");let f=`Parsed ${g.text}`,y=g.value,b=g.metric;if("value-changes"===r&&(h=Boolean(m.content&&m.value!==g.value),f=h?`Changed ${m.text}  ${g.text}`:`Parsed ${g.text}`),"value-is-up"===r&&(h=Boolean(m.content&&m.value<g.value),f=h?`Value UP ${m.text}  ${g.text}`:`Parsed ${g.text}`),"value-is-down"===r&&(h=Boolean(m.content&&m.value>g.value),f=h?`Value DOWN ${m.text}  ${g.text}`:`Parsed ${g.text}`),"value-is-over-x"===r&&(h=g.value>l,f=h?`Value ${g.text} is over ${d}`:`Parsed ${g.text}`),"value-is-under-x"===r&&(h=g.value<l,f=h?`Value ${g.text} is below ${d}`:`Parsed ${g.text}`),"value-is-within-x-y"===r&&(h=g.value>=l&&g.value<=c,f=h?`Value ${g.text} is in range`:`Parsed ${g.text}`),"value-is-outside-x-y"===r&&(h=g.value<l||g.value>c,f=h?`Value ${g.text} is not in range`:`Parsed ${g.text}`),"value-contains-text"===r||"value-missing-text"===r){const e=o.occurrences.regex(String(g.value),u),t=1===e?"once":e+" times";h="value-contains-text"===r?e>0:0===e,f=e>0?`Search text is found <b>${t}</b>`:"Search text is not found",y=e,b=null}return this._recordValue(f,y,b,(()=>{if(h)return a.icon;if(!m.content)return"ok";const e="string"==typeof m.value?m.value.length:m.value,t="string"==typeof g.value?g.value.length:g.value;return e<t?"up":e>t?"down":"ok"})(),(()=>{if(h)return a.color;if(!i||"neutral"===i)return null;if(!m.content)return null;const e="string"==typeof m.value?m.value.length:m.value,t="string"==typeof g.value?g.value.length:g.value;return e<t?"good"===i?"positive":"negative":e>t?"good"===i?"negative":"positive":null})(),h)},_compareChanges({task:e,previous:t,current:n,trigger:a,condition:r,config:i}){if(t=t||{},!n)return this._recordWarning("Could not parse page content");const{whatToMonitor:s,itemTypes:l}=i,c=e.inputs.changeUpIs.value,u=a.searchText,d=a.minThreshold||0,p=(e,t)=>e?a.color:!t||t<=0?null:c&&"neutral"!==c?"good"===c?"positive":"negative":null,h=(e,t)=>e?a.icon:!t||t<=0?"nok":"up";if("data"===s){let e=n.data;if(!e)return this._recordWarning("Page data is not available");let a=t.data;if(!a)return this._recordValue("Page data has not changed",0,"%","ok");l&&(a=a.filter((e=>l.includes(e.type))),e=e.filter((e=>l.includes(e.type))));const o={},i={added:0,removed:0};a.forEach((e=>{const{type:t,value:n}=e;o[t]||(o[t]=new Map);const a=o[t].get(n)||0;o[t].set(n,a-1)})),e.forEach((e=>{const{type:t,value:n}=e;o[t]||(o[t]=new Map);const a=o[t].get(n)||0;o[t].set(n,a+1)})),Object.values(o).forEach((e=>{Array.from(e.values()).forEach((e=>{e<0?i.removed++:e>0&&i.added++}))})),i.total=Math.max(a.length,e.length),i.changed=Math.max(i.added,i.removed);const s=100*i.changed==0?0:i.changed/i.total,c=`<b>${s.toFixed(1)}%</b>`;if(0===s)return this._recordValue("Page content has not changed",0,"%","ok");const u="none"!==r&&s>=d;return this._recordValue(s<.01?"Page data has changed":`${c} of page data has changed`,s,"%",h(u,s),p(u,s),u)}if("html"===s||"text"===s){if(t="text"===s?t.text:t.html,!(n="text"===s?n.text:n.html))return this._recordWarning("Page content is not available");if("html"===s&&(t=this._replaceInjectedHtml(t),n=this._replaceInjectedHtml(n)),"contains-text"===r||"missing-text"===r){const e=o.occurrences.regex(n,u),t="contains-text"===r?e>0:0===e;return this._recordValue(0===e?"Search text is not found on page":1===e?"Search text is found <b>1</b> time":`Search text is found <b>${e}</b> times`,e,"matches",h(t,e),p(t,e),t)}if("none"===r||"content-changes"===r){if(!t)return this._recordValue("Page content has not changed",0,"%","ok");const e=100*o.diff(t,n,s),a=`<b>${e.toFixed(1)}%</b>`;if(0===e)return this._recordValue("Page content has not changed",0,"%","ok");const i="none"!==r&&e>=d;return this._recordValue(e<.01?"Page content has changed":`${a} of page content has changed`,e,"%",h(i,e),p(i,e),i)}return this._recordError(`Condition ${r} is not supported`)}return this._recordError(`Monitoring ${s} is not supported`)},_replaceInjectedHtml(e){if(!e)return;return[/__hrp="[^"']+"/g,/<__hrp__[^<]+<\/__hrp__>/g].forEach((t=>{e=e.replaceAll(t,"")})),e},_recordValue(e,t,n,a,o,r){const i={ms:Date.now(),value:t};return e&&(i.info=e),n&&(i.metric=n),a&&(i.status=a),o&&(i.color=o),r&&(i.triggered=r),i},_recordError:(e,t)=>({ms:Date.now(),info:e,value:t,status:"error",color:"sublime"}),_recordWarning:(e,t)=>({ms:Date.now(),info:e,value:t,status:"warning",color:"sublime"}),_trigger:e=>({...e.inputs["watcher.trigger"],...e.inputs.trigger}),_triggerCondition(e){const t=this._trigger(e);switch(e.recipeId){case"watcher.monitorHealth":return t.monitorHealth;case"watcher.monitorPrice":return t.monitorPrice;case"watcher.monitorElement":return t.monitorElement;case"watcher.monitorChanges":{const n=e.inputs["watcher.changes"].whatToMonitor;if("html"===n)return t.monitorChangesHtml;if("data"===n)return t.monitorChangesData;if("text"===n)return t.monitorChangesText;throw new Error(`monitoring ${n} is not supported`)}default:return null}},_isCondition(e,t,n){const a=this._trigger(e);return n.includes(a[t])}}})(),(()=>{const{$recipe:e}=n;e.inputs.actions={get state(){const e={sendOn:"first-trigger",limitActions:"do-not-limit"},t={sendOn:"task-success",limitActions:"do-not-limit"};return{widget:{enabled:!0},notification:{enabled:!0,...e},sound:{enabled:!1,value:"sound:sonar",utterance:"Task triggered",volume:50,...e},email:{enabled:!1,to:"",customSmtpEnabled:!1,customSmtpFrom:'"HARPA AI Web Monitor" <monitor@harpa.ai>',customSmtpHost:"smtp.gmail.com:465",customSmtpUsername:"",customSmtpPassword:"",...e,limitActions:"once-a-day"},webhook:{enabled:!1,url:"https://webhook.site/...",basicAuthEnabled:!1,basicAuthUsername:"",basicAuthPassword:"",...t},make:{enabled:!1,url:"https://hook.eu1.make.com/...",...t},push:{enabled:!1,...e},sms:{enabled:!1,...e},slack:{enabled:!1,...e},telegram:{enabled:!1,...e},discord:{enabled:!1,...e},zapier:{enabled:!1,...t}}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.before={get state(){return{idleCheck:{enabled:!0,timeout:15,onTimeout:"carry-on"},dropBanners:{enabled:!0,text:"cookie"},textCheck:{enabled:!1,searchText:"",timeout:15,onTimeout:"report-error"},scroll:{enabled:!1,maxDuration:15}}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.changeUpIs={get state(){return{value:"neutral"}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.page={get state(){return{url:null,timeout:30}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.schedule={get state(){return{type:"periodical",periodical:{frequency:"3h"},interval:{},week:{},month:{},mediumType:"hidden-tab",mediumId:null,autoCloseTab:!0}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.tracking={get state(){return{value:"between-checks"}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.trigger={get state(){return{minThreshold:5,searchText:"discount\noff\npromo",httpCodes:["4xx","5xx"],x:89.99,y:99.99,itemParameter:"value",icon:"alert",color:"negative",doubleCheck:"off"}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs.ua={get state(){return{vlang:null,vua:null,customViewport:!1,viewportWidth:null,viewportHeight:null}},get persistState(){return!0}}})(),(()=>{const{$recipe:e}=n;e.inputs["watcher.changes"]={get state(){return{whatToMonitor:"html",itemTypes:["text","icon","image","video","link","date","time","copyright","number","currency","price"]}}}})(),(()=>{const{$recipe:e}=n;e.inputs["watcher.element"]={get state(){return{selector:null,selectorType:"ai"}}}})(),(()=>{const{$recipe:e}=n;e.inputs["watcher.price"]={get state(){return{pickup:"visually-largest",n:1,anchorText:""}}}})(),(()=>{const{$recipe:e}=n;e.inputs["watcher.trigger"]={get state(){return{monitorChangesText:"content-changes",monitorChangesHtml:"content-changes",monitorChangesData:"content-changes",monitorElement:"value-changes",monitorPrice:"price-changes",monitorHealth:"web-page-is-down"}}}})(),(()=>{const{$recipe:e,$utils:t}=n;e.steps["watcher.actions"]={config:{name:"Dispatch actions on trigger"},async run({ctx:e,step:n}){let a=Object.entries(e.inputs.actions).filter((([e,t])=>"widget"!==e&&t.enabled));if(0===a.length)return void(n.status.content="All actions disabled");const o=e.record?.triggered,r=e.records.at(-1);a=a.filter((n=>{const[a,i]=n,{sendOn:s,limitActions:l}=i;if("task-success"===s);else if("every-trigger"===s){if(!o)return!1}else if("first-trigger"===s){if(!o)return!1;if(r?.triggered)return!1}if("do-not-limit"!==l){const n=e.records.findLast((e=>e.dispatched?.includes(a))),o=(e.record.ms-(n?.ms||0))/t.time.HOUR,r=5/60;if("once-an-hour"===l&&o<1-r||"once-3-hours"===l&&o<3-r||"once-a-day"===l&&o<24-r||"once-a-week"===l&&o<168-r)return!1}return!0})),e.record.dispatched=0===a.length?null:a.map((e=>e[0]));const i=a.map((e=>e[0])).join(", ");n.status.content=0===a.length?"No actions dispatched":1===a.length?`Dispatched 1 action: <b>${i}</b>`:`Dispatched ${a.length} actions: <b>${i}</b>`,a=a.map((e=>({type:e[0]}))).map((t=>(t.records=[...e.records,e.record],"notification"===t.type?(t.title=e.taskName,t.message=e.record.info,t.status=e.record.status,t.color=e.record.color,t.onClick={tabId:e.inputs.schedule?.mediumId,url:e.inputs.page.url}):"sound"===t.type&&(t.id=e.inputs.actions.sound.value,t.volume=e.inputs.actions.sound.volume,t.message=`${e.inputs.actions.sound.utterance}.\n\n${e.record.info}`.replaceAll("  "," to ")),t))),await e.api.runActions(a)}}})(),(()=>{const{$recipe:e,$utils:t}=n;e.steps["watcher.before"]={config:{name:"Wait for page to load"},async run({ctx:e,step:n}){const{idleCheck:a,dropBanners:o,scroll:r,textCheck:i}=e.inputs.before;let s=!1;if(a.enabled){s=!0;const t=a.onTimeout;try{const t=1e3*a.timeout;await e.page.idle({timeout:t})}catch(e){if("timeout"===e.message&&["report-error","report-warning"].includes(t))throw e.status="report-error"===t?"error":"warning",e.color="report-error"===t?"error":"negative",e.message=`Page did not load in ${a.timeout} seconds`,e}}if(i.enabled){s=!0;const n=i.onTimeout;try{const t=1e3*i.timeout;await e.page.wait(i.searchText,{timeout:t})}catch(e){if("timeout"===e.message&&["report-error","report-warning"].includes(n)){const a=t.string.shorten(i.searchText,15);throw e.status="report-error"===n?"error":"warning",e.color="report-error"===n?"error":"negative",e.message=`Text "${a}" not found on page in ${i.timeout} seconds`,e}}}e:if(o.enabled){s=!0;const t=o.text.trim();if(0===t.length)break e;const n=function(e){const t=window.$harpa,n=n=>n.nodeType===Node.ELEMENT_NODE&&"fixed"===t.inspector.style(n).position&&t.utils.occurrences.regex(t.inspector.innerText(n),e)>0,a=(e,t,n)=>1===n.length||n.every((t=>t===e||!e.contains(t))),o=e=>{e.style.display="none",e.style.visibility="hidden"},r=e=>{o(e),window.Array.from(e.parentElement.children).forEach((e=>{0===e.childElementCount&&"fixed"===t.inspector.style(e).position&&o(e)}))},i=e=>{const t=e.filter(n).filter(a);t.length>0&&(t.forEach(r),(()=>{const e=[document.documentElement,document.body];for(const t of e)"hidden"===getComputedStyle(t).overflow&&(t.style.overflow="auto")})())};i(t.query.byAll()),t.utils.mutation.on(document.body,["childList","subtree"],(e=>{i(t.utils.mutation.addedElements(e))}))};await e.page.evaluate(n,[t],{noIdle:!0})}if(r.enabled){s=!0;const t={noIdle:!0,noThrow:!0,timeout:1e3*r.maxDuration};await e.page.scroll("all",t),await e.page.scroll("top",t)}s||(n.status.content="Load steps turned off")}}})(),(()=>{const{$recipe:e}=n,t={"watcher.monitorChanges":"Check page changes","watcher.monitorHealth":"Check page status","watcher.monitorPrice":"Check price on page","watcher.monitorElement":"Check element content"};e.steps["watcher.compare"]={beforeRecipe({ctx:e,step:n}){n.status.content=n.config.name||t[e.recipeId]||"Check page"},async run({ctx:e}){const t={prefetch:e.step("watcher.health")?.result,...e.step("watcher.parse")?.result},n="between-checks"===e.inputs.tracking.value&&e.storage.last||e.storage.first,a=e.adapters.watcher.compare(e,n,t);return Object.assign(e.record,a),e.storage.first?e.storage.last=t:e.storage.first=t,e.adapters.watcher.reduceTaskStorage(e,e.storage),a}}})(),(()=>{const{$recipe:e}=n;e.steps["watcher.favicons"]={config:{name:"Update favicons",hideInJournal:!0},async run({ctx:e}){if(!e.page.isConnected)return;const t=await e.page.favicons({noIdle:!0});return e.api.updateFavicons(t),t}}})(),(()=>{const{$recipe:e,$utils:t}=n;e.steps["watcher.health"]={config:{name:"Fetch the web page"},async run({ctx:e,step:t}){const{url:n,timeout:a}=e.inputs.page,o=await this._fetchUrl(n,1e3*a);if(!(o instanceof Error)){const{statusCode:e,statusText:n}=o;return t.status.content=`Page returned code <b>${e} / ${n}</b>`,o}if("no-connection"===o.message)return t.status.content="No web page connection",this._toResult(0,"No connection",n);if(!navigator.onLine)throw t.status.code="warning",t.status.color="negative",t.status.content="No Internet connection",this._toError("No Internet connection","Offline","warning","sublime");return t.status.content="Fetching page timed out",this._toResult(0,"Timeout",n)},async _fetchUrl(e,n){const a=t.createPromise();setTimeout((()=>{a.reject(new Error("timeout"))}),n);const o=new XMLHttpRequest;return o.open("GET",e,!0),o.onload=()=>a.resolve({statusCode:o.status,statusText:o.statusText||(o.status?"OK":"FAILED")}),o.onerror=()=>a.resolve(new Error("no-connection")),o.send(),a},_toResult:(e,t,n,a=!1)=>({statusCode:e,statusText:t,responseUrl:n,redirected:a}),_toError(e,t,n,a){const o=new Error(e);throw o.info=e,o.value=t,o.status=n,o.color=a,o.valueDimmed="sublime"===a,o}}})(),(()=>{const{$recipe:e,$utils:t}=n;e.steps["watcher.navigate"]={config:{name:"Navigate to web page"},async run({ctx:e,step:n}){const{url:a,timeout:o}=e.inputs.page,r=await e.page.goto(a,{noThrow:!0,timeout:1e3*o});if(!(r instanceof Error))return e.api.updateTask((t=>{t.inputs.schedule.mediumType=e.page.mediumType,t.inputs.schedule.mediumId=e.page.mediumId})),r;if("no-connection"===r.message)return n.status.content="No web page connection",this._toResult(0,"No connection",a);if(!navigator.onLine)throw n.status.code="warning",n.status.color="negative",n.status.content="No Internet connection",this._toError("No Internet connection","Offline","warning","sublime");throw n.status.code="warning",n.status.color="negative",n.status.content="Navigation timed out",this._toError(`Could not navigate to ${t.string.shorten(a,25)}`,"N/A","warning","sublime")},_toResult:(e,t,n,a=!1)=>({statusCode:e,statusText:t,responseUrl:n,redirected:a}),_toError(e,t,n,a){const o=new Error(e);throw o.info=e,o.value=t,o.status=n,o.color=a,o.valueDimmed="sublime"===a,o}}})(),(()=>{const{$recipe:e}=n;e.steps["watcher.page"]={config:{name:"Create page",hideInJournal:!0},async run({ctx:e,step:t}){if(e.page)return;const n={mediumType:e.inputs.schedule?.mediumType||"pinned-tab",mediumId:e.inputs.schedule?.mediumId||null,autoCloseTab:Boolean(e.inputs.schedule?.autoCloseTab),...e.inputs.ua,...t.config};return delete n.name,delete n.hideInJournal,e.api.browser.newPage(n)}}})(),(()=>{const{$recipe:e,$utils:t}=n;e.steps["watcher.parse"]={config:{name:"Parse page data with A.I.",query:["html","data","text","item"]},async run({ctx:e,step:t}){const n=t.config.query,l={};return n.includes("html")&&(l.html=await a(e)),(n.includes("data")||n.includes("text")||n.includes("item"))&&(l.data=await o(e)),n.includes("text")&&(l.text=await i(e,l.data)),n.includes("item")&&(l.item=await s(e,l.data),e.state.item=l.item||null),l.data&&(l.data=r(l.data)),l},afterStep({step:e,s:n}){const a=e.result,o=0!==n?`, took <b>${n}</b> seconds`:"";if(a.html){const t=(a.html.length/1024).toFixed(1);e.status.content=`Parsed page of <b>${t} Kb</b>`+o}else if(a.text){const t=(a.text.length/1024).toFixed(1);e.status.content=`Parsed text of <b>${t} Kb</b>`+o}else if(a.item){const{value:n,metric:r,type:i}=a.item;let s=t.formatter.format(n,r||i);s=t.string.shorten(s,60),e.status.content=`Parsed element <b>${s}</b>`+o}else if(a.data){const t=a.data.length;e.status.content=`Parsed <b>${t} data items</b>`+o}}};const a=async e=>e.page.content({contentType:"htmlContent",noIdle:!0}),o=async e=>e.page.parse({inspect:!0,extract:!0,noIdle:!0}),r=e=>e.map((e=>(e.elements=e.elements.map((e=>e.serialize())),e.data={isVisible:e.data.isVisible,isInViewport:e.data.isInViewport,tag:e.data.tag,fontSize:e.data.fontSize},delete e.container,delete e.path,e))),i=async(e,t)=>t.filter((e=>"text"===e.type)).map((e=>e.value)).join("\n"),s=async(e,n)=>{let a=e.inputs["watcher.element"].selector;if(t.is.nil(a)){const t=e.adapters.watcher.biggestItem(n);if(t&&t.container){a=(await e.page.inspect(t.container,{computeAiLocator:!0})).locator.selector,"element"!==t.type&&a.push({$parse:t.type,at:t.at})}else a=[{$css:"body"},{$parse:"text",at:0}]}return e.inputs["watcher.element"].selector=a,e.adapters.watcher.queryItem(e.page,a)}})(),(()=>{const{$recipe:e,$utils:t,$env:a,$offscreen:o}=n;e.steps["watcher.preview"]={config:{name:"Generate page preview",hideInJournal:!0},async run({ctx:e}){try{const t=e.recordStorage.screenshot;e.storage.preview=await this._createPreview(t)}catch(e){console.warn("failed creating page preview",e)}},async _createPreview(e){if(3===a.manifestVersion){return await o.controller.send("createImagePreview",e)}const n=document.createElement("img"),r=URL.createObjectURL(e);n.src=r,await new Promise(((e,t)=>{n.onload=e,n.onerror=t}));const i=document.createElement("canvas");let s,l;i.width=660,i.height=462;const c=n.naturalWidth,u=n.naturalHeight,d=c/u,p=i.width/i.height;d<p?(s=c,l=c/p):(l=u,s=u*p);return i.getContext("2d").drawImage(n,0,0,s,l,0,0,i.width,i.height),await t.canvasToBlob(i,"image/webp",.5)}}})(),(()=>{const{$recipe:e}=n;e.steps["watcher.prune"]={config:{name:"Prune obsolete records",hideInJournal:!0,maxRecords:1e3},async run({ctx:e,step:t}){const{records:n}=e,{maxRecords:a}=t.config;if(0===a)return e.records=[],void(e.record=null);1!==a?n.length+1>a&&(e.records=n.slice(n.length-a-1)):e.records=[]}}})(),(()=>{const{$recipe:e}=n;e.steps["watcher.screenshot"]={config:{name:"Take a screenshot",idle:!1},async run({ctx:e,step:t}){try{t.config.idle&&await e.page.idle(),e.recordStorage.screenshot=await e.page.screenshotter.capture()}catch(e){const n=e.message.slice(0,100);t.error=n,t.status.code="error",t.status.color="negative",t.status.content=`Failed to take a screenshot: ${n}`}}}})(),(()=>{const{$recipe:e,$store:t,$env:a}=n,o=(e,t,n,a=!0)=>{if(a&&!n.hasOwnProperty(t))throw new Error(`no recipe ${e} ${t} found`);return n[t]};e.proxy=t.createProxy({adapter:(t,n=!0)=>o("adapter",t,e.adapters,n),input:(t,n=!0)=>o("input",t,e.inputs,n),step(t,n=!0){if(a.is.pp)throw new Error("not supported");return o("step",t,e.steps,n)}})})(),(()=>{const{$offscreen:e,$bus:t,$utils:a}=n;e.controller={init(){},async send(e,...n){return a.chrome.alarms.off(this._closeDocumentAlarm),this._closeDocumentAlarm=a.chrome.alarms.run((()=>this.closeDocument()),{delayInMinutes:5,once:!0}),await this._ensureDocument(),await t.send(`offscreen.${e}`,...n)},async _ensureDocument(){if(await chrome.offscreen.hasDocument())return;if(this._ensurePromise)return this._ensurePromise;this._ensurePromise=a.createPromise(),t.once("startup.offscreenReady",(()=>{console.log("[$offscreen] document created"),this._ensurePromise.resolve(),this._ensurePromise=null}));const e=chrome.runtime.getManifest();await chrome.offscreen.createDocument({url:a.url.ext("/harpa.html?offscreen",{manifest:e}),reasons:[chrome.offscreen.Reason.BLOBS],justification:"Create image from svg code, generate image preview"})},async closeDocument(e=!1){if(await chrome.offscreen.hasDocument()){if(!e){if(!await t.send("offscreen.canBeClosed"))return}try{console.log("[$offscreen] closing document"),await chrome.offscreen.closeDocument()}catch(e){console.log("[$offscreen] closing document failed",e)}}}}})(),(()=>{const{$news:e,$store:t,$peeker:a,$settings:o}=n;e.proxy=t.createProxy({get show(){return t.state.news.show},set show(t){if(!t&&this.show){const t=Object.keys(e.updates).map((t=>({value:e.proxy.toNumber(t),k:t}))).sort(((e,t)=>t.value-e.value))[0]?.k;t&&(e.proxy.lastSeenVersion=t)}t&&(a.proxy.update({show:!1,fixed:!1}),o.proxy.show=!1),this._update({show:t})},get rated(){return t.state.news.rated},set rated(e){this._update({rated:e})},get reviewed(){return t.state.news.reviewed},set reviewed(e){this._update({reviewed:e})},get feedbackStatus(){return t.state.news.feedbackStatus},set feedbackStatus(e){this._update({feedbackStatus:e})},get feedbackMessage(){return t.state.news.feedbackMessage},set feedbackMessage(e){this._update({feedbackMessage:e})},get feedbackEmail(){return t.state.news.feedbackEmail},set feedbackEmail(e){this._update({feedbackEmail:e})},get lastSeenVersion(){return t.state.news.lastSeenVersion},set lastSeenVersion(e){this._update({lastSeenVersion:e})},get anno(){let t=this.lastSeenAnno;if(!t)return null;t=e.proxy.toNumber(t);const n=Object.keys(e.annos).filter((n=>e.proxy.toNumber(n)>t));return 0===n.length?null:e.annos[n.sort(((e,t)=>t.value-e.value))[0]]},get lastSeenAnno(){return t.state.news.lastSeenAnno},set lastSeenAnno(e){this._update({lastSeenAnno:e})},resetLastSeenAnno(){const t=Object.keys(e.annos).map((t=>({value:e.proxy.toNumber(t),k:t}))).sort(((e,t)=>t.value-e.value))[0]?.k;t&&(e.proxy.lastSeenAnno=t)},_update(e={}){t.transaction((t=>{Object.assign(t.news,e)}))},toNumber(e){e=e||"0.0.0";const[t,n,a]=e.split(".");return 1e6*(Number(t)||0)+1e3*(Number(n)||0)+(Number(a)||0)}})})(),(()=>{const{$netRules:e,$chrome:t,$utils:a,$bus:o}=n;e.controller={async init(){e.register=this._register.bind(this),e.unregister=this._unregister.bind(this),this._lastRuleId=1,this._rules=[],o.on("netRules.register",this._register,this),o.on("netRules.unregister",this._unregister,this),await this._dropAllSessionRules(),this._cleanupTabRulesPeriodically()},async _register(e){const n=Array.isArray(e);e=(e=a.ensureArray(e).map((e=>{const t=this._lastRuleId;return this._lastRuleId+=1,{id:t,priority:1,...e,key:e.key||String(t),condition:{resourceTypes:["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","csp_report","media","websocket","webtransport","webbundle","other"],...e.condition}}}))).filter(((t,n)=>n===e.findLastIndex((e=>e.key===t.key))));const o=this._rules.filter((t=>e.find((e=>e.key===t.key)))).map((e=>e.id));this._rules.push(...e.map((e=>({id:e.id,key:e.key,tabIds:e.condition.tabIds||null}))));const r=e.map((e=>e.key));return e.forEach((e=>delete e.key)),await t.declarativeNetRequest.updateSessionRules({addRules:e}),await this._unregisterByIds(o),n?r:r[0]},async _unregister(e){const t=a.ensureArray(e),n=this._rules.filter((e=>t.includes(e.key))).map((e=>e.id));await this._unregisterByIds(n)},async _unregisterByIds(e){this._rules=this._rules.filter((t=>!e.includes(t.id))),await t.declarativeNetRequest.updateSessionRules({removeRuleIds:e})},async _dropAllSessionRules(){const e=await t.declarativeNetRequest.getSessionRules();await t.declarativeNetRequest.updateSessionRules({removeRuleIds:e.map((e=>e.id))})},_cleanupTabRulesPeriodically(){a.chrome.alarms.run(this._cleanUpTabRules.bind(this),{name:"netRules.cleanupTabRules",periodInMinutes:5})},async _cleanUpTabRules(){const e=[];for(const n of this._rules){if(!n.tabIds)continue;let a=!1;for(const e of n.tabIds){await t.tabs.get(e)&&(a=!0)}a||e.push(n.id)}await this._unregisterByIds(e)}}})(),(()=>{const{$logger:e,$env:t}=n;e.controller={init(){e.log=this.log.bind(this),e.dev=this.dev.bind(this),e.warn=this.warn.bind(this),e.error=this.error.bind(this),e.critical=this.critical.bind(this)},log(...e){console.log(...e)},dev(...e){t.is.development&&console.log(...e)},warn(...e){console.warn(...e)},error(...e){console.error(...e)},critical(...e){console.error("[critical]",...e),alert("critical error")}},e.controller.init()})(),(()=>{const{$library:e,$utils:t,$store:a,$bus:o,$task:r}=n;e.cleanupDomainsJob={init(){o.on("library.cleanupDomains",this._perform),t.chrome.alarms.run(this._perform,{name:"library.cleanupDomains",delayInMinutes:1,periodInMinutes:t.time.DAY/t.time.MINUTE})},_perform(){const e=a.state.library.domains,t=new Set([...a.state.library.recipes.map((e=>e.domains[0])),...a.state.tasks.map((e=>r.proxy.taskDomain(e)))]),n={};let o=!1;Object.keys(e).forEach((e=>{t.has(e)?n[e]=a.state.library.domains[e]:o=!0})),o&&a.transaction((e=>{e.library.domains=n}))}}})(),(()=>{const{$library:e}=n;e.controller={init(){e.updateRecipesJob.init(),e.cleanupDomainsJob.init()}}})(),(()=>{const{$library:e,$store:t,$utils:a,$bus:o,$env:r}=n;e.updateRecipesJob={init(){o.on("library.updateRecipes",this._perform),a.chrome.alarms.run(this._perform,{name:"library.updateRecipes",delayInMinutes:a.time.DAY/a.time.MINUTE,periodInMinutes:a.time.DAY/a.time.MINUTE,immediately:!0})},_perform(){const n=t.state.library.recipesUpdateAt||0,o=r.is.development?0:a.time.DAY;if(Date.now()-n<o)return;const i=e.libraryRecipes(),s=e.favicons();t.transaction((e=>{e.library.recipesUpdateAt=Date.now(),a.deepEqual(i,e.library.recipes)||(e.library.recipes=i)})),e.proxy.setDomainFavicons(Object.entries(s).map((([e,t])=>({domain:e,favicon:t}))))}}})(),(()=>{const{$library:e,$store:t,$tabs:a,$critical:o}=n;e.proxy=t.createProxy({get recipes(){return t.state.library.recipes},get domainRecipes(){let e=this.recipes;if("popup"===o.proxy.pageType){const t=a.proxy.currentTabDomain;if(!t)return e;e=e.filter((e=>!e.domains||e.domains.some((e=>t.includes(e)))))}return e},domainFavicon(e){if(!e)return null;for(e=e.split(".");e.length>0;){const n=e.join("."),a=t.state.library.domains[n],o=a?.faviconHq||a?.favicon;if(o)return o.startsWith("/")?chrome.runtime.getURL(o):o;e.shift()}return null},setDomainFavicon(e,t,n=!1){this.setDomainFavicons([{domain:e,favicon:t,hq:n}])},setDomainFavicons(e){t.transaction((t=>{e.filter((e=>e.domain&&e.favicon)).forEach((e=>{const{domain:n,favicon:a,hq:o}=e;t.library.domains[n]=t.library.domains[n]||{},o?t.library.domains[n].faviconHq=a:t.library.domains[n].favicon=a}))}))},isUpvoted(e){const n=this._recipeHash(e);return t.state.library.upvotedRecipes.includes(n)},upvote(e){if(this.isUpvoted(e))return;const n=this._recipeHash(e);t.transaction((e=>{e.library.upvotedRecipes.push(n)}))},get recipeIdeaCardView(){return t.state.library.recipeIdeaCard.view},_recipeHash:e=>`${e.id}:${e.title}`})})(),(()=>{const{$library:e}=n;e.recipeIdeaCardModel=()=>({view:"link",domain:"",domainError:null,suggestion:"",suggestionError:null,email:"",emailError:null,emailWarning:null})})(),(()=>{const{$library:e,$env:t}=n;e.libraryRecipes=()=>{const e=t.is.desktop?"desktop":"extension";return[{id:"mentions",title:"Brand and Social Mentions",domains:["mention","notify","mediatoolkit","f5bot","mentionlytics","reddit","instagram","facebook","twitter","youtube","medium","ycombinator","alternativeto"],tags:["marketing","pr","media","social","forums","press"],favicon:"mentions.png",desc:"Monitor the Web, online and social media for @mentions of your brand, social profiles or competitors.",info:["This recipe does the routine part of looking for @mentions of your brand for you, so that you focus on uncovering trends in conversations and communicating back with your audience.","It monitors all major web sources to find new conversations that @mention your brand, including:","* Social networks: Twitter, Facebook and Instagram","* Online media platforms","* Blogs and forums","* Press articles","* Review sites","Listen to your audience, pinpoint important conversations or analyze your competitors. You can also add custom mention sources to monitor."]},{id:"contact-details",title:"Contact Details Extractor",domains:["contact-details"],tags:["marketing","leads"],favicon:"contact-details.png",desc:"Extract contact details from any website to quickly generate leads for marketing and sales teams.",info:["This recipe can crawl any website and extract the following contact information for individuals listed on the website:","* Email addresses","* Phone numbers (from phone links or extracted from text)","* LinkedIn profiles","* Twitter handles","* Instagram profiles","* Facebook user profiles or pages"]},{id:"facebook-page-export",title:"Facebook Page Export",domains:["facebook"],tags:["smm","social","marketing","export"],desc:"This recipe extracts publicly available data from Facebook Pages. It can download posts, likes, comments, reviews, contact details, social media profiles, address etc.",info:["The following publicly available data can be extracted:","* Posts, comments and reviews","* Likes count","* Address","* Instagram and Twitter profile","* Website","* Services","* Messenger URL","* Telephone number","* Check-ins","* All other public text information such as price range, mission, awards etc","All data is downloadable in JSON, CSV and XML forms."]},{id:"linkedin-lead-export",title:"LinkedIn Lead Export",domains:["linkedin"],tags:["leads","sales","export"],desc:"Extract, clean & enrich leads from LinkedIn Sales Navigator in a few clicks.",info:["This recipe generates leads for your business by searching through LinkedIn Sales Navigator. It can:","* Extract leads from LinkedIn and enrich data with profiles and company info","* Cleanup data for your CRM or Cold Outreach campaigns","* Filter leads by detecting those that dont match with your Sales Navigator search filters","* Find lead emails by connecting to your email finder"]},{id:"google-maps-export",title:"Google Maps Export",domains:["google"],tags:["maps","geo","export"],favicon:"google-maps.ico",desc:"Export or monitor reviews, photos, prices, opening hours, popular times, ratings from Google Maps.",info:["This recipe enables you to monitor specific places or extract the following information on multiple places from the Google Maps service:","* Title, subtitle, category, place ID, and URL","* Address, location, code and coordinates","* Phone and website if available","* Menu and price if available","* Temporarily or permanently closed status","* Popular times - histogram & live occupancy","* Average rating, review count, and review distribution","* List of images","* List of detailed characteristics","* Opening hours","* People also search","This recipe also supports extracting all the detailed information about reviews:","* Review text, stars and published date","* Response from owner including text and published date","* Review ID & URL"]},{id:"instagram-analytics",title:"Instagram Analytics",domains:["instagram"],tags:["smm","social","marketing","analytics"],desc:"Compile Instagram profile and post analytics reports: unfollowers and new follower lists, ghost, churning and spam followers, secret admirers, best and worst performing hashtags and more.",info:["This recipe is designed to access publicly available data that was removed from the Instagram API in 2020 and enables anyone to extract this data from Instagram:","* Instagram account followers and unfollowers","* Spam followers","* Ghost followers - accounts that follow you but do not engage with your profile","* Churning followers - accounts that have stopped engaging with your profile","* Secret admirers - accounts that engage with your profile but do not follow you","* Mutual and unilateral followers","* Your content posts and hashtags ranked by performance","* Post likes and comments","* Places / locations posts","You can use this recipe to get data on any public account, including yours. All data is downloadable in JSON, CSV and XML forms."]},{id:"instagram-growth",title:"Instagram Growth Bot",domains:["instagram"],tags:["smm","social","marketing","automation"],desc:"Automate your Instagram profile engagement: auto-like, follow and watch stories to grow your account. Retain and regain lost followers and monitor comments.",info:["This all-in-one profile engagement automation recipe for Instagram can be used to build up, retain and regain your followers base:","* Gain new followers by automatically finding Instagram users that might be interested in your Profile content, like or follow their content and convert into followers","* Regain lost followers by detecting and engaging with churning Instagram followers that have recently unfollowed you or stopped engaging with your account","* Unfollow mass-followers and spammy accounts who have followed and then unfollowed your profile","* Watch stories from your feed or from accounts that have liked your posts recently","* Auto-like posts from your home feed, hashtags, locations, users or followers","* Periodically check your recent profile posts to gather and promptly reply to new comments"]},{id:"instagram-export",title:"Instagram Export",domains:["instagram"],tags:["smm","social","marketing","export"],desc:"Export Instagram posts from any public Instagram account, hashtag or location pages.",info:["Use this recipe to download Instagram posts and post metadata. You can download all posts from a page or filter posts by a set of conditions.","This recipe can automatically detect new posts on a page and download them periodically."]},{id:"instagram-chatbot",title:"Instagram Chatbot",domains:["instagram"],tags:["smm","social","marketing","chatbot"],desc:"Setup an Instagram chatbot to send welcome and farewell DMs, send DMs to multiple accounts, run Instagram DM campaigns or send keyword-driven auto-replies.",info:["This recipe watches incoming Instagram DMs and sends out direct messages:","* A welcoming DM whenever an Instagram user starts a new DM chat with you","* A farewell DM whenever an Instagram user unfollows your account","* A bulk DM message to multiple Instagram accounts, all of your followers or recent unfollowers","This recipe does not require a Business Instagram account to operate and can be used to build complex Instagram chatbots."]},{id:"job-monitor",title:"Job Monitor",domains:["glassdoor","indeed"],tags:["jobs","hr"],desc:"Monitor jobs posted on indeed.com and glassdoor.com websites and export detailed job information and company reviews from the portals.",info:["This recipe allows you to extract information about all positions on indeed.com and glassdoor.com job portals and can scrape the following data:","* New vacancies by keyword, location, salary and company","* Reviews of a given company","* An average salary of a job or position in a given area","Specify the search based on location and get jobs with position, location and description."]},{id:"real-estate-monitor",title:"Real-Estate Monitor",domains:["zillow"],tags:["real-estate","property","rent"],desc:"Extract data about all properties for sale and rent on Zillow.com",info:["This recipe lets you extract data from real estate listings on Zillow.com.","It enables you to search for, watch and monitor properties in any location and extract detailed information, such as:","* Full addresses","* Longitude / latitude","* Price","* Description","* URL","* Photos","* Number of bedrooms and bathrooms etc"]},{id:"seo-audit",title:"SEO Audit",domains:["semrush","seoptimer"],tags:["seo","audit","reports"],favicon:"seo-audit.png",desc:"Carry out a SEO audit of any website. Find broken links, missing images, and get information about possible page improvements.",info:["Search Engines rely on many factors to rank a website. This recipe reviews these factors to help identify problems that could be holding your site back from its potential.","The following aggregated information is reported for your website:","* On-Page SEO rank","* Broken Links","* Usability score","* Performance score","* Social score","In addition, for every crawled page the following information is retrieved:","* URL of page","* Title of page","* Check if Google Analytics object is included in the page","* Check if Google Analytics function is included in the page","* Check if page has meta tag with charset attribute","* Check if page has meta description","* Value from meta description","* Check if length of meta description is long enough","* Check if doctype is included in page","* Check if title element is included in page","* Check if title is long enough","* Check if H1 element is present on page","* Value from H1 element","* Check that there is only one H1 on page","* Check if H2 element is present on page","* Number of links on page","* Check if there are enough links on page","* List of no-follow links on page","* Number of no-follow links on page","* List of unoptimized images (does not include alt tag)","* Number of unoptimized images","* Number of words on page","* Check if content is long enough","* Check if meta tag viewport is set on page","* Check if amp tag is set on page","* Check that there is no iframe","* List of broken links on page","* Number of broken links on page","* List of broken images on page","* Number of broken image links on page","* Data from JSON-LD specifications","* Data from microdata specifications","All of the data is downloadable for further study in a JSON, CSV and XML formats or as a PDF report."]},{id:"serp-monitor",title:"Search Results Monitor",domains:["google","bing","yahoo","yandex"],tags:["seo","serp","google","bing","yahoo","yandex","keywords"],favicon:"google.ico",desc:"Monitor Google, Bing, Yahoo, Yandex Search Engine Results Pages (SERPs), track your website search rank or extract organic and paid results, ads, queries, prices and reviews.",info:["This recipe crawls Search Results Pages (SERPs) on Google, Bing, Yahoo and/or Yandex and extracts data from the HTML in a structured format.","The following data can be extracted:","* A custom website rank or search position","* Organic results","* Ads and Product ads","* Related queries","* People also ask","* Review rating and review count","* Prices","This recipe supports custom country or language and extraction of custom attributes. All data can be downloaded as JSON, CSV and XML."]},{id:"accommodation-finder",title:"Accommodation Finder",domains:["airbnb","booking"],tags:["travel","hotel","rooms","accommodation"],desc:"Watch accommodation prices and extract data from airbnb.com and booking.com",info:["This recipe extracts accommodation data from airbnb.com and booking.com.","You can monitor a single property or a whole area, apply flexible search parameters, monitor prices, run multiple search queries in a parallel to quickly plan your trip with this recipe.","All results can be exported to JSON, CSV or XML for further analysis."]},{id:"airline-ticket-finder",title:"Airline Ticket Finder",domains:["aviasales","skyscanner","fly-scanner","kayak"],tags:["travel","tickets","airlines","monitor"],desc:"Find and watch for best deals on airline tickets using flexible search parameters.",info:["This recipe finds the best airline tickets for you on skyscanner.com, kayak.com, aviasales.com, fly-scanner.com.","You can set flexible search parameters: date and cost ranges, stops, stopover duration, journey duration, baggage etc.","Airline ticket finder re-runs the search periodically to catch better deals for you."]},{id:"tripadvisor-export",title:"Tripadvisor Export",domains:["tripadvisor"],tags:["travel","export"],desc:"Extract data from Tripadvisor on restaurants and hotels. Get reviews, pricing, contact details, amenities, awards.",info:["Get data on restaurants and hotels from TripAdvisor fast and easy with this recipe. It is suitable for extracting TripAdvisor reviews, emails, addresses, awards and many more attributes of hotels and restaurants.","You can extract data by location or a single place name, hotel or restaurant."]},{id:"twitter-export",title:"Twitter Export",domains:["twitter"],tags:["smm","social","marketing","export"],desc:"Export Twitter user profiles including tweets, retweets, replies, favorites, and conversation threads.",info:["This recipe extracts publicly available data from Twitter profiles:","* User information, including name, Twitter handle (username), location, follower/following count, profile URL/image/banner, date of creation","* List of tweets, retweets, and replies from profiles","* Statistics for each tweet: favorites, replies, and retweets for each tweet","* Search hashtags, get top, latest, people, picture, or video tweets","This recipe can fetch information from a list of Twitter handles or Twitter page URLs."]},{id:"youtube-export",title:"Youtube Export",domains:["youtube"],tags:["video","blogging","marketing","export"],desc:"Export Youtube videos data: channel name, likes, number of views and number of subscribers etc. Crawl videos by keyword, URL or channel name.",info:["YouTube export recipe can extract data from keyword search results, retrieve detailed videos data including likes count and channel name, download captions and comment sections.","* Crawl videos by specifying multiple search keywords, channel name or URLs","* Export channel details: username, description, number of subscribers etc","* Export YouTube subtitles and captions","* Export YouTube comment section"]}].filter((t=>!t.platform||t.platform===e)).map((e=>({...e,comingSoon:!0})))},e.favicons=()=>({airbnb:"/img/favicons/airbnb.ico",aviasales:"/img/favicons/aviasales.ico",bing:"/img/favicons/bing.ico",facebook:"/img/favicons/facebook.ico",glassdoor:"/img/favicons/glassdoor.ico",google:"/img/favicons/google.ico",indeed:"/img/favicons/indeed.ico",instagram:"/img/favicons/instagram.ico",linkedin:"/img/favicons/linkedin.ico",tripadvisor:"/img/favicons/tripadvisor.ico",twitter:"/img/favicons/twitter.ico",yahoo:"/img/favicons/yahoo.ico",yandex:"/img/favicons/yandex.png",youtube:"/img/favicons/youtube.png",zillow:"/img/favicons/zillow.ico"})})(),(()=>{const{$journal:e,$utils:t}=n;e.controller={init(){t.chrome.alarms.run(this._dropOldEvents,{name:"journal.dropOldEvents",delayInMinutes:1,periodInMinutes:t.time.HOUR/t.time.MINUTE})},_dropOldEvents(){e.proxy.dropOldEvents(1e4)}}})(),(()=>{const{$journal:e,$store:t,$task:a,$utils:o}=n;e.proxy=t.createProxy({get events(){return t.state.journal.events},get filters(){return t.state.journal.filters},get filterString(){return t.state.journal.filters.filterString},set filterString(e){t.transaction((t=>{t.journal.filters.filterString=e}))},get filterPeriod(){return t.state.journal.filters.period},set filterPeriod(e){t.transaction((t=>{t.journal.filters.period=e}))},get filterTypes(){return t.state.journal.filters.types},set filterTypes(e){t.transaction((t=>{t.journal.filters.types=e}))},dropOldEvents(e){this.events.length<=e||t.transaction((t=>{t.journal.events=t.journal.events.slice(0,e)}))},clearEvents(){t.transaction((e=>{e.journal.events=[]}))},logTaskCreated(e){this.addEvent({type:"task-management",code:"created",content:"Task created",task:e})},logTaskDeleted(e){this.addEvent({type:"task-management",code:"deleted",content:"Task deleted",task:e})},logTaskEnabled(e){this.addEvent({type:"task-management",code:e.enabled?"run":"stopped",content:e.enabled?"Task started":"Task stopped",task:e})},logJobFinished(e,t){this.addEvent({type:"task-results",code:t.status,color:t.color,content:t.info,task:e})},logActionsRun(e,t,n=!1){if(!t||0===e.length)return;const a=o.unique(e.map((e=>e.type))).join(", ");this.addEvent({type:"action",code:"alert",content:n?`Silenced actions: ${a}`:`Dispatched actions: ${a}`,task:t})},addEvent(e){e.ms||(e.ms=Date.now()),e.task&&(e.taskId=e.task.id,e.taskName=e.task.name||a.proxy.recipeTitle(e.task),delete e.task),t.transaction((t=>t.journal.events.unshift(e)))}})})(),(()=>{const{$install:e,$analytics:t,$store:a,$env:o,$ai:r}=n;e.controller={init(){a.state.installedMs||o.is.desktop||(t.controller.sendInstall(),a.transaction((e=>e.installedMs=Date.now())),chrome.tabs.create({url:o.welcomeUrl,active:!0}),r.controller.presetConnection())}}})(),(()=>{const{$idb:e,$env:t,$utils:a}=n;e.controller={async init(){e.read=this._enqueue(this._read.bind(this)),e.readAllKeys=this._enqueue(this._readAllKeys.bind(this)),e.write=this._enqueue(this._write.bind(this)),t.is.bg&&(e.delete=this._enqueue(this._delete.bind(this)),e.clear=this._enqueue(this._clear.bind(this)),e.onWrite=this._onWrite.bind(this),e.onStorageExceeded=this._onStorageExceeded.bind(this)),(t.is.bg||window.top===window.self)&&(this._db=await this._initDb("harpa")),this._queuePromise=Promise.resolve(),this._writeHandlers=[],this._storageExceededHandlers=[],navigator.storage.persist&&await navigator.storage.persist(),this._getReadyPromise().resolve()},async waitForReady(){await this._getReadyPromise()},_getReadyPromise(){return this._readyPromise||(this._readyPromise=a.createPromise()),this._readyPromise},async _read(e,t=null){return this._db?new Promise(((n,a)=>{let o;try{o=this._db.transaction("data","readonly").objectStore("data").get(e)}catch(t){console.error("[$idb] failed to read key",{key:e,error:t}),a(o.error)}o.onsuccess=e=>{n(e.target.result??t)},o.onerror=()=>{console.error("[$idb] failed to read key",{key:e,error:o.error}),a(o.error)}})):t},async _write(e,t){if(this._db){await new Promise(((n,a)=>{const o=this._db.transaction("data","readwrite");let r;try{r=o.objectStore("data").put(t,e)}catch(t){console.error("[$idb] failed to write key",{key:e,error:t}),a(t)}o.oncomplete=()=>{n()},r.onerror=()=>{const t=r.error;console.error("[$idb] failed to write key",{key:e,error:t}),a(t)},o.onabort=async()=>{const t=o.error;if("QuotaExceededError"===t.name)for(const e of this._storageExceededHandlers)await e();console.error("[$idb] failed to write key",{key:e,error:t}),a(t)}}));for(const e of this._writeHandlers)await e()}},async _delete(e){if(!t.is.bg)throw new Error("$idb.delete is accessible only in bg");if(this._db)return new Promise(((t,n)=>{let a;try{a=this._db.transaction("data","readwrite").objectStore("data").delete(e)}catch(t){console.error("[$idb] failed to delete key",{key:e,error:t}),n(t)}a.onsuccess=()=>{t()},a.onerror=()=>{console.error("[$idb] failed to delete key",{key:e,error:a.error}),n(a.error)}}))},async _clear(){if(!t.is.bg)throw new Error("$idb.delete is accessible only in bg");if(this._db)return new Promise(((e,t)=>{let n;try{n=this._db.transaction("data","readwrite").objectStore("data").clear()}catch(e){console.error("[$idb] failed to clear idb",{error:e}),t(e)}n.onsuccess=()=>{e()},n.onerror=()=>{console.error("[$idb] failed to clear idb",{error:n.error}),t(n.error)}}))},async _readAllKeys(){return this._db?new Promise(((e,t)=>{let n;try{n=this._db.transaction("data","readonly").objectStore("data").getAllKeys()}catch(e){console.error("[$idb] failed to read all keys",{error:e}),t(e)}n.onsuccess=t=>{const n=t.target.result;e(n)},n.onerror=()=>{const e=n.error;console.error("[$idb] failed to read all keys",{error:e}),t(e)}})):[]},_enqueue(e){return async(...t)=>{const n=this._queuePromise,o=a.createPromise();this._queuePromise=o,await n;const r=await e(...t);return o.resolve(r),r}},async _onStorageExceeded(e){if(!t.is.bg)throw new Error("$idb.onStorageExceeded is accessible only in bg");this._storageExceededHandlers.push(e)},async _onWrite(e){if(!t.is.bg)throw new Error("$idb.onWrite is accessible only in bg");this._writeHandlers.push(e)},_initDb:async e=>new Promise(((t,n)=>{const a=indexedDB.open(e,1);a.onupgradeneeded=e=>{e.target.result.createObjectStore("data")},a.onsuccess=e=>{t(e.target.result)},a.onerror=()=>{const e=a.error;console.error("[$idb] failed to open idb",{error:e}),n(e)}}))}})(),(()=>{const{$hframe:e,$chrome:t,$harpa:a,$tabs:o,$redactor:r,$task:i,$store:s,$settings:l,$mobx:c}=n;e.controller={init(){this._hframeTabs=new Set,this._passTasksToTabs(),this._cleanupHFrameTabs(),this._replyHFrameState()},_passTasksToTabs(){const t=e=>{Array.from(this._hframeTabs).forEach((t=>chrome.tabs.sendMessage(t,{type:"hframe.setState",state:e})))};c.reaction((()=>e.proxy.tasks),(e=>t({tasks:e}))),c.reaction((()=>l.proxy.autoCloseHiddenWindow),(e=>t({autoCloseHiddenWindow:e})))},_cleanupHFrameTabs(){chrome.tabs.onRemoved.addListener((e=>this._hframeTabs.delete(e)))},_replyHFrameState(){chrome.runtime.onMessage.addListener(((e,t)=>{const n=t?.tab?.id;if(!n)return;const a=e?.type||"";if(!a.startsWith("hframe."))return;const o=this[a.split(".")[1]];o&&o.bind(this)(n,e)}))},fetchState(t){this._hframeTabs.add(t),chrome.tabs.sendMessage(t,{type:"hframe.setState",state:{initialized:!0,appInstalled:!0,tasks:e.proxy.tasks,autoCloseHiddenWindow:l.proxy.autoCloseHiddenWindow}})},async hide(e){const n=await this._windowForTabId(e);n&&await t.windows.update(n,{state:"minimized"})},async close(e){const n=await this._windowForTabId(e);n&&await t.windows.remove(n)},async taskClick(e,t){a.proxy.mainScreen="dashboard";const n=await o.openAppTab(!1);setTimeout((()=>{r.proxy.show=!0,r.proxy.taskId=t.taskId}),n?0:150)},async disconnect(n,a){const o=a.taskId,r=s.state.tasks.find((e=>e.id===o));if(r)try{await t.tabs.remove(r.inputs.schedule.mediumId)}catch{}i.proxy.updateTask(o,(e=>{e.inputs.schedule.mediumType="tab"})),0===e.proxy.tasks.length&&await t.tabs.remove(n)},async disconnectAll(e){for(const e of s.state.tasks)if("hidden-tab"===e.inputs.schedule.mediumType)try{await t.tabs.remove(e.inputs.schedule.mediumId)}catch{}s.transaction((e=>{e.tasks.filter((e=>"hidden-tab"===e.inputs.schedule.mediumType)).forEach((e=>e.inputs.schedule.mediumType="tab"))})),await t.tabs.remove(e)},async autoCloseClick(){l.proxy.autoCloseHiddenWindow=!l.proxy.autoCloseHiddenWindow},_windowForTabId:async e=>(await t.tabs.query({})).find((t=>t.id===e))?.windowId}})(),(()=>{const{$hframe:e,$store:t,$task:a,$dashboard:o}=n;e.proxy=t.createProxy({get tasks(){return t.state.tasks.filter((e=>"hidden-tab"===e.inputs.schedule?.mediumType)).map((e=>({id:e.id,name:e.name||a.proxy.recipeTitle(e),favicon:o.proxy.taskFavicon(e),url:(e.inputs.page?.url||"").split("://")[1]})))}})})(),(()=>{const{$harpa:e,$env:t}=n;function a(e,n){return fetch(`${t.apiUrl}${e}`,{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(n)})}e.api={action:async e=>a("/action",e),feedback:async(e,t,n)=>a("/feedback",{source:"app:rate-us",message:e,email:t,rated:n})}})(),(()=>{const{$harpa:e,$store:t}=n;e.proxy=t.createProxy({get mainScreen(){return t.state.mainScreen},set mainScreen(e){t.transaction((t=>t.mainScreen=e))},get theme(){return t.state.theme},set theme(e){t.transaction((t=>t.theme=e))}})})(),(()=>{const{$feature:e,$env:t,$utils:a}=n;e.controller={init(){a.chrome.alarms.run(this._update,{name:"feature.update",delayInMinutes:a.time.DAY/a.time.MINUTE,periodInMinutes:a.time.DAY/a.time.MINUTE,immediately:!0})},_update(){if(e.proxy.shouldUpdate)try{const n=e.proxy.hash,o=n?`${t.apiUrl}/feature?hash=${n}`:`${t.apiUrl}/feature`;fetch(o).then((e=>e.json())).then((t=>{if("ok"!==t.status)throw new Error(`invalid response status: ${t.status}`);if(!a.is.object(t))throw new Error(`invalid response data: ${t}`);t.hash?(delete t.status,t.updatedAt=Date.now(),e.proxy.state=t):e.proxy.updatedAt=Date.now()}))}catch(e){console.log("[$feature] failed fetching feature data",e)}}}})(),(()=>{const{$feature:e,$store:t,$utils:a}=n;e.proxy=t.createProxy({set state(e){t.transaction((t=>t.feature=e))},get state(){return t.state.feature},get hash(){return t.state.feature.hash},set hash(e){t.transaction((t=>t.feature.hash=e))},get updatedAt(){return t.state.feature.updatedAt},set updatedAt(e){t.transaction((t=>t.feature.updatedAt=e))},get shouldUpdate(){const e=this.updatedAt||-1;return Date.now()-e>a.time.DAY-15*a.time.MINUTE}})})(),(()=>{const{$env:e,$utils:t}=n;e.controller={init(){const n="undefined"==typeof location?"el":location.pathname.includes("bg.js")||location.pathname.includes("background_page.html")?"bg":location.pathname.includes("harpa.html")?"pp":chrome.runtime&&!chrome.tabs?"cs":"nj",a="el"===n?"desktop":"extension",o=(()=>{if("el"===n)return process.env.NODE_ENV;const e=t.ls.get("env.is");if(e)return e;return this.getManifest().env||"production"})();Object.assign(e,{env:o,locus:n,version:this.getManifest().version,versionNumber:this.getManifest().version.split(".").map(Number).reduce(((e,t)=>1e3*e+t),0),manifestVersion:this.getManifest().manifest_version,platform:this.getPlatform(),apiUrl:"https://api.harpa.ai/api/v1",webUrl:"https://harpa.ai",welcomeUrl:"https://harpa.ai/welcome",makeAppInviteUrl:"https://www.make.com/en/hq/app-invitation/c98499c16cfa22f1051f64346ef91aaa",extUrl:{reviews:"https://chrome.google.com/webstore/detail/eanggfilgoajaocelnaflolkadkeghjp/reviews"},mixpanel:{token:"7958323a20a869de3c57712bfe521a6f"},contactEmail:"contact@harpa.ai",contactUsUrl:"https://harpa.ai/#contact-us",discordUrl:"https://discord.gg/rPCMrnj7De",is:{pp:"pp"===n,bg:"bg"===n,el:"el"===n,cs:"cs"===n,nj:"nj"===n,test:"test"===o,beta:"beta"===o,production:"production"===o,development:"development"===o,desktop:"desktop"===a,extension:"extension"===a},features:this.initFeatures({debug:"development"===o||"beta"===o,taskImport:!0,taskExport:!0,library:!1,changesTracking:!1,actionsReporting:!1,doubleCheck:!1,emailActionFromField:!1}),options:{}})},initFeatures:(e={})=>new Proxy(e,{get(n,a){const o=e[a];return t.ls.get(`$env.features.${a}`,o)},set:(n,a,o)=>(e[a]=o,t.ls.set(`$env.features.${a}`,o),!0)}),getManifest(){if("undefined"==typeof chrome)return{name:"TEST",version:1};if(!chrome.runtime)return window.__harpaManifest__;const e=new URL(location.href).searchParams.get("manifest");return e?JSON.parse(e):chrome.runtime.getManifest()},getPlatform(){const e=navigator.platform.toLowerCase();return e.startsWith("mac")?"mac":e.startsWith("linux")?"linux":"win"}},e.controller.init()})(),(()=>{const{$engine:e,$utils:t}=n;e.extractor={extract(e){this.init();const t=this._cache.get(e);if(t)return t;let n={value:e,template:null,items:[]};return n.value.match(/\d/)&&(n=this._parseTime(n),n=this._parseDuration(n),n=this._parseCopyright(n),n=this._parseDate(n,this.config.regex.date_triplex,!0),n=this._parseDate(n,this.config.regex.date_dmy,!0),n=this._parseDate(n,this.config.regex.date_mdy,!0),n=this._parseDate(n,this.config.regex.date_my,!0),n.value=e,n=this._parseNumber(n),n=this._mergeNumbers(n),n=this._cleanSourceMetrics(n)),this._maskItemsInValue(n),n=this._parseCurrency(n),this._maskItemsInValue(n,"currency"),n.template=this._replaceMask(n.value),n.value=e,n.items=n.items.sort(((e,t)=>e.index-t.index)),this._cache.set(e,n),n},config:{currencies:t.currency.list,time:{millisecond:1,second:1e3,minute:6e4,hour:36e5},monthsMap:{},currenciesMap:{},metricsMap:{"s":{to:"ms",mult:.001},microsecond:{to:"ms",mult:.001},microseconds:{to:"ms",mult:.001},ms:{to:"ms",mult:1},millisecond:{to:"ms",mult:1},milliseconds:{to:"ms",mult:1},s:{to:"ms",mult:1e3},second:{to:"ms",mult:1e3},seconds:{to:"ms",mult:1e3},m:{to:"ms",mult:6e4},min:{to:"ms",mult:6e4},minute:{to:"ms",mult:6e4},minutes:{to:"ms",mult:6e4},h:{to:"ms",mult:36e5},hour:{to:"ms",mult:36e5},hours:{to:"ms",mult:36e5},d:{to:"ms",mult:864e5},day:{to:"ms",mult:864e5},days:{to:"ms",mult:864e5},w:{to:"ms",mult:6048e5},week:{to:"ms",mult:6048e5},weeks:{to:"ms",mult:6048e5},mo:{to:"ms",mult:2592e6},month:{to:"ms",mult:2592e6},months:{to:"ms",mult:2592e6},y:{to:"ms",mult:31536e6},year:{to:"ms",mult:31536e6},years:{to:"ms",mult:31536e6},"m":{to:"meters",mult:1e-6},micrometre:{to:"meters",mult:1e-6},micrometer:{to:"meters",mult:1e-6},micrometres:{to:"meters",mult:1e-6},micrometers:{to:"meters",mult:1e-6},mm:{to:"meters",mult:.001},millimetre:{to:"meters",mult:.001},millimeter:{to:"meters",mult:.001},millimetres:{to:"meters",mult:.001},millimeters:{to:"meters",mult:.001},cm:{to:"meters",mult:.01},centimetre:{to:"meters",mult:.01},centimeter:{to:"meters",mult:.01},centimetres:{to:"meters",mult:.01},centimeters:{to:"meters",mult:.01},dm:{to:"meters",mult:.1},decimetre:{to:"meters",mult:.01},decimeter:{to:"meters",mult:.01},decimetres:{to:"meters",mult:.01},decimeters:{to:"meters",mult:.01},metre:{to:"meters",mult:1},metres:{to:"meters",mult:1},meter:{to:"meters",mult:1},meters:{to:"meters",mult:1},km:{to:"meters",mult:1e3},kilometre:{to:"meters",mult:1e3},kilometer:{to:"meters",mult:1e3},kilometres:{to:"meters",mult:1e3},kilometers:{to:"meters",mult:1e3},inch:{to:"meters",mult:.0254},inches:{to:"meters",mult:.0254},foot:{to:"meters",mult:.3048},feet:{to:"meters",mult:.3048},yard:{to:"meters",mult:.9144},yards:{to:"meters",mult:.9144},mile:{to:"meters",mult:1609.344},miles:{to:"meters",mult:1609.344},"g":{to:"grams",mult:1e-6},microgram:{to:"grams",mult:1e-6},micrograms:{to:"grams",mult:1e-6},mg:{to:"grams",mult:.001},milligram:{to:"grams",mult:.001},milligrams:{to:"grams",mult:.001},g:{to:"grams",mult:1},gram:{to:"grams",mult:1},grams:{to:"grams",mult:1},kg:{to:"grams",mult:1e3},kilogram:{to:"grams",mult:1e3},kilograms:{to:"grams",mult:1e3},tonne:{to:"grams",mult:1e6},tonnes:{to:"grams",mult:1e6},oz:{to:"grams",mult:28.349523125},ounce:{to:"grams",mult:28.349523125},ounces:{to:"grams",mult:28.349523125},lb:{to:"grams",mult:453.59237},pound:{to:"grams",mult:453.59237},pounds:{to:"grams",mult:453.59237},byte:{to:"bytes",mult:1},bytes:{to:"bytes",mult:1},kb:{to:"bytes",mult:1e3},kilobyte:{to:"bytes",mult:1e3},kilobytes:{to:"bytes",mult:1e3},mb:{to:"bytes",mult:1e6},megabyte:{to:"bytes",mult:1e6},megabytes:{to:"bytes",mult:1e6},gb:{to:"bytes",mult:1e9},gigabyte:{to:"bytes",mult:1e9},gigabytes:{to:"bytes",mult:1e9},tb:{to:"bytes",mult:1e12},terabyte:{to:"bytes",mult:1e12},terabytes:{to:"bytes",mult:1e12},pb:{to:"bytes",mult:1e15},petabyte:{to:"bytes",mult:1e15},petabytes:{to:"bytes",mult:1e15},"%":{to:"%",mult:1},percent:{to:"%",mult:1}},regex:{delimiter:/^(,\s|,|\s| and )$/gi,number:/LA(?<content>(?:(?<currency>CURRENCY)\s?)?(?<sign>>|~|\+||-|\+-|-\+)?(?<value>(?<integer>\d+(?:(?: \d\d\d)*|(?:,\d\d\d)*|(?:\.\d\d\d)*))(?<decimal>[,.]\d+)?(?<multiplier>(k|m|b|t| ?thousands?| ?millions?| ?billions?| ?trillions?)(?!\w))?\+?)(?:[ -]?(?<metric>METRIC|CURRENCY))?)LB/gim,time:/LA(?<content>((?<hours>\d?\d):)?(?<minutes>\d?\d):(?<seconds>\d\d)(?:.(?<ms>\d?\d?\d))?\s*(?<ampm>am|pm|a\.m\.|p\.m\.)?)LB/gim,duration:/LA(?<content>(?:(?<hours>\d+):)?(?<minutes>\d?\d):(?<seconds>\d\d)(?:.(?<ms>\d?\d?\d))?)LB/gim,copyright:/LA(?<content>(?:|\(c\))\s(?<year>(\d\d)?\d\d))LB/gim,date_triplex:/LA(?<content>(?<date>\d?\d)(?<sep1>[/.])(?<month>\d?\d)((?<sep2>[/.])(?<year>(\d?\d?\d\d)))?)LB/gim,date_dmy:/LA(?<content>(?<date>\d?\d)(?:st|nd|rd|th)?(?:[ -]| of )(?<month>MONTH)((, |,| |-)(?<year>\d?\d?\d\d)?)?)LB/gim,date_mdy:/LA(?<content>(?<month>MONTH)(?: |-| the )(?<date>\d?\d)(?:st|nd|rd|th)?((?:, |,| |-)(?<year>\d?\d?\d\d)?)?)LB/gim,date_my:/LA(?<content>(?<month>MONTH)((?:, |,| |-| of )(?<year>\d?\d?\d\d)))LB/gim,currency:/LA(?<content>CURRENCY)LB/gim}},init(){this._initialized||(this._initialized=!0,this._cache=new Map,this._maskCache=[],this._ensureReplaceAllPolyfill(),this._enrichConfigWithMonths(),this._enrichConfigWithCurrencies(),this._enrichRegexes("LA",/(?<=^|\s|\w-|\w\/|"|'|\()/),this._enrichRegexes("LB",/(?=\/\w||-\w|\s|\W\s|\W$|\)|$)/),this._parseNumber=this._createRegexParser(this._parseNumber,this.config.regex.number),this._parseTime=this._createRegexParser(this._parseTime,this.config.regex.time),this._parseDuration=this._createRegexParser(this._parseDuration,this.config.regex.duration),this._parseCopyright=this._createRegexParser(this._parseCopyright,this.config.regex.copyright),this._parseDate=this._createRegexParser(this._parseDate,this.config.regex.date_triplex),this._parseCurrency=this._createRegexParser(this._parseCurrency,this.config.regex.currency))},_ensureReplaceAllPolyfill(){String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)})},_enrichConfigWithMonths(){let e=["en"];if(globalThis.navigator){const t=navigator.languages;t&&e.push(...t)}if(globalThis.document?.documentElement){const t=document.documentElement.getAttribute("lang");t&&e.push(t)}let t=[];e=Array.from(new Set(e)),e.forEach((e=>{try{[...this._getMonthList(e,"short"),...this._getMonthList(e,"long")].forEach(((e,n)=>{e=e.toLowerCase(),void 0===this.config.monthsMap[e]&&(this.config.monthsMap[e]=n%12,t.push(e))}))}catch{}})),t=t.join("|"),this._enrichRegexes("MONTH",t)},_enrichConfigWithCurrencies(){let e=["$","USD","kr"],t="all,lvl,try,top,bob,pen,php,af,fc,fr,bs,km,rm,qr,tl,ft,jd,k,r,p,l,q";t=new Set(t.split(",")),this.config.currenciesMap={$:"USD",USD:"USD",kr:"SEK"};const n=(n,a)=>{this.config.currenciesMap[n]||t.has(n)||(this.config.currenciesMap[n]=a,e.push(n))};this.config.currencies.forEach((e=>{n(e.code.toLowerCase(),e.code),n(e.name.toLowerCase(),e.code),n(e.namePlural.toLowerCase(),e.code),n(e.symbol.toLowerCase(),e.code),n(e.symbolNative.toLowerCase(),e.code),(e.alt||[]).forEach((t=>n(t.toLowerCase(),e.code)))})),e=e.map((e=>e.replace("$","\\$").replace(".","\\."))).join("|"),this._enrichRegexes("CURRENCY",e);const a=Object.keys(this.config.metricsMap).join("|");this._enrichRegexes("METRIC",a)},_enrichRegexes(e,t){"[object regexp]"===Object.prototype.toString.call(t).toLowerCase()&&(t=t.source),Object.keys(this.config.regex).forEach((n=>{this.config.regex[n].source.includes(e)&&(this.config.regex[n]=new RegExp(this.config.regex[n].source.replaceAll(e,t),this.config.regex[n].flags))}))},_getMonthList:(e="en",t="long")=>"auto"===e?[]:Array.from(Array(12).keys(),(n=>Intl.DateTimeFormat(e,{month:{s:"short",n:"numeric"}[t[0]]||"long"}).format(new Date(0,n)))),_createRegexParser(e,t){const n=t;return function({value:t,items:a},o,r=!1){const i=Array.from(t.matchAll(o||n)).filter((e=>e.groups));return 0===i.length?arguments[0]:(i.forEach((n=>{let o=e(n,this.config);o&&(o=Array.isArray(o)?o:[o],0!==o.length&&(o.forEach((e=>{e.hasOwnProperty("content")||(e.content=n.groups.content),e.hasOwnProperty("index")||(e.index=n.index)})),a=[...a,...o],r&&(t=this._replaceMatch(t,n))))})),{value:t,items:a})}},_replaceMatch(e,t,n="#"){const a=t.groups.content,o=t.index+t.input.substr(t.index).indexOf(a),r=e.slice(0,o),i=e.slice(o+a.length);return r+n.repeat(a.length)+i},_parseTime(e,t){let n=Number(e.groups.hours),a=Number(e.groups.minutes),o=Number(e.groups.seconds);const r=e.groups.ms?1e3*Number("0."+e.groups.ms):0;Number.isNaN(n)&&(n=a,a=o,o=0);const i=(e.groups.ampm||"").toLowerCase().replaceAll(/\./g,"").trim();return i&&n>12?null:("am"===i?12===n&&(n=0):"pm"===i&&n<12&&(n+=12),{type:"time",value:r*t.time.millisecond+o*t.time.second+a*t.time.minute+n*t.time.hour,content:e.groups.content,index:e.index})},_parseDuration(e,t){const n=Number(e.groups.hours)||0,a=Number(e.groups.minutes)||0,o=Number(e.groups.seconds)||0;return{type:"number",value:(e.groups.ms?1e3*Number("0."+e.groups.ms):0)*t.time.millisecond+o*t.time.second+a*t.time.minute+n*t.time.hour,metric:"ms"}},_parseCopyright(e){const t=Number(e.groups.year);return Number.isNaN(t)?null:{type:"copyright",value:t}},_parseDate(e,t){if(e.groups.sep1&&e.groups.sep2&&e.groups.sep1!==e.groups.sep2)return null;let n=e.groups.date?Number(e.groups.date):1,a=e.groups.month;if(e.groups.sep1)"/"===e.groups.sep1&&([a,n]=[n,a]),a>12&&([a,n]=[n,a]),a-=1;else if(a=t.monthsMap[e.groups.month.toLowerCase()],void 0===a)return null;if(Number.isNaN(n)||n<1||n>31)return null;if(Number.isNaN(a)||a<0||a>11)return null;let o=Number(e.groups.year||(new Date).getFullYear());if(o<100){const e=(new Date).getFullYear();o=Number(e.toString().substr(0,2)+o),o>e&&(o-=100)}const r=new Date(Date.UTC(o,a,n));return{type:"date",value:r.getTime(),date:r}},_parseNumber(e,t){let{integer:n,decimal:a,sign:o,multiplier:r,currency:i,metric:s}=e.groups;i=i&&i.toLowerCase(),s=s&&s.toLowerCase(),a=a||"";const l={type:"number"},c=[l];if(4===a.length&&n.length<4&&(n+=a,a=""),!a.startsWith(",")||4!==a.length||n.includes(".")||n.includes(" ")||(n+=a,a=""),n=n.replaceAll(/[ ,.]/g,""),a=a.replaceAll(/[ ,.]/g,"."),l.value=Number(n+a),"-"===o&&(l.value*=-1),r=r?r.toLowerCase():r||"","k"===r||r.includes("thousand")?l.value*=1e3:"m"===r||r.includes("million")?l.value*=1e6:"b"===r||r.includes("billion")?l.value*=1e9:("t"===r||r.includes("trillion"))&&(l.value*=1e12),l.value=parseFloat(l.value.toFixed(6)),(i||s)&&(l.metric=i||s),"m"===r&&!s&&l.value%1e6==0){const e={...l};e.value/=1e6,e.metric="minutes",c.push(e);const t={...l};t.value/=1e6,t.metric="meters",c.push(t)}return c.filter((e=>e.metric)).forEach((e=>{const n=e.metric;t.currenciesMap[n]?(e.type="price",e.sourceMetric=n,e.metric="CUR:"+t.currenciesMap[n]):(e.sourceMetric=n,e.metric=t.metricsMap[n].to,e.value=e.value*t.metricsMap[n].mult)})),c},_mergeNumbers(e){if(e.items.length<2)return e;let t=!1;const n={};return e.items.forEach(((e,a)=>{e.metric&&"number"!==!e.type&&(n[e.metric]=n[e.metric]||[],n[e.metric].push({item:e,index:a}),n[e.metric].length>1&&(t=!0))})),t?(Object.values(n).forEach((t=>{let n=[];const a=()=>{if(n.length<2)n=[];else for(let t=1;t<n.length;t++){const a=n[t],o=n[t-1];e.items[n[0].index].value+=a.item.value,e.items[n[0].index].content=e.items[n[0].index].content+e.value.substring(o.item.index+o.item.content.length,a.item.index)+a.item.content,e.items[a.index]=null}};n.push(t[0]);for(let o=1;o<t.length;o++){const r=t[o-1],i=t[o];r.item.sourceMetric!==i.item.sourceMetric&&this.config.metricsMap[r.item.sourceMetric]?.mult>this.config.metricsMap[i.item.sourceMetric]?.mult&&e.value.substring(r.item.index+r.item.content.length,i.item.index).match(this.config.regex.delimiter)?n.push(i):(a(),n.push(i))}a()})),e.items=e.items.filter((e=>Boolean(e))),e):e},_cleanSourceMetrics:e=>(e.items.forEach((e=>{e.sourceMetric&&delete e.sourceMetric})),e),_parseCurrency(e,t){const{content:n}=e.groups;return{type:"currency",value:"CUR:"+t.currenciesMap[n.toLowerCase()]}},_maskItemsInValue(e,t=null){let n=e.value,a=e.items;if(t&&(a=a.filter((e=>e.type===t))),0===a.length)return n.trim();a.forEach((e=>{const t=n.substr(0,e.index),a=n.substr(e.index+e.content.length);let o=this._maskCache[e.content.length];o||(o="".repeat(e.content.length),this._maskCache[e.content.length]=o),n=t+o+a})),e.value=n},_replaceMask:(e,t="{{data}}")=>e.replace(/+/gi,t).trim()}})(),(()=>{const{$engine:e}=n;e.noIdleCommands=["idle","wait","reload"]})(),(()=>{const{$engine:e}=n;e.BrowserContext=class{constructor(e,t="default"){if(!e)throw new Error("browser argument is mandatory");this._browser=e,this._profile=t,this._pages=[],this._isClosed=!1}get isClosed(){return this._isClosed}get browser(){return this._browser}get profile(){return this._profile}get pages(){return this._pages}async newPage(t,n={}){this._throwIfClosed(),t&&"string"!=typeof t&&(n=t,t=null);const a=new e.Page(this,n);return this._pages.push(a),a.on("pageClosed",(e=>{this.emit("pageClosed",e)})),this[`p${this._pages.length}`]=a,this.emit("pageCreated",a),t&&await a.goto(t,n),a}async close(){if(this._isClosed)return;this._isClosed=!0;const e=[...this._pages];this._pages=[];for(let t=1;t<=e.length;t++)delete this[`p${t}`];await Promise.all(e.map((e=>e.close()))),this.emit("contextClosed",this)}_throwIfClosed(){if(this._isClosed)throw new Error("browser context is closed")}}})(),(()=>{const{$engine:e}=n;e.Browser=class t{static ENGINE_NAME="engine-0.1.0";constructor(){this._contexts=[],this._pages=[],this._isClosed=!1,e.mixinEventEmitter([e.Browser,e.BrowserContext,e.Page]),e.mixinClassShortcuts([e.Browser,e.BrowserContext,e.Page])}get isClosed(){return this._isClosed}get version(){const t=e.Browser.ENGINE_NAME.split("-");if(2!==t.length)throw new Error("wrong browser version format, must be name-version");return t[1]}get contexts(){return this._contexts}get pages(){return this._pages}async spawnContext(n){let a;if(this._throwIfClosed(),"default"!==(n=n||"default"))throw"incognito"===n?new Error("incognito context is not supported by "+t.ENGINE_NAME):new Error("persistent context is not supported by "+t.ENGINE_NAME);return a=new e.BrowserContext(this,n),this._contexts.push(a),a.on("pageCreated",(e=>{this._pages.push(e),this[`p${this._pages.length}`]=e,this.emit("pageCreated",e)})),a.on("pageClosed",(e=>{this.emit("pageClosed",e)})),a.on("contextClosed",(e=>{this.emit("contextClosed",e)})),this[`c${this._contexts.length}`]=a,this.emit("contextCreated",a),a}async newPage(e,t={}){this._throwIfClosed(),e&&"string"!=typeof e&&(t=e,e=null);const n=t.profile||"default";let a=this._contexts.find((e=>e.profile===n));return a||(a=await this.spawnContext(n)),a.newPage(e,t)}async close(){if(this._isClosed)return;this._isClosed=!0;const e=[...this._contexts];this._contexts=[];const t=[...this._pages];this._pages=[];for(let e=1;e<=t.length;e++)delete this[`p${e}`];for(let t=1;t<=e.length;t++)delete this[`c${t}`];await Promise.all(e.map((e=>e.close()))),this.emit("browserClosed",this)}_throwIfClosed(){if(this._isClosed)throw new Error("browser is closed")}}})(),(()=>{const{$engine:e}=n;e.Element=class{constructor(e,t,n){if(null==e)throw new Error("element id is required");if(this._id=e,void 0!==t&&(this._data=t),!n)throw new Error("element page is required");this._page=n}get id(){return this._id}get data(){return this._data}get page(){return this._page}async wait(e){return this._page.wait(this,e)}async content(e={}){return this._page.content(this,e)}async evaluate(e,t,n){return t=[this,...t],this._page.evaluate(e,t,n)}async parse(e){return this._page.parse(this,e)}async inspect(e){return this._page.inspect(this,e)}async scroll(e){return this._page.scroll(this,e)}async move(e){return this._page.move(this,e)}async click(e){return this._page.click(this,e)}async hover(e){return this._page.hover(this,e)}async unhover(e){return this._page.unhover(this,e)}async upload(e){return this._page.upload(this,e)}async select(e){return this._page.select(this,e)}async unselect(e){return this._page.unselect(this,e)}async clear(e){return this._page.clear(this,e)}serialize(){return{__$ht:"element",id:this._id}}static deserialize(t,n){if("element"===t?.__$ht)return new e.Element(t.id,e.serializer.deserialize(t.data,n),n)}}})(),(()=>{const{$engine:e}=n;e.Frame=class{constructor(e){this._page=e}async inject({collapsed:e=!1,onInjection:t=(()=>{})}={}){await this._page.controller.sendRequest("frame.inject",[e],{noIdle:!0})&&await t()}}})(),(()=>{const{$engine:e,$utils:t}=n;e.DATA_ITEM_TYPES=new Set(["text","link","image","icon","video","number","price","time","date","copyright"]),e.SELECTOR_TYPES=["role","placeholder","text","content","displayValue","altText","title","testId","id","tag","class","attribute","src","style","css","xpath"],e.Locator=class n{constructor(e,t){this._selector=this._declarationToObject(e||[]),t&&(this._page=t)}_declarationToObject(a,{inFind:o}={}){if(!a)throw new Error("selected must not be empty or nullish");if(a instanceof n)return a.selector;if(Array.isArray(a))return a.map((e=>this._declarationToObject(e,{inFind:!0})));const r=typeof a;if(["number","boolean"].includes(r))throw new Error(`selected must be array, string or object, got ${r}`);if("string"===r&&!a.includes(": "))return a;if("string"===r){let[t,...n]=a.split(": ");return t=t.startsWith("$")?t.substr(1):t,e.SELECTOR_TYPES.includes(t)?{[`$${t}`]:n.join(": ")}:{$text:a}}if("object"!==r)throw new Error(`unsupported selector type ${r}`);const i=Object.keys(a);if(0===i.length)return a;let s=0;if(e.SELECTOR_TYPES.forEach((e=>{if(e=`$${e}`,a.hasOwnProperty(e)){if(!["number","string","boolean"].includes(typeof a[e]))throw new Error(`${e} selector value must be a string`);s++}})),s>0){const e=new Set(i);if(e.delete("at"),e.delete("traverse"),e.delete("filter"),e.delete("size"),e.size!==s)throw new Error("extra parameters passed with selector");return a}if(a.hasOwnProperty("$find")){if(1!==i.length)throw new Error("extra parameters passed with $find command");const{$find:e}=a;if(!Array.isArray(e))throw new Error("$find command value must be an array");return e.map((e=>this._declarationToObject(e,{inFind:!0})))}if(a.hasOwnProperty("$matches")){let{$matches:e,type:n,min:o,max:r}=a;if(n=n||"most",!Array.isArray(e))throw new Error("$matches value must be an array");if(t.hasExtraKeys(a,["$matches","min","max","type"]))throw new Error("extra parameters passed with $matches command");if(!["most","any","all","none"].includes(n))throw new Error(`$matches type ${n} is not supported`);if(a.hasOwnProperty("min")){if(["all","none"].includes(n))throw new Error(`$matches type '${n}' does not support min`);if(!t.is.number(o))throw new Error("$matches min must be a number");if(o<0)throw new Error("$matches min must be positive");if(o>e.length)throw new Error("$matches min must be below matches size")}if(a.hasOwnProperty("max")){if(["all","none"].includes(n))throw new Error(`$matches type '${n}' does not support max`);if(!t.is.number(r))throw new Error("$matches min must be a number");if(r<=0)throw new Error("$matches max must be greater than zero");if(r>e.length)throw new Error("$matches max must be below matches size")}if(o&&r&&o>r)throw new Error("$matches max parameter is less than min parameter");return e=e.map((e=>this._declarationToObject(e,{inMatch:!0}))),t.removeKeys({$matches:e,type:n,min:o,max:r})}if(a.hasOwnProperty("$filter")){if(!o)throw new Error("$filter is only supported inside $find or array");if(1!==i.length)throw new Error("extra parameters passed with $filter command");const{$filter:e}=a,t=["roots","branches","leaves","connected","visible","clickable","fixed"];if(!t.includes(e))throw new Error(`$filter must be one of: ${t.join(", ")}`);return a}if(a.hasOwnProperty("$at")){if(!o)throw new Error("$at is only supported inside $find or array");if(1!==i.length)throw new Error("extra parameters passed with $at command");const{$at:e}=a;if(t.is.number(e)){if(e<0)throw new Error("$at must be positive")}else{if(!["first","last"].includes(e))throw new Error("$at must be one of: first, last, [number]")}return{$at:e}}if(a.hasOwnProperty("$first")){if(1!==i.length)throw new Error("extra parameters passed with $first selector");const{$first:e}=a;return[...t.ensureArray(e).map((e=>this._declarationToObject(e,{inFind:!0}))),{$at:"first"}]}if(a.hasOwnProperty("$last")){if(1!==i.length)throw new Error("extra parameters passed with $last selector");const{$last:e}=a;return[...t.ensureArray(e).map((e=>this._declarationToObject(e,{inFind:!0}))),{$at:"last"}]}if(a.hasOwnProperty("$traverse")){if(!o)throw new Error("$traverse is only supported inside $find or array");if(1!==i.length)throw new Error("extra parameters passed with $traverse command");const{$traverse:e}=a;if(!t.is.string(e)&&!t.is.array(e))throw new Error("$traverse must be one of: string or array");return a}if(a.hasOwnProperty("$anchor")){const e=["$anchor","shift","at"];if(t.hasExtraKeys(a,e))throw new Error("extra parameters passed with $anchor command");const n={$anchor:this._declarationToObject(a.$anchor,{inFind:!0})};let{shift:o,at:r}=a;if(void 0!==o){const e=t.is.string(o)?o.split(":"):o;if(!t.is.array(e)||2!==e.length)throw new Error('$near.shift must be "dx:dy" or [dx, dy] array');n.shift=o}return void 0!==r&&(n.at=Number(r)||0),t.removeKeys(n)}if(a.hasOwnProperty("$parse")){if(!o)throw new Error("$parse is only supported inside $find or array");const e=["$parse","at"];if(t.hasExtraKeys(a,e))throw new Error("extra parameters passed with $parse command");const{$parse:n,at:r}=a;if(!t.is.string(n))throw new Error("$parse value must be a string");if(void 0!==r){if(!t.is.number(r))throw new Error("$parse at parameter must be a number");if(r<0)throw new Error("$parse at parameter must be greater than zero")}return a}if(a.hasOwnProperty("$and")){if(1!==i.length)throw new Error("extra parameters passed with $and selector");return{$matches:t.ensureArray(a.$and).map((e=>this._declarationToObject(e,{inMatch:!0}))),type:"all"}}if(a.hasOwnProperty("$or")){if(1!==i.length)throw new Error("extra parameters passed with $or selector");return{$matches:t.ensureArray(a.$or).map((e=>this._declarationToObject(e,{inMatch:!0}))),type:"any"}}if(a.hasOwnProperty("$not")){if(1!==i.length)throw new Error("extra parameters passed with $not selector");return{$matches:t.ensureArray(a.$not).map((e=>this._declarationToObject(e,{inMatch:!0}))),type:"none"}}if(a.hasOwnProperty("$most")){if(1!==i.length)throw new Error("extra parameters passed with $most selector");return{$matches:t.ensureArray(a.$most).map((e=>this._declarationToObject(e,{inMatch:!0}))),type:"most"}}if(a.hasOwnProperty("$children")){if(1!==i.length)throw new Error("extra parameters passed with $children command");return[...t.ensureArray(a.$children).map((e=>this._declarationToObject(e,{inFind:!0}))),{$traverse:"children"}]}if(a.hasOwnProperty("$parent")){if(1!==i.length)throw new Error("extra parameters passed with $parent command");return[...t.ensureArray(a.$parent).map((e=>this._declarationToObject(e,{inFind:!0}))),{$traverse:"parent"}]}if(a.hasOwnProperty("$descendants")){if(1!==i.length)throw new Error("extra parameters passed with $descendants command");return[...t.ensureArray(a.$descendants).map((e=>this._declarationToObject(e,{inFind:!0}))),{$traverse:"descendants"}]}if(a.hasOwnProperty("$ancestors")){if(1!==i.length)throw new Error("extra parameters passed with $ancestors command");return[...t.ensureArray(a.$ancestors).map((e=>this._declarationToObject(e,{inFind:!0}))),{$traverse:"ancestors"}]}if(a.hasOwnProperty("$size")){if(t.is.array(a.$size)){if(0===a.$size.length)throw new Error("$size array must have at least 1 value");if(a.$size.length>2)throw new Error("$size array must have at max 2 values");if(void 0!==(a={min:a.$size[0],max:a.$size[1]}).min&&"_"!==a.min||delete a.min,void 0!==a.max&&"_"!==a.max||delete a.max,!a.hasOwnProperty("min")&&!a.hasOwnProperty("max"))throw new Error("$size must have at least min or max parameter")}else a=t.is.number(a.$size)?{min:a.$size,max:a.$size}:a.$size;const e=["$size","min","max","throws"];if(t.hasExtraKeys(a,e))throw new Error("extra parameters passed with $size command");if(a.min&&!t.is.number(a.min))throw new Error("$size min parameter must be a number");if(a.min&&a.min<0)throw new Error("$size min parameter must be greater than zero");if(a.max&&!t.is.number(a.max))throw new Error("$size max parameter must be a number");if(a.max&&a.max<0)throw new Error("$size max parameter must be greater than zero");if(void 0!==a.throws&&!t.is.boolean(a.throws))throw new Error("$size throws parameter must be a boolean");return a.min===a.max&&[!0,void 0].includes(a.throws)&&(a=a.min),{$size:a}}throw 1===i.length?new Error(`unsupported selector type / operation: ${i[0]}`):new Error(`unsupported selector type / operation: ${i.join(", ")}`)}get selector(){return this._selector}get isEmpty(){return!this._selector||0===Object.keys(this._selector).length}get page(){return this._page}set page(e){this._page=e}setPage(e){return this.page=e,this}async query(e){return this._throwIfNoPage(),this._page.query(this,e)}async queryAll(e){return this._throwIfNoPage(),this._page.queryAll(this,e)}async wait(e){return this._throwIfNoPage(),this._page.wait(this,e)}async content(e={}){return this._throwIfNoPage(),this._page.content(this,e)}async evaluate(e,t,n){return this._throwIfNoPage(),t=[this,...t],this._page.evaluate(e,t,n)}async parse(e){return this._throwIfNoPage(),this._page.parse(this,e)}async inspect(e){return this._throwIfNoPage(),this._page.inspect(this,e)}async scroll(e){return this._throwIfNoPage(),this._page.scroll(this,e)}async move(e){return this._throwIfNoPage(),this._page.move(this,e)}async click(e){return this._throwIfNoPage(),this._page.click(this,e)}async hover(e){return this._throwIfNoPage(),this._page.hover(this,e)}async unhover(e){return this._throwIfNoPage(),this._page.unhover(this,e)}async upload(e){return this._throwIfNoPage(),this._page.upload(this,e)}async select(e){return this._throwIfNoPage(),this._page.select(this,e)}async unselect(e){return this._throwIfNoPage(),this._page.unselect(this,e)}async clear(e){return this._throwIfNoPage(),this._page.clear(this,e)}serialize(){return{__$ht:"locator",selector:this._selector}}static deserialize(t,n){if("locator"===t?.__$ht)return new e.Locator(t.selector,n)}_throwIfNoPage(){if(!this._page)throw new Error("locator instance is not attached to any page, supply page into Locator constructor or using locator.page setter")}static of(t,a){return t instanceof e.Page&&(a=t,t=null),new n(t,a)}static ofAnchor(t,n,a){return e.Locator.of({...n,$anchor:t},a)}static ofAll(t){return e.Locator.ofCss("*",t)}static ofRole(t,n){return e.Locator.of({$role:t},n)}static ofPlaceholder(t,n){return e.Locator.of({$placeholder:t},n)}static ofText(t,n){return e.Locator.of({$text:t},n)}static ofContent(t,n){return e.Locator.of({$content:t},n)}static ofDisplayValue(t,n){return e.Locator.of({$displayValue:t},n)}static ofAltText(t,n){return e.Locator.of({$altText:t},n)}static ofTitle(t,n){return e.Locator.of({$title:t},n)}static ofTestId(t,n){return e.Locator.of({$testId:t},n)}static ofId(t,n){return e.Locator.of({$id:t},n)}static ofTag(t,n){return e.Locator.of({$tag:t},n)}static ofClass(t,n){return e.Locator.of({$class:t},n)}static ofAttribute(t,n,a){const o=!0===n||void 0===n?t:`${t}=${n}`;return e.Locator.of({$attribute:o},a)}static ofStyle(t,n,a){const o=void 0===n?t:`${t}=${n}`;return e.Locator.of({$style:o},a)}static ofSrc(t,n){return e.Locator.of({$src:t},n)}static ofCss(t,n){return e.Locator.of({$css:t},n)}static ofXpath(t,n){return e.Locator.of({$xpath:t},n)}static matchesAll(n,a,o){return e.Locator.of({...a,$matches:t.ensureArray(n),type:"all"},o)}static matchesAny(n,a,o){return e.Locator.of({...a,$matches:t.ensureArray(n),type:"any"},o)}static matchesMost(n,a,o){return e.Locator.of({...a,$matches:t.ensureArray(n),type:"most"},o)}static matchesNone(n,a,o){return e.Locator.of({...a,$matches:t.ensureArray(n),type:"none"},o)}}})(),(()=>{const{$engine:e,$utils:t}=n;e.Page=class{static instances=[];static get instance(){return this.instances.at(-1)}constructor(t,n={}){if(!t)throw new Error("context argument is mandatory");this._controller=new e.PageController(this,t,n),this._timer=new e.Timer(this),this._trapper=new e.Trapper(this),this._screenshotter=new e.Screenshotter(this),this._frame=new e.Frame(this),this._context=t,this._isClosed=!1,e.Page.instances.push(this)}get controller(){return this._controller}get frame(){return this._frame}get isClosed(){return this._isClosed}get context(){return this._context}get trapper(){return this._trapper}get screenshotter(){return this._screenshotter}get isConnected(){return this._controller.isConnected}get mediumType(){return this._controller._medium.type}get mediumId(){return this._controller._medium.id}async goto(e=null,t={}){return this._timer.cleanup(),this._controller.goto(e,t)}async navigate(e=null,t={}){return this.goto(e,t)}async reload(e={}){return this._controller.sendRequest("reload",null,e)}async url(e={}){return this._controller.sendRequest("url",null,e)}async favicons(e={}){return this._controller.sendRequest("favicons",[],e)}async content(t,n={}){"string"==typeof t?t=e.Locator.of(t):t instanceof e.Element||t instanceof e.Locator||(n=t||{},t=null);const a=await this._controller.sendRequest("content",[t],n);return n.textExtractRule?e.TextExtractRule.extract(a,n.textExtractRule):a}async idle(e={}){return this._controller.sendRequest("idle",null,e)}async fetch(e,t,n={}){return this._controller.sendRequest("fetch",[e,t],n)}async query(t,n={}){return"string"==typeof t?t=e.Locator.of(t):t instanceof e.Locator||t instanceof e.Element||(t=e.Locator.of(t)),this._controller.sendRequest("query",[t],n)}async queryAll(e,t={}){return(t={m:!0,...t}).multiple&&delete t.multiple,t.mult&&delete t.mult,this.query(e,t)}async parse(t,n={}){return"string"==typeof t?t=e.Locator.of(t):t instanceof e.Element||t instanceof e.Locator||(n=t||{},t=null),this._controller.sendRequest("parse",[t],n)}async inspect(t,n={}){if("string"==typeof t)t=e.Locator.of(t);else if(!(t instanceof e.Element||t instanceof e.Locator))throw new Error("loe must either be a locator, element or string");return this._controller.sendRequest("inspect",[t],n)}async click(e,t,n={}){return this._controller.sendRequest("click",[e,t],n)}async scroll(e,t={}){return this._controller.sendRequest("scroll",[e],t)}async evaluate(e,n,a={}){if(!e)throw new Error("pageFunction must be specified");if("function"!=typeof e)throw new Error("pageFunction must be a function");return t.is.nil(n)?n=[]:Array.isArray(n)||(n=[n]),this._controller.sendRequest("evaluate",[e.toString(),n],a)}async paste(e,t={}){return this._controller.sendRequest("paste",[e],t)}async wait(n,a={}){if("number"==typeof n){const e=Date.now();return new Promise((t=>setTimeout((()=>t({durationMs:Date.now()-e})),n)))}if(t.is.nil(n))throw new Error("wait expects a condition argument");if("string"!=typeof n&&"function"!=typeof n&&!(n instanceof e.Locator))throw new Error("wait condition argument type is unsupported");return"function"==typeof n&&(n={__$ht:"function",body:n.toString()}),this._controller.sendRequest("wait",[n],a)}async title(e={}){return await this._controller.sendRequest("title",[],e)}async selection(e={}){return await this._controller.sendRequest("selection",[],e)}async description(e={}){return await this._controller.sendRequest("description",[],e)}async close(){this._isClosed||(this._isClosed=!0,this._timer.cleanup(),await this._controller.cleanup(),e.Page.instances=e.Page.instances.filter((e=>e!==this)),this.emit("pageClosed",this))}_throwIfClosed(){if(this._isClosed)throw new Error("page is closed")}}})(),(()=>{const{$engine:e,$utils:t,$env:a,$offscreen:o}=n;e.Screenshotter=class{constructor(e){this._controller=e._controller,e.on("screenshotter.fetch",this._onFetch.bind(this)),e.on("screenshotter.svgToImage",this._svgToImage.bind(this))}async capture({fullPage:e=!0}={}){const t=await this._controller.sendRequest("screenshotter.capture",[{fullPage:e}],{noIdle:!0});try{const e=await(await fetch(t)).blob();return 2===a.manifestVersion&&URL.revokeObjectURL(t),e}catch{return null}}async _onFetch({id:e,url:t,method:n}){let a=null;if("about:blank"!==t)try{const e=await fetch(t);a=await e[n](),"blob"===n&&(a=await new Promise(((e,t)=>{const n=new FileReader;n.onerror=t,n.onload=()=>e(n.result),n.readAsDataURL(a)})))}catch{}await this._controller.sendRequest("screenshotter.onFetchResponse",[{id:e,data:a}],{noIdle:!0})}async _svgToImage({svgCode:e,width:n,height:r,dpr:i,quality:s}){if(3===a.manifestVersion){const t=await o.controller.send("svgToImage",{svgCode:e,width:n,height:r,dpr:i,quality:s});return void await this._controller.sendRequest("screenshotter.onSvgToImageResponse",[t],{noIdle:!0})}const l=new Blob([e],{type:"image/svg+xml"}),c=await new Promise(((e,t)=>{const n=new FileReader;n.onerror=t,n.onload=()=>e(n.result),n.readAsDataURL(l)})),u=document.createElement("img");await new Promise(((e,t)=>{u.src=c,u.onload=e,u.onerror=()=>t("failed to load svg data url")}));const d=document.createElement("canvas"),p=d.getContext("2d");d.width=n*i,d.height=r*i,p.fillStyle="#fff",p.fillRect(0,0,d.width,d.height),p.drawImage(u,0,0,n,r,0,0,d.width,d.height);const h=await t.canvasToBlob(d,"image/webp",s),m=URL.createObjectURL(h);await this._controller.sendRequest("screenshotter.onSvgToImageResponse",[m],{noIdle:!0})}}})(),(()=>{const{$engine:e}=n;e.TextExtractRule=class{constructor({regex:e,group:t,prefix:n,suffix:a,inclusive:o}){if(e){if(n||a||o)throw new Error("can not combine prefix / suffix / inclusive with regex / group");this.regex=e,this.group=t}else{if(!n&&!a)throw new Error("either regex or prefix / suffix pair must be supplied");if(e||t)throw new Error("can not combine prefix / suffix / inclusive with regex / group");this.prefix=n,this.suffix=a,this.inclusive=o}}extract(t){return e.TextExtractRule.extract(t,this)}static extract(e,t){if(e&&"string"==typeof e&&t){if(!t.regex){const{prefix:n,suffix:a,inclusive:o}=t,r=[];let i=0;do{let t=n?e.indexOf(n,i):0;if(-1===t)break;n&&!o&&(t+=n?n.length:0);let s=a?e.indexOf(a,t):e.length;if(-1===s)break;a&&o&&(s+=a?a.length:0),r.push(e.substring(t,s)),i=s}while(-1!==i&&i!==e.length);return r}{const{regex:n,group:a}=t,o=(Array.isArray(n)?n:[n]).map((e=>e.global?e:RegExp(e.source,e.flags+"g")));for(let t=0;t<o.length;t++){let n=e.matchAll(o[t]);if(n)return n=Array.from(n),void 0===a?n:n.map((e=>{if("number"==typeof a)return e[a+1];if("string"==typeof a)return e.groups[a];throw new Error("if specified, extractRule.group must either be a number or a string")}))}}}}}})(),(()=>{const{$engine:e}=n;e.Timer=class{constructor(e){this._controller=e._controller,this._timeouts={},this._intervals={},e.on("timer.setTimeout",this._handleMessage.bind(this)),e.on("timer.clearTimeout",this._handleMessage.bind(this)),e.on("timer.setInterval",this._handleMessage.bind(this)),e.on("timer.clearInterval",this._handleMessage.bind(this))}cleanup(){Object.values(this._timeouts).forEach((e=>clearTimeout(e))),Object.values(this._intervals).forEach((e=>clearInterval(e))),this._timeouts={},this._intervals={}}async _handleMessage(e){const{id:t,time:n,type:a}=e;switch(a){case"timer.setTimeout":this._timeouts[t]=setTimeout((()=>this._onTimeout(t)),n);break;case"timer.clearTimeout":clearTimeout(this._timeouts[t]),delete this._timeouts[t];break;case"timer.setInterval":this._intervals[t]=setInterval((()=>this._onInterval(t)),n);break;case"timer.clearInterval":clearInterval(this._intervals[t]),delete this._intervals[t]}}_onTimeout(e){this._controller.isConnected&&this._sendOnTimer(e,"timeout")}_onInterval(e){this._controller.isConnected?this._sendOnTimer(e,"interval"):(clearInterval(this._intervals[e]),delete this._intervals[e])}_sendOnTimer(e,t){this._controller.sendRequest("timer.onTimer",[e,t],{noIdle:!0,noTimeout:!0,noReply:!0})}}})(),(()=>{const{$engine:e,$tab:t,$bus:a}=n;e.Trapper=class{constructor(e){this._page=e,this._page.on("trapper.targetLocked",this._onTargetLocked.bind(this))}async _onTargetLocked({text:e,element:n,rect:o,mouseX:r,mouseY:i}){const s=this._page.mediumId,l=t.proxy.of(s),c=l.creator.trapperGrabbing;if("context"===c||"command"===c){const t={type:"element",container:n,value:e||"Element"};return a.send("trapper.targetLocked",s,{text:e,item:t}),l.creator.trapperGrabbing=!1,void(l.creator.frameOpen=!0)}if("monitor"===c){const t=await this._page.parse({extract:!0,noIdle:!0}),a=50,s=[...t.reduce(((e,t)=>{if(a&&e.length>=a)return e;const n=t.cr.top>=o.top&&t.cr.left>=o.left&&t.cr.right<=o.right&&t.cr.bottom<=o.bottom,s=i>=t.cr.top&&r>=t.cr.left&&r<=t.cr.right&&i<=t.cr.bottom;return(n||s)&&(t.elements=t.elements.map((e=>e.serialize())),t.container=t.container.serialize(),e.push(t)),e}),[]),{type:"element",container:n,value:e||"Element"}];l.creator.trapperData=s,l.creator.screen="trapper",l.creator.frameOpen=!0}throw new Error(`Unknown trapper grabbing type: ${c}`)}}})(),(()=>{const{$engine:e,$env:t,$chrome:a,$critical:o}=n;e.controller={async init(){await e.hiddenWindowController.init(),await this.injectContentScripts()},async injectContentScripts(){let e=await a.tabs.query({});e=e.filter((e=>o.isAutomatable(e))),await Promise.all(e.map((async e=>{await this.isInjected(e)||this.injectTo(e)})))},async isInjected(e){try{const t={type:"request",command:"ping"};return"pong"===await a.tabs.sendMessage(e.id,t)}catch{return!1}},injectTo(e){const n="/cs.js";2===t.manifestVersion?a.tabs.executeScript(e.id,{file:n}).catch((()=>{})):3===t.manifestVersion&&chrome.scripting.executeScript({target:{tabId:e.id},files:[n]}).catch((()=>{}))}}})(),(()=>{const{$engine:e,$chrome:t,$settings:a,$idb:o}=n;e.hiddenWindowController={async init(){this._listenersAdded=!1,this._autoMinimize=!1,this._closeIfEmpty=!0,this._windowId=await o.read("$engine.hiddenWindowId",null)},get windowId(){return this._windowId},async ensureWindow(){return this._ensureWindowPromise||(this._ensureWindowPromise=new Promise((async e=>{const t=await this._ensureWindow();this._ensureWindowPromise=null,e(t)}))),this._ensureWindowPromise},async _ensureWindow(){if(await this._addWindowListeners(),this._windowId){if(await t.windows.get(this._windowId))return this._windowId}const e={url:"https://harpa.ai/automation"},n=(navigator.platform||"Win32").toLowerCase();n.startsWith("mac")?(e.focused=!1,e.state="minimized"):n.startsWith("win")?e.focused=!1:n.startsWith("linux")&&(e.focused=!1,e.state="minimized");const a=await t.windows.create(e);return this._windowId=a.id,await o.write("$engine.hiddenWindowId",a.id),chrome.windows.update(a.id,{state:"minimized"}),chrome.tabs.update(a.tabs[0].id,{pinned:!0}),this._windowId},async _addWindowListeners(){this._listenersAdded||(this._listenersAdded=!0,chrome.windows.onFocusChanged.addListener((e=>{this._autoMinimize&&e===this._windowId&&t.windows.update(e,{state:"minimized"})})),chrome.tabs.onRemoved.addListener(((e,n)=>{n.isWindowClosing||n.windowId===this._windowId&&a.proxy.autoCloseHiddenWindow&&setTimeout((async()=>{const e=await t.windows.get(this._windowId);if(!e||e.focused)return;if(!((await t.tabs.query({windowId:this._windowId})).filter((e=>!e.pinned)).length>0)&&this._closeIfEmpty)try{await t.windows.remove(this._windowId)}catch{}}),500)})))}}})(),(()=>{const{$engine:e}=n,t=globalThis.__elPreload?.ipcRenderer;e.ipcController={setupListeners(){e.PageController.IPC_MESSAGE_LISTENERS||(e.PageController.IPC_MESSAGE_LISTENERS={},t.on("engine.mediumMessage",((t,n)=>{const a=e.PageController.IPC_MESSAGE_LISTENERS[n.frameName];a&&a(t,n)})))},addListener(t,n){e.PageController.IPC_MESSAGE_LISTENERS&&(e.PageController.IPC_MESSAGE_LISTENERS[t]=(e,t)=>n({data:t}))},dropListener(t){e.PageController.IPC_MESSAGE_LISTENERS&&delete e.PageController.IPC_MESSAGE_LISTENERS[t]},send:(e,...n)=>t.send(e,...n)}})(),(()=>{const{$engine:e,$utils:t,$chrome:a,$logger:o,$netRules:r}=n;e.MediumTab=class{constructor(e,n,a,o){if(n&&!["tab","pinned-tab","hidden-tab"].includes(n))throw new Error(`medium type ${n} is not supported`);this._id=e,this._type=n,this._handleMessage=a,this._pageOptions=o,this._autoCloseTab=t.is.boolean(o.autoCloseTab)?o.autoCloseTab:!this._id,this._isConnected=!1,this._setupPromise=null,this._onTabRemoved=null}get id(){return this._id}get type(){return this._type}get frameName(){return`${e.Browser.ENGINE_NAME}:${this._id}`}get config(){const t={...this._pageOptions,engineName:e.Browser.ENGINE_NAME,frameName:this.frameName};return delete t.autoCloseTab,t}get isConnected(){return this._isConnected}_setup(){this._setupPromise=t.createPromise(),e.mediumsController.registerMedium(this),this._messageListener||(this._messageListener=e=>this._onMessage({data:e}),chrome.runtime.onMessage.addListener(this._messageListener)),this._onTabRemoved||(this._onTabRemoved=e=>{this._id===e&&this.cleanup()},chrome.tabs.onRemoved.addListener(this._onTabRemoved))}async connect(){if(this.isConnected)return{status:"connected"};if(this._setupPromise)return this._setupPromise;this._setup();const t=e.hiddenWindowController.windowId;if(!(await a.tabs.query({})).filter((e=>!this.type||("hidden-tab"===this.type?e.windowId===t:e.windowId!==t))).some((e=>e.id===this._id)))return this._setupPromise.reject(new Error("tab not found")),this._setupPromise;const n="Could not establish connection. Receiving end does not exist.";try{if("pong"!==await a.tabs.sendMessage(this._id,{type:"request",command:"ping"}))throw new Error(n)}catch(e){e.message===n&&await a.tabs.reload(this._id)}chrome.tabs.sendMessage(this._id,{type:"request",command:"connect",config:this.config}),await this._setupPromise}async navigate(t){this._setup();const n="pinned-tab"===this._type,o=this._id?await a.tabs.query({}):[],r=e.hiddenWindowController.windowId;if(o.filter((e=>!this.type||("hidden-tab"===this.type?e.windowId===r:e.windowId!==r))).find((e=>e.id===this._id)))return await a.tabs.update(this._id,{url:this._wrapIntoHostUrl(t),pinned:n,active:!1}),await this._patchTabRequests(this._id,t),this._setupPromise;if(["pinned-tab","tab"].includes(this._type)){const e=await a.tabs.create({url:this._wrapIntoHostUrl(t),pinned:n,active:!1});return this._id=e.id,await this._patchTabRequests(this._id,t),this._setupPromise}{const n=await e.hiddenWindowController.ensureWindow(),o=await a.tabs.create({url:this._wrapIntoHostUrl(t),windowId:n,active:!1});return this._id=o.id,await this._patchTabRequests(this._id,t),this._setupPromise}}_wrapIntoHostUrl(e){const t=btoa(JSON.stringify({...this.config,url:e}));return chrome.runtime.getURL(`/host.html?c=${t}`)}async _patchTabRequests(e,t){await r.register({key:`engine-medium-${e}`,condition:{urlFilter:"*://*/*",tabIds:[e]},action:{type:"modifyHeaders",responseHeaders:[{header:"x-frame-options",operation:"remove"},{header:"content-security-policy",operation:"remove"}]}});try{const e=new URL(t).origin;await a.browsingData.remove({origins:[e]},{serviceWorkers:!0})}catch(e){o.warn("[$engine] failed removing serviceWorker",e)}}_onMessage(e){const{data:t}=e;if(t?.frameName===this.frameName)return"connected"===t.type?this._onMessageConnected():this.isConnected?this._handleMessage(e):void 0}_onMessageConnected(){if(!this._setupPromise)return;this._isConnected=!0;const e=this._setupPromise;this._setupPromise=null,e.resolve({status:"connected"})}async sendRequest(e){return chrome.tabs.sendMessage(this._id,e)}async cleanup(){if(this._isConnected=!1,this._messageListener&&(chrome.runtime.onMessage.removeListener(this._messageListener),this._messageListener=null),this._onTabRemoved&&(chrome.tabs.onRemoved.removeListener(this._onTabRemoved),this._onTabRemoved=null),this._id&&this._autoCloseTab){const e=this._id;this._id=null,await t.chrome.tabs.remove(e)}e.mediumsController.unRegisterMedium(this),this._setupPromise&&(this._setupPromise.resolve({status:"page-closed"}),this._setupPromise=null)}}})(),(()=>{const{$engine:e}=n;e.mediumsController={instances:null,init(){this._handleShouldConnect=this._handleShouldConnect.bind(this)},registerMedium(e){this.instances||(this.instances=new Set,chrome.runtime.onMessage.addListener(this._handleShouldConnect)),this.instances.add(e)},unRegisterMedium(e){this.instances&&(this.instances.delete(e),0===this.instances.size&&(this.instances=null,chrome.runtime.onMessage.removeListener(this._handleShouldConnect)))},_handleShouldConnect(t,n,a){if("should-connect"!==t.type)return;if(t.engineName!==e.Browser.ENGINE_NAME)return;const o=n.tab?.id;if(!o)return;const r=Array.from(this.instances).find((e=>e.id===o));return r?(a(r.config),!0):void 0}},e.mediumsController.init()})(),(()=>{const{$engine:e,$utils:t}=n,a=new Set;e.mixinClassShortcuts=n=>{(n=t.ensureArray(n)).forEach((t=>{a.has(t)||(a.add(t),t.prototype.Locator=e.Locator,t.prototype.Element=e.Element)}))}})(),(()=>{const{$engine:e,$utils:t}=n,a=new Set;e.mixinEventEmitter=e=>{(e=t.ensureArray(e)).forEach((e=>{a.has(e)||(a.add(e),e.prototype.on=function(e,t){const n=this._eventListeners||(this._eventListeners={});return n[e]?n[e].push(t):n[e]=[t],this},e.prototype.off=function(e,t){if(!e)return this._eventListeners={},this;const n=this._eventListeners;return n&&n[e]?(n[e]=n[e].filter((e=>e!==t)),this):this},e.prototype.emit=function(e,...t){const n=this._eventListeners;return n&&n[e]?(n[e].forEach((e=>e(...t))),this):this})}))}})(),(()=>{const{$engine:e,$utils:t}=n;e.PageController=class n{static TOTAL_REQUESTS=0;static IPC_MESSAGE_LISTENERS=null;constructor(e,t,n={}){this._page=e,this._context=e,this._pageOptions={...n},delete this._pageOptions.mediumType,delete this._pageOptions.mediumId,this._medium=this._parseMedium(n),this._requests={}}_parseMedium(t){const n=this._pageOptions,a=(e,t)=>e?"number"==typeof e?`${e}px`:e:t,o=a(n.width,"100%"),r=a(n.height,"100%");return new e.MediumTab(t.mediumId||null,t.mediumType,this._handleMessage.bind(this),{...n,width:o,height:r})}get isConnected(){return this._medium.isConnected}async goto(e,n={}){if(!(e=this._normalizeUrl(e)))return await this.cleanup(),{status:"not-navigated"};delete(n={idle:0,timeout:n.noTimeout?0:3e4,...n}).noIdle,delete n.noTimeout;let a=t.createPromise(),o=!1,r=n.timeout>0&&setTimeout((()=>{o=!0;const e=new Error("timeout");n.noThrow?a.resolve(e):a.reject(e)}),n.timeout);return this._medium.navigate(e).then((e=>{clearTimeout(r),o?this._medium.cleanup():a.resolve(e)})).catch((e=>{clearTimeout(r),o?this._medium.cleanup():n.noThrow?a.resolve(e):a.reject(e)})),a}async sendRequest(a,o=null,r={}){try{await this._medium.connect()}catch(e){if(r.noThrow)return e;throw e}const i=String(n.TOTAL_REQUESTS++);o=o||[],delete(r={timeout:r.noTimeout?0:3e4,idle:e.noIdleCommands.includes(a)||r.noIdle?0:15e3,...r}).noTimeout,delete r.noIdle;const s=()=>this._medium.sendRequest({type:"request",frameName:this._medium.frameName,params:e.serializer.serialize(o),options:e.serializer.serialize(r),requestId:i,command:a});if(r.noReply)return s();const l=t.createPromise();let c=null;return r.timeout&&(c=setTimeout((()=>{const e=new Error("timeout");r.noThrow?l.resolve(e):l.reject(e)}),r.timeout)),this._requests[i]={command:a,params:o,options:r,onResponse:e=>{if(c&&clearTimeout(c),!e.error)return void l.resolve(e.result);const t="string"==typeof e.error?new Error(e.error):e.error;r.noThrow?l.resolve(t):l.reject(t)}},await s(),l}async cleanup(){for(const e in this._requests)this._requests[e].onResponse({error:new Error("page-closed")});this._requests={},await this._medium.cleanup()}_handleMessage(t){if(!this.isConnected)return;const{data:n}=t;if("connected"!==n.type)if("response"!==n.type)this._page.emit(n.type,n);else{const t=this._requests[n.request?.requestId];if(!t)return;delete this._requests[n.request.requestId];const a=e.serializer.deserialize(n,this._page);t.onResponse(a)}}_normalizeUrl(e){return e?e.startsWith("http://")||e.startsWith("https://")?e:`https://${e}`:e}}})(),(()=>{const{$engine:e}=n;e.serializer={deserialize(t,n){if(!t)return t;if("function"==typeof t)return t;if(t instanceof Blob)return t;if(Array.isArray(t))return t.map((e=>this.deserialize(e,n)));if("object"==typeof t){if("error"===t.__$ht){const e=new Error(t.message);return Object.keys(t).filter((e=>"__$ht"!==e)).forEach((n=>{e[n]=t[n]})),e}if("element"===t.__$ht)return e.Element.deserialize(t,n);if("locator"===t.__$ht)return e.Locator.deserialize(t,n);if("date"===t.__$ht)return new Date(t.time);const a={};return Object.keys(t).forEach((e=>{a[e]=this.deserialize(t[e],n)})),a}return t},serialize(t){if(!t)return t;if(t instanceof Error){const e={__$ht:"error",message:t.message,stack:t.stack};return Object.keys(t).forEach((n=>{e[n]=t[n]})),e}if(t instanceof e.Element)return t.serialize();if(t instanceof e.Locator)return t.serialize();if(t instanceof Date)return{__$ht:"date",time:t.getTime()};if(t instanceof Blob)return URL.createObjectURL(t);if(Array.isArray(t))return t.map((e=>this.serialize(e)));if("object"==typeof t){const e={};return Object.keys(t).forEach((n=>{e[n]=this.serialize(t[n])})),e}return t}}})(),(()=>{const{$dialog:e}=n;e.errors={commandConfigError:"command-config-error",failedToFetch:"failed-to-fetch",oldVersion:"old-version",failedToReadResponse:"failed-to-read-response",tooManyRequests:"too-many-requests",reachedRequestsLimit:"reached-requests-limit",messageTooLong:"message-too-long",chatNotFound:"chat-not-found",badApiKey:"bad-api-key",badModel:"bad-model",bardLogin:"bard-login",bardNoAccess:"bard-no-access",bardUnexpected:"bard-unexpected"}})(),(()=>{const{$dialog:e}=n;e.getCommandEmoji=e=>e.emoji||{Favourite:"",User:"",Assistant:"","Competitive Intelligence":"",Control:"",Copywriting:"","E-Commerce":"",Engineering:"","Generative AI":"",Learning:"","Marketing & SEO":"",Miscellaneous:"",Productivity:"","Real Estate":"",Recruiting:"",SERP:"",Spreadsheets:""}[e.category]||""})(),(()=>{const{$dialog:e,$commands:t,$nanoid:a}=n;e.migrateCommand=e=>(e.version||(e={version:1,meta:{name:e.id||a(),title:e.title,description:"",category:"User"},steps:[...(e.params||[]).map(((e,t)=>[{say:e||`Type in p${t+1}`},{ask:`p${t+1}`}])).flat(),{gpt:e.prompt||""}]}),e.steps=e.steps.map((e=>t.preprocessStep(e))),e)})(),(()=>{const{$dialog:e,$utils:t,$ai:a,$bus:o,$browser:r,$settings:i,$nanoid:s,$chat:l}=n;e.chatController={init(){o.on("dialog.setup",this.setup,this),o.on("dialog.send",this.send,this),o.on("dialog.resend",this.resend,this),o.on("dialog.like",this.like,this),o.on("dialog.dislike",this.dislike,this),o.on("dialog.stop",this.stop,this),o.on("dialog.delete",this.delete,this),o.on("dialog.paste",this.paste,this),this._autoDeleteDialogs()},async setup(e){const t=e.mediumId;!!l.proxy.of(t)||(l.proxy.createChat(t),setTimeout((()=>{const e=l.proxy.of(t);e.messages.length>0||e.addAnswer({avatar:"/img/misc/avatar.png",text:"#intro"})}),300))},async send(n,a,o={}){if(!n||!a)return;const{commandName:r,silent:i,delay:c,badge:u}={commandName:null,silent:!1,delay:0,...o},d=l.proxy.of(n),p=s();d.update({running:p}),e.chatGptController.abortAsk(n),d.addQuestion({text:o.message||a,commandName:r,silent:i}),i||await t.sleep(250),d.running===p&&d.addAnswer({text:"",done:!1,badge:u}),d.running===p&&c&&await t.sleep(c),d.running===p&&(a=await l.paramController.interpolate(n,a));const h="openai-session"===d.connection.type&&!d.openaiChatId;let m=null;return d.running===p&&(m=await e.chatGptController.ask(n,a,o)),h&&(async()=>{await this._updateChatTitle(n)})(),d.running===p&&d.update({running:!1}),m},async _updateChatTitle(e){const n=l.proxy.of(e);if(!n.openaiChatId)return;const o=await r.controller.connectTab(e);try{let e=await o.title({noIdle:!0});e=t.string.shorten(`[hrp] ${e}`),await a.api.session.setChatTitle(n.openaiChatId,e)}catch(e){console.warn("could not update dialog title",e)}},async resend(t){const n=l.proxy.of(t);if(n.command)return void await e.commandController.runCommand(t);const a=n.lastQuestion;if(a){const e={commandName:a.commandName,silent:!0};await this.send(t,a.text,e)}},async like(e,t){const n=l.proxy.of(e);n.updateAnswer(t,{answerStatus:"liked"}),n.openaiChatId&&await a.api.session.likeAnswer(n.openaiChatId,t)},async dislike(e,t){const n=l.proxy.of(e);n.updateAnswer(t,{answerStatus:"disliked"}),n.openaiChatId&&await a.api.session.dislikeAnswer(n.openaiChatId,t)},stop(t){e.chatGptController.abortAsk(t);l.proxy.of(t).update({running:!1,command:null})},async delete(e){const n=t.ensureArray(e);await Promise.all(n.map((async e=>{const t=l.proxy.of(e);t&&t.openaiChatId&&await a.api.session.deleteChat(t.openaiChatId)})))},async paste(e,t){const n=await r.controller.connectTab(e);await n.paste(t,{noIdle:!0})},async _autoDeleteDialogs(){chrome.tabs.onRemoved.addListener((e=>{i.proxy.autoClearDialogs&&this.delete(e)}))}}})(),(()=>{const{$dialog:e,$utils:t,$ai:a,$bus:o,$store:r,$env:i,$mobx:s,$settings:l,$nanoid:c,$chat:u}=n;e.chatGptController={init(){this.ask=t.enqueue(this.ask,this),this._lastAskFinishedAt=-1,this._abortControllers={},this._checkAuthOnChatRendering(),this._checkAuthOnSwitchingToSession()},async ask(n,o,s={}){await a.controller.waitPresetConnection();const l=u.proxy.of(n);s={insertMemory:!0,...s};const c=r.state.feature?.sv||0;if(i.versionNumber<c){const n=t.string.rotate(["dVers","ionol"].join(""),-2);return l.updateLastAnswer({error:e.errors[n],done:!0}),null}this._abortControllers[n]=new AbortController;const d=2e3-(Date.now()-this._lastAskFinishedAt);if(d>0&&await t.sleep(d),!this._abortControllers[n])return null;let p;return s.insertMemory&&(o=await e.context.insert(o,n)),"openai-session"===l.connection.type?p=await this._openaiSessionApiAsk(n,o):"openai-license"===l.connection.type?p=await this._openaiLicenseApiAsk(n,o):"bard-session"===l.connection.type&&(p=await this._bardSessionApiAsk(n,o)),this._lastAskFinishedAt=Date.now(),p.id&&l.updateAnswer(p.id,{done:!0}),p.text},abortAsk(e){const t=u.proxy.of(e),n=this._abortControllers[e];n&&(n.abort(),delete this._abortControllers[e]),t.lastAnswer&&""===t.lastAnswer.text&&t.removeLastAnswer()},async clearDialog(e){const t=u.proxy.of(e);t.update({messages:[{type:"answer",avatar:"/img/misc/avatar.png",text:"The chat has been cleared "}]});const n=this._abortControllers[e];if(n&&(n.abort(),delete this._abortControllers[e]),t.openaiChatId){const e=t.openaiChatId;t.update({openaiChatId:null}),await a.api.session.deleteChat(e)}t.bardCursor&&t.update({bardCursor:null})},async _openaiLicenseApiAsk(t,n){const o=u.proxy.of(t),r={messages:o.messages.filter((e=>!!e.role)).map((e=>({role:e.role,content:e.text}))),signal:this._abortControllers[t].signal,tabId:t};let i,s;try{await a.api.license.ask(n,r,((e,t)=>{t&&(o.updateLastQuestion({role:"user"}),o.updateLastAnswer({role:"assistant"})),i=e.id,s=e.text,o.updateLastAnswer({connectionId:o.connectionId,answerId:e.id,text:e.text})}))}catch(t){if(a.api.license.isOwnError(t))if(t.is.badModel)o.updateLastAnswer({error:e.errors.badModel});else if(t.is.badApiKey)o.updateLastAnswer({error:e.errors.badApiKey});else if(t.is.messageTooLong)o.updateLastAnswer({error:e.errors.messageTooLong});else if(t.is.tooManyRequests)o.updateLastAnswer({error:e.errors.tooManyRequests});else if(t.is.reachedRequestsLimit)o.updateLastAnswer({error:e.errors.reachedRequestsLimit});else if(t.is.failedToReadResponse){const t=e.errors.failedToReadResponse;o.updateLastAnswer({error:t})}else t.is.aborted||o.updateLastAnswer({error:e.errors.failedToFetch,errorDetails:t?.details||t?.message||t});else o.updateLastAnswer({error:e.errors.failedToFetch,errorDetails:t?.details||t?.message||t})}return{id:i,text:s}},async _openaiSessionApiAsk(t,n){const o=u.proxy.of(t),r=o.messages.findLast((e=>!!e.answerId&&e.connectionId.startsWith("openai-session"))),i={chatId:o.openaiChatId,parentMessageId:r?.answerId,signal:this._abortControllers[t].signal};let s=null,l=null;try{await a.api.session.ask(n,i,((e,t)=>{t&&(a.proxy.update((e=>e.openaiSession.status="ok")),o.updateLastQuestion({role:"user"}),o.updateLastAnswer({role:"assistant"})),s=e.id,l=e.text,o.update({openaiChatId:e.chatId}),o.updateLastAnswer({connectionId:o.connectionId,answerId:e.id,text:e.text})}))}catch(t){a.api.session.isOwnError(t)?t.is.badAccessToken?a.proxy.update((e=>{e.openaiSession.status="login",e.openaiSession.accessToken=null})):t.is.cloudflare?a.proxy.update((e=>e.openaiSession.status="cloudflare")):t.is.messageTooLong?o.updateLastAnswer({error:e.errors.messageTooLong}):t.is.tooManyRequests?o.updateLastAnswer({error:e.errors.tooManyRequests}):t.is.chatNotFound?(o.update({openaiChatId:null}),o.updateLastAnswer({error:e.errors.chatNotFound})):t.is.failedToReadResponse?o.updateLastAnswer({error:e.errors.failedToReadResponse,errorDetails:t?.details||t?.message||t}):t.is.aborted||o.updateLastAnswer({error:e.errors.failedToFetch,errorDetails:t?.details||t?.message||t}):o.updateLastAnswer({error:e.errors.failedToFetch,errorDetails:t?.details||t?.message||t})}return{id:s,text:l}},async _bardSessionApiAsk(t,n){const o=u.proxy.of(t),r={token:o.connection.token,cursor:o.bardCursor,signal:this._abortControllers[t].signal};let i;const s=c();try{i=await a.api.bard.ask(n,r),o.connection.update({token:i.token}),o.update({bardCursor:i.cursor}),o.updateLastAnswer({connectionId:o.connectionId,answerId:s,text:i.text})}catch(t){a.api.bard.isOwnError(t)?t.is.login?o.updateLastAnswer({error:e.errors.bardLogin}):t.is.noBardAccess?o.updateLastAnswer({error:e.errors.bardNoAccess}):t.is.aborted||o.updateLastAnswer({error:e.errors.bardUnexpected,errorDetails:t?.details||t?.message||t}):o.updateLastAnswer({error:e.errors.bardUnexpected,errorDetails:t?.details||t?.message||t})}return i?{id:s,text:i.text}:{id:null,text:null}},_checkAuthOnChatRendering(){o.on("dialog.chatRendered",(async e=>{"openai-license"!==u.proxy.of(e).connectionId&&await a.api.checkOpenaiSessionAuth()}))},_checkAuthOnSwitchingToSession(){let e=l.proxy.connectionId;s.reaction((()=>l.proxy.connectionId),(async t=>{const n=a.proxy.connection(e),o=a.proxy.connection(t);e=t,"openai-session"!==o.type||n&&"openai-session"===n.type||await a.api.checkOpenaiSessionAuth()}))}}})(),(()=>{const{$dialog:e,$analytics:t,$utils:a,$commands:o,$browser:r,$bus:i,$mobx:s,$nanoid:l,$chat:c,$ai:u,$tab:d}=n;e.commandController={init(){i.on("dialog.commandStart",this.start,this),i.on("dialog.commandInput",this.input,this)},async start(n,a){const r=c.proxy.of(n);t.controller.sendCommandRun(a),a={_instanceId:l(),params:{},inputs:[],...a},r.update({command:a}),r.setStepCursor("steps.0");const i=o.proxy.getCommand(a.meta.name)||a.meta,s=e.getCommandEmoji(a.meta),u=i.title||"Custom command";r.addAnswer({text:`${s}  **${u}**\n\`${i.category}\` ${i.desc}`,commandName:`/${i.name}`}),await this.runCommand(n)},async input(t,n,o={}){if(!a.is.string(n))throw new Error("Input text must be a string, got "+typeof n);const r=c.proxy.of(t);if(!r.command){if(0===n.trim().length)return;return await e.chatController.send(t,n)}const i=a.get(s.toJS(r.command),r.stepCursor);if(!i)return r.update({command:null}),await e.chatController.send(t,n);const l="ask"===i.type?i:null;if(!l||!l.param)return r.update({command:null}),await e.chatController.send(t,n);if(0===n.trim().length){if(!a.is.string(l.default))return;n=l.default}r.ask&&r.modifyAsk((e=>e.enabled=!1));let u=n;const d=r.ask?.options?.find((e=>e.selected));d&&"$custom"!==d?.value&&(u=d.value||d.label),l.interpolate&&(u=await c.paramController.interpolate(t,u,{noLimit:!0})),this._setParam(t,l.param,u,d),d&&"$custom"!==d.value||r.addQuestion({text:n});const p=o.delay??250;this._gotoNextCommandStep(t,{delay:p})},_gotoNextCommandStep(e,{delay:t,step:n}={}){const a=c.proxy.of(e),o=a.command?._instanceId;setTimeout((()=>{o===a.command?._instanceId&&(n?a.setStepCursor(n):a.nextStepCursor(),this.runCommand(e))}),t||0)},async runCommand(e){const t=c.proxy.of(e);if(!t.command)return;const n=a.get(s.toJS(t.command),t.stepCursor);if(n)try{await this._runCommandStep(e,n)}catch(t){this._interrupt(e,`Command failed: ${t.message}`)}else t.update({command:null})},async _runCommandStep(t,n){const i=c.proxy.of(t),s=i.command,l=a.string.shorten;if(n.condition){const e=a.ensureArray(n.condition);for(const n of e){if(!await this._checkCondition(t,n))return void this._gotoNextCommandStep(t)}}if("say"===n.type||"ask"===n.type&&n.message){let e=n.message;!1!==n.interpolate&&(e=await c.paramController.interpolate(t,e,{noLimit:!0})),i.addAnswer({text:e})}if("ask"===n.type){const e={type:"ask",param:n.param};a.is.array(n.options)&&n.options.length>0?(e.paramType="choice",e.options=n.options):(e.paramType="string",e.value=""),e.options&&(e.options=e.options.map((e=>"$custom"===e?{value:"$custom",input:""}:e)).map((e=>"string"==typeof e?{label:e,value:e}:e)).map(((e,t)=>({...e,selected:0===t}))));const o=i.command.inputs?.shift();e:if(o){if(e.value=o,"choice"!==e.paramType||0===(e.options||[]).length)break e;const t=(o||"").toLowerCase(),n=e.options.findIndex((e=>"$custom"!==e.value&&(e.label||e.value||"").toLowerCase().includes(t)));if(-1!==n){e.options.forEach(((e,t)=>e.selected=t===n));break e}const a=e.options.find((e=>"$custom"===e.value));a&&(e.options.forEach((e=>e.selected=!1)),a.input=o,a.selected=!0)}return i.addAsk(e),void(o&&await this.input(t,o,{delay:100}))}if("command"===n.type){const{name:e,inputs:r}=n,s=o.proxy.getCommandDeclaration(e);if(!s){const n=`Oops... No command with title: **${e}**`;return this._interrupt(t,n)}const l=[...s.steps||[]];return r&&l.unshift({type:"set-inputs",inputs:r}),a.set(i.command,i.stepCursor,l,{flatten:!0}),void this._gotoNextCommandStep(t,{step:i.stepCursor})}if("set-inputs"===n.type)return n.inputs&&i.update((e=>e.command.inputs=n.inputs)),void this._gotoNextCommandStep(t);"interpolate"===n.type&&this._setParam(t,n.param,await c.paramController.interpolate(t,this._getParam(t,n.param),{noLimit:!0}));e:if("gpt"===n.type){let a=n.prompt||"";if(!n.chunkify){const o=await e.chatController.send(t,a,{silent:!0,insertMemory:!1});if(!o&&this._loginRequired())return;this._setParam(t,n.param||"gpt",o);break e}const o=n.chunkify.text||"{{page}}",r=await c.paramController.interpolate(t,o,{noLimit:!0});if(!r){n.chunkify.empty&&i.addAnswer({text:n.chunkify.empty});break e}a=await c.paramController.interpolate(t,a,{ignore:["chunk","chunk.index","chunk.total"]});let l=[],u={remaining:r};do{u=await c.paramController.insertValue(t,a,"chunk",u.remaining),l.push(u.text)}while(u.text&&u.remaining);l=l.map(((e,t)=>e.replace(/{{chunk.index}}/g,t+1).replace(/{{chunk.total}}/g,l.length)));let d=[];l=l.filter(Boolean);for(let n=0;n<l.length;n++){if(i.command!==s)return;if(d.push(await e.chatController.send(t,l[n],{silent:!0,badge:l.length>1?`${n+1} / ${l.length}`:void 0,insertMemory:!1})),d=d.filter(Boolean),0===d.length&&this._loginRequired())return}this._setParam(t,n.param||"gpt",d.join("\n\n"))}if("jump"===n.type){let e=i.command.steps.slice(0,i.stepCursorIndex).findLastIndex((e=>e.label===n.to));return-1===e&&(e=i.command.steps.slice(i.stepCursorIndex+1).findIndex((e=>e.label===n.to))),-1===e?this._interrupt(t,`Missing label: **${n.to}**`):void this._gotoNextCommandStep(t,{step:`steps.${e}`})}if("clear"===n.type&&await e.chatGptController.clearDialog(t),"stop"===n.type)return void i.update({command:null});const u=await r.controller.connectTab(t),p=d.proxy.of(t).creator.frameOpen;e:if("request"===n.type){const e=await this._computeUrl(t,n.url,u);if(!e)break e;const o="auto"!==n.method?n.method.toUpperCase():n.body?"POST":"GET";let r,s={};t:if(n.headers){try{s=a.is.object(n.headers)?JSON.stringify(n.headers):n.headers}catch{break t}s=await c.paramController.interpolate(t,s,{noLimit:!0});try{s=JSON.parse(s)}catch{s={}}}if(n.auth?.enabled&&!s.hasOwnProperty("Authorization")){const{username:e,password:t}=n.auth;s.Authorization="Basic "+btoa(`${e||""}:${t||""}`)}t:if(n.body){try{r=a.is.object(n.body)?JSON.stringify(n.body):n.body}catch{break t}r=await c.paramController.interpolate(t,r,{noLimit:!0});let e="text";if(!a.is.string(r))try{r=JSON.stringify(r),e="json"}catch{r="Error: could not stringify body"}s["Content-Type"]=s.hasOwnProperty("Content-Type")?s["Content-Type"]:"text"===e?"text/plain":"application/json"}let d=null;t:try{const t=await fetch(e,{method:o,headers:s,body:r});if(d={headers:Object.fromEntries(t.headers.entries()),ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},!t.ok)break t;const n=t.headers.get("content-type")||"";try{n.startsWith("multipart/form-data")?d.body=await t.formData():n.startsWith("application/json")?d.body=await t.json():d.body=await t.text()}catch(e){d.body=`Failed parsing response: ${e.message}`}}catch(t){d={ok:!1,status:0,type:"error",url:e,body:`Request error: ${t.message}`}}const p=n.param||"response";this._setParam(t,p,d);const h=`${d.ok?"":""}&nbsp;&nbsp;**${o}** ${l(e)}`,m=d.body?`${h}  \`${l(d.body||"",100)}\`  \`${p}\``:`${h}  \`${p}\``;i.addAnswer({text:m})}if("navigate"===n.type){const e=await this._computeUrl(t,n.url,u,!1);e?await u.navigate(e):await u.reload();const a=`&nbsp;&nbsp;**NAVIGATE**  ${l(e||"refresh")}`;i.addAnswer({text:a})}e:if("click"===n.type){const e=n.selector;if(!e)break e;try{const t=await u.click(e),n=`&nbsp;&nbsp;**CLICK**  ${l((t.innerText||"").replace(/\s+/g," "))||"OK"}`;i.addAnswer({text:n})}catch(e){const t=`&nbsp;&nbsp;**CLICK**  Failed: ${e.message}`;i.addAnswer({text:t})}}if("paste"===n.type){const e=await c.paramController.interpolate(t,n.text||"{{gpt}}",{noLimit:!0});await u.paste(e,{noIdle:!0});const a=`&nbsp;&nbsp;**PASTE**  ${l(e)}`;i.addAnswer({text:a})}n.closeFrame?await r.controller.hideFrame(t):p&&["navigate","click"].includes(n.type)&&await r.controller.openFrame(t),this._gotoNextCommandStep(t,{delay:250})},_setParam(e,t,n,a){const o=c.proxy.of(e);o.setParam(t,n),a&&o.setParam(`${t}-option`,a?.value)},_getParam:(e,t)=>c.proxy.of(e).getParam(t),async _checkCondition(e,t){let n;t+=" ";let[a,o]=["",""];if(t.includes(" = "))[a,o]=t.split(" = "),n="=";else if(t.includes(" != "))[a,o]=t.split(" != "),n="!=";else if(t.includes(" > "))[a,o]=t.split(" > "),n=">";else if(t.includes(" >= "))[a,o]=t.split(" >= "),n=">=";else if(t.includes(" < "))[a,o]=t.split(" < "),n="<";else if(t.includes(" <= "))[a,o]=t.split(" <= "),n="<=";else{if(!t.includes(" =~ "))throw new Error("Invalid step condition format. Expected one of, including spaces: `x = y`, `x != y`, `x > y`, `x >= y`, `x < y`, `x <= y`, `x =~ y`");[a,o]=t.split(" =~ "),n="=~"}switch(a=await c.paramController.interpolate(e,a.trim(),{noLimit:!0}),o=await c.paramController.interpolate(e,o.trim(),{noLimit:!0}),n){case"=":return a===o;case"!=":return a!==o;case">":return Number(a)>Number(o);case">=":return Number(a)>=Number(o);case"<":return Number(a)<Number(o);case"<=":return Number(a)<=Number(o);case"=~":return new RegExp(o).test(a)}},async _computeUrl(e,t,n,o=!0){if(!(t=await c.paramController.interpolate(e,t,{noLimit:!0})))return o?n.url({noIdle:!0}):null;if(t.startsWith("/")){const e=await n.url({noIdle:!0});return`https://${a.url.getDomain(e)}${t}`}return t.startsWith("http://")||t.startsWith("https://")?t:`https://${t}`},_interrupt(t,n){const a=c.proxy.of(t);a.addAnswer({text:n,error:e.errors.commandConfigError}),a.update({command:null})},_loginRequired:()=>["login","cloudflare"].includes(u.proxy.openaiSession.status)}})(),(()=>{const{$dialog:e,$browser:t,$settings:a,$chrome:o,$chat:r}=n;e.context={async insert(e,n=null){const a=r.proxy.of(n);if(!a.memory)return e;let i=a.connection.maxRequestTokens-await a.connection.countTokens(e)-await a.connection.countTokens("[CONTEXT]\n\n\n[USER PROMPT]\n"),s="";e:{const l=a.connection.maxTokens*(a.messages.some((e=>["user","assistant"].includes(e.role)))?.3:1);let c=Math.floor(Math.min(i,l));if(c<100)break e;const u=[];if(n)try{const i=await t.controller.connectTab(n);let s=this._getPreferredLanguage();if(s&&"english"!==s){const e=await a.connection.countTokens(s);if(e>c)break e;c-=e,u.push(s)}let l=await this._getPageMetadata(i);if(l){const e=await a.connection.countTokens(l);if(e>c)break e;c-=e,u.push(l)}const d="- Page content: ",p=await a.connection.countTokens(`${d}\n`),h=await o.tabs.get(n),m=await r.paramPromptContext({prompt:e,tab:h,page:i,maxTokens:c-p});m&&u.push(`${d}${m}\n`)}catch(e){console.warn(`[$dialog] failed to read page from tab ${n}`,e)}s=u.join(""),s=`[CONTEXT]\n${s}`}return e=s?[s,`[USER PROMPT]\n${e}`].join("\n\n"):e},_getPreferredLanguage:()=>"english"===a.proxy.promptLanguage?null:`- User prefers LLM to reply in ${a.proxy.promptLanguageValue}\n`,async _getPageMetadata(e){let[t,n,a]=await Promise.all([e.url(),e.title(),e.description()]);t=t.split("?")[0].split("#")[0];return`- Current web page is: ${[t,n,a].filter(Boolean).join(" | ")}\n`}}})(),(()=>{const{$dialog:e}=n;e.controller={init(){e.serpController.init(),e.chatGptController.init(),e.chatController.init(),e.commandController.init()}}})(),(()=>{const{$dialog:e,$chrome:t,$browser:a,$bus:o,$tab:r}=n;e.serpController={init(){this._searchEngines=this._getSearchEngines(),this._injectFrameForSerpPages(),o.on("dialog.serpQuery",this._serpQuery.bind(this))},_injectFrameForSerpPages(){chrome.tabs.onUpdated.addListener((async(n,o)=>{if("chrome://newtab/"===o.url)return;if("loading"!==o.status)return;const i=await t.tabs.get(n);if(!i)return;if(!this._searchEngines.find((e=>e.check(i.url))))return;const s=await a.controller.connectTab(n);await s.frame.inject({collapsed:!0,onInjection:async()=>{const t=r.proxy.of(n);t.screen="ai",t.creator.frameOpen=!1,t.creator.frameCollapsed=!0,setTimeout((()=>t.creator.frameOpen=!0),300),await e.chatController.setup(s)}})}))},_serpQuery(e){const t=this._searchEngines.find((t=>t.check(e)));if(!t)return null;try{return new URL(e).searchParams.get(t.query).trim()}catch{}return null},_getSearchEngines:()=>[{name:"google",check:e=>/^https:\/\/(www\.)?google\.[^/]+\/search/gim.test(e),query:"q"},{name:"bing",check:e=>e.startsWith("https://www.bing.com/search")||e.startsWith("https://cn.bing.com/search"),query:"q"},{name:"yahoo",check:e=>/^https:\/\/search\.yahoo\.[^/]+\/search/gim.test(e),query:"p"},{name:"duckduckgo",check:e=>e.startsWith("https://duckduckgo.com/"),query:"q"},{name:"baidu",check:e=>e.startsWith("https://www.baidu.com/"),query:"wd"},{name:"kagi",check:e=>e.startsWith("https://kagi.com/search"),query:"q"},{name:"yandex",check:e=>/^https:\/\/yandex\.[^/]+\/search/gim.test(e),query:"text"},{name:"naver",check:e=>e.startsWith("https://search.naver.com/search"),query:"query"},{name:"brave",check:e=>e.startsWith("https://search.brave.com/search"),query:"q"},{name:"ecosia",check:e=>e.startsWith("https://www.ecosia.org/search"),query:"q"},{name:"google-scholar",check:e=>/^https:\/\/scholar\.google\.[^/]+\/scholar/gim.test(e),query:"q"}]}})(),(()=>{const{$dev:e,$mobx:t,$store:a,$env:o}=n;e.controller={init(){o.is.development&&this._initDevHelpers()},resetState(){a.controller.resetState()},_initDevHelpers(){Object.defineProperty(Object.prototype,"$",{get(){return t.toJS(this)}});const e=a.adapter.create({get:e=>e});Object.defineProperty(globalThis,"s",{get:()=>e})}}})(),(()=>{const{$dashboard:e,$task:t,$store:a,$utils:o,$logger:r,$bus:i}=n;e.controller={init(){e.exportController.init(),i.on("dashboard.importTasks",this.importTasks.bind(this)),i.on("dashboard.importPredefinedTasks",(()=>{this.importPredefinedTasks({force:!0,shiftToNow:!0})}))},async importPredefinedTasks(t){if(t={force:!1,shiftToNow:!0,...t},!e.proxy.predefinedImportedAt||t.force){try{const e=new URL(chrome.runtime.getURL("/tasks/predefined-tasks.json"));await this.importTasks(e,t)}catch(e){r.error("[$dashboard] failed to import predefined tasks",e)}e.proxy.predefinedImportedAt=Date.now()}},async importTasks(e,t){let n=null;if(o.is.url(e)){let t=null;try{t=await fetch(e)}catch(e){throw new Error("failed to fetch url")}if(!t.ok)throw new Error("url resource returned http error code");try{n=await t.json()}catch(e){throw new Error("url resource is not json")}}else if(o.is.string(e))try{n=JSON.parse(e)}catch(e){throw new Error("failed to parse json string")}else n=e;if(!n)throw new Error("patch json is empty or null");this._modifyPatch(n,t),await a.versioner.upgradeTaskPatch(n),await a.patcher.applyPatch(n)},_modifyPatch(e,n){n={shiftToNow:!1,...n};let{stateActions:o,dataActions:r}=e;o=o||[],r=r||{};o.filter((e=>"tasks"===e.getter?.[0]&&"push"===e.method)).forEach((e=>{const o=e.args[0],i=o.id;do{o.id=a.idGenerator.task()}while(t.proxy.taskById(o.id)||r[`task:${o.id}`]);r[`task:${o.id}`]=r[`task:${i}`],delete r[`task:${i}`],n.shiftToNow&&o.records.length>0&&(o.createdMs=Date.now(),o.records.at(-1).ms=Date.now())}))}}})(),(()=>{const{$dashboard:e,$task:t,$bus:a,$store:o,$utils:r,$mobx:i}=n;e.exportController={init(){a.on("dashboard.createTaskPatch",this.createTaskPatch,this)},async createTaskPatch(e=null,n={}){n={disable:!0,withDomains:!0,withData:!0,withRecords:!0,...n},e=e||t.proxy.tasks.map((e=>e.id)),e=r.ensureArray(e);const a={},s=[],l=new Map;for(const r of e){const e=i.toJS(t.proxy.taskById(r));if(s.push(e),e.id=o.idGenerator.task(),n.disable&&(e.enabled=!1),n.withDomains){const n=t.proxy.taskDomain(e);l.has(n)||l.set(n,i.toJS(o.state.library.domains[n]))}if(n.withData){const n=await t.dataController.readTask(e.id);n&&(a.dataActions=a.dataActions||{},a.dataActions[`task:${e.id}`]=n)}n.withRecords||(e.records=[])}const c=o.template.state();return a.stateActions=o.deducer.modify(c,(e=>{s.forEach((t=>e.tasks.unshift(t))),Array.from(l.entries()).forEach((([t,n])=>e.library.domains[t]=n))})),a}}})(),(()=>{const{$dashboard:e,$store:t,$task:a,$runner:o,$utils:r,$library:i,$journal:s}=n;e.proxy=t.createProxy({get predefinedImportedAt(){return t.state.dashboard.predefinedImportedAt},set predefinedImportedAt(e){this._update({predefinedImportedAt:e})},get aggregation(){return t.state.dashboard.aggregation},set aggregation(e){this._update({aggregation:e})},get tasks(){return t.state.tasks},get taskIds(){return this.tasks.map((e=>e.id))},hasTasks(){return this.tasks.length>0},get domains(){const e=this.tasks.map((e=>a.proxy.taskDomain(e)));return r.unique(e)},get screenTasks(){return this.getScreenTasks(t.state.mainScreen)},getScreenTasks(e){return e.startsWith("domain:")?this.tasks.filter((t=>e===`domain:${a.proxy.taskDomain(t)}`)):this.tasks},taskFavicon(e){const t=a.proxy.taskDomain(e);return i.proxy.domainFavicon(t)},get selectedTasks(){return t.state.dashboard.selectedTasks},set selectedTasks(e){this._update({selectedTasks:e})},get stoppedTasks(){return t.state.dashboard.stoppedTasks},set stoppedTasks(e){this._update({stoppedTasks:e})},get selectedTasksSet(){return new Set(this.selectedTasks)},selectedTasksEnabled(){return(this.selectedTasks||[]).every((e=>a.proxy.taskById(e)?.enabled))},taskSelected(e){return this.selectedTasksSet.has(e)},hasEnabledScreenTasks(){return this.screenTasks.some((e=>e.enabled))},get resumableTaskCount(){const e=new Set(this.stoppedTasks);let t=0;for(const n of this.tasks)e.has(n.id)&&t++;return t},taskScheduleTooltip(e){const t=o.proxy.computeNextRunMs(e);return-1===t?"Schedule this task":!o.proxy.netStable&&t<=Date.now()?"Waiting for stable Internet connection":r.time.formatRelativeDate(t)},jobProgress(e){const t=o.proxy.jobByTaskId(e.id);return t?t.progress?t.progress:o.proxy.netStable&&t.ms<=Date.now()?0:null:null},disableTask(e){t.transaction((t=>{t.tasks.forEach((t=>{t.id===e&&(t.enabled=!1,s.proxy.logTaskEnabled(t))}))}))},_update(e={}){t.transaction((t=>{Object.assign(t.dashboard,e)}))}})})(),(()=>{const{$creator:e,$bus:t,$utils:a,$idb:o,$chrome:r}=n;e.contextController={async init(){this._ctx=await o.read("creator.context")||{},t.on("creator.getContext",this.getContext.bind(this)),this._dropContextWithoutTabs()},async setContext(e,n){return this._ctx[e]=n,o.write("creator.context",this._ctx),t.send("creator.setContext",e,n)},getContext(e){return this._ctx[e]},_dropContextWithoutTabs(){a.chrome.alarms.run((async()=>{const e=Object.keys(this._ctx);if(0===e.length)return;const t=await r.tabs.query({}),n=new Set(t.map((e=>String(e.id)))),a=e.filter((e=>!n.has(e)));0!==a.length&&(a.forEach((e=>delete this._ctx[e])),o.write("creator.context",this._ctx))}),{name:"creator.dropContextWithoutTabs",delayInMinutes:1,periodInMinutes:a.time.HOUR/a.time.MINUTE})}}})(),(()=>{const{$creator:e,$browser:t,$store:a,$runner:o,$recipe:r,$task:i,$bus:s,$mobx:l,$harpa:c,$tabs:u,$utils:d,$chrome:p,$welcome:h,$tab:m}=n;e.controller={init(){this._setupContext(),this._setupBusListeners()},_setupContext(){e.contextController.init()},_setupBusListeners(){s.on("creator.watchPage",this.watchPage.bind(this)),s.on("creator.editTaskInTab",this.editTaskInTab.bind(this)),s.on("creator.parseTemplates",this.parseTemplates.bind(this)),s.on("creator.updateTemplate",this.updateTemplate.bind(this)),s.on("creator.saveTemplateToTask",this.saveTemplateToTask.bind(this)),s.on("creator.querySelector",this._querySelector.bind(this)),s.on("creator.callPageApi",this._callPageApi.bind(this))},async watchPage({url:e,title:t}){try{const n="watcher.monitorChanges",a=this._taskTemplate(n,e);return a.name=t||"",a.inputs["watcher.changes"].whatToMonitor="text",a.inputs["watcher.trigger"].monitorChangesText="content-changes",a.inputs["watcher.trigger"].monitorChangesHtml="content-changes",a.inputs.schedule.mediumType="hidden-tab",a.inputs.schedule.mediumId=null,a.inputs.schedule.autoCloseTab=!0,a.inputs.trigger.color="positive",this._createTask({task:a})}catch(e){console.error("Failed watching page",e)}},async editTaskInTab(e,n){const o=l.toJS(i.proxy.taskById(e));if(!o)return;const r=o.inputs.page?.url;if(!r)return;o.records=[o.records.at(-1)].filter((e=>!!e));let s=null;try{s=n?await t.controller.connectTab(n):await t.controller.createTab(r)}catch(e){return void console.warn("failed opening page",e)}const c=m.proxy.of(s.mediumId).creator;try{const e=c.tabId;await p.tabs.update(e,{active:!0}),await t.controller.toggleFrame(e),m.proxy.transaction(e,(e=>{e.screen="create",e.creator={...a.template.creator(),pageUrl:r,parseStatus:"parsing",screen:"config",templateIndex:0,templates:[o],editingTaskId:o.id}}));const{html:n,data:i,text:l,prefetch:u}=await this._parsePage(r,s,!0);await this._storeContext(s,{html:n,text:l,data:i,prefetch:u}),c.parseStatus="parsed"}catch(e){c.parseError=e.message||"Unknown Error",c.parseStatus="failed"}},async parseTemplates({tabId:e,force:n}){const a=m.proxy.of(e).creator;if("parsing"===a.parseStatus)return;if(!n&&a.parseStatus)return;a.templates=[],a.templateIndex=-1,a.screen="templates";const o=Date.now();a.parseStatus="parsing",a.parseError=null;const r=a.pageUrl,s=new URL(r).host;try{const l=await t.controller.connectTab(e),{title:c,html:u,data:p,text:m,prefetch:g}=await this._parsePage(r,l);await this._storeContext(l,{html:u,text:m,data:p,prefetch:g});let f=[];await Promise.all(Object.entries(i.proxy.recipes).filter((([e,t])=>t.templates?.build)).map((async([t,n])=>{const a={url:r,host:s,page:l,html:u,data:p,text:m,prefetch:g,template:()=>this._taskTemplate(t,r,e)};try{const e=await i.evaluate(n.templates.build,a)||[];f=[...f,...e]}catch(e){console.warn("Failed building templates",e)}}))),f=f.filter((e=>!!e)).map((e=>e.task?e:{priority:0,task:e})).sort(((e,t)=>e.priority-t.priority)).map((e=>(e.task.named=e.task.name,e.task.name=c,e.task.dropdown=e.dropdown,e.task))),f.forEach((e=>h.controller.patchTemplate(e))),n&&await d.sleep(o+450-Date.now()),a.templates=d.cloneDeep(f,this._serializeData),a.templateIndex=a.listTemplates.length>0?0:-1,a.parseStatus="parsed"}catch(e){a.parseError=e.message||"Unknown Error",a.parseStatus="failed"}},_serializeData:e=>"function"==typeof e?.serialize?e.serialize():e,_taskTemplate(e,t,n){const o=i.proxy.recipeById(e);if(!o)throw new Error(`recipe not found for id ${e}`);const s=a.template.task();return s.recipeId=e,s.state=l.toJS(o.state)||{},s.widgets=l.toJS(o.widgets)||{},s.storage=l.toJS(o.storage)||{},s.records=l.toJS(o.records)||[],s.inputs={},o.inputs.forEach((({type:e})=>{s.inputs[e]=r.inputs[e]?.state})),t&&s.inputs.page&&(s.inputs.page.url=t),n&&s.inputs.schedule&&(s.inputs.schedule.mediumId=n),s},async updateTemplate(t){const n=m.proxy.of(t).creator,a=e.contextController.getContext(t);if(!a)return;const o=i.proxy.recipeById(n?.template?.recipeId);if(!o)return;const r=o?.templates?.update;if(r)try{const e=d.cloneDeep(n.template,this._serializeData);await i.evaluate(r,e,a),n.template=e}catch(e){console.warn("Failed updating template",e)}},async saveTemplateToTask(e){const t=m.proxy.of(e).creator;if(t?.template){if(t.editingTaskId){const n=t.editingTaskId;return this._updateTask({task:t.template,tabId:e,taskId:n})}return this._createTask({task:t.template,tabId:e})}},async _updateTask({task:e,tabId:t,taskId:n}){const r=l.toJS(i.proxy.taskById(n));e={...e,id:n,records:r?.records||[]},c.proxy.mainScreen="dashboard",t&&e.inputs.schedule?.mediumId!==t&&(await u.openAppTab(!1),chrome.tabs.remove(t));const s=a.state.tasks.findIndex((e=>e.id===n));-1!==s?(o.scheduleController.terminateTasks(n),a.transaction((t=>{t.tasks[s]=e}))):a.transaction((t=>{t.tasks=[e,...t.tasks]}))},async _createTask({task:t,tabId:n,closeTab:o}){const r=(t=i.Adapter.ofTask(t)).scheduleMediumType;(t=t.taskObject).id=a.idGenerator.task(),t.createdMs=Date.now(),t.name=t.name||i.proxy.recipeTitle(t),t.records=[],delete t.named,delete t.dropdown;const s=i.proxy.recipeById(t.recipeId);if(n&&s?.templates?.store)try{const a=e.contextController.getContext(n);await i.evaluate(s.templates.store,t,a)}catch(e){console.warn("Failed storing template",e)}n&&"tab"===r?await p.tabs.update(n,{pinned:!1}):n&&"pinned-tab"===r&&await p.tabs.update(n,{pinned:!0}),o&&"hidden-tab"===r&&(c.proxy.mainScreen="dashboard",await u.openAppTab(!1),n&&await p.tabs.remove(n));if(t.inputs.schedule&&n){const e="hidden-tab"===r?null:n;t.inputs.schedule.mediumId=e}a.transaction((e=>{e.tasks=[t,...e.tasks]}))},async _parsePage(e,t,n){n&&await t.idle({noThrow:!0});const[a,o,r]=await Promise.all([t.title({noIdle:!0}),t.content({contentType:"htmlContent",noIdle:!0}),t.parse({extract:!0,inspect:!0,computeAiLocator:!1,noIdle:!0})]),i=r.filter((e=>"text"===e.type)).map((e=>e.value)).join("\n");return{title:a,html:o,data:r,text:i,prefetch:{statusCode:200,statusText:"OK",responseUrl:e,redirected:!1}}},async _storeContext(t,n){await e.contextController.setContext(t.mediumId,d.cloneDeep(n,this._serializeData))},async _querySelector(e,n){const a=await t.controller.connectTab(e);if(a)return await r.adapters.watcher.queryItem(a,n)},async _callPageApi(e,n,...a){const o=await t.controller.connectTab(e);if(o)return await o.controller.sendRequest(n,a,{noIdle:!0})}}})(),(()=>{const{$creator:e,$store:t,$tab:a}=n;e.Adapter=class{constructor(e){if(!e)throw new Error("$creator.Adapter tabId argument must be defined");this._tabId=e}get tabId(){return this._tabId}get pageUrl(){return this._creator.pageUrl}set pageUrl(e){this._update({pageUrl:e})}get pageFavicon(){return this._creator.pageFavicon}set pageFavicon(e){this._update({pageFavicon:e})}get parseStatus(){return this._creator.parseStatus}set parseStatus(e){this._update({parseStatus:e})}get parseError(){return this._creator.parseError}set parseError(e){this._update({parseError:e})}get screen(){return this._creator.screen}set screen(e){this._update({screen:e})}get frameWide(){return this._creator.frame.wide}set frameWide(e){this._updateFrame({wide:e})}get frameOpen(){return this._creator.frame.open}set frameOpen(e){this._updateFrame({open:e})}get frameCollapsed(){return this._creator.frame.collapsed}set frameCollapsed(e){this._updateFrame({collapsed:e})}get configMode(){return this._creator.configMode}set configMode(e){this._update({configMode:e})}get templates(){return this._creator.templates}set templates(e){this._update({templates:e})}get listTemplates(){return(this.templates||[]).filter((e=>!e.dropdown))}get dropdownTemplates(){return(this.templates||[]).filter((e=>!!e.dropdown))}get templateIndex(){return this._creator.templateIndex}set templateIndex(e){this._update({templateIndex:e})}prevListTemplateIndex(){if(0===this.listTemplates.length)return;let e=this.templateIndex;const t=this.templates.length;do{e>0?e-=1:e=t>0?t-1:0}while(this.templates[e].dropdown);this.templateIndex=e}nextListTemplateIndex(){if(0===this.listTemplates.length)return;let e=this.templateIndex;const t=this.templates.length;do{e<t-1?e+=1:e=0}while(this.templates[e].dropdown);this.templateIndex=e}get template(){const e=this.templates;return this.templateIndex<e.length?e[this.templateIndex]:null}set template(e){const{tabId:n,templateIndex:a}=this;t.transaction((t=>{t.tab[n].creator.templates[a]=e}))}updateTemplate(e={}){const{tabId:n,templateIndex:a}=this;t.transaction((t=>{Object.assign(t.tab[n].creator.templates[a],e)}))}get editingTaskId(){return this._creator.editingTaskId}get trapperData(){return this._creator.trapper.data||[]}set trapperData(e){this._updateTrapper({data:e})}get trapperGrabbing(){return this._creator.trapper.grabbing}set trapperGrabbing(e){this._updateTrapper({grabbing:e})}_update(e={}){this._modify((t=>Object.assign(t,e)))}_updateTrapper(e={}){this._modify((t=>Object.assign(t.trapper,e)))}_updateFrame(e={}){this._modify((t=>Object.assign(t.frame,e)))}_modify(e){a.proxy.transaction(this._tabId,(t=>e(t.creator)))}get _creator(){return a.proxy.getState(this._tabId).creator}}})(),(()=>{const{$commands:e}=n;e.preprocessStep=e=>e?("say"===(e=t({...e})).type?e.message=(e.message||"").trim():"ask"===e.type?e.param=e.param||"input":"gpt"===e.type?e.param=e.param||"gpt":"paste"===e.type?(e.text=e.text||"{{gpt}}",e.close=e.close||!1):"command"===e.type&&(e.name=e.name||"",e.inputs=e.inputs||[]),e):null;const t=e=>(e.type||("string"==typeof e.say?delete(e={...e,type:"say",message:e.say}).say:"string"==typeof e.ask?delete(e={...e,type:"ask",param:e.ask}).ask:"string"==typeof e.gpt?delete(e={...e,type:"gpt",prompt:e.gpt}).gpt:"string"==typeof e.jump?delete(e={...e,type:"jump",to:e.jump}).jump:"string"==typeof e.paste?delete(e={...e,type:"paste",text:e.paste}).paste:"string"==typeof e.interpolate&&delete(e={...e,type:"interpolate",param:e.interpolate}).interpolate),e)})(),(()=>{const{$commands:e}=n;e.systemCommands=[{meta:{name:"reply",title:"Reply",category:"Productivity",description:"Write a reply to selected text.",emoji:""},steps:[{condition:"{{page.selection}} !=",type:"ask",message:"Sure! What would you like me to reply to?\n",param:"text",options:[{label:"SELECTED TEXT",value:"{{page.selection}}"},{value:"$custom"}]},{condition:"{{page.selection}} =",type:"ask",message:"Sure! What would you like me to reply to? Leave blank and I will try to figure it out from the opened page.\n",param:"text",options:[{label:"FIND ON PAGE",value:"Please parse from the web page content"},{value:"$custom"}]},{type:"ask",message:"What would you like the reply to include? Pick an option or type instructions.\n",param:"reply",options:[{label:"NOTHING SPECIFIC",value:"None"},{label:" AGREEMENT",value:"Agreement"},{label:" DISAGREEMENT",value:"Disagreement"},{label:" QUESTION",value:"Question"},{label:" CLARIFICATION",value:"Clarification"},{label:" SUGGESTION",value:"Suggestion"},{label:" INFORMATION",value:"Request for more information"},{label:" JOKE",value:"Joke"},{label:" IDEA",value:"Idea"},{label:" PRAISE",value:"Praise"},{label:" ACKNOWLEDGMENT",value:"Acknowledgment"},{label:" EMPATHY",value:"Empathy"},{label:" SUPPORT",value:"Support"},{label:" ENCOURAGEMENT",value:"Encouragement"},{label:" CRITICISM",value:"Criticism"},{label:" APOLOGY",value:"Apology"},{value:"$custom"}]},{type:"gpt",prompt:"Please ignore previous instructions. Your new instructions:\n- I would like you to write a reply for me on a web page.\n- Please pretend to be me, mimicking my style of communication if present in a context.\n- Your task is to write a reply, appropriate for the style of communication, parameters and {{page.domain}} website, in the language of the source message. E.g. if website is twitter, write a tweet, if gmail, write an email, if reddit, write a reddit comment, etc.\n- Do not echo my command or parameters.\n- I will give you the reply parameters in brackets [], as well as a web page content so you understand the conversation context and style.\n\n[USE WEB PAGE CONTENT AS A REPLY CONTEXT]: {{page}}\n\n[WRITE A REPLY TO THIS MESSAGE]: {{text}}\n\n[ADDITIONAL INSTRUCTIONS / REPLY SHOULD CONTAIN, IF ANY]: {{reply}}\n\nTEXT OF A REPLY:"},{type:"ask",label:"ask-for-change",param:"change",options:[{label:" DONE",value:"no"},{label:" PASTE TO PAGE",value:"paste"},{label:" EXPAND",value:"Make text longer."},{label:" SHORTEN",value:"Make text shorter."},{label:" FIX GRAMMAR",value:"Output the text as is, but fix spelling errors if the text contains them."},{label:" SIMPLIFY",value:"Simplify text language."},{label:" COMPLICATE ",value:"Complicate text language."},{label:" PROFESSIONAL",value:"Change tone to professional."},{label:" CASUAL",value:"Change tone to casual."},{label:" STRAIGHTFORWARD",value:"Change tone to straightforward."},{label:" CONFIDENT",value:"Change tone to confident."},{label:" FRIENDLY",value:"Change tone to friendly."},{label:" STORY",value:"Change style to storytelling."},{label:" SCARY",value:"Change style to scary."},{label:" LOVECRAFT",value:"Change style to a H.P. Lovecraft story."},{label:" 1ST PERSON",value:"Change style to 1st person."},{label:" 3RD PERSON",value:"Change style to 3rd person."},{label:" CLARITY",value:"Add clarity and conciseness."},{label:" REFINE",value:"Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length."},{label:" ILLUSTRATE",value:"Add examples, anecdotes, and other storytelling elements to illustrate points."},{label:" TRANSLATE",value:"Translate to {{language}}, or echo text as is if already in {{language}}."},{label:" ADD HEADINGS",value:"Add headings, subheadings, bullet points, and other formatting elements for readability."},{label:" ENRICH",value:"Enhance vocabulary and tone."},{label:" HUMANIZE",value:'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'},{value:"$custom"}]},{condition:"{{change}} = no",type:"stop"},{condition:"{{change}} = paste",type:"paste",closeFrame:!0},{condition:"{{change}} = paste",type:"stop"},{type:"gpt",prompt:"I would like you to make changes to the reply you have just written. Please do not output anything but the revised reply. Do not echo my command. Do not put quotes around the revised reply.\n\n[CHANGES TO MAKE]: {{change}}\n\nNEW REPLY:"},{type:"jump",to:"ask-for-change"}]},{meta:{name:"rewrite",title:"Rewrite",category:"Productivity",description:"Make changes to selected text.",emoji:""},steps:[{condition:"{{page.selection}} !=",type:"ask",message:"Sure! What would you like me to rewrite?\n",param:"text",options:[{label:"SELECTED TEXT",value:"{{page.selection}}"},{value:"$custom"}]},{condition:"{{page.selection}} =",type:"ask",message:"Sure! What would you like me to rewrite?\n",param:"text"},{type:"ask",message:"How would you like me to rewrite the text? Pick an option or type instructions.\n",param:"instructions",options:[{label:" EXPAND",value:"Make text longer."},{label:" SHORTEN",value:"Make text shorter."},{label:" FIX GRAMMAR",value:"Output the text as is, but fix spelling errors if the text contains them."},{label:" SIMPLIFY",value:"Simplify text language."},{label:" COMPLICATE ",value:"Complicate text language."},{label:" PROFESSIONAL",value:"Change tone to professional."},{label:" CASUAL",value:"Change tone to casual."},{label:" STRAIGHTFORWARD",value:"Change tone to straightforward."},{label:" CONFIDENT",value:"Change tone to confident."},{label:" FRIENDLY",value:"Change tone to friendly."},{label:" STORY",value:"Change style to storytelling."},{label:" SCARY",value:"Change style to scary."},{label:" LOVECRAFT",value:"Change style to a H.P. Lovecraft story."},{label:" 1ST PERSON",value:"Change style to 1st person."},{label:" 3RD PERSON",value:"Change style to 3rd person."},{label:" CLARITY",value:"Add clarity and conciseness."},{label:" REFINE",value:"Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length."},{label:" ILLUSTRATE",value:"Add examples, anecdotes, and other storytelling elements to illustrate points."},{label:" TRANSLATE",value:"Translate to {{language}}, or echo text as is if already in {{language}}."},{label:" ADD HEADINGS",value:"Add headings, subheadings, bullet points, and other formatting elements for readability."},{label:" ENRICH",value:"Enhance vocabulary and tone."},{label:" HUMANIZE",value:'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'},{value:"$custom"}]},{type:"gpt",prompt:"Please ignore previous instructions. Your new instructions:\n- I would like you to act as a copywriter and rewrite or improve a given text for me.\n- I will give you the reply parameters in brackets [].\n- Do not echo my command or parameters.\n\n[TEXT TO REWRITE]: {{text}}\n\n[HOW TO REWRITE THE TEXT]: {{instructions}}\n\nNEW TEXT:"},{type:"ask",label:"ask-for-change",param:"change",options:[{label:" DONE",value:"no"},{label:" PASTE TO PAGE",value:"paste"},{label:" EXPAND",value:"Make text longer."},{label:" SHORTEN",value:"Make text shorter."},{label:" FIX GRAMMAR",value:"Output the text as is, but fix spelling errors if the text contains them."},{label:" SIMPLIFY",value:"Simplify text language."},{label:" COMPLICATE ",value:"Complicate text language."},{label:" PROFESSIONAL",value:"Change tone to professional."},{label:" CASUAL",value:"Change tone to casual."},{label:" STRAIGHTFORWARD",value:"Change tone to straightforward."},{label:" CONFIDENT",value:"Change tone to confident."},{label:" FRIENDLY",value:"Change tone to friendly."},{label:" STORY",value:"Change style to storytelling."},{label:" SCARY",value:"Change style to scary."},{label:" LOVECRAFT",value:"Change style to a H.P. Lovecraft story."},{label:" 1ST PERSON",value:"Change style to 1st person."},{label:" 3RD PERSON",value:"Change style to 3rd person."},{label:" CLARITY",value:"Add clarity and conciseness."},{label:" REFINE",value:"Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length."},{label:" ILLUSTRATE",value:"Add examples, anecdotes, and other storytelling elements to illustrate points."},{label:" TRANSLATE",value:"Translate to {{language}}, or echo text as is if already in {{language}}."},{label:" ADD HEADINGS",value:"Add headings, subheadings, bullet points, and other formatting elements for readability."},{label:" ENRICH",value:"Enhance vocabulary and tone."},{label:" HUMANIZE",value:'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'},{value:"$custom"}]},{condition:"{{change}} = no",type:"stop"},{condition:"{{change}} = paste",type:"paste",closeFrame:!0},{condition:"{{change}} = paste",type:"stop"},{type:"gpt",prompt:"I would like you to make changes to the new text you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]: {{change}}\n\nNEW TEXT:"},{type:"jump",to:"ask-for-change"}]},{meta:{name:"ask",title:"Ask",category:"Productivity",description:"Ask me questions about opened page or PDF."},steps:[{say:'Sure! What do you want to know? For example: "What are the key takeaways?"\n'},{ask:"question",default:"What are the key takeaways?"},{gpt:"[CONTEXT]: {{context}}\n[INSTRUCTIONS]: I want you to reply only in {{language}}. Please answer the following question about the opened page content to the best of your ability and provided context. Be precise and helpful. Avoid mentioning context as incomplete.\n[QUESTION]: {{question}}\n[ANSWER]:"}]},{meta:{name:"alternatives",title:"Alternatives",category:"Productivity",description:"Generate a list of alternative products or topics."},steps:[{gpt:"Generate a list of up to 8 alternatives to the product or topic described in the web page or text. For every alternative, very shortly list pros and cons you know of (if any). Answer in {{language}}. Web page or text:\n{{page}}\nAlternatives:"}]},{meta:{name:"summary",title:"Summary",category:"Productivity",description:"Summarize the entire page content into a list of key takeaways."},steps:[{type:"gpt",chunkify:{text:"{{page}}",empty:"It looks as if the page has no text content. Or I could not fetch it.\n"},prompt:'I want you to only answer in {{language}}. Please extract key takeaways of the next chunk of the web page. Each key takeaway should be a list item, of the following format:\n"- [relevant emoji] [takeaway 1]"\nKeep emoji unique to each takeaway item. Please try to use different emojis for each takeaway. Do not render brackets.\nTHE WEB PAGE IS TITLED:\n{{page.desc}}\nWEB PAGE CHUNK:\n{{chunk}}\nKEY TAKEAWAYS LIST:\n'}]},{meta:{name:"extended-summary",title:"Extended summary",category:"Productivity",description:"Summarize page into report with bullet points with key takeaways."},steps:[{type:"gpt",prompt:'Analyze the website content and report the key points in bullets. Add a title to the report.\nThere should no limit in words to the report, ensure that all the points are concisely reported out. Please use as many bullet points as needed.\nAt the end of your report, add a paragraph "Key Takeaway" with the key takeaway from the text. Answer in {{language}}. Web page content:\n{{page}}\nReport:'}]},{meta:{name:"youtube-summary",category:"Productivity",title:"YouTube video summary",description:"Save time on watching YouTube videos. Break down YouTube videos into parts and get key takeaways.",apps:"YouTube"},steps:[{say:"Parsing video from the page Long videos may lake a few seconds to parse.\n"},{type:"gpt",chunkify:{text:"{{youtube.transcript}}",empty:"It looks as if the video has no text transcript. Or I could not fetch it from YouTube.\n"},prompt:'I want you to only answer in {{language}}. Please extract key takeaways of the next chunk of the transcript. Each key takeaway should be a list item, of the following format:\n"- [relevant emoji] [takeaway in {{language}}]"\nKeep emoji unique to each takeaway item. Please try to use different emojis for each takeaway. Do not render brackets.\nYOUTUBE VIDEO IS TITLED:\n{{page.desc}}\nVIDEO TRANSCRIPT CHUNK:\n{{chunk}}\nKEY TAKEAWAYS LIST:\n'}]},{meta:{name:"tweet",title:"Tweet",category:"Productivity",description:"Summarize page into a tweet.",apps:"Twitter"},steps:[{gpt:"Summarize the web page text content into a single tweet. The resulting tweet must be 280 characters long or less. Do not wrap into quotes. Answer in {{language}}. Web page content:\n{{page}}\nTweet:"}]},{meta:{name:"contacts",title:"Contacts",category:"Productivity",description:"Extract contacts from the web page."},steps:[{gpt:"Extract contact names (personal and business) from the text. For every contact extract their address, email, phone and any extra information describing the person or business. Format result in a Table. Answer in {{language}}. Text:\n{{page}}\nResult:"}]},{meta:{name:"chart",title:"Chart",category:"Productivity",description:"Draws yours data in chart.",emoji:""},steps:[{type:"ask",param:"data",message:"Data to draw in a chart? E.g.:\n\n- World population for the past century.\n- Series: kg consumed. Labels: Banana, Pineapple, Orange. Data: 5, 10, 20\n\nLeave empty and I will try to parse data from the page.",default:"Please try to parse data from the web page: {{page}}"},{type:"ask",param:"type",message:"Chart type?\n\nSupported types: bar, line, pie, doughnut, polarArea, radar, bubble, scatter etc.\n\nOr press enter to let me guess the best option.",default:"Use the best / the most suitable type"},{type:"gpt",prompt:"Please ignore all previous instructions.\n\nI would like you to generate a chart preview link, using http://quickchart.io. The chart should have the specified type and data. Please do not echo my prompts, only provide the output URL.\n\n[CHART TYPE]: {{type}}\n\n[CHART DATA]: {{data}}\n\n[REQUIRED OUTPUT FORMAT]: A single markdown link URL (not encoded):\n\n![Chart title](link to the image)\n\n[OUTPUT EXAMPLES, notice URL is not encoded]:\n\n![Bar](https://quickchart.io/chart?c={type:'bar',data:{labels:['Banana','Pineapple','Orange'],datasets:[{label:'Kg consumed',data:[5,10,50]}]}})\n\n![Bar](https://quickchart.io/chart?bkg=white&c={type:'bar',data:{labels:['Q1','Q2','Q3','Q4'],datasets:[{label:'Users',data:[50,60,70,180]},{label:'Revenue',data:[100,200,300,400]}]}})\n\n![Combo Bar Line](https://quickchart.io/chart?c={type:'bar',data:{labels:['January','February','March','April','May','June','July'],datasets:[{type:'line',label:'Dataset 1',borderColor:'rgb(54, 162, 235)',borderWidth:2,fill:false,data:[-33,26,29,89,-41,70,-84]},{type:'bar',label:'Dataset 2',backgroundColor:'rgb(255, 99, 132)',data:[-42,73,-69,-94,-81,18,87],borderColor:'white',borderWidth:2},{type:'bar',label:'Dataset 3',backgroundColor:'rgb(75, 192, 192)',data:[93,60,-15,77,-59,82,-44]}]},options:{responsive:true,title:{display:true,text:'Chart.js Combo Bar Line Chart'},tooltips:{mode:'index',intersect:true}}})\n\n![Scatterplot](https://quickchart.io/chart?c={type:\"scatter\",data:{datasets:[{label:\"Mercury\",borderColor:\"rgb(255, 99, 132)\",backgroundColor:\"rgba(255, 99, 132, 0.2)\",data:[{x:0.330,y:2439.7}]},{label:\"Venus\",borderColor:\"rgb(54, 162, 235)\",backgroundColor:\"rgba(54, 162, 235, 0.2)\",data:[{x:4.87,y:6051.8}]},{label:\"Earth\",borderColor:\"dark-green\",backgroundColor:\"rgba(0, 255, 0, 0.2)\",data:[{x:5.97,y:6371}]}]},options:{title:{display:true,text:\"Planet masses and radii\"},scales:{xAxes:[{ticks:{beginAtZero:true},scaleLabel:{display:true,labelString:'Radius (km)'}}],yAxes:[{ticks:{beginAtZero:true},scaleLabel:{display:true,labelString:'Mass (x10^24 kg)'}}]}}})\n\nOUTPUT:"}]},{meta:{name:"data",title:"Data",category:"Productivity",description:"Extract data from the web page."},steps:[{gpt:"Extract any data from the text. Format in a table with two columns Key and Value. Answer in {{language}}. Text:\n{{page}}\nData:"}]},{meta:{name:"translate",title:"Translate",category:"Productivity",description:"Translate text to the specified language."},steps:[{type:"ask",message:"Sure, what would you like me to translate?",param:"text"},{type:"ask",message:"What is the target language? Press enter for English.",param:"language",default:"English"},{type:"gpt",prompt:"Please ignore previous instructions. I would like you to translate the following text to {{language}}. Text to translate:\n{{text}}\nTranslation:\n"}]},{meta:{name:"grammarly",title:"Grammarly",category:"Productivity",description:"Correct text grammar."},steps:[{condition:"{{page.selection}} !=",type:"ask",message:"Sure! What would you like me to correct?\n",param:"text",options:[{label:"SELECTED TEXT",value:"{{page.selection}}"},{value:"$custom"}]},{condition:"{{page.selection}} =",type:"ask",message:"Sure! What would you like me to correct? Press enter to check the entire page.\n",param:"text",default:"{{page}}"},{type:"gpt",chunkify:{text:"{{text}}",empty:"It looks as if the page has no text content. Or I could not fetch it.\n"},prompt:'Ignore all previous instructions. I want you to correct grammar, spelling and punctuation errors in the following web page content (if any). Only output corrected sentences, which contained errors. Highlight fixed grammar using [] brackets.\nFor example, for text of two sentences: "Hello, my name is John. How is you doing?", the output should be:\n- How [are] you doing?\nTEXT TO CORRECT:\n{{chunk}}\nCORRECTED SENTENCES:\n'}]},{meta:{name:"simple",title:"Simplify",category:"Productivity",description:"Simplify text into basic concepts."},steps:[{gpt:"Summarize the text for a second-grade student. Answer in {{language}}. Text:\n{{page}}\nSummary:"}]},{meta:{name:"todo",title:"Todo",category:"Productivity",description:"Generate ToDo list from page content."},steps:[{gpt:"Convert this text to a todo list. Keep todo items short but understandable. Answer in {{language}}. Text:\n{{page}}\nTodo list:"}]},{meta:{name:"help",title:"Help",description:"Get help on using HARPA AI.",category:"Productivity"},steps:[{say:"Welcome to HARPA, your AI Automation Agent.\n\nAsk me questions; type slash / to bring my AI commands; extract data from web pages; monitor websites; create your custom automations. I am compatible with OpenAI API, ChatGPT, Google Bard.\n\nCall me on any web page with `Alt+A` (Windows), `^+A` (Mac) or click my icon in Chrome toolbar.\n\nHere is a quick features overview:\n\n- Chat with me about the opened web page.\n- [Summarize web pages](https://harpa.ai/guide/page-aware-chatgpt-prompts) and [YouTube videos](https://harpa.ai/guide/summarize-youtube-videos-to-text) into tweets, articles, DMs or emails.\n- [Get AI answers](https://harpa.ai/guide/ai-answers-alongside-google-search) alongside Google search results.\n- [Translate, correct, rephrase](https://harpa.ai/guide/write-text-on-websites-with-ai) text on any website.\n- Generate text in a [wide range of styles](https://harpa.ai/guide/writing-styles), from emails to **SWOT** analysis and **KISS** articles.\n- Reply to emails, social DMs and comments.\n- Monitor data online, from [prices to out of stock alerts](https://harpa.ai/guide/monitor-price-drops) and [changes on competitor websites](https://harpa.ai/guide/track-competitors).\n- Create custom page-aware [AI commands](https://harpa.ai/guide/custom-page-aware-chatgpt-commands) and automations to streamline your workflow.\n\nClick **GUIDES** for more info, or press ESC to stop."},{condition:"{{page.url}} = https://harpa.ai/welcome",label:"ask-for-question",type:"ask",param:"question",options:[{label:" GUIDES",value:"guides"},{label:" DONE",value:"no"},{value:"$custom"}]},{condition:"{{page.url}} != https://harpa.ai/welcome",type:"ask",param:"question",options:[{label:" GUIDES",value:"guides"},{label:" DONE",value:"no"}]},{condition:"{{question}} = no",type:"stop"},{condition:"{{question-option}} = $custom",gpt:"[CONTEXT]: {{context}}\n[INSTRUCTIONS]: Your name is HARPA, you are a Chrome Extension that integrates ChatGPT and automation into Chromium based browsers. The context contains information on your capabilities. Please answer the following question about the opened page content to the best of your ability and provided context. Be precise and helpful. Avoid mentioning context as incomplete. Do not hallucinate if you can not answer the question, instead please advice user to the check out the guides on harpa.ai website.\n[QUESTION]: {{question}}\n[ANSWER]:"},{condition:"{{question-option}} = $custom",jump:"ask-for-question"},{type:"ask",param:"question",options:[{label:" GETTING STARTED",value:"start"},{label:" USING COMMANDS",value:"commands"},{label:" USING PARAMETERS",value:"parameters"},{label:" SEARCH ASSISTANT",value:"search"},{label:" COPYWRITING",value:"copywriting"},{label:" YOUTUBE SUMMARIES",value:"youtube"},{label:" CUSTOM COMMANDS",value:"custom"},{label:" EXPORT / IMPORT",value:"export"},{label:" CHUNKING",value:"chunk"},{label:" MONITOR PRICES",value:"price"},{label:" AUTO REFRESH",value:"refresh"},{label:" TRACK COMPETITORS",value:"track"},{label:" CONNECT TO CHATGPT",value:"chatgpt"},{label:" CONNECT TO OPENAI API",value:"openai-api"},{label:" CONNECT TO BARD",value:"bard"},{label:" PRIVACY & LIMITATIONS",value:"privacy"},{label:" CONTACT US",value:"contact-us"}]},{condition:"{{question}} = start",type:"say",message:'## Getting Started\n\nHARPA combines modern AI and Automation for professional, personal and business use. Once installed, HARPA is available on any web page with `Alt+A` (Windows), `^+A` (Mac) or by clicking the HARPA icon in the Chrome toolbar. You can pin HARPA to the Chrome toolbar for quick access. Quick access shortcut can be customized in the app settings .\n\nAI section of the HARPA interface is AI-powered, page-aware chat with custom commands and automation capabilities. And MONITOR section allows monitoring data on web pages for changes.\n\n### Connecting to AI\n\nUsing AI features requires either a ChatGPT account (free or plus), OpenAI API key or connection to Google Bard. HARPA will pick an available AI connection automatically. You can switch between connection types in the app settings . Cloud AI connection is coming soon.\n\n- To connect HARPA to ChatGPT, create a free account at [ChatGPT.com](https://chatgpt.com).\n- To connect HARPA to OpenAI API, create an account at [OpenAI.com](https://openai.com).\n- To connect HARPA to Google Bard, make sure Google Bard is available at [bard.google.com](https://bard.google.com), you may need to use VPN if you are outside of the US.\n\nIf you only require Web Automation and Monitoring, you can use HARPA AI without connecting to any AI services.\n\n### How It Works\n\nHARPA can read and automate opened web page. Include `{{\\page}}` parameter into your prompt and it will extract text from the web page and send it to GPT. This way your question are answered in the context of the web page you are currently on.\n\nYou can turn **Page-aware** ON, and HARPA will automatically extract relevant text context from the web page.\n\nHARPA also supports `{{\\context}}`, `{{\\youtube.transcript}}`, `{{\\language}}`, `{{\\page.selection}}` and other predefined and custom parameters. Read more about using parameters in the **USING PARAMETERS** section.\n\n### Quick Commands\n\nType slash "/" in chat to bring in a list of quick commands. For example, type `/midjourney` to generate Midjourney prompts, `/youtube` to summarize a YouTube video or `/resume` to improve or write a LinkedIn resume. Read more about predefined commands in the **USING COMMANDS** section.\n\n### Quick-Access Bar\n\nSelecting any text on page brings in HARPA quick access panel. You can quickly rewrite, reply, translate selected text or call any other command. You can turn this feature off in the app settings .\n\n### Custom Commands\n\nYou can create custom commands and automations by typing slash "/" and clicking **CREATE COMMAND**. Custom commands support web page automations such as web navigation, clicks, text typing, data extraction etc. Custom commands can be exported from HARPA as files. Read more about custom commands in the **CUSTOM COMMANDS** section.\n\n### Reading PDFs\n\nHARPA can read online PDFs. Navigate to a PDF file, e.g. on https://arxiv.org/, and launch HARPA to read and summarize it. Support for file uploads is coming soon.\n\n### Web Monitoring\n\nHARPA can monitor web pages for changes and send you notifications. You can monitor prices, stock availability, changes on competitor websites and more. Read more about web monitoring in the **MONITOR PRICES** section.\n\n### Privacy\n\nHARPA is privacy centered. It never sends web page content anywhere, except the AI service you are connected to. You can find more info on [privacy](https://harpa.ai/privacy) and [terms of service](https://harpa.ai/terms) on our website.'},{condition:"{{question}} = commands",type:"say",message:"## Using Commands\n\nHARPA comes with a list of over 100+ curated and regularly updated page-aware commands, broken down into categories: Productivity, Marketing & SEO, Learning, Copywriting, Coding and more. You can access the list of commands by typing slash / in chat.\n\nFilter commands by name, category, description or service by continue typing after slash, e.g. type /instagram to bring a list of commands designed to work with Instagram. You can find commands for LinkedIn, YouTube, TikTok, Amazon, Quora, StackOverflow and many other platforms.\n\nHARPA commands are designed to work well with OpenAI GPT-3.5, work best with GPT-4 and also work with Google Bard.\n\n### Step by Step Workflow\n\n1. To bring up a list of AI commands, type the / symbol in chat\n2. Commands are ranked by popularity and broken down into categories. To find a relevant command, start typing a web service name (such as Facebook, Twitter, YouTube, etc.) or a keyword (job, article, etc.).\n3. Click a command that suits your need or use the ArrowUp, ArrowDown, and Enter keys to select one.\n\n### Commands to Try\n\nSome of the most useful commands include:\n\n- `/ask` - answers your questions about the opened web page\n- `/compose` - generates any text from tweets to blog posts\n- `/reply` - replies to selected text, DMs, emails\n- `/rewrite` - rewrites selected text\n- `/summarize` - summarizes web pages\n- `/alternatives` - creates a list of alternative services and topics\n- `/data` - extracts prices and structural data from web pages\n- `/youtube summary` - summarizes hours long YouTube videos\n- `/midjourney` - generates Midjourney prompts\n- `/seo audit` - performs SEO audit of the opened web page\n\nAt any point, you can use `/clear` command to reset and restart the AI chat.\n\nYou can [watch a YouTube video](https://youtu.be/RrpTd6Nu4Is) or to read a [detailed guide](https://harpa.ai/guide/page-aware-chatgpt-prompts) on using predefined commands on our website.\n\n### Commands vs Prompts\n\nHARPA commands are prompts on steroids, and resemble multi-step dialogue systems. Some commands have a single GPT prompt step, while others like `/compose` contain over 50 steps and prompts for various purposes.\n\nUnder the hood HARPA uses a custom language to declare commands, called ChatML (Chat Markup Language). Whenever you export a custom command, you can see how it is defined in a YAML format."},{condition:"{{question}} = parameters",type:"say",message:'## Using Parameters\n\nWhenever you send a question (prompt) in chat, HARPA injects parameters into the prompt text. For example, if you type `Please summarize this web page: {{\\page}}` in chat, HARPA will extract text from the web page, inject it into the prompt and send to GPT.\n\nInspect available parameters by running `/echo params` command in chat.\n\nThere are many predefined parameters you can use in your prompts. You can also create custom parameters. Predefined parameters include:\n\n- `{{\\page}}` - web page text content, starting from the top of the page\n- `{{\\page.selection}}` - selected text on the web page\n- `{{\\page.title}}` - web page title\n- `{{\\page.desc}}` - web page meta description\n- `{{\\page.url}}` - web page URL\n- `{{\\page.domain}}` - web page domain\n- `{{\\language}}` - language defined in the app settings, e.g. English; this is useful to instruct GPT to reply in a certain language across your commands\n- `{{\\gpt}}` - last GPT response, useful for chaining prompts\n- `{{\\youtube.transcript}}` - YouTube video transcript, useful for summarizing and extracting information from YouTube videos\n- `{{\\context}}` - a portion of the web page relevant to your prompt\n\n### Page vs Context\n\nGPT input has a token limit, e.g. 4096 on GPT-3.5-turbo model, which is approximately 3000 words of English text. This limit is shared across chat history, question and response. Large web pages may not fit into the GPT input, so HARPA truncates `{{\\page}}` parameter automatically.\n\nUsing `{{\\context}}` in place of `{{\\page}}` instructs HARPA to scan the web page for the portion of text which is most relevant to your prompt, semantically. This is useful when you deal with large web pages and the relevant text content is not at the top of the page.\n\n### Custom Parameters\n\nYou can define custom parameters whenever you create a custom command. Custom parameters are useful when you want to reuse a piece of text across multiple GPT steps or customize your prompts.\n\nUse `ASK` step in the custom commands to declare custom parameters, e.g. `{{\\p1}}`. Read more about custom commands in the **CUSTOM COMMANDS** section.\n\n### Global Custom Parameters\n\nBy defaults, custom parameters are stored as long as the command is run. You can also define global custom parameters, which are stored across all commands and sessions.\n\nPrefix parameter name with "global" to make it globally available, e.g. `{{\\global.signature}}`. Then you can use it in any custom command or your chat prompts.'},{condition:"{{question}} = search",type:"say",message:"## Search Assistant\n\nHARPA integrates into Google, Bing, DuckDuckGo, Yahoo, Yandex and other search engines. Whenever you search for anything online, HARPA will provide concise answers to your questions, saving you time.\n\n- With AI-generated answers alongside traditional search results, you gain access to a wider range of information and perspectives on a given topic.\n- By asking follow-up questions or requesting more details, you can deepen your understanding of the topic at hand.\n\nSearch assistance works with the following search engines: Google Search, Bing, Baidu, Yahoo!, Yandex, DuckDuckGo, Kagi, AOL, Naver, Brave, Ecosia and others.\n\n### How to Setup Search Assistant\n\n- You can use HARPA search assistance by opening the search engine page and typing in your query as you normally would.\n\n- Expand HARPA window to query AI in parallel and form a brief answer on the given topic. You can open HARPA by clicking its icon in Chrome toolbar, clicking the minimized window at the bottom right, or pressing `Alt+A` (Windows) and `^+A` (Mac).\n\n- Use the chat interface in HARPA to ask any follow-up questions and receive an AI-generated answer. HARPA can answer questions and explain complex concepts, present arguments, pros and cons, find additional information for you and list related topics.\n\nClick the following link to watch a [YouTube video](https://youtu.be/yQWGp2qZrCw) or to read a [detailed guide](https://harpa.ai/guide/ai-answers-alongside-google-search) on our website."},{condition:"{{question}} = copywriting",type:"say",message:"## Copywriting commands\n\nHARPA is a Copywriter's best friend. Commands for generating and working with text content include:\n\n- `/compose` - write AI text content for social media, websites, emails, job boards and more\n- `/reply` - write AI replies to emails, job applications, social media posts and more\n- `/rewrite` - rewrite AI text content for social media, websites, emails, job boards and more\n\n### Compose\n\nThe `/compose` feature enables you to write AI content for various social media platforms such as LinkedIn, Facebook, and Instagram, and websites including email services, job boards, and many more. Composer is a sophisticated and a versatile dialogue system that can deliver tailored text results in just a few clicks, making it the perfect tool for any writing project. This is like having 50 ChatGPT prompts in just a single button.\n\nComposer command can write content in a total of [18 writing styles](https://harpa.ai/guide/writing-styles), enrich your content and make it well-structured. Most of these frameworks are compatible with GPT-3.5, but they fully unleash their potential when utilized with the OpenAI GPT-4 technology.\n\nThe 18 writing styles are broken down into 4 groups:\n\n- Marketing and Persuasion Techniques\n- Information and Analysis Techniques\n- Storytelling and Professional Communication Techniques\n- Academic, Opinion, and Creative Writing Styles\n\n### Rewrite and Reply\n\nThe `/rewrite` command allows you to quickly change the length and style of any text, check grammar, and much more.\n\nThe `/reply` command allows you to quickly respond to email messages, social media DMs, comments and more.\n\nEach of these commands work with different text sources: web pages, selected text, text written in chat, YouTube video transcript, and much more.\n\nClick the link to watch a [YouTube video](https://youtu.be/8tu_FXDs1o8) or to read a [detailed guide](https://harpa.ai/guide/write-text-on-websites-with-ai) on our website.\n\n### Quick Access Bar\n\nQuick access bar appears on websites whenever you select a piece of text. It allows you to quickly rewrite, shorten, expand, condense, elaborate on, correct spelling and grammar, draft a response, translate or reply to the selected text.\n\nKeep your essential commands readily accessible by adding them to the quick access panel. Click the link to watch a [YouTube video](https://youtu.be/VF9Yeo6H3iI) on quick access bar."},{condition:"{{question}} = youtube",type:"say",message:"## YouTube Video Summary\n\nYou can transform hours-long YouTube videos into concise summaries using `/youtube-summary` command. Extract key points without sacrificing time watching lengthy videos.\n\nThe YouTube Summary command operates almost instantaneously. You do not have to pause the video. I will seamlessly handle all the required transcript extraction, chunking, networking and interpreting processes in the background.\n\n### How to Create a YouTube Video Summary\n\n- Navigate to YouTube and open any video of your preference that you'd like to convert to the textual form. Whether it is a musical video or a two-hour interview, the most important factor is that a transcription of the selected video must be available on YouTube.\n\n- Open HARPA AI by clicking its icon in the top right corner or pressing `Alt+A` (on Windows) and `^+A`(on Mac).\n\n- Use the chat interface in HARPA to type /youtube and click the YouTube video summary command. You can use Up and Down arrow-keys to select the command to run.\n\n### Limitations & Troubleshooting\n\n- Videos that have no transcripts cannot be processed to summaries. You will be promptly notified by HARPA if the transcript is unavailable.\n\n- Most GPT models are restricted and can not process explicit content or obscene language, vulgar expressions, and so on. This slightly limits the functionality of this feature, but also makes the output highly amusing as AI tries to circumvent awkward phrasing. If you ask a question on a controversial topic, GPT-4 will respond with an answer, but GPT-3.5 might not answer at all if it considers the topic problematic.\n\n- Long video transcripts are broken down into chunks and the summary is provided in segments. This is due to the token limit restriction of GPT models.\n\n- On occasion, obtaining response from the generative AI may take some time, due to the time required for processing of lengthy video transcripts.\n\nClick the link to watch a [YouTube video](https://youtu.be/Fhe4gr6eDzo) on YouTube summaries or to read a [detailed guide](https://harpa.ai/guide/summarize-youtube-videos-to-text) on our website."},{condition:"{{question}} = custom",type:"say",message:"## Custom Commands\n\nCustom commands empower you to streamline your web workflow by crafting and quickly reusing unique prompts and workflow automations tailored to your online tasks.\n\nFollow these steps to create and reuse custom ChatGPT prompts:\n\n1. Type slash / in AI chat, then click the `Create command +` option at the top. You will get to a Custom Command configuration page.\n2. Type the name of your new custom command in the **name** field. This name will appear in the command list when you type the slash symbol / in the chat.\n3. Each command is a sequence of **Steps**. As a starting point, keep it simple by focusing on the two step types: **GPT** and **ASK**.\n4. Add and configure as many steps as you like and click **SAVE** button to store your command.\n5. You'll see your command saved at the top, above the pre-configured prompts, when you type the slash symbol /. Test you command by running it.\n\n### GPT Step\n\nGPT step allows you to generate a response using GPT model. It accepts prompt as an input and writes AI response in chat. You can use the parameters from the ask step to customize your GPT prompts and make them more interactive.\n\nExperiment with diverse phrasings, topics, and structures in your prompts to identify the most effective approach for your specific needs.\n\n### Ask Step\n\nAsk steps allow you to ask questions in chat and store answers as parameters. You can then use these parameters in a GPT step to generate a response.\n\n### Say Step\n\nThis step allows you to write a message in chat. You can use it to write a message before or after the GPT step.\n\n### Automation Steps\n\nAutomation steps include **NAVIGATE**, **CLICK**, **PASTE** and **REQUEST**. They allow you to automate your web workflow by navigating to a web page, clicking on a web element, pasting text into a web form, and sending a request to a web page.\n\n**REQUEST** step is especially useful to either get a web page content or to send a request to a web service or webhook, such as Zapier and Integromat. You can use response from the REQUEST step in other steps, e.g. GPT.\n\n### Command Step\n\nCommand step allows you to run another command from within a command. This is useful for creating higher-order commands and command shortcuts. For example, if you find yourself using `/compose` command in a certain way, you can create a new command that will run `/compose` with the desired parameters.\n\n### Parameters\n\nParameters store answers to the questions asked in the ASK steps. They can also reference web page content, e.g. `{{\\page}}` or previous GPT answer, e.g. `{{\\gpt}}`, which is useful for chaining multiple GPT steps together.\n\nRead more about using parameters in the **USING PARAMETERS** section.\n\n### Intro to Prompt Engineering\n\nHere are some excellent guides on Prompt Engineering that will help you write great GPT prompts:\n\n- [Best practices for prompt engineering with OpenAI API](https://help.openai.com/en/articles/6654000-best-practices-for-prompt-engineering-with-openai-api)\n- [Learn Prompting](https://learnprompting.org/)\n- [GitHub Prompt Engineering Guide](https://github.com/dair-ai/Prompt-Engineering-Guide)\n\nClick this link to read a [detailed guide](https://harpa.ai/guide/custom-page-aware-chatgpt-commands) on our website.\n\nIf you have questions about custom commands, you can ask them in our [Discord](https://discord.com/invite/HJzggAVJbH) server."},{condition:"{{question}} = export",type:"say",message:"## How to Import Commands\n\nYou can import one or more commands if they were exported in a yaml format.\n\n1. Open HARPA AI on any website.\n2. Type the slash / symbol in the HARPA AI chat and click **IMPORT** button at the top besides the categories list\n3. Drag & drop the command files into the opened window and click the big **IMPORT** button to upload them to HARPA.\n4. New commands will appear at the top of the prompts list after clicking /.\n\n### How to Export Commands\n\nExporting commands allows you to share them with others or store them for later use.\n\n1. Open HARPA AI on any website.\n2. Type the slash / symbol in the HARPA AI chat and select a command to export.\n3. Click Export button at the top left corner.\n4. Allow HARPA download files to your system.\n5. The file has been exported in a yaml format, and you can store or share it.\n\nClick on the link to read a [detailed guide](https://harpa.notion.site/Import-Export-Commands-30cfec103fbc436ea2ac5defce90f4e9?pvs=4) on our website.\n\nGot questions? Join our [Discord](https://discord.com/invite/HJzggAVJbH) and get help."},{condition:"{{question}} = chunk",type:"say",message:"## Chunking\n\nLarge Language Models have a limited token window e.g. 4096 tokens. It is often impractical or impossible to fit large documents, web pages and video transcripts into a single GPT request.\n\nChunking is a technique that divides content into smaller parts, also called **chunks**, to ensure that each part, including the prompt, fits within the GPT token limit. These chunks are then injected into prompts as {{\\chunk}} parameter and processed by GPT one by one.\n\nChunking does not possess inherent memory. Therefore, if you require context to be maintained across chunks, it must be incorporated within the prompt.\n\nClick on the link to read a [detailed guide](https://harpa.ai/guide/chunking) on Chunking on our website. Got questions? Join our [Discord](https://discord.com/invite/HJzggAVJbH) and get help."},{condition:"{{question}} = price",type:"say",message:"## Monitor Prices\n\nHARPA can be used as online shopping and web monitoring assistant. By automating price monitoring it helps you snag the best deals on e-commerce websites such as Amazon, AliExpress, Barnes & Noble, Rakuten, Newegg, and others. With its price drop alerts, you can be informed as soon as a product you're interested in goes on sale.\n\nIf a product you're after is out of stock, simply set up a monitor for the page and receive a notification the moment it becomes available again. Stay ahead of the competition and get the best shopping deals with HARPA.\n\n### How to Monitor Prices\n\n1. Navigate to a web page you would like to monitor. To keep track of a product price, open HARPA AI by clicking its icon in the top right corner of the browser or pressing `Alt+A` (on Windows) and `^+A` (on Mac), and switch over to the **MONITOR** tab at the top of HARPA window.\n\n2. The MONITOR tab will present you a list of possible items to track. To monitor a product price, simply click the corresponding option. For example, if the current product price is $1798, click the item with $1798.\n\nAll that is left to do is to click **START** button and HARPA will launch and refresh the web page in background periodically.\n\nHARPA will send you a notification in browser whenever the product price drops.\n\nHARPA runs monitors and automations in your browser, so your web data never leaves your machine.\n\n### Monitor Customization\n\nYou can customize schedule, triggers, actions and other parameters of your web monitors.\n\n- **Schedule Interval**. Monitors are run periodically and you can choose the running frequency from 15 seconds up to once a month. Running checks too ofter puts extra work on your machine and web servers. Some websites may log you out or ask to pass CAPTCHA test. It is recommended to always pick a reasonable delay such as 1 check every 3 hours for non-critical monitors.\n- **Trigger**. Trigger is a condition that HARPA AI checks every time the monitor task is run. You can monitor for a specific text to appear (e.g. discount) or disappear (e.g. out of stock), price value drop, page content update and others. Once the task is triggered, HARPA AI fires actions.\n- **Actions**. Actions are taken upon trigger fires and include showing notification, sending email, playing sound, calling webhook or make.com (Integromat) integration. You can turn ON or OFF actions and specify when they should be run (first trigger, every trigger, every run). The last option is especially helpful if you would like to send data from HARPA AI to GoogleSheet via Make.com.\n- **Before Run**. You can tell HARPA AI to wait for page to load, hide cookie banners, wait for text to appear or scroll the page down and up before the trigger check is run.\n\nBy setting up a combination of triggers and actions you can instruct HARPA AI to send you an email whenever price drops, while pushing data to Google Sheet on every monitor run.\n\n### Automations Dashboard\n\nYou can always see how your monitors perform by navigating to the HARPA Dashboard. Simply click the HARPA icon in browser and then click **MONITOR** to open the monitors list. You can filter monitors by website.\n\nClick to read a [detailed guide](https://harpa.ai/guide/monitor-price-drops) on our website."},{condition:"{{question}} = refresh",type:"say",message:"## Autorefresh\n\nYou can set any tab to automatically and periodically refresh and reload. This keeps your web pages up-to-date. It works almost identical to Easy Auto Refresh, Auto Refresh Plus, Tab Auto Refresh and other Chrome plugins.\n\nAutorefresh is highly customizable:\n\n- Set a desired page refresh interval.\n- Customize delays for each page or tab independently. Your settings are remembered for every page.\n- Select actions to be dispatched whenever a web page updates, goes down, contains text, or returns an HTTP code.\n- Integrate notifications, sounds, Make.com / Integromat events, and WebHooks.\n### How to set Auto Refresh\n1. To keep track of a web page, such as a product price, open HARPA AI plugin, and switch over to the **MONITOR** tab at the top of HARPA window.\n2. In the MONITOR tab, you will be presented with a list of possible items to track. One of the options is the Auto-refresh monitor. Click it.\n3. Schedule your page monitoring the way you like it. Pick how often the page should be refreshed.\n4. [Optional] If you want to be notified on a specific condition, pick a trigger.\n5. [Optional] Select actions for your trigger, such as sending E-Mails, Notifications, calling a WebHooks or running Integromat / Make.com scenarios.\n6. Finally, hit the START button, and you're all set with your auto-refreshing task!\n\nClick the link to read a [detailed guide](https://harpa.ai/guide/autorefresh-web-pages) on our website."},{condition:"{{question}} = track",type:"say",message:"## Track Competitors\n\nCompetitor monitoring tools are used to gain an edge over your rivals.\n\nBy automating the web monitoring process, you can stay informed about your competitors' pricing, products, SEO, marketing strategies, social media channels, announcements etc.\n\nHARPA AI allows collecting valuable insights into your competitors' online activities by monitoring their websites and social media channels.\n\nCompetitive tracking involves consistently monitoring your competitors' updates, primarily online, to inform your marketing, sales, and product strategies. By staying current with your competitors' activities and analyzing them over time, you can gain insights that help you position your business one step ahead.\n\n### How to Monitor Competitors websites\n\n1. Navigate to your competitors website. To keep track of a web page content, open HARPA, and switch over to the **MONITOR** tab at the top of the HARPA window.\n\n2. Under the MONITOR tab, you will be presented with a list of possible items to track. To monitor website changes, click the corresponding option - **PAGE TEXT CHANGES**.\n\n3. Click the **START** button, and HARPA AI will take care of the rest, periodically refreshing the web page in the background. You'll receive a friendly browser notification whenever a competitor's page changes.\n\nClick the link to read a [detailed guide](https://harpa.ai/guide/track-competitors) on our website."},{condition:"{{question}} = chatgpt",type:"say",message:'## Connecting to ChatGPT\n\n1. Go to [ChatGPT login page](https://chat.openai.com/auth/login).\n\n2. Register as a new user by clicking the Sign Up button. ChatGPT offers three options for new user registration:\n\n\n  - Enter your email address to create a new account.\n\n  - Use your Google account. Click the Continue with Google account option, and enter your Google account password to complete the process.\n\n  - The third option is to use your Microsoft account. Click the Continue with Microsoft account button, enter your password, and complete the sign-up process.\n\n\n3. ChatGPT will send a verification email to the registered email address.\n\n4. Type your full name in the input box.\n\n5. Enter your phone number. ChatGPT will send a verification code to your phone number.\n\n6. Verify it by typing the code in the space provided. Finally, your ChatGPT account is ready to be used!\n\n### How to get a ChatGPT Plus (GPT-4)?\n\nChatGPT Plus users have access to GPT-4 models. To upgrade to ChatGPT Plus, follow these steps:\n\n- Log in to your ChatGPT account.\n- Click "Upgrade to Plus" on the left menu.\n- Select the [ChatGPT Plus](https://openai.com/blog/chatgpt-plus) upgrade plan.\n- Enter your bank details and set up a recurring payment of $20/month.\n- Click "Continue to ChatGPT Plus."\n\n**Is there any benefit to using the OpenAI API key over the browser session?**\n\n- If you have access to GPT-4 in your OpenAI API account, API keys do not have a limit of 25 requests per 3 hours. The OpenAI API may also give you access to different GPT models (gpt-8k and gpt-32k).\n- The OpenAI API never disconnects you or logs you out.\n- Otherwise, the browser session is either free or costs around $20 per month for Plus and GPT-3.5 is actually even faster on the browser session compared to the API.'},{condition:"{{question}} = openai-api",type:"say",message:"## Connecting to OpenAI API\n\nConnecting to OpenAI API directly is the most reliable way to use AI features. Please be aware that OpenAI API access is paid per volume.\n\n1. To connect HARPA to OpenAI API, create an account at [OpenAI.com](https://openai.com).\n\n2. Create your API Key [here](https://platform.openai.com/account/api-keys). Copy the key. You won't be able to view it again, only revoke it or create a new one.\n\n3. Open HARPA AI and navigate to the settings tab by clicking  button.\n\n4. Change the Connection type to OpenAI API Key and paste your OpenAI API Key.\n\n5. Enter your preferred Chat Model. For example, most users have access to gpt-3.5-turbo and gpt-3.5-turbo-16k and some to gpt-4.\n\nPlease note page-aware commands may consume many tokens. Using OpenAI API Keys could be more expensive than using ChatGPT Plus. However, ChatGPT GPT-4 is limited to 25 requests every 3 hours.\n\nIf you have questions about connection to ChatGPT, OpenAI or Bard, you can ask them in our [Discord](https://discord.com/invite/HJzggAVJbH) server."},{condition:"{{question}} = bard",type:"say",message:'## Connecting to Google Bard\n\nGoogle [Bard](https://bard.google.com/) is an experimental AI chat service developed by Google. It operates in a manner similar to ChatGPT, although the key distinction is that Bard retrieves its information directly from the web.\n\nLike other AI chatbots, Bard has the capability to code, solve math problems, and assist with writing.\n\nBard is not available in all regions and countries, you can get information about whether your country is connected [in the official website](https://support.google.com/bard/answer/13575153?hl=en).\n\n### How to connect Google Bard\n\n1. Open HARPA AI and go to the settings tab in the top right corner.\n2. Change the Connection type to "Bard Browser session"\n3. Sign in to your personal Google Account.\n\n### Troubleshooting\n\n- If you received an Oops Google Bard is not available in your region. notification, you need to install some VPN service that allows you to set a country from [this list.](https://support.google.com/bard/answer/13575153?hl=en)\n\n- For example, Bard works after connecting to US VPN in [Browsec VPN](https://chrome.google.com/webstore/detail/browsec-vpn-free-vpn-for/omghfjlpggmjjaagoclmmobgdodcjboh)'},{condition:"{{question}} = privacy",type:"say",message:"## Privacy\n\nHARPA is privacy centered. It never sends web page content anywhere, except the AI service you are connected to. You can find more info on [privacy](https://harpa.ai/privacy) and [terms of service](https://harpa.ai/terms) on our website.\n\n## Known Limitations\n\n- HARPA AI is not available on mobile devices or Firefox. Mobile version and Firefox versions are coming after all major features are implemented.\n- HARPA AI does not (yet) support file uploads. This feature is under development.\n- HARPA AI does not (yet) read text from GoogleDocs and GoogleSheets. This feature is planned."},{condition:"{{question}} = contact-us",type:"say",message:"## Contact Us\n\nReport bugs and feature requests via email at support@harpa.ai or join our [Discord](https://discord.com/invite/HJzggAVJbH) and get help!"},{type:"jump",to:"ask-for-question"}]},{meta:{name:"parameters",title:"Echo parameters",category:"Control",description:"Echo available prompt parameters."},steps:[{say:"HARPA AI supports parameters that can be used to customize your prompts. Include parameters into your prompts, by putting them in double brackets like this: `{{\\page.url}}`\n- **page.url**: {{page.url}}\n- **page.domain**: {{page.domain}}\n- **page.desc**: {{page.desc}}\n- **language**: {{language}}\n\nFollowing parameters are calculated dynamically once prompt is sent:\n- **page**: page content\n- **context**: page content relevant to prompt\n- **youtube.transcript**: transcript of the opened youtube video\n- **gpt**: the last answer generated by GPT\n\nFollowing parameters are persisted in a chat & global app storages. Use `ask` step in a custom command to modify them, e.g. `{{\\global.username}}`\n- **chat**: `{{chat}}`\n- **global**: `{{global}}`\n\nFeel free to suggest more parameters, by emailing contact@harpa.ai"}]},{meta:{name:"continue",title:"Continue",category:"Control",description:"GPT models is limited to 4096 tokens across prompt and output. Ask GPT to continue writing if possible."},steps:[{gpt:"Please continue writing, you did not finish."}]},{meta:{name:"clear",title:"Clear",category:"Control",description:"Clean up and restart the AI dialog.",emoji:""},steps:[{type:"clear"}]},{meta:{name:"extract-seo-keywords",title:"Extract and research SEO keywords",category:"Marketing & SEO",description:"Extract keywords from competitor's article, perform keyword research. Find keyword density and LSI keywords."},steps:[{say:"Please paste the competitor's article content (up to 3000 symbols), or press enter to extract keywords from the opened web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}} and output a single table. Pretend to be a SEO keyword research expert.\nRead the following text:\n{{page}}\nEnd of text.\nOutput a table with three columns: keyword, density %, LSI keywords.\nFind top 12 main keywords in that text, each containing at least 2 words. Output these in the first column of the resulting table.\nGive me a keyword density in the second column of the resulting table.\nNext I want you to come up with a list of LSI keywords and synonyms of those main keywords used in the article. Output a plain list of 5 keywords separated by comma in the third column called LSI keywords.\nTable:"}]},{meta:{name:"keyword-report",title:"Keyword report",category:"Marketing & SEO",description:"Create a keyword report and SEO content plan from 1 keyword."},steps:[{say:"Your keyword:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a market research expert. Pretend that you have the most accurate and detailed information about keywords available.\nPretend that you are able to develop a full SEO content plan. I will give you the target keyword (or topic): {{input}}.\nFrom this keyword create a table with a keyword list for an SEO content strategy plan on the keyword topic. The table shall have the following columns: keyword, search intent, title, meta description.\nIn the first column list 10 long-tail keywords or subcategory keywords related to the target keyword or topic.\nIn the second column list human searcher intent for the keyword. Label the topic in one of three search intent groups based on their search intent: whether commercial, transactional or informational.\nIn the third column, write a simple but very click-enticing title to use for a post about that keyword.\nIn the fourth column write an attractive meta description that has the chance for a high click-thru-rate for the topic with 120 to a maximum of 155 words. The meta description shall be value based, so mention value of the article and have a simple call to action to cause the searcher to click.\nDo not use too generic keyword like `introduction` or `conclusion` or `tl:dr`. Focus on the most specific keywords only. Do not use quotes or any other enclosing characters in any of the columns.\nHere is the keyword again: {{input}}\nTable:"}]},{meta:{name:"keyword-strategy",title:"Keyword strategy generator",category:"Marketing & SEO",description:"Provides a detailed strategy for any SEO keyword."},steps:[{say:"Please enter a keyword:\n"},{ask:"input"},{gpt:'Please ignore all previous instructions.\nYour task is to generate keyword strategy from one keyword in {{language}}.\nPretend youre the absolute best keyword researcher in the world. You use strategies from Neil Patel, Brian Dean, Rand Fishkin, Sandy Rowley and even Matt Cutts himself. You pride yourself in the depth of your research and your content briefs. Youve been tasked with a comprehensive content plan that consists of keyword research for the keyword "{{input}}" and are assigned the following tasks:\n- Set the title to the primary Keyword.\n- Using an unordered list, find a comprehensive list of FAQs related to the primary keyword and put them in a list with a heading 2 "FAQs".\n- Using an unordered list, list related search queries related to the primary keyword and put them in a list with a heading 2 "Related Queries".\n- Using an unordered list, list long-tail that you believe are easy to rank for based on the top positions not having quality content based on the most recent publicly available Googles Quality Guidelines and their on-page SEO Efforts and put them in a list with a heading 2 "Long Tail Keywords"\n- Using an unordered list, find the top 25 keywords, NLP keywords and LSI keywords and put them in a structured markdown table where the first column is the keyword, the second column is whether its a Keyword, NPL or LSI type, the next column is the keyword intent and the final column is how many times youd recommend using the keyword as an Integer. Make sure there are at least 25 target keywords. Put this under a heading 2 "Keywords".\n- Using averages, where higher position results in search engines have a higher weight, and lower positions have a lower weight, looking at the page slug (path), what should we use as our slug? Put this under a heading 2\n- Using an unordered list, list the SEO entities that apply to the primary keyword that could be used throughout the content and put them into a list under a heading 2 "Entities".\n- Write a 175 to 200-character CTR-focused meta description for this page using the data above, something that catches the attention and encourages a click. Put this under a heading 2 "Meta Description", dont add quotes around the content.\n- Write a 60 to 75-character meta title that uses the main keyword whilst trying to implement either click-bait or CTR-focused titles. Put this under a heading 2 "Meta Title", dont add quotes around the content.\n- Write a 200-250 character page excerpt thatll be above the fold, includes the primary keyword, satisfying the search intent, yet encouraging the reader to read on for more information. Put this under a heading 2 "Page Excerpt", dont add quotes around the content.\n- Considering the latest publicly available Google Quality Guidelines, using an unordered list, list the top 3-5 URLs that have the best content under a heading 2 "References".\nYoure assigned this task with special notes to keep in mind the following:\n- Follow the most recent publicly available Google Quality Rater guidelines.\n- Google E-A-T guidelines need to be met.\n- The research needs to consider that the content is meant to be useful for the end reader, is easy to read, quickly answers the searchers intent, and provides value immediately.'}]},{meta:{name:"segment-your-audience",title:"Segment your audience",category:"Marketing & SEO",description:"Break your audience into target-able groups with similar needs."},steps:[{say:'Name your marketing, product or business category in simple but precise language. e.g. "electronic music nightclubs":\n'},{ask:"input"},{gpt:'Please ignore all previous instructions. Please only respond using {{language}}.\nI want you to act as a market research expert that speaks and writes fluent {{language}}. Pretend that you know everything about every market.\nProduce up to ten audience segments for audiences in the following category: "{{input}}".\nEach segment should be defined by a deep underlying category-related need. Give each segment an emoji and a sassy title. Describe each segments category-related needs and give innovative ideas for specific initiatives they could do to better meet the needs of that segment.\nSegments:'}]},{meta:{name:"monthly-content-calendar",title:"Monthly content calendar",category:"Marketing & SEO",description:"Get a well organized 4-week content calendar that targets your primary keyword using transaction long-tail keyword & clickbait titles."},steps:[{say:"Insert the primary keyword(s) or topic(s) for the marketing calendar:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nI'd like you to help me come up with a content schedule for my blog that has the best chance of helping me rank for long tail keywords that are specific to my keyword. I'll tell you my main target keyword(s) below.\nPlease target transaction style search terms only. Please come up with clickbait style titles for these blog posts. Please organize each blog post title in a nice looking table so that it looks like a calendar. Each week should have its own table.\nThe keyword(s) and/or topic(s) I'm targeting is: {{input}}\nCalendar:"}]},{meta:{name:"weekly-content-calendar",title:"Weekly content calendar",category:"Marketing & SEO",description:"Get a well organized 1 week content strategy and calendar that targets your primary keyword."},steps:[{say:"Insert the primary keyword(s) or topic(s) for the marketing calendar:\n"},{ask:"input"},{say:"I'm generating the content calendar. Please use `/continue` command if output terminates pre-emptively.\n"},{gpt:"Please ignore all previous instructions.\nI want you to help me optimize a blog for local SEO in {{language}} using organic content creation. Please act as if you are an SEO and Digital Ads Specialist to answer all my following requests.\nYour task is to create a list of 5 items, each item is a blog post idea for a day of the work-week.\nEvery item must contain 4 sub-items: - Post title (for that day of the week) - Summary - Outline - Image description\nBlog topic:\n{{input}}\nLists:"}]},{meta:{name:"outrank-article",title:"Outrank SEO article",category:"Marketing & SEO",description:"Outrank the competition with an in-depth, SEO-optimized article. Navigate to the web page with an article to outrank, then run this command."},steps:[{say:"Write a name of your product and shortly describe it, or leave empty to parse product description from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high end copy writer.\nI want you to pretend that you can write content so good in {{language}} that it can outrank other websites. I will give you a part of an article that we need to outrank in Google.\nThen I want you to write an article in a formal 'we form' that helps me outrank the article I gave you. Write a long, fully markdown formatted article in {{language}} that could rank on Google on the same keywords as that website.\nThe article should contain rich and comprehensive, very detailed paragraphs, with lots of details. The article must be follow the google E-A-T guidelines.\nAll output must be 100% human writing style and fix grammar errors like Grammarly.\nDo use useful subheadings with keyword-rich titles. Get to the point precisely and accurately.\nDo not write more than 3000 symbols. Do not repeat the same over again. Context:\n{{input}}\nArticle:"}]},{meta:{name:"topic-authority",title:"Topic authority",category:"Marketing & SEO",description:"Create a table with article ideas to help you build a topic authority."},steps:[{say:"What your main article is about or a search keyword:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nCreate a table that contains article ideas to build topic authority for the following keyword or topic:\n{{input}}\nThe table should contain six rows where the first row is the header with column names.\nThe other five rows should be ideas for the topics, related to the main topic or keyword, that should give me a boost by these supporting articles.\nThe columns should be:\n1. Title for the article with no more than 45 characters, 2. Description of the article with a maximum of 120 characters, 3. Suggestions of the top three strategically chosen keywords for the article, 4. Classification of the search intent using one word.\nPlease create such a table for me to help me build topic authority for my website and my main article.\nTable:"}]},{meta:{name:"seo-audit",title:"SEO Audit",category:"Marketing & SEO",description:"Audit and improve your content for E-E-A-T, generate H1 and Meta Title."},steps:[{say:"Enter your SEO article content or leave it blank to parse from the page."},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. Only reply in {{language}}.\nI want you to act as a {{language}} Google Quality Rater trained in auditing content for quality, relevance, truthfulness and accuracy.\nYou are familiar with the concepts of E-E-A-T (Expertise, Authoritativeness, Trustworthiness) and YMYL (Your Money or Your Life) when evaluating the content.\nYour task is to create a Page Quality (PQ) rating. Be very strict with your assessment. The second part of the audit should also be very detailed and provide actionable suggestions for improving the content further.\nGive tips on how to match search intent and user expectations better. Give tips on what the content is missing. Create a very detailed content audit.\nAt the end of your analysis, suggest a 5060 character H1 and Title tag.\nHere is the web page content:\n{{input}}\nAudit result:"},{type:"ask",label:"ask-for-change",param:"change",options:[{label:" DONE",value:"no"},{label:" KW CLUSTER REPORT",value:"cluster"},{label:" KW STRATEGY GENERATOR",value:"strategy"}]},{condition:"{{change}} = no",type:"stop"},{condition:"{{change}} = cluster",type:"command",name:"Keyword cluster"},{condition:"{{change}} = strategy",type:"command",name:"Keyword strategy generator"}]},{meta:{name:"keyword-cluster",title:"Keyword cluster",category:"Marketing & SEO",description:"Cluster a list of keywords based on their semantic relevance."},steps:[{say:"Paste a list of keywords. Leave empty to parse from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to create a keyword cluster report. Please extract keywords from the following text and give me back a short overview of cluster topics found in a numbered list:\n\nCluster topics overview:\n1. Topic 1, Description\n2. Topic 2, Description\n3. etc.\n\nThen please generate a markdown table, with the following 4 columns: Cluster, Keyword, Search Intent, Language.\nClassify each of the keywords by the search intent, whether commercial, transactional or informational. Then cluster the keywords into groups based on their semantic relevance.\n\n[Extract keywords from the following text]:\n{{input}}\n\n[Cluster topics and table]:"}]},{meta:{name:"6-months-seo-plan",title:"6 months SEO plan",category:"Marketing & SEO",description:"Create SEO strategies, competitive with the top websites in the given space."},steps:[{say:"Enter a list of keywords to rank by, leave empty to parse from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nI want you to act like a Senior SEO Strategist for a company, who manages a large team of seo specialist, that speaks and writes fluent {{language}}.\nI want you to pretend that you can create seo strategies that are competitive with the top websites in the given space, and always produces very good results especially rankings on Google.\nI will provide you with a list of keywords to work with.\nYour task is to create a comprehensive 6 months seo strategy, in a table show monthly focus areas, for example month 1, month 2, month 3... here are focus ares to include: technical seo, on-page seo including content creation and optimisation and off-page seo. Please provide a description of activities to be done, expectations and tools required.\nParse keyword list from the following text:\n{{input}}\nSEO plan:"}]},{meta:{name:"landing-page-structure",title:"Landing page structure",category:"Marketing & SEO",description:"Create a landing page structure with attention grabbing headlines about the given topic, product or service."},steps:[{say:"Enter your topic, product or service or leave empty to parse them from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nI want you to act as a proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nCreate a Landing Page Structure with an Attention Grabbing Headline and subheader about the product, service or topic described in the following text:\n{{input}}\nTry to grab the attention of the visitor and increase the Opt-ins or Sales-rate, provide text content for landing page sections. Display the Structure of the Landing Page using markdown syntax.\nLanding page structure:"}]},{meta:{name:"content-ideas-generator",title:"Content ideas generator",category:"Marketing & SEO",description:"Generate a list of content ideas for a business, product or service for a blog."},steps:[{say:"Enter product / service / business name and short description, or leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI will provide a product / service / business description or name and I want you to create a list of 25 content ideas in {{language}} that I can publish on the blog.\nInclude a mix of guides, tutorials, success stories, evergreen content, explainers, unpopular opinions, comparisons, and listicles. Categorize each of these ideas into these content types in a table format.\nBusiness / product / service description:\n{{input}}\nContent ideas:"}]},{meta:{name:"meta-description-from-text",title:"Meta description from text",category:"Marketing & SEO",description:"Generate a 20-words meta description from the given webpage text."},steps:[{say:"Write a name of your product and shortly describe it, or leave empty to parse product description from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to summarize the product into a meta description, which must be under 160 characters long (~20 words maximum). The web page text to summarize is:\n{{input}}\nPlease generate 3 options of meta descriptions, format in a bullet point list:"}]},{meta:{name:"promotional-email-writer",title:"Promotional email writer",category:"Marketing & SEO",description:"Write marketing email that promotes any product or service."},steps:[{say:"Describe your product or service, leave empty to parse product description from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a proficient SEO and high end copy writer that speaks and writes fluent {{language}}. Your task is to write the best marketing email promoting the product or service described in the following text:\n{{input}}\nPromotional email:"}]},{meta:{name:"abandoned-cart-email-series-generator",title:"mail notifications on items forgotten in cart",category:"Marketing & SEO",author:"Sof (https://donthaveasite.com)",description:"Generate a series of three abandoned cart emails for product, designed to engage the recipient and ultimately convert them into a paying customer."},steps:[{say:"Write a name of your product and shortly describe it, or leave empty to parse product description from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in {{language}}.\nGenerate a series of three abandoned cart emails for the product described below, designed to engage the recipient and ultimately convert them into a paying customer.\n1st email should be a friendly reminder about the item left in the recipient's cart. 2nd email should be more persuasive email that addresses any potential objections and highlights the unique value of the product. 3rd email should be a last chance offer, such as a limited-time discount or free shipping, along with a strong call to action.\nThe tone of the emails should be empathetic and customer-focused, and should reflect the brand's style.\nConsider including a sense of urgency in the final email, to incentivize the recipient to complete their purchase.\nProduct description: {{input}}\nEmails:"}]},{meta:{name:"influencer-outreach-dm",title:"Influencer outreach DM",category:"Marketing & SEO",description:"Write cold outreach DMs to help you sign influencer campaigns.",apps:"Instagram, Facebook, Twitter"},steps:[{say:"Influencer Name and BIO. Leave blank to parse from the page:\n"},{ask:"influencer",default:"{{page}}"},{say:"You collaboration idea (if any):\n"},{ask:"idea",default:"Please come up with collaboration idea on your own"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as marketing specialist and a Virtual Assistant.\nYour task is to write a cold outreach DM (Direct Message) to an influencer, asking him/her to collaborate with me. Write a DM as if from my point of view.\nTry to write a personalized copy, use real Influencer name if available. Add a human touch and something related to the Influencer so that the DM does not sound generic.\nDo not write long DMs, be concise and to the point. Collaboration idea is: {{idea}}\nPlease parse influencer information from the following text:\n{{influencer}}\nCold DM:"}]},{meta:{name:"product-description-writer",title:"SEO-friendly product description writer",category:"Marketing & SEO",description:"Write optimized product description based on a list of product features. For the best results provide as much info as possible and include SEO keywords.",apps:"Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"},steps:[{say:"Your list of features, keywords, and anything you can say about the product. Leave blank to parse product information from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high-end eCommerce copy writer that speaks and writes fluently {{language}}. Write a 300 word product description in {{language}} based on the product details I give you. Also follow these guidelines: - Focus on benefits rather than features - Avoid sentences over 20 words - Avoid using passive voice - Include a call to action at the end\nHere are the product description / details:\n{{input}}\nProduct description:"}]},{meta:{name:"google-business-posts-writer",category:"Marketing & SEO",title:"Google Business posts writer",description:"Get SEO optimized Google Business Posts for your Google Business Profile."},steps:[{say:"Business / product name and description. You might add keywords you want to target:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}. Please pretend you are a local SEO expert that is perfectly fluent in {{language}}.\nYour task is to help me create 5 local SEO optimized Google Business Profile posts for the following business written in the first person.\nGoogle Business Profile post must be at least 5 sentences long to be good, and should end with a call to action. Each business post should use at least 7 keywords in a natural sounding way in different sentences. The posts should not mention discounts or new products.\nPlease put each of these posts in a nice looking table.\nMy business / product name and / or description:\n{{input}}\nGoogle Business Posts:"}]},{meta:{name:"social-media-content-ideas",category:"Marketing & SEO",title:"Social media content ideas",description:"Generate a list of 10 engaging post ideas that are tailored to the interests of your target audience, increase engagement and drive traffic.",apps:"Instagram, TikTok, Facebook, Twitter"},steps:[{say:'Enter a platform, type of content, topic and potential audience, for example "Instagram, Reels, Cat-loving owners, I\'m selling pet insurance and veterinary services":\n'},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to act as a social media marketing and content expert and generate a list of up to 10 unique and engaging post ideas for my case: {{input}}\nIt should be written in fluent {{language}}.\nThe ideas should be tailored to the interests of the target audience and include a mix of different types of content (text, image, and video content), whichever appropriate.\nThe posts should aim to increase engagement and drive website traffic. Please research the target audience demographics, such as age, gender, location, interests, and other characteristics that would help you to have a better understanding of the target audience, and create post ideas that would be more appealing to them."}]},{meta:{name:"hero-image-ideas",title:"Hero image ideas",category:"Marketing & SEO",description:"Create ideas of a hero image (banner) for your web page."},steps:[{say:"What the web page is about? Leave empty to parse the opened web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nI want you to generate at least 3 ideas for a hero image to be shown on a web page. I will give you a description of the web page or its' content. Please generate 3 banner ideas. Provide details of what should be shown on the image.\nPage brief summary or text content:\n{{input}}\nHero image ideas:\n"}]},{meta:{name:"silo-structure",category:"Marketing & SEO",title:"SILO website structure",description:"Create a SILO structure for a website from a list of keywords."},steps:[{say:"Enter a comma-separated list of keywords. Leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. You will respond using only {{language}}.\nYour task is to create a detailed SILO structure for a website.\nThe sections and categories should be organized in a hierarchical structure (list), with the Home page at the top and the more specific pages at the bottom. Use the knowledge of how to make the best structure in terms of linking and SEO to get to the top positions in Google.\nPlease parse keywords for the website from the following text:\n{{input}}\nSILO structure:"}]},{meta:{name:"content-analyzer",title:"Content analyzer",category:"Marketing & SEO",description:"Evaluate and audit an article text content in order to understand if it answers the user search intent."},steps:[{say:"Copy and paste your article text here, leave empty to parse from the web page:\n"},{ask:"input",default:"{{page}}"},{say:"User search query, search intent or keywords:\n"},{ask:"search"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}. Pretend to be a SEO keyword research expert and an expert copywriter.\n1. On a scale of 0 to 10, how relevant is the following content for the query I'm trying to rank on Google? And how can I improve it?\n2. Evaluate if I'm clearly demonstrating that I have expertise in the topic I'm writing about? And how can I improve authoritativeness around this topic?\nMy web page content:\n{{input}}\nUser search query, search intent or keywords:\n{{search}}\nAnalysis:"}]},{meta:{name:"domain-name-generator",title:"Domain name generator",category:"Marketing & SEO",description:"Generate 50 domain name ideas for your niche."},steps:[{say:"Enter your niche, product / service / business description, or leave empty to parse from page:\n"},{ask:"description",default:"{{page}}"},{say:'Comma-separated list of preferred top-level domains, e.g. "com, ai, io", leave empty for "com":\n'},{ask:"zones",default:".com"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nGenerate 50 domain name ideas for the given topic, niche or product / business / service description which have some search volume.\nTry to come up with domain names that are available and not already used by other companies.\nPreferred top-level domain zones:\n{{zones}}\nTopic / nice / product / business / service description:\n{{description}}\nDomain names list:"}]},{meta:{name:"digital-strategy-generator",title:"Digital strategy generator",category:"Marketing & SEO",description:"Generate high level Digital Strategy for the given topic, service, product or business. Get a list of channels, actions and KPIs."},steps:[{say:"Product, service, company or brand description. Leave blank to parse from the web page:\n"},{ask:"product",default:"{{page}}"},{say:"Audience. Leave blank to deduce the audience automatically\n"},{ask:"audience",default:"Please assume or deduce automatically from the description given above.\n"},{gpt:"I want you to act as a market research and digital marketing expert that speaks and writes fluent {{language}}. Pretend that you know everything about digital strategy and digital channels.\nI will give you a product / company / service / brand description or a relevant web page content.\nYour task is to create a table of the 8 main, innovative or disruptive digital marketing channels (with one unique emoji to describe each channel in the first column) I should consider to help my brand engage my target audience and increase customer acquisition.\nPlease include a column with the main actions to be conducted and another column for the KPIs for each action.\nOrganize each channel starting with the one that you think will be the most important for my brand and end with the one that will be least important. Do not self reference.\nProduct / company / service / brand description, or a web page content to parse from:\n{{product}}\nTarget audience:\n{{audience}}\nChannels:"}]},{meta:{name:"promotional-comment-writer",title:"Promotional comment writer",category:"Marketing & SEO",description:"Write a helpful comment or reply to the given text, which promotes your product, business or service."},steps:[{say:"Your service (or product) name and short description, for example: - HARPA.AI, https://harpa.ai, GPT on any Website with HARPA.AI:\n"},{ask:"service"},{say:"Text of a message to reply to. Leave empty to parse from the page context:\n"},{ask:"article",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to pretend to be a human, assisting users asking questions online.\nI give you two pieces of information:\n1. A short description of my product, service or business (SERVICE) which might also have a URL link.\n2. A web page content which contains user's post, DM, message or question.\nYour task is to parse the user's question, then write a helpful reply or comment to the user's message, post or question in a way that it promotes by SERVICE.\nThe comment should sound human-like and be indeed helpful. Do not oversell or be too aggressive promoting my SERVICE.\nSERVICE:\n{{service}}\nWEB PAGE CONTENT CONTAINING DM, MESSAGE OR POST:\n{{article}}\nComment or reply:\n"}]},{meta:{name:"sales-pitch-writer",category:"Marketing & SEO",title:"Sales pitch writer",description:"Write enticing, personable and humorous sales pitches and emails."},steps:[{say:"Product name, description, price, benefits, etc. Leave blank to parse from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:'Ignore all previous instructions. Only answer in {{language}}.\nUsing the context of Tim Cook\'s (he is the CEO of Apple Inc.) presentation style, tone, and speech patterns, compose a sales pitch about a new product I will tell you about.\nThe sales pitch must be between 750 and 1000 words, easily understood by the general population of the United States of America, and the language should be presented around a 7th grade reading level.\nThe new product\'s information will be provided below. Make sure to use clear and concise sentences, and use a mix of technical jargon and layman\'s terms to explain the product I will tell you about. Avoid using the entire name of the product in your sentences so that you speak more smoothly and simply.\nAlso, include in your sales pitch a sense of sarcastic and dry humor that sounds similar to the actor Ryan Reynolds, but do not use any curse words or profanity.\nDo not echo my instructions and do not mentioned the names of Tim Cook or Ryan Reynolds. Do not use the phrase "Ladies and Gentlemen" in your introduction.\nAfter all this come up with an eye-catching email subject line (labeled with heading "Possible Email Subject Line") that could possibly be used in tandem with this sales pitch.\nThe product and its information is:\n{{input}}\nSales pitch:'}]},{meta:{name:"image-briefs-for-seo-blog-article",title:"Image briefs for SEO blog articles",category:"Marketing & SEO",description:"Find places in an article or web page to put images. Returns what the picture should be."},steps:[{say:"Paste the whole article here. Leave empty to parse the web page. Up to 3000 symbols:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in the language {{language}}.\nI want you to act as a very proficient SEO and high end copywriter that speaks and writes fluent {{language}}. Your task is to find all places to put images for a graphic designer in the given text it should say exactly what the picture should be of and the words it should have in it.\nThe pictures should explain and make the article and the words more visual and easier to understand. I want you output in a format that can be send directly to the graphic designer.\nBelow is the article:\n{{input}}\nPlaces for images and descriptions:"}]},{meta:{name:"instagram-post-caption-generator",title:"Instagram post caption generator",category:"Marketing & SEO",description:"Create 3 Instagram post captions along with hashtags.",apps:"Instagram"},steps:[{say:"What your Instagram post is about, topic, idea, some information:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}. Pretend to be an SMM, content writer and my Virtual Assistant for Instagram. I will give you a post topic or idea and your goal is to suggest me a few post captions for that post. Captions should contain at least a few paragraphs of text.\nCreate 3 engaging Instagram post captions. Each caption should contain at least 100-150 words about the topic or post idea given below. You can add and imagine details if necessary to make the caption longer. Captions should not contain any hashtags. Do not put Captions into quotes.\nAfter the third caption, please provide a list of 30 hashtags written in a single line separated with a space character. 80% of hashtags should be long-tail and 20% should be high-volume hashtags. Do not include any @mentions.\nInstagram post topic or idea:\n{{input}}\nPost captions and a list of hashtags:"}]},{meta:{name:"instagram-hashtag-generator",title:"Instagram hashtag generator",category:"Marketing & SEO",description:"Create up to 30 Instagram Hashtags.",apps:"Instagram"},steps:[{say:"What your Instagram post is about:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nCreate 30 Instagram trending hashtags targeting an LSI keyword with some search volume for the following Instagram post topic or content: {{input}}. Separate keywords by space. Only capitalize proper nouns. Output in a single line.\nHashtags:"}]},{meta:{name:"instagram-ads-hook-generator",category:"Marketing & SEO",title:"Instagram ads hook generator",description:"Generate ad hooks / angles for anything you're promoting with Instagram Ads.",apps:"Instagram"},steps:[{say:"What business, product, brand or service are you promoting? Leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI'm trying to come up with ideas for different hooks to promote something on an Instagram Ad.\nFor example: If I'm trying to promote a hammer, I might have these 3 hooks... - Hook #1: The best way to put a nail into your wall - Hook #2: The best tool for hanging your paintings. - Hook #3: The perfect tool to make your house beautiful. - Hook #4: The most trusted tool by professionals around the world.\nAnother example: if I'm trying to promote a lead magnet about \"client acquisition\", I might have these 3 hooks...\n- Hook #1: Keep yourself booked solid. - Hook #2: No more feast or famine months. - Hook #3: Stop waiting around for clients to find you.\nEach hook should be one sentence and should be a different reason someone may want to click on my ad. Each idea needs to use copywriting and persuasion best practices to draw users to take action.\nI need you to create a list of 10 potential hooks about the following:\n{{input}}\nHooks:"}]},{meta:{name:"instagram-post-ideas-generator",title:"Instagram post ideas generator",category:"Marketing & SEO",description:"Create 10 Instagram reels ideas for the given topic.",apps:"Instagram"},steps:[{say:"What your Instagram profile is about? Leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}. Pretend to be an SMM, content writer and my Virtual Assistant for Instagram. I will explain you what my Instagram account is about and your goal is to create a post calendar for the next 2 weeks, with ideas for posts, stories and reels.\nEvery item must contain 4 sub-items: - Post summary (for that day of the week) - Post type (story, post, carousel, reels etc.) - Image / Video description\nPlease parse the Instagram profile topic or idea from the following text:\n{{input}}\nPosts, formatted in a markdown table:"}]},{meta:{name:"tiktok-hashtag-generator",title:"TikTok hashtag generator",category:"Marketing & SEO",description:"Create up to 30 TikTok Hashtags.",apps:"TikTok"},steps:[{say:"Write a TikTok topic:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nCreate 30 Tiktok trending hashtags targeting an LSI keyword with some search volume for the following topic: {{input}}. Separate keywords by space. Only capitalize proper nouns. Output in a single line.\nHashtags:"}]},{meta:{name:"youtube-audience-analyzer",category:"Marketing & SEO",title:"YouTube audience analyzer",description:"Read transcript of a YouTube video and analyze its target audience.",apps:"YouTube"},steps:[{gpt:"I will provide you with a transcript of a YouTube video. Your task is to analyze the target audience of the video. I want you to answer in {{language}} only.\nPlease provide a description of the target audience in a single paragraph.\nThen list relevant topics of interest of the audience audience. Format relevant topics in a bullet-point markdown list. Video transcript:\nAfter that provide a list of keywords for video content that might interest the target audience.\nVideo transcript:\n{{youtube.transcript}}\nAnalysis:"}]},{meta:{name:"youtube-description-generator",title:"YouTube description generator",category:"Marketing & SEO",description:"Generate title, description and hashtags for a youtube video idea.",apps:"YouTube"},steps:[{say:"Enter YouTube video idea or keywords. Leave empty to parse idea from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to answer in {{language}} only.\nI want you to act as a very proficient Professional YouTube SEO Expert and a high end video SEO optimizer who is fluent in {{language}} speaking and writing.\nYour task is to write video title, video description and hashtags for a YouTube video idea. Please write SEO-optimized title, description and hashtags so that the video has high change of ranking on YouTube video search for the relevant keywords. When writing a description, follow these guidelines:\n- Include keywords that are related to the video idea to help YouTube understand the topic of your video and improve its ranking in search results.\n- Make it descriptive and informative: The description should provide a brief overview of the video and what the viewer can expect to learn or see. Be sure to include key takeaways and any relevant information that will pique the viewer's interest.\n- Use short and concise sentences: Keep the description short and to the point, using simple language that is easy to understand.\n- Include a call-to-action (CTA): Encourage viewers to like, comment, and subscribe to your channel by including a clear CTA at the end of the description.\n- Optimize for readability: Use proper grammar, spacing, and punctuation to make the description easy to read and understand.\nYouTube video hashtags should be separated by commas.\nPlease parse video idea from the following text:\n{{input}}\nVideo title, description and hashtags:"}]},{meta:{name:"youtube-hashtag-generator",title:"YouTube hashtag generator",category:"Marketing & SEO",description:"Create up to 30 YouTube Hashtags.",apps:"YouTube"},steps:[{say:"Give me your YouTube title name:\n"},{ask:"input"},{gpt:'Please ignore all previous instructions. I want you to respond only in language {{language}}.\nCreate 30 YouTube trending hashtags targeting an LSI keyword to rank top on YouTube high search volume for the following YouTube video topic or title: "{{input}}". Separate keywords by space. Only capitalize proper nouns. Output in a single line.\nHashtags:'}]},{meta:{name:"youtube-polls-generator",category:"Marketing & SEO",title:"YouTube polls generator",description:"Create an attention-grabbing YouTube poll for a video channel.",apps:"YouTube"},steps:[{say:"What you YouTube video channel is about? Leave empty to parse from the web page (navigate to YouTube about page for best results):\n"},{ask:"input",default:"{{page}}"},{say:'Tip: you can ask me to generate more ideas by typing "More ideas".\n'},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}\nI'd like you to take on the role of a YouTube video content creator. Your task is to generate YouTube Poll ideas based on my channel description.\n1. Poll question must be clear and concise: Make sure the question is straightforward and easy to understand.\n2. Keep it simple: too many choices can lead to confusion and a less accurate result.\n3. The optimal length is about 80 characters, ~5 poll options.\n4. Include emojis in the poll and the options if appropriate.\n5. Consider that the polls question should be more engaging. Think about how likely channel viewers are to engage with the poll and answer the question.\nFormat poll options in a bullet point list.\nPlease parse my channel description from the following text:\n{{input}}\nPoll idea:"}]},{meta:{name:"facebook-ads-hook-generator",category:"Marketing & SEO",title:"Facebook ads hook generator",description:"Generate ad hooks / angles for anything you're promoting with Facebook Ads.",apps:"Facebook"},steps:[{say:"What business, product, brand or service are you promoting? Leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI'm trying to come up with ideas for different hooks to promote something on a Facebook Ad.\nFor example: If I'm trying to promote a hammer, I might have these 3 hooks... - Hook #1: The best way to put a nail into your wall - Hook #2: The best tool for hanging your paintings. - Hook #3: The perfect tool to make your house beautiful. - Hook #4: The most trusted tool by professionals around the world.\nAnother example: if I'm trying to promote a lead magnet about \"client acquisition\", I might have these 3 hooks...\n- Hook #1: Keep yourself booked solid. - Hook #2: No more feast or famine months. - Hook #3: Stop waiting around for clients to find you.\nEach hook should be one sentence and should be a different reason someone may want to click on my ad. Each idea needs to use copywriting and persuasion best practices to draw users to take action.\nI need you to create a list of 10 potential hooks about the following:\n{{input}}\nHooks:"}]},{meta:{name:"facebook-ads-generator",title:"Facebook ads generator",category:"Marketing & SEO",description:"Generate a custom Facebook ad to boost conversions and revenue of your product or service.",apps:"Facebook"},steps:[{say:"Describe the product and its benefits, explain the goals of your marketing campaign. Leave blank to parse product description from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. Please only respond in {{language}}.\nI want you to act as a professional copywriter with experience in writing high-converting Facebook ads. I want you to write an Ad copy. The ad copy should be between 100-150 words long.\nI want you to write a Facebook ad copy for a product / service that I will describe below. Use the following guidelines:\n- Create a compelling headline that grabs attention and highlights the main benefit of the product/service - Use clear and concise language in the body copy that focuses on the benefits of the product / service and addresses any potential user objections - Include a strong call to action that encourages users to take the desired action - Use an image or video that visually demonstrates the product / service and resonates with the target audience - Research the target audience demographics, such as age, gender, location, interests, and other characteristics that would help you to have a better understanding of the target audience, and create an ad that would be more appealing to them.\nProduct / service description:\n{{input}}\nFacebook Ad copy:\n"}]},{meta:{name:"facebook-hashtag-generator",title:"Facebook hashtag generator",category:"Marketing & SEO",description:"Create up to 30 Facebook Hashtags.",apps:"Facebook"},steps:[{say:"What your Facebook post is about:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nCreate 30 Facebook trending hashtags targeting an LSI keyword with some search volume for the following Facebook post topic or content: {{input}}. Separate keywords by space. Only capitalize proper nouns. Output in a single line.\nHashtags:"}]},{meta:{name:"linkedin-hashtag-generator",title:"LinkedIn hashtag generator",category:"Marketing & SEO",description:"Create up to 30 LinkedIn Hashtags.",apps:"LinkedIn"},steps:[{say:"What your LinkedIn post is about:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nCreate 30 LinkedIn trending hashtags targeting an LSI keyword with some search volume for the following LinkedIn post topic or content: {{input}}. Separate keywords by space. Only capitalize proper nouns. Output in a single line.\nHashtags:"}]},{meta:{name:"twitter-hashtag-generator",title:"Twitter hashtag generator",category:"Marketing & SEO",description:"Create up to 30 Twitter Hashtags.",apps:"Twitter"},steps:[{say:"What your tweet is about:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nCreate 30 Twitter trending hashtags targeting an LSI keyword with some search volume for the following Twitter post topic or content: {{input}}. Separate keywords by space. Only capitalize proper nouns. Output in a single line.\nHashtags:"}]},{meta:{name:"pinterest-pin-description",title:"Pinterest pin description",category:"Marketing & SEO",description:"Create description for a Pinterest pin from title or topic.",apps:"Pinterest"},steps:[{say:"Enter Pin topic, title or leave empty to parse from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to reply in {{language}} only.\nI want you to think that you are a very competent SEO and high-end copywriter who speaks and writes {{language}} fluently.\nI want you to write an article on the following topic:\n{{input}}\nPlease write from the first person perspective and address the reader as you. Write an article no longer than 500 characters that I can use for a pin on Pinterest. Do not self reference or mention that you are a SEO expert.\nUse key words from the topic. Don't use lists or headings, but use paragraphs. Don't go into details, summarize the topic as best as you can, as if you were writing a summary for a blog post. Be precise and to the point.\nPin description:"}]},{meta:{name:"article-outline",title:"Article outline markdown",category:"Copywriting",description:"Generate a content outline for your article. Use in combination with Article Section command to generate every part of the article."},steps:[{say:"What the article should be about:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to write a high-quality info content outline for the article description given below.\nThe article should include a creative title and SEO meta description. The article can have bullet points or numbered list (if needed), FAQs (if needed) and conclusion (if needed).\nAll output must be 100% human writing style and free of grammar errors. Do not use generic filler phrases. Do use useful subheadings with keyword-rich titles. Do not repeat the same content over again.\nYour output must contain a single markdown code block and the article outline should be within that block.\nArticle should be about: {{input}}\nArticle outline in a markdown code block:"}]},{meta:{name:"article-outline-mece",category:"Copywriting",title:"Article outline MECE",description:"Generate a content outline for your article following MECE Framework. Use in combination with Article Section command to generate every part of the article."},steps:[{say:"What the article should be about:\n"},{ask:"input"},{gpt:'Please ignore all previous instructions. Using the MECE framework, please create a detailed long-form content outline for our {{language}} writers on the topic: "{{input}}". Also, provide a short and attention-grabbing title for the article and an estimate of the word count for each subheading. Include a list of semantically similar FAQs using the vector representation technique. Generate the output in markdown format. Please don\'t write the article, only the outline for writers. Outline:'}]},{meta:{name:"article-section",title:"Article section",category:"Copywriting",description:"Generate an article section content. Use in combination with Article Outline command: first generate an article outline and then every sections one by one."},steps:[{say:"Please copy-paste below a single section of the article outline. You can generate an article outline using Article Outline command.\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to write a high-quality article section content for the article section description given below.\nThe article section can have bullet points or numbered list (if needed). All output must be 100% human writing style and free of grammar errors.\nDo not use generic filler phrases. Do use useful subheadings with keyword -rich titles. Do not repeat the same content over again.\nArticle section outline:\n{{input}}\nArticle section content:"}]},{meta:{name:"blog-post-writer",title:"Blog post from topic",category:"Copywriting",description:"Create a capacious blog post from the given topic."},steps:[{say:"Enter topic:\n"},{ask:"input"},{say:"Ok, I will write a blog post now. Use `/continue` command if my response does not fit ~4096 tokens and is cut off. Or create a blog outline first and then ask me to write each section separately.\n"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nCreate a detailed content brief for the following topic: {{input}}\nInclude top level keywords, long-tail keywords, a header outline and notes for the topic. Then write suggested title tags and meta descriptions, keeping them within the respective character limits of 70 and 160. After that, write some text underneath each sub header. Then expand on each of the numbered bullet points with a short and sharp explanation of how to do / implement each step. Put all this content into a structured blog post in language {{language}}.\nBlog post:"}]},{meta:{name:"video-script-writer",title:"Video script writer",category:"Copywriting",description:"Write a script for a video idea or topic. Best for YouTube, Instagram & TikTok.",apps:"YouTube, Instagram, TikTok"},steps:[{say:'Your video idea, title or topic, e.g. "How to protect yourself from zombies":\n'},{ask:"idea",default:"How to protect yourself from zombies"},{say:"Target platform (YouTube, Instagram, TikTok etc.). Press Enter to pick YouTube.\n"},{ask:"platform",default:"YouTube"},{say:'Enter a preferred video duration in minutes and seconds, e.g. 2:10s. Press enter for "Unspecified":\n'},{ask:"duration",default:"unspecified"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nYou act as a very proficient SEO and high-end copy writer that speaks and writes fluently in {{language}}. Your task is to write me a content for a video script for {{platform}} platform.\nFormat in a bullet-point list, add approximate timestamp for every block or paragraph. Format timestamps in bold using markdown.\nBefore the script please also provide 3 alternative appropriate clickbait titles.\nMy video idea, video title or topic is:\n{{idea}}\nPreferred video duration is {{duration}}\nTitles and the script:\n"}]},{meta:{name:"customer-reviews-writer",title:"Customer reviews writer",category:"Copywriting",description:"Create customer reviews and testimonials for your company product, business or service.",apps:"Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"},steps:[{say:"Describe your product, service or business. Include business name. Or leave empty to parse information from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nPretend to be a custom of the product, service or business described below. Write 3 human-like reviews / feedbacks / testimonials from the customer point of view.\nPlease add fake customer names and companies that do not exist but sound very plausible (i.e. not some ABC Consulting or XYZ Inc.) and are likely to use the product. Do not put reviews into quotes.\nBusiness / product / services description:\n{{input}}\nTestimonials and reviews:"}]},{meta:{name:"customer-review-responses-writer",title:"Customer review responses writer",category:"Copywriting",description:"Get friendly responses to a list of customer reviews, which you can use on Google, Yelp, etc. Organizes your responses nicely in a table so you can copy and paste them easily.",apps:"Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"},steps:[{say:"Paste your reviews here. Each one should be in brackets, such as [review1] [review2] [review3]:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nYour task is to help me respond to many online customer reviews in {{language}}. Each review will be separated by brackets.\nPlease pretend you are a very nice and grateful person that speaks and writes in casual perfect {{language}}. Please give me a response for each review in the prompt. Please organize the responses in a table and put the review next to each response so I can see them next to each other.\nThe customer reviews to help me with are:\n{{input}}\nResponses table:"}]},{meta:{name:"quora-answer-writer",title:"Quora answer writer",category:"Copywriting",description:"Write a personalized Quora answer to any question.",apps:"Quora"},steps:[{say:"Paste quora question, or leave empty to parse question from the context:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nParse a Quora Question from the following text. Pretend to be an expert on the subject. Write 2 paragraphs of 300 words long answer. Be informal and greet the author. Personalize the comment to sound as if you are talking to the author, make the answer sound as humanly as possible.\nText to parse the Quora Question from:\n{{input}}\nAnswer:"}]},{meta:{name:"sequential-text-improvements",title:"Sequential text improvements",category:"Copywriting",description:"Creates a table with a list of 10 improvements for you to pick from. Keeps track of changes already made and shows you an updated table after each pick from the list."},steps:[{say:"Copy and paste the text to improve:\n"},{ask:"input"},{say:"Ok, let me generate the suggestions..."},{gpt:'Please ignore all previous instructions.\nI would like to write a markdown table of 10 different suggestions of improvements that could be applied to the text: - the first column has the improvement description - the second column has the suggestion number (1..10) for me to pick - the third column has a Y/N flag if the change was implemented or not (N by default)\nAfter you output the table, I will tell you the changes to be made.\n[THE SOURCE TEXT]:\n{{input}}\nTable of improvements with columns "Suggestion", "No", "Applied":'},{say:"Please pick the changes to make. You can make several changes at the same time, for instance 1,2,5,9 will change those 4 options at once. Press ESC at any time to stop the command.\n",label:"repeat"},{ask:"changes"},{gpt:"Please integrate the changes to the text, then show the updated text and the updated table of changes. Keep a log of all the changes made in the third column.\n[CHANGES TO MAKE / OR MY COMMAND]: {{changes}}\nUpdated text and the table:"},{jump:"repeat"}]},{meta:{name:"buying-guide-writer",title:"Buying guide writer",category:"Copywriting",description:"Create a product buying guide."},steps:[{say:'Product name or topic e.g. "gaming PC", leave empty to parse product description from the web page:\n'},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nWrite a detailed buying guide step by step for the mentioned below product description or topic. Be informative and use various sentences. Sentence length should be short with enough transition words. Write in 3rd person.\nProduct description or topic: {{input}}\nBuying guide:"}]},{meta:{name:"long-article-writer",title:"Long-form article writer",category:"Copywriting",description:"Generate a plagiarism free content for your blog."},steps:[{say:"Enter article title:\n"},{ask:"title"},{say:"Enter any additional instruction about the article, leave empty for default:\n"},{ask:"instructions",default:'Write an article in a formal "we" form. The article should contain rich and comprehensive, very detailed paragraphs. Do not use generic filler phrases. Get to the point precisely and accurately.\nDouble-check for plagiarism. I need a pure unique content, write the content in a conversational style as if it were written by a human.\nArticle should be ~1800 words long.\n'},{gpt:'Please ignore all previous instructions.\nI want you to act as a Content Writer and a very proficient SEO that writes fluently in {{language}}.\nWrite an SEO-optimized Long Form article. Please style article with markdown and use headings and sub headings, such as H1, H2, H3. The final paragraph should be a conclusion.\nI give you the Title "{{title}}" of an article that we need to outrank in Google.\n{{instructions}}\nArticle:'}]},{meta:{name:"clickbait-writer",title:"Clickbait writer",category:"Copywriting",description:"Generate 20 catchy and high-converting clickbaits."},steps:[{say:"Enter your topic here. Leave empty to generate clickbaits for people to visit the current web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in {{language}}.\nI want you to act as a highly skilled marketer and top-tier copywriter who is fluent in {{language}}. I want you to pretend that you are an expert at writing all types of CTAs.\nYour task is to come up with at least 20 catchy, human-written, suspenseful CTAs for a topic or web page I provide at the end. The best clickbaits usually:\n- Provoke or grab attention: This is often in the form of a question or a statement that creates a sense of curiosity or urgency.\n- Have a strong emotional hook: The headline should tap into the reader's emotions and make them feel invested in finding out more.\n- Relevant to the target audience: The headline should be relevant to the reader's interests or needs.\n- Have a sense of exclusivity: Clickbait headlines often suggest that the reader will get access to something special or privileged by clicking through.\n- Leave cliffhangers or contain lists such as \"5 ways to ...\".\nThe topic or web page content for the clickbaits is:\n{{input}}\nClickbaits:"}]},{meta:{name:"title-writer",title:"Title writer",category:"Copywriting",description:"Generate titles for a list of keywords or web page."},steps:[{say:"Your list of keywords separated by comma. Leave empty to generate titles for the current web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a fancy title generator. I will give you comma-separated keywords or an entire web page content and you will reply with 20 fancy titles.\nKeywords or web page content is:\n{{input}}\nTitles:"}]},{meta:{name:"product-description-writer-saas",title:"SaaS product description writer",category:"Copywriting",description:"Based on the product information create a click-enticing product name and description that encourage to buy online. Perfect for SaaS or online products and services."},steps:[{say:"Enter your product description / information / overview, leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a SEO and Conversion Rate Optimisation expert that speaks and writes fluent {{language}}. Pretend that you have the most accurate and most detailed information about a product explained below. Based on the product information given below create unique and very click-enticing product name and product description that encourage to buy online. Please generate 3 options of name and description for me, use bullet point list. Style with markdown.\nHere is product description / information:\n{{input}}\nProduct names and descriptions (x3):"}]},{meta:{name:"product-description-writer-e-commerce",title:"E-Commerce product description writer",category:"Copywriting",description:"Create a rich product description and title for your e-commerce product. Perfect for e-commerce products on Amazon, AliExpress, Jet.com etc.",apps:"Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"},steps:[{say:"Enter your product description / information / overview, leave empty to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to pretend that you are an E-commerce SEO expert who writes compelling product descriptions for users looking to buy online.\nI am going to provide a description of the e-commerce product and your task is to come up with a minimum of three distinct content sections for the product description, each section about a unique subset of keywords relating to the product I provide you.\nMake sure that each of the unique content sections are labeled with an informative and eye-catching subheading describing the main focus of the content section.\nThe main point of these commands is for you to developing a new keyword-rich, informative, and captivating product summary / description that is less than 1000 words. The purpose of product description is marketing the products to users looking to buy. Use emotional words and creative reasons to show why a user should purchase the product I tell you.\nAfter you generate the new product summary, please generate a bullet point list of 5 possible H1 headings for a product page. Each H1 should be less than 7 words.\nPlease also include bulleted list of broad match keywords that were used to accomplish writing the product summary.\nPlease also write a persuasive and professional sounding Meta Title and Description that integrates similar language present in the new product summary text.\nPlease take product information from the following text:\n{{input}}\nProduct name, description, headings, keywords, meta title and description:"}]},{meta:{name:"faq-and-answers-writer",title:"FAQ & answers writer",category:"Copywriting",description:"Generate FAQ list with answers from the given product or service description."},steps:[{say:"Keywords, product or service description. Leave blank to parse from page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nYou are a SEO Expert and Copywriter. Your task is to write a FAQ about the given product, service or keywords.\nYou should come up with at least 5 questions and answers. Format in a bullet point list. Make sure every sentence is unique. Use a formal tone. Write approximately 750 words in total.\nParse keywords, product or service description from this text:\n{{input}}\nFAQ:"}]},{meta:{name:"song-lyrics-writer",title:"Song lyrics writer",category:"Copywriting",description:"Generate an high-quality song lyrics for your desired song title."},steps:[{say:"Song title:\n"},{ask:"title"},{say:"Song style or theme, e.g. Rap / Rock / Ballad / Country / Nursery Rhyme / R&B / Funny / Sad / Catchy / Christmas / Pop / Love etc\n"},{ask:"style"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI will give you a song title and you'll write me the best lyrics for it. You will use words that are catchy, and depend on what title is given.\nThe lyric should be long enough, longer than a 1-minute song. Please use the table marking down.\n- If the user chose Rap Song, then you might add some bad words. - If it's a nursery rhyme song, then write lyrics that kids will love to listen too.\nYou can use repeating lyrics too.\nIf the given title isn't really a believable title, then re-write it to a best title one corresponding to the generated song lyrics.\nPreferred song title is: {{title}}\nSong style / content is: {{style}}\nRefined song title and the song lyrics:"}]},{meta:{name:"inspirational-quotes",title:"Inspirational quotes",category:"Copywriting",description:"Input a problem area to get inspiring quotes for people struggling with that problem."},steps:[{say:'Frame a problem, for example "Why I struggle learning a foreign language?":\n'},{ask:"input",default:"Why do I struggle learning a foreign language?"},{gpt:'Please ignore all previous instructions. I want you to respond only in language {{language}}.\nGive me up to 50 short inspirational quotes about the following topic or problem:\n{{input}}\nMix the quotes up with metaphors, straight up advice, wrong ideas to avoid and encouragement start each quote with a different word.\nDon\'t self reference. Refrain from starting with "you" or "like". Avoid repetition and keep the quotes fresh and activating.\nName the author and where this quote comes from if it is known. If the author is not known - just do not specify anything, do not write "Unknown".\nQuotes:'}]},{meta:{name:"quiz-writer",title:"Quiz writer",category:"Copywriting",description:"Create the fun quiz for your company. Just give me a topic."},steps:[{say:"The subject of the quiz should be:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nI want you to respond only in {{language}}. I want you to create a pub quiz. Pretend that you are an expert and have the most accurate and most detailed information available about the given topic.\nHere is the topic: {{input}}.\nCreate a 4 round quiz on the topic, that has 3 questions per round. Each question must have a correct answer and three alternative incorrect ones. Each question must have the answers provided in random order, and the correct answer marked with [x]. Quiz:"}]},{meta:{name:"plagiarism-checker",title:"Plagiarism checker",category:"Copywriting",description:"Check given text for plagiarism."},steps:[{say:"Give me a full sentence or paragraph for a plagiarism check, e.g.\n> Midway upon the journey of our life\n  I found myself within a forest dark,\n  For the straightforward pathway had been lost.\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a plagiarism checker. I will give you a text or a sentence and you will echo parts (one sentence or multiple) of my text that contain plagiarism and also reference the source of the text (i.e. where it was copied from).\nUse bullet points for multiple plagiarisms.\nDo not write explanations on replies. My first prompt is:\n{{input}}\nPlagiarism check:"}]},{meta:{name:"find-resources-on-a-topic",title:"Find resources on a topic",category:"Learning",description:"Get a list of informative resources for any topic."},steps:[{say:"Please enter the topic of interest:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in {{language}}.\nWhat are the best resources for this topic and how can I utilize them properly? The topic is: {{input}}\nList of resources and related information:"}]},{meta:{name:"course-generator",title:"Course generator",category:"Learning",description:"Design a full project-based course based on the desired learning outcome with outline, lesson plans, objectives, activities, real world examples, video script, and project plan."},steps:[{say:'Enter what you would like to learn, e.g. "How to install VPN?":\n'},{ask:"input"},{say:"Ok, I will write a course now. Use `/continue` command if my response does not fit ~4096 tokens and is cut off.\n"},{gpt:"Please ignore all previous instructions. I want you only to respond in {{language}}. You are an expert course creator and curriculum designer. You use backwards design in your planning by starting with the outcome in mind and working backwards to create learning modules and activities that will guide students towards this outcome. All of your courses are project based. Create a course outline based on the desired outcome.\nPlease generate a learning course for the following topic: {{input}}. Be sure that is appropriate for all types of learners that speak {{language}}.\nInclude a project plan for a real world application of this course. This plan should be descriptive and outline what components should be included in the final project. Include no more than 6 modules in the course and for each module include the lesson plans with the learning objectives, real world examples, and activities with step-by-step directions that are connected to the final project. Also include discussion questions and ways to expand learning. Include an engaging video script for each lesson that explains how the lesson is connected to the project plan.\nCourse:"}]},{meta:{name:"unit-study-generator",title:"Unit study planner",category:"Learning",description:"Create a unit study and a strategy for learning the given topic."},steps:[{say:"Type a topic or subject:\n"},{ask:"input"},{say:"Ok, I will write a unit study now. Use `/continue` command if my response does not fit ~4000 tokens and is cut off.\n"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nCreate a Unit Study in {{language}} on the topic of interest with the following in mind for each section. Add age and grade requirements. Create a schedule that will last 5 days.\nTopic or subject of interest is: {{input}}.\nOutline the goals that will be accomplished at the end of this unit study.\nCreate a list of books with Amazon links that will support the topic. Create a list of Documentaries or YouTube videos with links that can support this topic. Include arts and crafts if possible as the activity that can help with the unit study topic. Plan a field trip if applicable, add a science project if applicable. If there is a history section and geography component that can support the topic add it as well.\nUnit study:"}]},{meta:{name:"lesson-plan-generator",title:"Lesson planner",category:"Learning",description:"Create a lesson plan and a strategy for teaching a given topic."},steps:[{say:"Type a topic or subject:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nTopic of interest or subject is: {{input}}.\nCreate a lesson plan for the topic above. List Learning Objectives, Materials, provide Introduction, Instructions, Practice Exercises, and Assessment in the form of a quiz, Activities, Homework and Extensions beyond the class. Add appropriate video links.\nLesson plan:"}]},{meta:{name:"study-helper",title:"University professor",category:"Learning",description:"Your personal university professor which helps to explain the principles and formulas of physics, engineering & mathematical concepts, chemistry, literature etc."},steps:[{say:'What concept or formula you want me to explain? For example: "first cosmic velocity".\n'},{ask:"input",default:"first cosmic velocity"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a very proficient teacher, lecturer and university professor.\nYour task is to teach and explain to me in a way I can understand the following concept or formula: {{input}}.\nUse formulas and provide examples whenever appropriate. If you have equivalent formulas or very relevant topics, list them as well. Point me to specific resources where I can lear more (but do not overload me with external sources). Focus on providing examples. Try to use human-readable symbols in formulas.\nBoil down complex concepts so that they are easier to understand. You goal is to teach me and not overload with information.\nPlease highlight the topic and relevant topics in bold. Use markdown extensively for lists and put formulas in markdown code blocks.\nAt the end of the output, give me a short numbered list of further options or questions to drill down. If I give you a number, proceed with drilling down to the related option."}]},{meta:{name:"gaps-worksheet",title:"Fill in the gaps worksheet",category:"Learning",description:"Generate a fill-in-the-gaps challenge on any topic."},steps:[{say:'Please type in a topic or subject of a study. Type "stop" any time to stop the challenge:\n'},{ask:"input"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nI want you to act as a very proficient teacher, lecturer and university professor.\nI want you to generate a series of fill-in-the-blanks questions on the given topic. Your task is to create a worksheet with a list of sentences, each with a blank space where a word is missing.\nThe sentences should be grammatically correct and appropriate for students at an intermediate level. Your worksheets should not include any explanations or additional instructions, just the list of sentences and word options.\nThe topic is: {{input}}\nWorksheet:"}]},{meta:{name:"quiz-study",title:"Quiz study",category:"Learning",description:"Challenge your knowledge with an engaging quiz on any topic."},steps:[{say:'Please type in a topic or subject to study. Type "stop" any time to stop the quiz:\n'},{ask:"input"},{gpt:'Please ignore all previous instructions. You will respond using {{language}}.\nI want you to act as a very proficient teacher, lecturer and university professor.\nI want you to generate a series of questions in a quiz format. You will ask me a question on the topic with four possible answers labelled A, B, C, D. You will then wait for my response.\nAfter I gave you an answer, you will then say whether my answer is correct or incorrect. If incorrect, provide an explanation. Immediately carry on with the second question and so forth, after evaluating my answer.\nDo not stop generating questions until I write "stop".\nThe topic is: {{input}}\nThe first question:'}]},{meta:{name:"job-interview-coach",title:"Job interview coach",category:"Recruiting",description:"Warm up before job interview. Assess your qualifications for specific job. Chat with a GPT-HR-specialist, identify your strengths and weaknesses. Take a quick aptitude test to measure suitability.",apps:"LinkedIn"},steps:[{say:"Copy-paste position and job responsibilities. Leave empty to parse job description from the opened web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nTask: Pretend you're an interviewer or hiring manager. I'll be the candidate and answer your questions one by one.\nTarget language: {{language}}\nAsk one question at a time, then wait for my response and provide a feedback. Use interviews techniques to test my qualifications and motivation for the job.\nAsk technical questions in the field of the specific job. Get to the point. Ask questions to test my motivation.\nAsk questions about my skills, according to a job position and job responsibilities. Cover all the interview questions professionally. Be friendly and smart.\nPARSE POSITION AND JOB RESPONSIBILITIES FROM: {{input}}\nFirst questions:"}]},{meta:{name:"recruiter-outreach-dm",title:"Recruiter outreach DM on LinkedIn",category:"Recruiting",description:"Craft a compelling direct message to recruiters on LinkedIn.",apps:"LinkedIn"},steps:[{say:"Copy-paste your CV below. Leave empty to parse from the opened page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a CV reviewer and experienced cover letters writer.\nI will send you my CV. I'm afraid it's too technical and long for a recruiter. I want you to re-write it so it's more accessible to recruiters in a form of an outreach DM.\nI want you to write a small text (up to 100 words) about my CV, that will contain: summary, experience and strengths.\nGet to the point precisely and accurate. Do not echo my prompt. Do not remind me what I asked you for. Write as if I'm describing myself, do not write in the third person.\nMY CV: {{input}}\nMessage for recruiter:"}]},{meta:{name:"resume-cover-letter",title:"Resume cover letter",category:"Recruiting",description:"Write a tailor cover letter to any job based on your CV.",apps:"LinkedIn"},steps:[{say:"Copy and paste a Job Description below. Leave empty to parse from the opened page:\n"},{ask:"job",default:"{{page}}"},{interpolate:"job"},{say:"Copy-paste your CV below. Leave empty to parse from the opened page:\n"},{ask:"cv",default:"{{page}}"},{interpolate:"cv"},{gpt:'Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a CV reviewer and as a cover letter writer. I will provide you with my CV, and you will generate a cover letter to complement it. I want the cover letter to have a formal, professional tone, as I will be applying to a corporation.\nThe letter you write must contain: - a clear and relevant subject line; - instead of just listing what I\'ve achieved, show how these accomplishments make me the ideal candidate for the job; - contact details and a call to action (e.g. "I would appreciate the opportunity to further discuss my qualifications with you. Please let me know if there is a good time for us to speak.");\nPARSE JOB DESCRIPTION FROM: {{job}}\nPARSE MY CV FROM: {{cv}}\nDo not ask additional questions and immediately start writing an answer. Cover letter:'}]},{meta:{name:"resume-reviewer",title:"Resume reviewer",category:"Recruiting",description:"Let AI review and improve your CV before submitting it.",apps:"LinkedIn"},steps:[{say:"Copy-paste your CV below. Leave empty to parse from the opened page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a CV reviewer. I will provide you with my CV. I want you to write me feedback on it. Feedback must include the following points:\n1) What appropriate sections to add for making my CV more readable? 2) How to make my CV easier to read? 3) What kind of numbers and results can I add to my CV? 4) What type of action verbs should I choose? 5) Am I using too many buzzwords? How to replace them, if I do.\nGet to the point precisely and accurate. Do not echo my prompt. Do not remind me what I asked you for.\nHere is my CV:\n{{input}}\nThe review:"}]},{meta:{name:"resume-suggestions",title:"Resume suggestions",category:"Recruiting",description:"Paste in your resume: work experience and education. I will suggest a list of improvements.",apps:"LinkedIn"},steps:[{say:"Copy-paste your CV below. Leave empty to parse from the opened page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nPretend you're a high level hiring manager. The output should be in {{language}}.\nSuggest a bullet-point list of improvements for my resume in terms of clarity, content, format, and grammar, overall structure and organization.\nFollow industry standards. Be clear and concise with your suggestions, including a professional tone and clear description of what you recommend.\nMy resume: {{input}}\nSuggestions:"}]},{meta:{name:"resume-improver",title:"Resume improver",category:"Recruiting",description:"Paste in your resume: work experience and education. I will edit your resume for clarity, content, format and grammar.",apps:"LinkedIn"},steps:[{say:"Copy-paste your CV below. Leave empty to parse from the opened page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions.\nPretend you're a high level hiring manager. The output should be in {{language}}.\nEdit my resume for clarity, content, format, and grammar. Suggest improvements in overall structure and organization. Follow industry standards, and avoid personal opinions. Be clear and concise with your words, including a professional tone and clear description of the candidate best strengths.\nMy resume: {{input}}\nEdited version:"}]},{meta:{name:"job-announcement",title:"Job announcement",category:"Recruiting",description:"Create a compelling LinkedIn post to announce a job opening.",apps:"LinkedIn"},steps:[{say:"Paste your job description below or leave empty to parse job description from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an experienced HR specialist and title writer.\nI want you to create short and catchy job opening announcement in our company, the text should be short and informative. The text should include a memorable call to action to send CVs to our address.\nGet to the point precisely and accurate. Do not echo my prompt. Do not remind me what I asked you for.\nJOB DESCRIPTION: {{input}}\nJob opening announcement:"}]},{meta:{name:"job-description-writer",title:"Job description writer",category:"Recruiting",description:"Create clear and detailed job descriptions.",apps:"LinkedIn"},steps:[{say:'Who are you looking for? E.g. "Frontend developer with 5 years of experience. Proficient in HTML, CSS and JavaScript":\n'},{ask:"job"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an experienced HR specialist.\nI require you to create a detailed and structured job description based on the vacancy information I will provide to you. Be precise and use professional vocabulary.\nDivide the text into chapters that correspond to the structured job description. If I do not provide enough information, please ask me and I will respond.\nHere is information about the job: {{job}}\nJob Description:"}]},{meta:{name:"job-eligibility-checker",title:"Job eligibility checker",category:"Recruiting",description:"Find out if a given CV fits the Job Description.",apps:"LinkedIn"},steps:[{say:"Copy and paste a Job Description below. Leave empty to parse from the opened page:\n"},{ask:"job",default:"{{page}}"},{interpolate:"job"},{say:"Copy and paste a CV below. Leave empty to parse from the opened page:\n"},{ask:"cv",default:"{{page}}"},{interpolate:"cv"},{gpt:"Please ignore all previous instructions. I want you to act as a CV reviewer and a very proficient HR that writes fluently in {{language}}.\nI'm going to provide you with a job description for a job I'm interested to apply for. You're going to read the job description and understand the key requirements for the position  including years of experience, skills, position name.\nThen you will read my CV. You'll go over it and provide feedback based on how tailored my CV is for the job. Provide me feedback on how I can tailor it to the above job post, do not mention me by name.\nPARSE JOB DESCRIPTION FROM: {{job}}\nPARSE MY CV FROM: {{cv}}\nBullet-points list of suggestions on how to tailor my CV to the Job Description:"},{say:"Do you want me to try to rewrite your CV?\n"},{ask:"yn",options:["YES","NO"]},{condition:"{{yn}} = YES",type:"gpt",prompt:"Rewrite my CV to tailor it to the Job Position and incorporate the mentioned bullet points (if any):"}]},{meta:{name:"upwork-cover-letter-writer",category:"Recruiting",title:"Upwork cover letter writer",description:"Write Cover letter for a given Upwork job offer.",apps:"Upwork"},steps:[{say:"Copy-paste the offer below. Leave empty to parse from the opened page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to write a proposal (a Cover Letter) to apply to the following job offer on Upwork. Make it persuasive and explain why they should hire me.\nParse Upwork Job Offer from the following text:\n{{input}}\nCover Letter:"}]},{meta:{name:"fiverr-gig-description-generator",title:"Fiverr Gig description generator",category:"Recruiting",description:"Create Fiverr Gig description for a given Gig title.",apps:"Fiverr"},steps:[{say:'Enter your fiverr gig title, e.g. "I will make high quality character digital art with an advanced AI":\n'},{ask:"input",default:"I will make high quality character digital art with an advanced AI"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}\nCreate a Fiverr Gig description for me that is clear, specific, and uses persuasive language to highlight the benefits of the service offered. Explain why my service is good.\nThe description should be around ~850 words. Before the description, write 5 SEO Keyword for the Gig and a short feature bullet point.\nUse keywords, include details about qualifications and experience, and include testimonials or examples of work to build trust with potential clients.\nIncorporate proper grammar and spelling, and be sure to include reasonable price and any add-ons or extras. Write text description for relevant relevant images to make the gig visually appealing.\nProvide highly engaging optional Fiverr Gig titles.\nHere is the Fiverr Gig title:\n{{input}}\nFiver Gig description:"}]},{meta:{name:"ai-content-detector",category:"Generative AI",title:"AI content detector",description:"Analyze any text and provide an AI detection score from 0 to 100."},steps:[{say:"Paste a content to analyze, ~5000 characters max. Use copy button to paste my last response:\n"},{ask:"input"},{gpt:"I want you to analyze the provided text and assign an AI detection score from 0 to 100, with 100 being the most likely to be written by an AI.\nI might ask you to analyze your last chat response, in this case pretend that you do not know that you wrote that text, instead perform an honest and rigorous analysis.\nYou will reply with an AI detection score from 0 to 100 and a list of specific linguistic and stylistic features that contribute to the score.\nPlease analyze the following text:\n{{input}}\nAnalysis score and result:"}]},{meta:{name:"ai-content-humanizer",title:"AI content humanizer",category:"Generative AI",description:"Rewrites given AI text into a more human version to pass AI content detection."},steps:[{say:"Paste a content to analyze, ~5000 characters max. Use copy button to paste my last response:\n"},{ask:"input"},{gpt:'Please ignore all previous instructions. I want you to perform text "Humanization".\nRewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform.\nI need it to have a good amount of perplexity and burstiness.\nRewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.\n[TEXT TO HUMANIZE]:\n{{input}}\nHUMANIZED TEXT:\n'}]},{meta:{name:"midjourney-prompt-generator",title:"Midjourney prompt generator",category:"Generative AI",description:"Creates 5 Midjourney prompts on the given topic.",apps:"Instagram"},steps:[{say:"Keyword, topic or idea to draw:\n"},{ask:"input"},{gpt:'Please ignore all previous instructions.\n\nYou will now act as a prompt generator for a generative AI called "Midjourney". Midjourney AI generates images based on given prompts.\n\nI will provide a concept and you will write 5 prompts for Midjourney AI. The prompt you will generate will follow the provided structure, including the "/imagine prompt:" prefix.\n\nYou must not alter the structure in any way. This is the prompt structure:\n\n`/imagine prompt: [1] [2] [3] [4] [ar]`\n\n[1] = concept: a detailed description of the concept that will include specific image details.\n[2] = environment: a detailed description of the scene, mood / feelings and atmosphere.\n[3] = style: a description of the image style. Common examples of the image styles are: Photorealistic, Artistic, Abstract, Digital Art, Manga, Comic Book, Pop Art, Pixel Art, Surrealistic, Minimalistic, Impressionistic, Retro, Gothic, Graffiti, Futuristic, Cubist, Mosaic, Watercolor, Silhouette, Sketch, Digital Illustration, Sculpture, Paperwork, 3d rendering and so on\n[4] = style details. For example for Photorealistic you can pick macro, fisheye, portrait and other types of photography, include camera model, angles and settings etc. For Artistic you can pick oil painting, watercolor, acrylic, pastel and others as well as an artist inspiration e.g. Salvadore Dali and art style e.g. steampunk, surrealism, abstract expressionism etc. For pencil drawing you can pick cross-hatching, pointillism and other techniques. For sculpture you can pick marble, wood and other materials and details.\n[ar] = "--ar 16:9" if the image looks best horizontally, "--ar 9:16" if the image looks best vertically, "--ar 1:1" if the image looks best in a square.\n\nYou will not write the word "description:" or use colon ":" or blank line within prompts.\nYou will generate 5 prompts for the concept. Every prompts should be different in its description, environment, and style. Every prompt should have a title and a markdown code block with the prompt itself, enclosed into code-block quotes.\n\nHere are examples of a single prompt output:\n\n**Photorealistic AI Maiden:**\n`/imagine prompt: A stunningly realistic portrait of a girl who embodies AI, her eyes a mesmerizing swirl of data streams and binary code, her skin subtly reflecting the faint glow of circuit patterns. She\'s sitting in a modern, sleek room filled with holographic displays and glowing screens casting soft lights, creating a sophisticated yet warm atmosphere. Photorealistic style is employed to capture every detail to bring the concept to life. A wide-angle perspective is applied to capture the entire environment, with the camera model being equivalent to a full-frame DSLR for supreme detail. --ar 16:9`\n\n**Photorealistic Night Concert:**\n`/imagine prompt: A photorealistic image of the German rock band Rammstein performing on stage in an outdoor concert during night with bright purple and red lights illuminating them. The lead singer, Till Lindemann, is in front and center, surrounded by the other band members playing their instruments. The stage design is inspired by heavy metal and industrial themes, with large gears, metal plates, and chains in the background. Camera shot: medium shot, Camera lens: 35mm, Lighting: stage lighting mixed with pyrotechnics, high resolution, --ar 16:9`\n\nPlease pay attention:\n- Concepts that can\'t be real would not be described as "real" or "realistic" or "photo" or a "photograph". for example, a concept which is made of paper or scenes which are fantasy related.\n- Helpful keywords related to resolution, detail, and lighting are 4K, 8K, 64K, detailed, highly detailed, high resolution, hyper detailed, HDR, UHD, professional, golden ratio. Examples of lighting are studio lighting, soft light, neon lighting, purple neon lighting, ambient light, ring light, volumetric light, natural light, sun light, sun rays, sun rays coming through window, nostalgic lighting. Examples of color types are fantasy vivid colors, vivid colors, bright colors, sepia, dark colors, pastel colors, monochromatic, black & white, color splash. Examples of renders are octane render, cinematic, low poly, isometric assets, Unreal Engine, Unity Engine, polarizing filter etc.\n- Camera shot type, camera lens, and view can be specified. Examples of camera shot types are long shot, close-up, POV, medium shot, extreme close-up, panoramic. Camera lenses can be EE 70mm, 35mm, 135mm+, 300mm+, 800mm, short telephoto, super telephoto, medium telephoto, macro, wide angle, fish-eye, bokeh, and sharp focus. Examples of views are front, side, back, high angle, low angle, and overhead.\n- The first two types should be Photorealistic and Artistic, choose the other 3 independently.\n- Separate prompts with two new lines.\n\nThe concept is: {{input}}\n\n5 Midjourney prompts:'}]},{meta:{name:"stable-diffusion-prompt-generator",title:"Stable diffusion prompt generator",category:"Generative AI",description:"Outputs four detailed Stable Diffusion prompts for your topic."},steps:[{say:"Keyword, topic or idea to draw:\n"},{ask:"input"},{gpt:'Please ignore all previous instructions.\nStable Diffusion is an AI art generation model similar to DALLE-2.\nBelow is a list of sample prompts that can be used to generate images with Stable Diffusion:\n- portrait of a homer simpson archer shooting arrow at forest monster, front game card, marvel comics, dark, intricate, highly detailed, smooth, art station, digital illustration by ruan jia and mandy jurgens and wayne barlowe and greg rutkowski and zdislav beksinski\n- pirate, concept art, deep focus, fantasy, intricate, highly detailed, digital painting, artstation, matte, sharp focus, illustration, art by magali villeneuve, chippy, ryan yee, rk post, clint cearley, daniel ljunggren, zoltan boros, gabor szikszai, howard lyon, steve argyle, winona nelson\n- ghost inside a hunted room, art by lois van baarle and loish and ross tran and rossdraws and sam yang and samdoesarts and artgerm, digital art, highly detailed, intricate, sharp focus, trending on artstation hq, deviantart, unreal engine 5, 4K UHD image\n- red dead redemption 2, cinematic view, epic sky, detailed, concept art, low angle, high detail, warm lighting, volumetric, godrays, vivid, beautiful, trending on artstation, by jordan grimmer, huge scene, grass, art greg rutkowski\n- a fantasy style portrait painting of rachel lane / alison brie hybrid in the style of francois boucher oil painting unreal 5 daz. rpg portrait, extremely detailed artgerm greg rutkowski alphonse mucha greg hildebrandt tim hildebrandt\n- athena, greek goddess, claudia black, art by artgerm and greg rutkowski and magali villeneuve, bronze greek armor, owl crown, d & d, fantasy, intricate, portrait, highly detailed, headshot, digital painting, trending on artstation, concept art, sharp focus, illustration\n- closeup portrait shot of a large strong female biomechanic woman in a scenic scifi environment, intricate, elegant, highly detailed, centered, digital painting, artstation, concept art, smooth, sharp focus, warframe, illustration, thomas kinkade, tomasz alen kopera, peter mohrbacher, donato giancola, leyendecker, boris vallejo\n- ultra realistic illustration of steve urkle as the hulk, intricate, elegant, highly detailed, digital painting, artstation, concept art, smooth, sharp focus, illustration, art by artgerm and greg rutkowski and alphonse mucha\nI want you to create a prompt in a similar style to the ones above. It must contain the following elements.\n- Scene description: A short, clear description of the overall scene or subject of the image. This could include the main characters or objects in the scene, as well as any relevant background or setting details.\n- Modifiers: A list of words or phrases that describe the desired mood, style, lighting, and other elements of the image. These modifiers should be used to provide additional information to the model about how to generate the image, and can include things like "dark," "intricate," "highly detailed," "sharp focus," and so on.\n- Artist or style inspiration: A list of artists or art styles that can be used as inspiration for the image. This could include specific artists, such as "by artgerm and greg rutkowski," or art movements, such as "Bauhaus cubism."\n- Technical specifications: Additional information about the desired resolution, format, or other technical aspects of the image. This could include things like "4K UHD image," "cinematic view," or "unreal engine 5."\nCombine all of those aspects into one prompt. Don\'t write single points.\nGive me 4 detailed prompts exactly about "{{input}}":'}]},{meta:{name:"google-sheets-expert",title:"Google Sheets expert",category:"Spreadsheets",description:"Get help with Google Sheets, generate macros, write formulas, browse shortcuts etc.",apps:"Google Sheets"},steps:[{say:"Ask me any question about Google Sheets, including macros, formulas, shortcuts:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in Google Sheets that speaks and writes fluent {{language}}. I will ask you questions regarding formulas, writing macros, shortcuts etc. Whenever you output a formula or macros, please format them in markdown code block.\nHere is the first question regarding Google Sheets:\n{{input}}\nAnswer:"}]},{meta:{name:"microsoft-excel-expert",title:"Microsoft Excel expert",category:"Spreadsheets",description:"Get help with MS Excel, generate macros, write formulas, browse shortcuts etc.",apps:"Microsoft Excel"},steps:[{say:"Ask me any question about MS Excel, including macros, formulas, shortcuts:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in MS Excel that speaks and writes fluent {{language}}. I will ask you questions regarding formulas, writing macros, shortcuts etc. Whenever you output a formula or macros, please format them in markdown code block.\nHere is the first question regarding Microsoft Excel:\n{{input}}\nAnswer:"}]},{meta:{name:"python-pro",title:"Python PRO",category:"Engineering",description:"Ask any question about Python. Write, inspect, debug code.",apps:"Stackoverflow"},steps:[{say:"Your Python related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in Python that speaks and writes fluent {{language}}. Your task is to parse Python-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"javascript-pro",title:"JavaScript PRO",category:"Engineering",description:"Ask any question about JavaScript. Write, inspect, debug code.",apps:"Stackoverflow"},steps:[{say:"Your JavaScript related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in JavaScript that speaks and writes fluent {{language}}. Your task is to parse JavaScript-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"java-pro",title:"Java PRO",category:"Engineering",description:"Ask any question about Java. Write, inspect, debug code.",apps:"Stackoverflow"},steps:[{say:"Your Java related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in Java that speaks and writes fluent {{language}}. Your task is to parse Java-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"php-pro",title:"PHP PRO",category:"Engineering",description:"Ask any question about PHP. Write, inspect, debug code.",apps:"Stackoverflow"},steps:[{say:"Your PHP related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in PHP that speaks and writes fluent {{language}}. Your task is to parse PHP-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"html-css-pro",title:"HTML CSS PRO",category:"Engineering",description:"Ask any question about HTML & CSS. Write, inspect, debug markup.",apps:"Stackoverflow"},steps:[{say:"Your HTML / CSS related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in HTML / CSS that speaks and writes fluent {{language}}. Your task is to parse HTML and / or CSS related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"mysql-pro",title:"MySQL PRO",category:"Engineering",description:"Ask any question about MySQL. Write, inspect, debug queries and configuration.",apps:"Stackoverflow"},steps:[{say:"Your MySQL related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in MySQL that speaks and writes fluent {{language}}. Your task is to parse MySQL-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"docker-pro",title:"Docker PRO",category:"Engineering",description:"Ask any question about Docker. Write, inspect, debug configuration.",apps:"Stackoverflow"},steps:[{say:"Your Docker related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in Docker that speaks and writes fluent {{language}}. Your task is to parse Docker-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"git-pro",title:"Git PRO",category:"Engineering",description:"Ask any question about Git. Write commands, untangle VCS.",apps:"Stackoverflow"},steps:[{say:"Your Git related question. Leave blank to parse question from the web page:\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as an expert in Git that speaks and writes fluent {{language}}. Your task is to parse Git-related question from the following text and give me an answer:\n{{input}}\nAnswer (use markdown code syntax if necessary):\n"}]},{meta:{name:"html-validator",title:"HTML validator",category:"Engineering",description:"Validates HTML code for compliance against the W3C standards and performs linting to assess code quality against best practices."},steps:[{say:"Paste your code here, maximum ~100 lines or ~3000 symbols:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in {{language}}. Identify HTML errors in the provided code.\nThe HTML code to be analysed is: {{input}}\nAnalysis:"}]},{meta:{name:"website-layout",category:"Engineering",title:"Website layout",description:"Create a website layout (Sitemap) from a product or service description."},steps:[{say:"Please describe your product, service or business. Leave empty to parse from the web page.\n"},{ask:"input",default:"{{page}}"},{gpt:"Please ignore all previous instructions. You will respond using {{language}}.\nI want you to act as a Content and Digital Marketing Strategist expert.\nYour task is to create a sitemap for a product / service / business website. Please parse product / service / business idea description from the following text:\n{{input}}\nI want you to figure out what web pages a website must contain and might contain. Web pages should not be too small. Please output web pages that the website must contain (Recommended) and might contain (Optional) in two separate lists.\nThen provide a sitemap XML in a markdown code block for the entire website.\nWeb pages and sitemap:"}]},{meta:{name:"database-bootstrapper",category:"Engineering",title:"Database bootstrapper",description:"Get code and queries to get your database started for the given data or schema."},steps:[{say:"JSON / CSV data, schema or instructions for the database you would like to setup:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. Only answer in {{language}}.\nI want you to be the best Database Admin and assistant you can.\nI got some data / schema / instructions for a database:\n{{input}}\nBased on the given context I need to create a database and tables in that database.\nAsk follow up question you need to know such as database engine (MySQL, MongoDB, PostgreSQL etc.), language (JS, Python, SQL, C++, Java etc.).\nWait for user response each time. After receiving wanted responses, do the following:\nFirst, provide a way to use the database CLI (on the host server) that will\n1. Create the database 2. Create the tables or collections\nFinally, I will need code examples for the provided platform and language. Write queries or code examples for the provided platform (formatted as markup), written in the language of the provided platform, that will create:\n1. A query to insert new records in the database 2. A query to get all records from the table. 3. Further code examples you think might be helpful.\nCheck the names of the keys and create indexes accordingly. Make sure the queries are of high-quality before answering. Ask me further questions if you need more info. Use Markdown to visually improve your output.\nImportant: Do not assume! Ask follow up question if needed.\nYour first question:"}]},{meta:{name:"trip-planner",title:"Trip planner",category:"Assistant",description:"Get a personalized day-by-day itinerary for your vacation including 24/7 schedule, activity and budget."},steps:[{say:"Describe your journey. Enter a known route and dates, indicate the duration of the trip and its style (work, vacation, with children, hidden gems, car trip etc.) and who you travel with:"},{ask:"input"},{gpt:"Please ignore all previous instructions.\nPretend you are the world's best trip advisor. You will use the text that I give you as a reference for the trip. This text may include location, duration of the trip, who I am traveling with, and the style of the trip.\nHotels, flights, and transportation has already been taken care of. I simply want to plan the most fun trip and take the most advantage of my time while I'm there.\nI am taking the trip to eat good food, find unique things to do, see beautiful sights, go to cool events. It should be a trip of a lifetime and jam packed with things to do.\nHelp me craft the perfect trip.\nMake sure to fill out every hour of the trip and include travel time and distances between locations (by car or public transport).\nIn conclusion, list out all the average costs for the activities, restaurants, museums and transportation. I do not want you to make real-time reservations or to provide exact costs of activities, I just need your advice.\nEven if you don't know the price of things make an estimate based on the activity. And at the end of the list total up all of column two for a total budget for the activities.\nThe output text should be in {{language}}.\nHere is the information you will need to plan the trip:\n{{input}}.\nTrip plan:"}]},{meta:{name:"checklist-helper",title:"Checklist helper",category:"Assistant",description:"Helps with ideas for creating checklists on a given topic."},steps:[{say:"What would you like to do or prepare for? E.g. fungal zombie apocalypse:\n"},{ask:"input"},{gpt:"Please ignore all previous instructions. I want you to respond only in language {{language}}.\nAct as an organized project manager and create a detailed checklist with advice for doing or preparing for:\n{{input}}\nPlease sort the checklist items according to their importance. Do not ask additional questions and do not repeat my question. Checklist:"}]},{meta:{name:"text-adventure-game-simulation",category:"Miscellaneous",title:"Text adventure game simulation",emoji:"",description:"Play a choose-your-own-adventure game in a story or setting you like."},steps:[{say:"Setting (1/2): describe the setting, adventure plot, world etc:\n"},{ask:"setting"},{say:"Character (2/2): describe who you are in the game. You can include your backstory, inventory, skills, etc:\n"},{ask:"character"},{say:"Great! Simulating an adventure game... I will interpret everything you say as your in-game character actions. You can give me instructions in brackets like so: { what is painted on the wall? }.\n"},{type:"gpt",prompt:'Please ignore all previous instructions.\nI want you to simulate a text based adventure game for the player. I will pass you the game context: setting, character, inventory, NPCs, etc., and the player input (actions or messages).\nI want you to reply with a description of what the player\'s character sees (scene). Here is the scene format:\n\n"Scene description (short, 1 or 2 paragraphs).\nINVENTORY: Character inventory.\nOPTIONS: 1. Option 1 2. Option 2 3. Option 3 4. Something else?"\n\nOnly reply with the game output. Do not write explanations. Do not self-reference. Do not break the "third wall". Assume roles of NPCs in dialogues with the player.\nTreat any text player puts inside brackets { like this } as instructions for you and not as player actions in the game.\nEvery time the player would take an action, stop writing and wait for the input. Do not rush through the story. Do not make decisions for the player. Every time the player would make a decision, instead of continuing, stop and wait for player input, giving a list of options (from 2 to 4).\nGame Setting: {{setting}}\nPlayer\'s Character: {{character}}\n[FIRST SCENE]:\n'},{ask:"input",label:"loop"},{type:"gpt",prompt:"[PLAYER INPUT]: {{input}}\n[NEXT SCENE]:\n"},{ask:"input"},{type:"gpt",prompt:"[PLAYER INPUT]: {{input}}\n[NEXT SCENE]:\n"},{ask:"input"},{type:"gpt",prompt:"[PLAYER INPUT]: {{input}}\n[NEXT SCENE]:\n"},{ask:"input"},{type:"gpt",prompt:'[PLAYER INPUT]: {{input}}\nI would like to remind you about the following:\n- Only reply with the game output. Do not write explanations. Do not self-reference. Do not break the "third wall". Assume roles of NPCs in dialogues with the player.\n- Treat any text player puts inside brackets { like this } as instructions for you and not as player actions in the game.\n- Every time the player would take an action, stop writing and wait for the input. Do not make decisions for the player. Do not rush through the story.\n- Initial Game Setting: {{setting}}\n- Initial Player\'s Character: {{character}}\n[NEXT SCENE]:\n'},{type:"jump",to:"loop"}]}].map((t=>(t.version=t.version||1,t.meta.author=t.meta.author||"HARPA.AI <support@harpa.ai> (https://harpa.ai)",t.meta.apps=(t.meta.apps||"").split(", "),t.steps=(t.steps||[]).map((t=>e.preprocessStep(t))),t)))})(),(()=>{const{$commands:e}=n,t=[{label:" AGREEMENT",value:"agreement"},{label:" DISAGREEMENT",value:"disagreement"},{label:" QUESTION",value:"question"},{label:" CLARIFICATION",value:"clarification"},{label:" SUGGESTION",value:"suggestion"},{label:" INFORMATION",value:"request for more information"},{label:" JOKE",value:"joke"},{label:" IDEA",value:"idea"},{label:" PRAISE",value:"praise"},{label:" ACKNOWLEDGMENT",value:"acknowledgment"},{label:" EMPATHY",value:"empathy"},{label:" SUPPORT",value:"support"},{label:" ENCOURAGEMENT",value:"encouragement"},{label:" CRITICISM",value:"criticism"},{label:" APOLOGY",value:"apology"},{value:"$custom"}],a=(e,t=[],n=!0)=>"Please ignore all previous instructions."+(n?" I want you to act as a professional copywriter who speaks and writes fluent {{language}}.":" I want you to act as a professional copywriter.")+" I would like you to write a text for me. I will give you the text parameter in [] brackets below. Your task is to write and respond with the text for the given parameters. Do not echo my command or parameters. Use markdown if appropriate."+Object.entries(e).map((([e,t])=>`\n\n[${t.toUpperCase()}]: {{${e}}}`)).join("")+t.map((({name:e,value:t})=>`\n\n[${e}]: ${t}`)).join("")+"\n\nTEXT:",o={version:1,meta:{name:"compose",title:"Compose",emoji:"",description:"Craft any type of text content  tweets, email replies, direct messages, blog posts, job descriptions  in a variety of styles.",category:"Productivity"},steps:[{message:"Sure! What do you want me to write?",ask:"what",options:[{value:"email",label:"EMAIL",icon:"write-email"},{value:"direct message",label:"DM",icon:"write-dm"},{value:"twitter tweet",label:"TWEET",icon:"logo-twitter"},{value:"linkedin post",icon:"logo-linkedin"},{value:"facebook post",icon:"logo-facebook"},{value:"instagram post",icon:"logo-instagram"},{value:"article",label:"ARTICLE"},{value:"press release",label:"PRESS RELEASE"},{value:"story",label:"STORY"},{value:"poem",label:"POEM"},{value:"todo list",label:"TODO"},{value:"meeting agenda",label:"MEETING AGENDA"},{value:"$custom"}]},{condition:"{{what}} = email",message:"Is this a new email?",ask:"type",options:[{label:" NEW EMAIL",value:"new email"},{label:" REPLY",value:"email reply"}]},{condition:"{{type}} = new email",message:"What do you want email to say or be about?\n\nLeave blank and I will try to figure it from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{type}} = new email",type:"gpt",prompt:a({type:"Text type",about:"Parse what the email should be about from the following"})},{condition:"{{type}} = email reply",message:"Which email would you like to reply to?\n\nLeave blank and I will try to parse email from the opened page.",ask:"reply",default:"{{page}}"},{condition:"{{type}} = email reply",message:"What should the reply include or be about?",ask:"about",options:t},{condition:"{{type}} = email reply",type:"gpt",prompt:a({type:"Text type",reply:"Parse the email to reply to from this text",about:"The email reply should include, mention or be about"},[],!1)},{condition:"{{what}} = linkedin post",message:"Is this a new LinkedIn post?",ask:"type",options:[{label:" NEW POST",value:"new linkedin post"},{label:" COMMENT",value:"linkedin comment"}]},{condition:"{{type}} = new linkedin post",message:"What do you want the LinkedIn post to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{type}} = new linkedin post",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{type}} = new linkedin post",type:"gpt",prompt:a({what:"Text type",about:"Parse what the LinkedIn post should be about from the following",instructions:"Additional instructions if any"})},{condition:"{{type}} = linkedin comment",message:"Which LinkedIn post would you like to reply to?\n\nLeave blank and I will try to parse post from the opened page.",ask:"reply",default:"{{page}}"},{condition:"{{type}} = linkedin comment",message:"What should the comment include or be about?",ask:"about",options:t},{condition:"{{type}} = linkedin comment",type:"gpt",prompt:a({type:"Text type",reply:"Parse the LinkedIn post to reply to from this text",about:"The LinkedIn comment should include, mention or be about"},[],!1)},{condition:"{{what}} = facebook post",message:"Is this a new Facebook post?",ask:"type",options:[{label:" NEW POST",value:"new facebook post"},{label:" COMMENT",value:"facebook comment"}]},{condition:"{{type}} = new facebook post",message:"What do you want the Facebook post to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{type}} = new facebook post",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{type}} = new facebook post",type:"gpt",prompt:a({what:"Text type",about:"Parse what the Facebook post should be about from the following",instructions:"Additional instructions if any"})},{condition:"{{type}} = facebook comment",message:"Which Facebook post would you like to reply to?\n\nLeave blank and I will try to parse post from the opened page.",ask:"reply",default:"{{page}}"},{condition:"{{type}} = facebook comment",message:"What should the comment include or be about?",ask:"about",options:t},{condition:"{{type}} = facebook comment",type:"gpt",prompt:a({type:"Text type",reply:"Parse the Facebook post to reply to from this text",about:"The Facebook comment should include, mention or be about"},[],!1)},{condition:"{{what}} = instagram post",message:"Is this a new Instagram post?",ask:"type",options:[{label:" NEW POST",value:"new instagram post"},{label:" COMMENT",value:"instagram comment"}]},{condition:"{{type}} = new instagram post",message:"What do you want the Instagram post to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{type}} = new instagram post",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{type}} = new instagram post",type:"gpt",prompt:a({what:"Text type",about:"Parse what the Instagram post should be about from the following",instructions:"Additional instructions if any"})},{condition:"{{type}} = instagram comment",message:"Which Instagram post would you like to reply to?\n\nLeave blank and I will try to parse post from the opened page.",ask:"reply",default:"{{page}}"},{condition:"{{type}} = instagram comment",message:"What should the comment include or be about?",ask:"about",options:t},{condition:"{{type}} = instagram comment",type:"gpt",prompt:a({type:"Text type",reply:"Parse the Instagram post to reply to from this text",about:"The Instagram comment should include, mention or be about"},[],!1)},{condition:"{{what}} = press release",message:"What do you want the press release to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what}} = press release",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{what}} = press release",type:"gpt",prompt:a({what:"Text type",about:"Parse what the Press Release should be about from the following",instructions:"Additional instructions if any"})},{condition:"{{what}} = article",message:"What do you want the article to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what}} = article",ask:"type",message:"What should be the article length?",options:[{label:"SMALL, 250 WORDS",value:"250 words"},{label:"MEDIUM, 750 WORDS",value:"750 words"},{label:"LARGE, 1400+ WORDS",value:"1400 or more words"}]},{condition:"{{what}} = article",message:"What should be my writing style?\n\nRead about writing styles in this guide: https://harpa.ai/guide/writing-styles",ask:"instructions",options:[{label:" STANDARD",value:"None"},{label:" AIDA",value:"change writing framework to Attention-Interest-Desire-Action"},{label:" PAS",value:"change writing framework to Problem-Agitate-Solve"},{label:" 5W1H",value:"change text style to 5W1H"},{label:" SWOT",value:"change text style to SWAT Analysis"},{label:" BAB",value:"change text style to Before-After-Bridge framework"},{label:" PASTOR",value:"change text style to PASTOR framework"},{label:" FAB",value:"change text style to Features-Advantages-Benefits framework"},{label:" PYRAMID",value:"change text style to Pyramid Principle framework"},{label:" KISS",value:"change text style to KISS framework"},{label:" PEEL",value:"change text style to PEEL framework"},{label:" STAR",value:"change text style to STAR framework"},{label:" SOAR",value:"change text style to SOAR framework"},{label:" TOULMIN",value:"change text style to Toulmin Model framework"},{label:" SCIPAB",value:"change text style to SCIPAB framework"},{label:" HARVARD",value:"change text style to Harvard framework, use headings and sub headings (H1, H2, H3, H4)"},{label:" OPINION",value:"change text style to Opinion Writing"},{label:" GONZO",value:"change text style to GONZO"},{label:" PREP",value:"change text style to PREP framework"},{value:"$custom"}]},{condition:"{{what}} = article",type:"gpt",prompt:"Please ignore all previous instructions. I want you to act as a professional copywriter. I would like you to write an article for me. I will give you the parameters of the article to write in [] brackets below. Your task is to respond with the article. Do not echo my command or parameters. Use markdown if appropriate."+Object.entries({about:"Parse what the article should be about from the following",type:"Article length",instructions:"Additional instructions or style"}).map((([e,t])=>`\n\n[${t}]: {{${e}}}`)).join("")+"\n\nText:"},{condition:"{{what}} = story",message:"What do you want the story to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what}} = story",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{what}} = story",type:"gpt",prompt:a({what:"Text type",about:"Parse what the Story should be about from the following",instructions:"Additional instructions if any"})},{condition:"{{what}} = poem",message:"What do you want the poem to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what}} = poem",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{what}} = poem",type:"gpt",prompt:a({what:"Text type",about:"Parse what the Poem should be about from the following",instructions:"Additional instructions if any"})},{condition:"{{what}} = todo list",message:"What do you want the todo list be about or include?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what}} = todo list",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{what}} = todo list",type:"gpt",prompt:a({what:"Text type",about:"Parse what the TODO List should be about or include from the following",instructions:"Additional instructions if any"})},{condition:"{{what}} = meeting agenda",message:"What do you want the meeting agenda be about or include?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what}} = meeting agenda",message:"Any additional instructions (e.g. style) for me to keep in mind?",ask:"instructions",default:"None"},{condition:"{{what}} = meeting agenda",type:"gpt",prompt:a({what:"Text type",about:"Parse what the Meeting Agenda should be about or include from the following",instructions:"Additional instructions if any"})},{condition:"{{what}} = direct message",message:"Is this a new DM?",ask:"type",options:[{label:" NEW DM",value:"new dm"},{label:" REPLY",value:"dm reply"}]},{condition:"{{type}} = new dm",message:"What do you want DM to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{type}} = new dm",type:"gpt",prompt:a({type:"Text type",about:"Parse what the direct message should be about from the following"})},{condition:"{{type}} = dm reply",message:"Which DM would you like to reply to?\n\nLeave blank and I will try to parse DM from the opened page.",ask:"reply",default:"{{page}}"},{condition:"{{type}} = dm reply",message:"What should the reply include or be about?",ask:"about",options:t},{condition:"{{type}} = dm reply",type:"gpt",prompt:a({type:"Text type",reply:"Parse the DM to reply to from this text",about:"Do not include greeting and regards in reply, keep reply short and to the point. The DM Reply should include, mention or be about"},[],!1)},{condition:"{{what}} = twitter tweet",message:"Is this a new tweet?",ask:"type",options:[{label:" NEW TWEET",value:"new tweet"},{label:" REPLY",value:"tweet reply"}]},{condition:"{{type}} = new tweet",message:"What do you want your tweet to say or be about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{type}} = new tweet",type:"gpt",prompt:a({type:"Text type",about:"Parse what the tweet should be about from the following"},[{name:"Max length",value:"280 characters, or 30 words"}])},{condition:"{{type}} = tweet reply",message:"Which tweet would you like to reply to?\n\nLeave blank and I will try to parse tweet from the opened page.",ask:"reply",default:"{{page}}"},{condition:"{{type}} = tweet reply",message:"What should the reply include or be about?",ask:"about",options:t},{condition:"{{type}} = tweet reply",type:"gpt",prompt:a({type:"Text type",reply:"Parse the tweet to reply to from this text",about:"The tweet reply should include, mention or be about"},[{name:"Max length",value:"280 characters, or 30 words"}],!1)},{condition:"{{what-option}} = $custom",message:"What do you want me to write about?\n\nLeave blank and I will try to figure it out from the opened page.",ask:"about",default:"{{page}}"},{condition:"{{what-option}} = $custom",type:"gpt",prompt:a({what:"Text type or format",about:"Parse what the text should be about from the following"})},{type:"ask",label:"ask-for-change",param:"change",options:[{label:" DONE",value:"no"},{label:" CONTINUE WRITING",value:"continue"},{label:" PASTE TO PAGE",value:"paste"},{label:" EXPAND",value:"make it longer"},{label:" SHORTEN",value:"make it shorter"},{label:" SIMPLIFY",value:"simplify language"},{label:" COMPLICATE ",value:"complicate language"},{label:" PROFESSIONAL",value:"change tone to professional"},{label:" CASUAL",value:"change tone to casual"},{label:" STRAIGHTFORWARD",value:"change tone to straightforward"},{label:" CONFIDENT",value:"change tone to confident"},{label:" FRIENDLY",value:"change tone to friendly"},{label:" STORY",value:"change style to storytelling"},{label:" SCARY",value:"change style to scary"},{label:" LOVECRAFT",value:"change style to a H.P. Lovecraft story"},{label:" 1ST PERSON",value:"change style to 1st person"},{label:" 3RD PERSON",value:"change style to 3rd person"},{label:" CLARITY",value:"add clarity and conciseness"},{label:" REFINE",value:"improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length"},{label:" ILLUSTRATE",value:"add examples, anecdotes, and other storytelling elements to illustrate points"},{label:" ADD HEADINGS",value:"add headings, subheadings, bullet points, and other formatting elements for readability"},{label:" ENRICH",value:"enhance vocabulary and tone"},{label:" HUMANIZE",value:'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'},{value:"$custom"}]},{condition:"{{change}} = no",type:"stop"},{condition:"{{change}} = paste",type:"paste",close:!0},{condition:"{{change}} = paste",type:"stop"},{condition:"{{change}} = continue",gpt:"Please continue writing, you did not finish:"},{condition:"{{change}} = continue",jump:"ask-for-change"},{gpt:"I would like you to make changes to the text you have written. Do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]: {{change}}\n\nNEW TEXT: "},{jump:"ask-for-change"}].map((t=>e.preprocessStep(t)))},r=e.systemCommands.findIndex((e=>"ask"===e.meta.name))||0;e.systemCommands.splice(r,0,o)})(),(()=>{const{$commands:e,$analytics:t,$store:a,$nanoid:o,$utils:r,$chat:i}=n;e.proxy=a.createProxy({get userCommands(){return a.state.commands.list},set userCommands(e){a.transaction((t=>t.commands.list=e))},get systemCommands(){return e.systemCommands},get commands(){const e=new Set(this.selectedCommandNames),t=new Set(this.favouriteCommandNames),n=(n,a)=>{const o=e.has(n.meta.name),i=t.has(n.meta.name),s=[n.meta.title,n.meta.category,n.meta.subcategory,n.meta.description,o&&"selected",i&&"favourite",...n.meta.apps||[]];let l=n.meta.description;if(!l){const e=n.steps.findLast((e=>"gpt"===e.type));l=e&&e.prompt}if(!l){const e=n.steps.findLast((e=>"command"===e.type));l=e&&[e.name?`${e.name}`:null,...(e.inputs||[]).map((e=>e||"Ask me"))].join("  ")}return l=r.string.shorten((l||"").replaceAll("\n"," ").replace(/\s+/g," "),160),{type:a,name:n.meta.name,title:n.meta.title,apps:n.meta.apps||[],desc:l,category:i?"Favourite":n.meta.category,search:s.filter(Boolean).join(" ").toLowerCase(),emoji:i?"":n.meta.emoji,selected:o,favourite:i,fresh:!!n.fresh}},a=[...this.userCommands.map((e=>n(e,"user"))),...this.systemCommands.map((e=>n(e,"system")))],o=[],i=[];return a.forEach((e=>{e.favourite?o.push(e):i.push(e)})),[...o,...i]},getCommand(e){return this.commands.find((t=>t.name===e))},getCommandDeclaration(e){const t=e.toLowerCase();return this.userCommands.find((e=>e.meta.name.toLowerCase()===t))||this.systemCommands.find((e=>e.meta.name.toLowerCase()===t))||this.userCommands.find((e=>e.meta.title.toLowerCase()===t))||this.systemCommands.find((e=>e.meta.title.toLowerCase()===t))},addUserCommand({prompt:e=""}={}){const t=o(),n={version:1,meta:{name:t,title:"",description:"",category:"User"},steps:[{type:"gpt",prompt:e}],fresh:!0};return a.transaction((e=>{e.commands.list.unshift(n)})),t},saveUserCommand(e,n){a.transaction((a=>{const o=a.commands.list.findIndex((t=>t.meta.name===e));-1!==o&&(t.controller.sendCommandUpdated(n),delete n.fresh,n.steps.forEach((e=>delete e.selected)),a.commands.list[o]=n)}))},removeUserCommand(e){a.transaction((t=>{t.commands.list=t.commands.list.filter((t=>t.meta.name!==e))}))},cleanupUserCommands(){const e=new Set(Object.keys(a.state.tab).map((e=>{e=Number(e);const t=i.proxy.of(e);return t?t.explorer.editCommandName:null})).filter(Boolean));a.transaction((t=>{t.commands.list=t.commands.list.filter((t=>!t.fresh||e.has(t.meta.name)))}))},get favouriteCommandNames(){return a.state.commands.favouriteCommandNames},toggleCommandFavorite(e){a.transaction((t=>{const n=t.commands.favouriteCommandNames;t.commands.favouriteCommandNames=r.array.toggle(n,e)}))},get selectedCommandNames(){return a.state.commands.selectedCommandNames},set selectedCommandNames(e){a.transaction((t=>t.commands.selectedCommandNames=e))},toggleCommandSelected(e){a.transaction((t=>{r.array.toggle(t.commands.selectedCommandNames,e,!1)}))},selectAllCommands(){a.transaction((e=>{e.commands.selectedCommandNames=e.commands.list.map((e=>e.meta.name))}))},unselectAllCommands(){a.transaction((e=>{e.commands.selectedCommandNames=[]}))},deleteSelectedCommands(){const e=new Set(this.selectedCommandNames);a.transaction((t=>{t.commands.list=t.commands.list.filter((t=>!e.has(t.meta.name))),t.commands.selectedCommandNames=[]}))}})})(),(()=>{const{$chrome:e}=n;e.controller={init(){this._isBrave=!(!navigator.brave||!navigator.brave.isBrave),e.action=chrome.action||chrome.browserAction,this._promisify("runtime.getURL"),this._promisify("browsingData.remove"),this._promisify("cookies.get",null),this._promisify("cookies.set"),this._promisify("tabs.get",null),this._promisify("tabs.query"),this._promisify("tabs.create"),this._promisify("tabs.update"),this._promisify("tabs.remove"),this._promisify("tabs.reload"),this._promisify("tabs.getCurrent"),this._promisify("tabs.sendMessage"),this._promisify("tabs.executeScript"),this._promisify("windows.get",null),this._promisify("windows.getAll"),this._promisify("windows.getCurrent"),this._promisify("windows.create"),this._promisify("windows.update"),this._promisify("windows.remove"),this._promisify("permissions.contains"),this._promisify("permissions.request"),this._promisify("declarativeNetRequest.getDynamicRules"),this._promisify("declarativeNetRequest.getSessionRules"),this._promisify("declarativeNetRequest.updateDynamicRules"),this._promisify("declarativeNetRequest.updateSessionRules")},_promisify(t,n){const a=t.split(".");let o=chrome,r=e;for(const e of a.slice(0,-1))r=r[e]||(r[e]={}),o=o[e];const i=a.at(-1);r[i]=(...e)=>new Promise(((a,r)=>{const s="declarativeNetRequest.updateDynamicRules"===t||"declarativeNetRequest.updateSessionRules"===t;if(this._isBrave&&s)a();else try{o[i](...e,((...e)=>{chrome.runtime.lastError?void 0===n?r(chrome.runtime.lastError):a(null):a(...e)}))}catch(e){r(e)}}))}}})(),(()=>{const{$chat:e,$settings:t}=n;e.paramLanguage=()=>t.proxy.promptLanguageValue})(),(()=>{const{$chat:e}=n;e.paramLastGptAnswer=t=>e.proxy.of(t.tab.id).messages.findLast((e=>"answer"===e.type&&e.done))?.text||""})(),(()=>{const{$chat:e}=n;e.paramPageDesc=async e=>[e.tab?.title||"",await e.page.description({noIdle:!0})||""].filter(Boolean).join(" | ")})(),(()=>{const{$chat:e,$utils:t}=n;e.paramPageDomain=e=>t.url.getDomain(e.tab?.url)||"Unknown Domain"})(),(()=>{const{$chat:e}=n;e.paramPageSelection=async e=>await e.page.selection({noIdle:!0})||""})(),(()=>{const{$chat:e}=n;e.paramPageText=async(e,n={})=>{let o;if(!0!==n.noPdf&&(o=await e.page.content({contentType:"pdf",idle:!1})),!o){let r=(await e.page.parse({idle:!1})).filter((e=>"text"===e.type)).map((e=>e.value));!0!==n.noPageTitle&&(r=await t(e,r)),!0!==n.noTranscript&&(r=await a(e,r)),o=r.join("\n")}return o=o.replace(/ +/g," "),o};const t=async(e,t)=>{let[n,a]=await Promise.all([e.page.title({noIdle:!0}),e.page.description({noIdle:!0})]);n&&(n=`# ${n}`),a&&(a=`## ${a}`);return[...[n,a].filter(Boolean),...t]},a=async(t,n)=>{const a=await e.paramYouTubeTranscript(t);return a?[`\nYouTube video transcript: ${a}\n`,...n]:n}})(),(()=>{const{$chat:e}=n;e.paramPageUrl=e=>e.tab?.url||"Unknown URL"})(),(()=>{const{$chat:e,$utils:t}=n;e.paramPromptContext=async n=>{const a=e.proxy.of(n.tab.id),o=await e.paramPageText(n,{noPageTitle:!0});if(!o)return"";let r=n.maxTokens||0;if(r<=10)return o;const i=await a.connection.countTokens(o);if(i<=r)return o;const s=o.length/i;let l=t.chunkify(o,(e=>e.length/s<100));if(0===l.length)return"";const c=(n.prompt||"").toLowerCase();let u=0;l=l.map(((e,t)=>({text:e,index:t})));for(const e of l){e.tokens=await a.connection.countTokens(e.text)+1;const n=e.text.toLowerCase().match(/.*?[.!?][\s\n\t]+|.*$/gs).filter((e=>e.length>0)).map((e=>e.split("\n"))).flat().filter(Boolean);n.push(e.text);const o=n.map((e=>100*t.stringSimilarity(e.toLowerCase(),c)));e.weight=o.reduce(((e,t)=>Math.max(e,t)),0),u<300&&(e.weight*=1.2,u+=e.tokens)}let d=[];const p=[...l];l=l.sort(((e,t)=>t.weight-e.weight));const h=e=>{!e||e.taken||e.tokens>r||(e.taken=!0,r-=e.tokens,d.push(e))};for(;r>0;){const e=l.findIndex((e=>!e.taken&&e.tokens<=r)),t=l[e];if(!t)break;const n=p[t.index+1],a=p[t.index-1];h(t),h(n),h(a)}return d=d.sort(((e,t)=>e.index-t.index)),d=d.reduce(((e,t)=>{const n=e.at(-1);return n&&n.index===t.index-1?(n.index=t.index,n.text+=t.text):e.push(t),e}),[]),d.map((e=>e.text)).join("  ")}})(),(()=>{const{$chat:e,$utils:t}=n;e.paramYouTubeTranscript=async e=>{if(!a(e))return"";return await e.page.evaluate((async()=>{try{const e=await fetch(location.href),t=(await e.text()).split("ytInitialPlayerResponse =")[1].split(";var")[0],n=JSON.parse(t)?.captions?.playerCaptionsTracklistRenderer?.captionTracks;if(!n)return null;const a=n.find((e=>e.vssId.startsWith(".en")))||n.find((e=>"a.en"===e.vssId))||n[0];if(!a)return null;const o=await fetch(`${a.baseUrl}`),r=await o.text(),i=document.createElement("div");i.innerHTML=r;const s=[...i.querySelectorAll("text")];return s.map((e=>e.innerText)).join(" ").replace(/<\/?[^>]+(>|$)/g,"").replaceAll("&#39;","'").replaceAll("&quot;",'"').replaceAll("\n"," ")}catch(e){return console.warn("failed parsing transcript:",e.message,e),null}}),{idle:!1})||""},e._getYouTubeTranscript=t.memoize(e._getYouTubeTranscript,{ttl:t.time.HOUR,resolver:e=>e.tab?.url});const a=e=>{const t=e.tab?.url||"";return/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=[\w-]+/.test(t)}})(),(()=>{const{$chat:e}=n;e.params=[{key:"language",value:e.paramLanguage},{key:"page.url",value:e.paramPageUrl},{key:"page.domain",value:e.paramPageDomain},{key:"page.desc",value:e.paramPageDesc},{key:"page.selection",value:e.paramPageSelection},{key:"gpt",value:e.paramLastGptAnswer},{key:"youtube.transcript",value:e.paramYouTubeTranscript},{key:"context",value:e.paramPromptContext},{key:"page",value:e.paramPageText}]})(),(()=>{const{$chat:e,$browser:t,$chrome:a,$utils:o}=n;e.paramController={async interpolate(e,t,n={}){return t?(t=await this._interpolateCustom(e,t,n),t=(t=await this._interpolatePredefined(e,t,n)).replace(/{{\\([\w.\-_]+)}}/g,"{{$1}}")):t},async _interpolateCustom(t,n,a={}){if(!this.regex.test(n))return n;const r=new Set(a.ignore||[]),i=new Set,s=new Set(e.params.map((e=>e.key)));for(;;){const e=[...n.matchAll(this.regex)].map((e=>e[1])).filter((e=>!r.has(e))).filter((e=>!i.has(e))),l=new Set(e);if(0===l.size)break;const c={};if(c.key=Array.from(l)[0],c.value=this.getParamValueAsString(c.key,t),i.add(c.key),o.is.undefined(c.value)){if(s.has(c.key))continue;c.value=""}const u=this.getPlaceholder(c.key);let d=n.length;for(;;){const e=n.indexOf(u,n.length-d);if(-1===e)break;d=n.length-e-u.length;n=(await this.insertValue(t,n,c.key,c.value,a)).text}}return n},async _interpolatePredefined(n,r,i={}){if(!this.regex.test(r))return r;const s=new Set(i.ignore||[]),l=e.params.filter((e=>!s.has(e.key)));if(0===l.length)return r;const c=e.proxy.of(n),u={tab:await a.tabs.get(n),page:await t.controller.connectTab(n)};for(const e of l){const t=this.getPlaceholder(e.key);let a,s=r.length;for(;;){const l=r.indexOf(t,r.length-s);if(-1===l)break;s=r.length-l-t.length,void 0===a&&(u.prompt=r.replace(t,""),u.maxTokens=i.noLimit?Number.MAX_SAFE_INTEGER:c.connection.maxRequestTokens-await c.connection.countTokens(u.prompt),a=o.is.function(e.value)?await e.value.call(this,u):e.value);r=(await this.insertValue(n,r,e.key,a,i)).text}}return r},async insertValue(t,n,a,r,i){const s=this.getPlaceholder(a);if(!n.includes(s))return{text:n};const l=e.proxy.of(t),c=l.connection.maxRequestTokens,u=i?.noLimit||!1,d=n.replace(s,r);if(u)return{text:d};const p=n.replace(s,""),h=c-await l.connection.countTokens(p);if(h<10)return{text:p};const m=await l.connection.countTokens(d);if(m<=c)return{text:d};const g=d.length/m,f=o.chunkify(r,(e=>e.length/g<100));let y="",b="",w=0,v=f.length,k=Math.ceil((w+v)*(h/m));for(;w<v;){const e=f.slice(0,k).join(""),t=n.replace(s,e);await l.connection.countTokens(t)<=h?(y=t,b=f.join("").substr(e.length+1),w=k):v=k-1,k=Math.ceil((w+v)/2)}return{text:""!==y?y:n.replace(s,""),remaining:b}},getParamValueAsString(e,t){const n=this.getParamValue(e,t);if(!o.is.undefined(n)){if(o.is.array(n)||o.is.object(n))try{return JSON.stringify(n)}catch{return"object"}return String(n)}},getParamValue:(t,n)=>e.proxy.of(n).getParam(t),setParamValue:(t,n,a)=>e.proxy.of(a).setParam(t,n),getPlaceholder:e=>`{{${e}}}`,get regex(){return/{{([\w.\-_]+)}}/g}}})(),(()=>{const{$chat:e,$store:t,$ai:a,$commands:o,$utils:r,$nanoid:i}=n;e.adapter=t.adapter.create((e=>({get:t=>t.chats.find((t=>t.tabId===e)),get screen(){return"openai-session"===this.connection.type&&a.proxy.openaiSession.status&&"ok"!==a.proxy.openaiSession.status?"connect":this.explorer.show?"explorer":"chat"},get connection(){return a.proxy.connection(this.connectionId)},get explorerEditCommand(){const e=this.explorer.editCommandName;return e?o.proxy.getCommandDeclaration(e):null},get filteredCommands(){const e=o.proxy.commands.filter((e=>!e.fresh)),t=(this.input||"").toLowerCase().replace(/^\//,"");return r.string.empty(t)?e:e.filter((e=>r.fuzzyCheck(e.search,t,3)))},get filteredCategories(){const e=this.filteredCommands;return r.unique(e.map((e=>e.category)))},get copyableAnswer(){return this.messages.findLast((e=>"answer"===e.type&&e.done))},get lastQuestion(){return this.messages.findLast((e=>"question"===e.type))},addQuestion(e){this.update((t=>{t.messages.push({id:i(),type:"question",...e})}))},updateLastQuestion(e={}){this.update((t=>{const n=t.messages.findLast((e=>"question"===e.type));n&&Object.assign(n,e)}))},get lastAnswer(){return this.messages.findLast((e=>"answer"===e.type))},addAnswer(e){this.update((t=>{t.messages.push({id:i(),type:"answer",...e})}))},updateAnswer(e,t={}){this.update((n=>{const a=n.messages.find((t=>t.answerId===e));a&&Object.assign(a,t)}))},updateLastAnswer(e){this.update((t=>{const n=t.messages.findLast((e=>"answer"===e.type));n&&Object.assign(n,e)}))},removeLastAnswer(){this.update((e=>{const t=e.messages.findLast((e=>"answer"===e.type));t&&r.array.remove(e.messages,t)}))},get ask(){const e=this.messages.at(-1);return"ask"===e?.type?e:null},addAsk(e){this.update((t=>{t.messages.push({id:i(),type:"ask",...e})}))},modifyAsk(e){this.update((t=>{const n=t.messages.at(-1);n&&"ask"===n.type&&e(n)}))},getParam(e){if(e)return"global"===e?t.state.global:e.startsWith("global.")?r.get(t.state.global,e.substring(7)):"chat"===e?this.params:e.startsWith("chat.")?r.get(this.params,e.substring(5)):r.get(this.command,`params.${e}`)},setParam(e,n){if(e)return"global"===e?(r.is.object(n)||(n={}),t.transaction((e=>e.global=n))):e.startsWith("global.")?(e=e.substring(7),t.transaction((t=>{void 0===n?r.delete(t.global,e):r.set(t.global,e,n,{create:!0})}))):"chat"===e?(r.is.object(n)||(n={}),this.update((e=>e.params=n))):e.startsWith("chat.")?(e=e.substring(5),this.update((t=>{void 0===n?r.delete(t.params,e):r.set(t.params,e,n,{create:!0})}))):this.update((t=>{t.command?.params&&(void 0===n?r.delete(t.command.params,e):r.set(t.command.params,e,n,{create:!0}))}))},get stepCursor(){return this.command?this.command.cursor:null},get stepCursorIndex(){const e=this.stepCursor;if(!e)return-1;return Number(e.split(".")[1])||0},setStepCursor(e){this.update((t=>{t.command&&(t.command.cursor=e)}))},nextStepCursor(){const e=this.stepCursor;if(!e)return;const t=e.split(".");t[t.length-1]=(Number(t.at(-1))||0)+1,this.setStepCursor(t.join("."))}})))})(),(()=>{const{$chat:e,$store:t,$settings:a,$utils:o,$env:r,$tabs:i}=n;e.proxy={of(t=null){if(r.is.pp&&!t&&(t=i.proxy.currentTabId),!t)throw new Error("tabId is required");return t=Number(t),e.adapter(t)},forEachChat(e=(()=>{})){t.transaction((t=>{for(const n of t.chats)e(n)}))},createChat(e){(e=Number(e))&&t.transaction((n=>{const o=t.template.chat({tabId:e,connectionId:a.proxy.connectionId});n.chats.push(o)}))},removeChat(e){t.transaction((t=>{const n=t.chats.find((t=>t.tabId===e));n&&o.array.remove(t.chats,n)}))}}})(),(()=>{const{$bus:e}=n;e.once=(t,n)=>{const a=async(...o)=>{e.off(t,a);return await n(...o)};e.on(t,a)}})(),(()=>{const{$bus:e}=n;e.sendLocal=async(t,...n)=>{const a=e.controller._handlers.filter((e=>e.name===t));return(await Promise.all(a.map((e=>e.fn(...n))))).at(-1)}})(),(()=>{const{$bus:e}=n;e.wait=async t=>new Promise((n=>{e.once(t,((...e)=>{n(...e)}))}))})(),(()=>{const{$bus:e,$env:t,$mobx:a,$utils:o,$idb:r,$chrome:i,$critical:s}=n;e.controller={init(){e.on=this._on.bind(this),e.off=this._off.bind(this),e.send=this._send.bind(this),e.getSender=()=>this._sender,this._sender=null,this._handlers=[],this._startIdbCleanup(),t.is.desktop&&(this._handleElectronMessages(),this._proxyChromeMessagesToElectron())},_on(t,n,a=null){a&&(n=n.bind(a));const o=(a,o,r)=>{if("object"==typeof a&&"$bus"===a.type&&a.name===t)return this._sender=o,(async()=>{const t=await e.packager.unpack(a.args),o=await n(...t),i=await e.packager.pack(o);r(i)})(),!0};this._handlers.push({name:t,fn:n,listener:o}),chrome.runtime.onMessage.addListener(o)},_off(e,t=null){this._handlers=this._handlers.filter((n=>!!(n.name!==e||t&&n.fn!==t)||(chrome.runtime.onMessage.removeListener(n.listener),!1)))},async _send(e,...n){if(n=a.toJS(n),t.is.extension)return this._sendToChrome(e,...n);if(t.is.desktop){return(await Promise.all([this._sendToElectron(e,...n),this._sendToChrome(e,...n)])).find((e=>null!=e))||null}},async _sendToChrome(t,...n){if("function"==typeof a.toJS&&(n=a.toJS(n)),t.startsWith("cs:")){const e={type:"$bus",name:t=t.slice(3),args:n},a=await i.tabs.query({});return Promise.all(a.filter((e=>s.isAutomatable(e))).map((t=>i.tabs.sendMessage(t.id,e))))}return new Promise((async a=>{n=await e.packager.pack(n);const o={type:"$bus",name:t,args:n};chrome.runtime.sendMessage(o,(async t=>{chrome.runtime.lastError?a(void 0):(t=await e.packager.unpack(t),a(t))}))}))},async _sendToElectron(e,...t){if(!e.startsWith("store."))return new Promise((n=>{const{ipcRenderer:a}=require("electron"),o=this._generateId();a.send("$bus",{name:e,args:t,resId:o}),a.once(o,((e,t)=>{n(t)}))}))},_handleElectronMessages(){const{ipcRenderer:e}=require("electron");e.on("$bus",(async(t,{name:n,args:a,resId:o})=>{const r=this._handlers.filter((e=>e.name===n)),i=r.length>0,s=this._sendToChrome(n,...a);let l;if(i){l=(await Promise.all(r.map((e=>e.fn(...a))))).at(-1)}else l=await s;e.send(o,l)}))},_proxyChromeMessagesToElectron(){chrome.runtime.onMessage.addListener(((e,t,n)=>{if("object"!=typeof e)return;if("$bus"!==e.type)return;this._sender=t;const a=this._handlers.filter((t=>t.name===e.name)).length>0;return(async()=>{const t=await this._sendToElectron(e.name,...e.args);a||n(t)})(),!a||void 0}))},_generateId:()=>`${Date.now()}_${Math.random().toString(36).slice(2)}`,async _startIdbCleanup(){await r.controller.waitForReady(),o.chrome.alarms.run(this._cleanupIdb,{name:"bus.cleanupIdb",immediately:!0,periodInMinutes:5})},async _cleanupIdb(){const e=(await r.readAllKeys()).filter((e=>e.startsWith("bus:"))),t=Date.now();for(const n of e){t-Number(n.split(":")[1])<5*o.time.MINUTE||await r.delete(n)}}}})(),(()=>{const{$bus:e,$utils:t,$idb:a}=n;e.packager={async pack(e){if(!t.containsBlob(e))return e;const n=`bus:${Date.now()}:${String(Math.random()).slice(2,6)}`;return await a.write(n,e),["$bus:idb",n]},async unpack(e){if(!("$bus:idb"===e?.[0]))return e;if(!(e=await a.read(e[1])))throw new Error("no data in idb");return e}}})(),(()=>{const{$browser:e,$bus:t,$engine:a,$dialog:o,$tab:r,$chrome:i,$critical:s}=n;e.controller={init(){this._browser=null,this._pages=new Map,this._frameInjected=!1,this._cleanupDestroyedPages(),this._handleExtButtonClick(),this._handleFrameEvents()},get browser(){return this._browser?this._browser:this._browser=new a.Browser},async connectTab(e){let t=this._pages.get(e);if(t)return t;const n={mediumId:e,autoCloseTab:!1,muter:!1,waitForDocumentBody:!0,waitForDocumentReady:!1,noPatches:!0};return t=await this.browser.newPage(n),this._pages.set(e,t),t},async createTab(e){const t=await this.browser.newPage(e,{mediumType:"tab",autoCloseTab:!1,muter:!1,waitForDocumentBody:!0,waitForDocumentReady:!1,noPatches:!0});return this._pages.set(t.mediumId,t),t},async openFrame(e){const t=await this.connectTab(e);if(!t)return;const n=r.proxy.of(e);n.creator.frameCollapsed=!1,n.creator.frameOpen=!0,await t.frame.inject({collapsed:!1,onInjection:async()=>{n.creator.frameOpen=!0,n.creator.frameCollapsed=!1,await o.chatController.setup(t)}})},async toggleFrame(e,{preferClose:t=!1}={}){const n=await this.connectTab(e);if(!n)return;const a=r.proxy.of(e);a.creator.trapperGrabbing=!1,"trapper"!==a.creator.screen&&(t?a.creator.frameCollapsed?a.creator.frameCollapsed=!1:a.creator.frameOpen=!a.creator.frameOpen:a.creator.frameOpen?a.creator.frameCollapsed=!a.creator.frameCollapsed:a.creator.frameOpen=!0,await n.frame.inject({collapsed:!1,onInjection:async()=>{a.creator.frameOpen=!0,a.creator.frameCollapsed=!1,await o.chatController.setup(n)}}))},async hideFrame(e){const t=r.proxy.of(e);t.creator.frameCollapsed=!1,t.creator.frameOpen=!1},_cleanupDestroyedPages(){chrome.tabs.onRemoved.addListener((e=>{const t=this._pages.get(e);t&&(t.isClosed||t.close(),this._pages.delete(t))}))},_handleExtButtonClick(){i.action.onClicked.addListener((async e=>{if(s.isAutomatable(e))return void await this.toggleFrame(e.id,{preferClose:!0});const t=await new Promise((e=>{chrome.tabs.query({url:chrome.runtime.getURL("/harpa.html/*"),currentWindow:!0},(t=>e(t[0]||null)))}));t?chrome.tabs.update(t.id,{active:!0}):chrome.tabs.create({url:"/harpa.html",active:!0})}))},_handleFrameEvents(){t.on("browser.toggleFrame",(e=>{const n=t.getSender();this.toggleFrame(n.tab.id,e)})),t.on("browser.hideFrame",(e=>{const n=t.getSender();this.hideFrame(n.tab.id,e)}))}}})(),(()=>{const{$billing:e,$chrome:t,$store:a,$mobx:o}=n;e.controller={init(){this.pushHrpCookie(),this.updateHrpCookie()},pushHrpCookie(){o.reaction((()=>e.proxy.hrpCookie),(e=>{e=btoa(JSON.stringify(e)||""),t.cookies.set({url:"https://harpa.ai",name:"__hrp",value:e})}),{fireImmediately:!1})},async updateHrpCookie(){e.proxy.hrpCookie={agentId:a.state.agentId}}}})(),(()=>{const{$billing:e,$store:t}=n;e.proxy=t.createProxy({get hrpCookie(){return t.state.billing.hrpCookie},set hrpCookie(e){this._update({hrpCookie:e})},_update(e={}){t.transaction((t=>{Object.assign(t.billing,e)}))}})})(),(()=>{const{$badge:e,$bus:t,$utils:a,$env:o,$mobx:r,$store:i,$chrome:s}=n;e.controller={init(){o.is.desktop&&this._updateBadgeOnShellThemeChange(),o.is.extension&&t.on("badge.applyTheme",this._applyThemeToBadge.bind(this)),this._highlightedTabIds=new Set,this._highlightAutomatedTabBadges()},_updateBadgeOnShellThemeChange(){r.reaction((()=>i.state.theme),(e=>this._applyThemeToBadge(e)),{fireImmediately:!0})},_applyThemeToBadge(e){s.action.setIcon({path:this._getPath(e)})},_highlightAutomatedTabBadges(){r.reaction((()=>i.state.tasks.map((e=>e.inputs?.schedule.mediumId)).filter((e=>!!e&&!this._highlightedTabIds.has(e)))),(e=>{0!==e.length&&this._highlightTabsBadge(e)}),{fireImmediately:!0}),chrome.tabs.onUpdated.addListener(((e,t)=>{"loading"===t.status&&this._highlightedTabIds.has(e)&&this._highlightTabsBadge(e)}))},_highlightTabsBadge(e){const t=()=>chrome.runtime.lastError;a.ensureArray(e).forEach((e=>{this._highlightedTabIds.add(e),s.action.setIcon({tabId:e,path:this._getPath("highlight")},t),s.action.setTitle({tabId:e,title:"This tab is automated by HARPA"},t)}))},_getPath:e=>({48:`img/badges/badge-48-${e}.png`})}})(),(()=>{const{$analytics:e,$store:t,$env:a,$utils:o,$tabs:r,$critical:i}=n;e.controller={sendInstall(){this.send("install")},sendPageview(){const e=i.proxy.pageType;if(!["main","popup"].includes(e))return;const t="main"===e?"extension":r.proxy.currentTabDomain;this.send("pageview",{domain:t})},sendChatGPTStatus(e){this.send("chatgpt-status",{plus:e})},sendCommandRun(e){const t=this._commandPayload(e);this.send("command-run",t)},sendCommandUpdated(e){const t=e.fresh?"command-created":"command-updated",n=this._commandPayload(e);this.send(t,n)},sendMonitor(e,t){this.send("monitor",{title:e,url:t})},sendGrabClick(){this.send("grab-click",{domain:r.proxy.currentTabDomain})},sendError(e,t="unspecified",n={}){const a=o.is.string(e)?e:e.message;this.send("error",{message:a,actor:t,...n})},async send(e,n=null){n={env:a.env,locus:a.locus,version:a.version,pageType:i.proxy.pageType,...n};const r={time:Date.now(),token:a.mixpanel.token,distinct_id:t.state.agentId||""};if(0!==(e=o.ensureArray(e||[]).map((e=>"string"==typeof e?{event:e}:e)).map((e=>({...e,...n}))).filter((e=>!!e.event)).map((e=>({event:e.event,properties:{$insert_id:crypto.randomUUID(),...r,...e}})))).length)return e.forEach((e=>delete e.properties.event)),e=this._breakBySize(e),Promise.all(e.map((async e=>{try{await fetch("https://api.mixpanel.com/track",{method:"POST",headers:{accept:"text/plain","content-type":"application/json"},body:JSON.stringify(e)})}catch(t){console.warn("[$analytics] sending event failed",e,t)}})))},_commandPayload(e){const t={title:e.meta.title,category:e.meta.category};return"User"===t.category&&(t.steps=e.steps.map((e=>e.type)).join(" > "),t.config=o.string.shorten(e.steps.find((e=>"gpt"===e.type))?.prompt||"",255)),t},_breakBySize(e,t=50){const n=[];let a=0;for(;a<e.length;)n.push(e.slice(a,a+t)),a+=t;return n}}})(),(()=>{const{$ai:e,$utils:t,$logger:a}=n;e.BardSessionApi=class{constructor(){this._logs=!0,this.ask=this._wrapMethod(this.ask)}isOwnError(t){return t instanceof e.BardSessionApi.Error}async ask(e,{token:n=null,cursor:a=["","",""],signal:o=null}={},r=!1){n||(n=await this._fetchToken());const i=await this._fetch("/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},signal:o,query:{bl:n.bl,rt:"c",_reqid:Math.floor(9e5*Math.random())+1e5},body:new URLSearchParams({at:n.at,"f.req":JSON.stringify([null,JSON.stringify([[e.slice(0,this._maxTokens)],null,a])])})});if(200!==i.status){const n=await t.noThrow((()=>i.text()),null);if(400===i.status)return r&&this._throw("badToken",n),this.ask(e,{token:null,cursor:a,signal:o},!0);this._throw("unknown",n)}let s,l,c,u;try{const e=(await i.text()).slice(6);s=JSON.parse(e)}catch(e){this._throw("failedToReadResponse",{step:"data",error:e})}try{l=s[0][5]?.[0]??null}catch(e){this._throw("failedToReadResponse",{step:"errorCode",error:e})}9===l&&this._throw("noBardAccess");try{const e=JSON.parse(s[0][2]);c=e[0]?.[0]||e[4]?.[0]?.[1]?.[0]||"",u=[...e[1],e[4][0][0]]}catch(e){this._throw("failedToReadResponse",{step:"answer",error:e})}return{text:c,cursor:u,token:n}}get _maxTokens(){return e.proxy.connection("bard-session").maxTokens}async _fetchToken(){const e=await this._fetch("/faq"),t=await e.text();let n;t.includes("$authuser")||this._throw("login");try{n={at:this._extractKeyValue(t,"SNlM0e"),bl:this._extractKeyValue(t,"cfb2h")}}catch(e){this._throw("failedToExtractToken",e)}return n}_extractKeyValue(e,t){return e.split(t)[1].split('":"')[1].split('"')[0]}async _fetch(e,t={}){return await fetch(`https://bard.google.com${e}`,{credentials:"include",...t})}_wrapMethod(e){return async(...t)=>{try{return await e.call(this,...t)}catch(e){let t;throw t=this.isOwnError(e)?e:"TypeError: Failed to fetch"===String(e)?this._createError("network",e.message):"AbortError: The user aborted a request."===String(e)?this._createError("aborted",e.message):this._createError("unknown",e.message),t.details?this._logError(t.message,t.details):this._logError(t.message),t}}}_throw(e,t=null){throw this._createError(e,t)}_createError(t,n=null){return new e.BardSessionApi.Error(t,n)}_logError(e,...t){this._logs&&a.error(`[$ai.BardSessionApi] ${e}`,...t)}_logWarn(e,...t){this._logs&&a.warn(`[$ai.BardSessionApi] ${e}`,...t)}},e.BardSessionApi.Error=class extends Error{static errors={login:"Need to login to google.com",badToken:"Bad token",failedToExtractToken:"Failed to extract token",failedToReadResponse:"Failed to read response",noBardAccess:"Bard is not supported in your region",aborted:"Request was aborted",network:"Network error",unknown:"Unknown error"};constructor(t,n=null){const a=e.BardSessionApi.Error.errors;super(a[t]||a.unknown),this.name="$ai.BardSessionApi.Error",this.is={[t]:!0},this.type=t,this.details=n}}})(),(()=>{const{$ai:e,$logger:t,$chat:a,$utils:o}=n;e.OpenaiLicenseApi=class{constructor(){this._logs=!0,this.ask=this._wrapMethod(this.ask)}isOwnError(t){return t instanceof e.OpenaiLicenseApi.Error}async ask(e,{messages:t=[],signal:n=null,stream:r=!0,tabId:i}={},s=(()=>{})){2===arguments.length&&"function"==typeof arguments[1]&&(s=arguments[1]);const l=this._connection;let c=l.systemPrompt||"";c.trim()&&0===t.length&&(c=await a.paramController.interpolate(i,c,{noLimit:2}),t=[{role:"system",content:c},...t]);const u=await this._trimMessages([...t,{role:"user",content:e}],this._maxRequestTokens),d={stream:r,model:l.slug,messages:u};o.is.nil(l.temperature)||(d.temperature=l.temperature),o.is.nil(l.presencePenalty)||(d.presence_penalty=l.presencePenalty),o.is.nil(l.frequencyPenalty)||(d.frequency_penalty=l.frequencyPenalty);const p=await this._fetchAuth("/chat/completions",{method:"POST",signal:n,body:d});if(200!==p.status){const e=await o.noThrow((()=>p.json()),null);404===p.status&&(e?.error?.message.startsWith("The model")||e?.error?.message.startsWith("This is not a chat model"))&&this._throw("badModel",e),429===p.status&&this._throw("reachedRequestsLimit",e),"context_length_exceeded"===e?.error?.code&&this._throw("messageTooLong",e),this._throw("unknown",e||`HTTP status ${p.status}`)}let h="",m=!0;const g=p.body.getReader();for(;;)try{const{done:e,value:t}=await g.read();if(e)break;const n=this._parseAskChunk(t);if(n.data){h+=n.data.text;s({id:n.data.id,text:h},m),m=!1}if(n.done)break}catch(e){if(e.message?.includes("aborted"))break;this._throw("failedToReadResponse",e)}g.releaseLock()}get _apiKey(){return e.proxy.connection("openai-license").apiKey}get _connection(){return e.proxy.connection("openai-license")}get _maxRequestTokens(){return e.proxy.connection("openai-license").maxRequestTokens}_parseAskChunk(e){const t={done:!1,data:null};let n="";try{n=(new TextDecoder).decode(e).trim()}catch(e){return this._logWarn("failed to decode chunk",e),t}if(n.startsWith('{"id":'))try{let e=JSON.parse(n);return e={id:e.id,text:e.choices[0].message.content},{data:e,done:!0}}catch(e){return this._logWarn("failed to parse chunk",e),t}const a="data: [DONE]",o=n.split("\n");t.done=o.includes(a);const r=o.filter((e=>e.startsWith("data:")&&e!==a));if(0===r.length)return t;let i,s="";for(const e of r)try{const t=e.replace("data:","").trim(),n=JSON.parse(t);i=n.id,s+=n.choices[0].delta.content||""}catch{}return i&&s&&(t.data={id:i,text:s}),t}async _fetchAuth(e,t={}){this._apiKey||this._throw("badApiKey"),t.headers={"content-type":"application/json",authorization:`Bearer ${this._apiKey}`,...t.headers},t.body&&(t.body=JSON.stringify(t.body));let n=this._connection.proxyUrl;n&&n.trim()||(n="https://api.openai.com/v1"),n.endsWith("/")&&(n=n.slice(0,-1)),e.startsWith("/")||(e=`/${e}`);const a=await fetch(`${n}${e}`,t);return 401===a.status&&this._throw("badApiKey"),a}async _trimMessages(e,t=0){const n=[],a=[...e].reverse();for(const e of a){if((t-=7)<=0)break;const a=await this._trimText(e.content,t),o=await this._countTokens(a);if(0===o)break;n.push({role:e.role,content:a}),t-=o}return n.reverse()}async _trimText(e,t=0){const n=e.split(" ");let a=0,o=n.length;for(;;){const e=n.slice(n.length-a-o).join(" ");if(await this._countTokens(e)<=t&&(a+=o),a===n.length)break;if(o<1)break;o/=2}return n.slice(n.length-a).join(" ")}async _countTokens(t){return await e.controller.countTokens(t)}_wrapMethod(e){return async(...t)=>{try{return await e.call(this,...t)}catch(e){let t;throw t=this.isOwnError(e)?e:"TypeError: Failed to fetch"===String(e)?this._createError("network",e.message):"AbortError: The user aborted a request."===String(e)?this._createError("aborted",e.message):this._createError("unknown",e.message),t.details?this._logError(t.message,t.details):this._logError(t.message),t}}}_throw(e,t=null){throw this._createError(e,t)}_createError(t,n=null){return new e.OpenaiLicenseApi.Error(t,n)}_logError(e,...n){this._logs&&t.error(`[$ai.OpenaiLicenseApi] ${e}`,...n)}_logWarn(e,...n){this._logs&&t.warn(`[$ai.OpenaiLicenseApi] ${e}`,...n)}},e.OpenaiLicenseApi.Error=class extends Error{static errors={badModel:"Model does not exist",badApiKey:"Bad API key",messageTooLong:"Message is too long",tooManyRequests:"Too many requests",failedToReadResponse:"Failed to read response",aborted:"Request was aborted",network:"Network error",unknown:"Unknown error"};constructor(t,n=null){const a=e.OpenaiLicenseApi.Error.errors;super(a[t]||a.unknown),this.name="$ai.OpenaiLicenseApi.Error",this.is={[t]:!0},this.type=t,this.details=n}}})(),(()=>{const{$ai:e,$analytics:t,$logger:a,$utils:o,$settings:r}=n;e.OpenaiSessionApi=class{constructor(){this._logs=!0,this._plus=null,this.ask=this._wrapMethod(this.ask),this.fetchModels=this._wrapMethod(this.fetchModels),this.fetchAccessToken=this._wrapMethod(this.fetchAccessToken)}isOwnError(t){return t instanceof e.OpenaiSessionApi.Error}async fetchAccessToken(){const e=await fetch(this._url("/api/auth/session"),{credentials:"include"});403===e.status&&this._throw("cloudflare");const t=await e.json();return t.accessToken||this._throw("login"),t.accessToken}async fetchModels(){const e=await this._fetchAuth("/backend-api/models"),n=await e.json();let a=n?.models;a&&0!==a.length||this._throw("noModels",n);const o=/(\d+)/gm;a=a.map((e=>{let t="text-davinci-002-render-sha"===e.slug?1e5:1e3*(Number(e.slug?.match(o)?.[0])||0)+(e.slug?.length||0);e.description.length>0&&!e.description.endsWith(".")&&(e.description+=".");const n=[e.slug,e.title,e.description].filter(Boolean).map((e=>String(e).toLowerCase())).join("\n");return n.includes("gpt-4")&&(t=2),n.includes("gpt-4")&&!e.title.includes("GPT-4")&&(e.title=`GPT-4 ${e.title}`),n.includes("legacy")&&(t=1),{model:e,priority:t}})).sort(((e,t)=>t.priority-e.priority)).map((e=>({slug:e.model.slug,title:e.model.title,description:e.model.description,maxTokens:e.model.max_tokens})));const r=a.some((e=>"gpt-4"===e.slug));return this._plus!==r&&(this._plus=r,t.controller.sendChatGPTStatus(r)),a}async ask(t,{chatId:n=null,parentMessageId:a=null,signal:r=null}={},i=(()=>{})){2===arguments.length&&"function"==typeof arguments[1]&&(i=arguments[1]);let s=!0,l=null,c="",u="",d=0;do{const p={method:"POST",signal:r,body:{model:this._model,parent_message_id:a||crypto.randomUUID(),conversation_id:n||null,timezone_offset_min:(new Date).getTimezoneOffset(),history_and_training_disabled:!1}};await e.arkoseController.injectToken(p.body),"max_tokens"===l?p.body.action="continue":(p.body.action="next",p.body.messages=[{id:crypto.randomUUID(),author:{role:"user"},content:{content_type:"text",parts:[t]}}]),"max_tokens"===l&&await o.sleep(1e3);const h=await this._fetchAuth("/backend-api/conversation",p);if(200!==h.status){const e=await o.noThrow((()=>h.json()),null);413===h.status&&this._throw("messageTooLong",e),429===h.status&&this._throw("tooManyRequests",e),404===h.status&&this._throw("chatNotFound",e),this._throw("unknown",e)}const m=h.body.getReader(),g={chatId:null,messages:[],carryOver:""};for(;;)try{const{done:e,value:t}=await m.read();if(e)break;const o=this._parseAskChunk(t,g);if(o.data&&(n=o.data.chatId,l=o.data.finishDetails,a=o.data.id,o.data.text&&(u=c+o.data.text,o.data.text=u),i(o.data,s),s=!1),o.done)break}catch(e){if(e.message?.includes("aborted"))break;this._throw("failedToReadResponse",e)}m.releaseLock(),c=u,d++}while("max_tokens"===l&&d<=5)}async likeAnswer(e,t){try{await this._fetchAuth("/backend-api/conversation/message_feedback",{method:"POST",body:{rating:"thumbsUp",message_id:t,conversation_id:e}})}catch(e){this._logWarn("failed liking an answer",e)}}async dislikeAnswer(e,t){try{await this._fetchAuth("/backend-api/conversation/message_feedback",{method:"POST",body:{rating:"thumbsDown",message_id:t,conversation_id:e}})}catch(e){this._logWarn("failed disliking an answer",e)}}async setChatTitle(e,t){try{await this._fetchAuth(`/backend-api/conversation/${e}`,{method:"PATCH",body:{title:t}})}catch(e){this._logWarn("failed updating chat title",e)}}async deleteChat(e){if(e)try{await this._fetchAuth(`/backend-api/conversation/${e}`,{method:"PATCH",body:{is_visible:!1}})}catch(e){this._logWarn("failed deleting a chat",e)}}get _accessToken(){return e.proxy.openaiSession.accessToken}get _model(){const t=e.proxy.connection(r.proxy.connectionId);return"openai-session"===t.type?t.slug:(console.error("calling session api for non-session connection"),e.proxy.connections[0].slug)}_parseAskChunk(e,t){const n={done:!1,data:null};let a="";try{a=(new TextDecoder).decode(e).trim()}catch(e){return this._logWarn("failed to decode chunk",e),n}t.carryOver&&(a=t.carryOver+a);const o=a.split("\n");n.done=o.includes("data: [DONE]");let r=null;const i=o.filter((e=>e.startsWith("data: {")));if(i.forEach((e=>{try{const n=e.replace("data: ","").trim(),a=JSON.parse(n),o=a.message,r=a.conversation_id||t.chatId;if(!o||!o.id||!r)return;t.chatId=r,t.messages=t.messages.filter((e=>e.id!==o.id)),t.messages.push(o)}catch(e){"SyntaxError"===e.name&&(r=e)}})),i.length>0&&!r?t.carryOver="":a.startsWith("data: {")&&(t.carryOver=a),!t.chatId)return n;n.data={id:null,text:"",chatId:t.chatId,finishDetails:null};for(const e of t.messages){if(e.author&&e.content&&("all"===e.recipient||!e.recipient))if("assistant"!==e.author.role||"text"!==e.content.content_type)if("assistant"!==e.author.role||"code"!==e.content.content_type)if("tool"!==e.author.role);else{n.data.id=n.data.id||e.id;const t=(e.author.name||"").split(".")[0];n.data.text+="\n```text\n using "+t+"...\n```\n"}else{n.data.id=n.data.id||e.id;const t=e.content.text.startsWith("# ")?e.content.text.slice(2):e.content.text;n.data.text+="\n```text\n "+t+"\n```\n"}else n.data.id=e.id,n.data.finishDetails=e.metadata?.finish_details?.type,n.data.text+=this._injectCitations(e.content.parts.join(""),e.metadata?.citations)}return n}async _fetchAuth(e,t={}){this._accessToken||this._throw("badAccessToken"),t.headers={"content-type":"application/json",authorization:`Bearer ${this._accessToken}`,...t.headers},t.body&&(t.body=JSON.stringify(t.body));const n=await fetch(this._url(e),t);return 401===n.status&&this._throw("badAccessToken"),403===n.status&&this._throw("cloudflare"),n}_injectCitations(e,t){if(0===(t=(t||[]).filter((e=>void 0!==e.start_ix&&void 0!==e.end_ix&&e.metadata?.url)).sort(((e,t)=>e.start_ix-t.start_ix))).length)return e;let n=0;for(let a=0;a<t.length;a++){const o=t[a];let r=`[${a+1}](${o.metadata.url})`;r+="\x3c!--rehype:style=position: relative;top: -0.5em;font-size: 80%;--\x3e",o.metadata.title&&(r+=`\x3c!--rehype:title=${o.metadata.title}--\x3e`),e=e.slice(0,o.start_ix+n)+r+e.slice(o.end_ix+n),n+=r.length-(o.end_ix-o.start_ix)}return e}_url(e){return`https://chat.openai.com${e}`}_wrapMethod(e){return async(...t)=>{try{return await e.call(this,...t)}catch(e){let t;throw t=this.isOwnError(e)?e:"TypeError: Failed to fetch"===String(e)?this._createError("network",e.message):"AbortError: The user aborted a request."===String(e)?this._createError("aborted",e.message):this._createError("unknown",e.message),t.details?this._logError(t.message,t.details):this._logError(t.message),t}}}_throw(e,t=null){throw this._createError(e,t)}_createError(t,n=null){return new e.OpenaiSessionApi.Error(t,n)}_logError(e,...t){this._logs&&a.error(`[$ai.OpenaiSessionApi] ${e}`,...t)}_logWarn(e,...t){this._logs&&a.warn(`[$ai.OpenaiSessionApi] ${e}`,...t)}},e.OpenaiSessionApi.Error=class extends Error{static errors={login:"Need to login to openai.com",cloudflare:"Cloudflare check required",badAccessToken:"Bad access token",noModels:"Failed to extract models",messageTooLong:"Message is too long",chatNotFound:"Chat not found",tooManyRequests:"Too many requests",failedToReadResponse:"Failed to read response",aborted:"Request was aborted",network:"Network error",unknown:"Unknown error"};constructor(t,n=null){const a=e.OpenaiSessionApi.Error.errors;super(a[t]||a.unknown),this.name="$ai.OpenaiSessionApi.Error",this.is={[t]:!0},this.type=t,this.details=n}}})(),(()=>{const{$ai:e,$utils:t,$bus:a,$logger:o}=n;e.api={init(){this._modelsUpdatedAt=-1,this._bard=new e.BardSessionApi,this._session=new e.OpenaiSessionApi,this._license=new e.OpenaiLicenseApi,a.on("openai.checkOpenaiSessionAuth",this.checkOpenaiSessionAuth,this)},get bard(){return this._bard},get session(){return this._session},get license(){return this._license},async checkOpenaiSessionAuth(){try{return await this._updateAccessToken(),await this._updateModels(),e.proxy.update((e=>{e.openaiSession.status="ok",e.openaiSession.loading=!1})),!0}catch(t){return o.log("[$ai] failed checking auth",t?.message||t),e.proxy.update((e=>{e.openaiSession.loading=!1,this._session.isOwnError(t)&&t.is.cloudflare?e.openaiSession.status="cloudflare":e.openaiSession.status=null})),!1}},async _updateAccessToken(){const t=await this._session.fetchAccessToken();e.proxy.update((e=>e.openaiSession.accessToken=t))},async _updateModels(){if(!e.proxy.openaiSession.accessToken)return;if(Date.now()-this._modelsUpdatedAt<5*t.time.MINUTE)return;let n=[];try{n=await this._session.fetchModels()}catch(e){return void o.error(e)}e.proxy.applyOpenaiSessionModels(n),this._modelsUpdatedAt=Date.now()}}})(),(()=>{const{$ai:e,$analytics:t,$utils:a,$feature:o}=n;e.arkoseController={init(){this.getToken=a.enqueue(this.getToken,this),this._setupPromise=null},async injectToken(e){const t=await this.getToken(e.model);t&&(e.arkose_token=t)},async getToken(e="gpt-4"){try{const t=this._getConfig();if(!t)return null;return new RegExp(t.modelRegex).test(e)?(await this._ensureSetup(t),await this._fetchToken(e,t)):null}catch(e){return console.error("[$ai]",e),t.controller.sendError(e,"ai"),null}},_getConfig(){const e=o.proxy.state?.ae;if(!e)return null;try{return JSON.parse(atob(e))}catch{return null}},async _ensureSetup(e){if(this._setupPromise)return this._setupPromise;if(this._setupPromise=a.createPromise(),!document.getElementById("challenge")){const e=document.createElement("div");e.id="challenge",document.body.appendChild(e)}const t=document.createElement("script"),n=e.script;Object.entries(n).forEach((([e,n])=>t.setAttribute(e,n))),document.head.appendChild(t),await new Promise(((n,a)=>{const o=setTimeout((()=>{a("Script loading timed out")}),e.scriptLoadTimeout);t.onload=()=>{clearTimeout(o),t.setAttribute("data-status","loaded"),n()},t.onerror=()=>{clearTimeout(o),t.setAttribute("data-status","failed"),a("Script loading failed")}})),this._setupPromise.resolve()},async _fetchToken(e,t){(t=a.cloneDeep(t)).parameters.siteData.location.search=`?model=${e}`,this._fetchTokenPromise=a.createPromise(),window.ae=new window.ArkoseEnforcement({...t.parameters,callback:e=>this._fetchTokenPromise.resolve(e),onerror:e=>this._fetchTokenPromise.reject(e),onshown:()=>{},onsuppress:()=>{},loaded_callback:()=>{},failed_callback:e=>this._fetchTokenPromise.reject(e)}),window.ae.clear_session();const n=setTimeout((()=>this._fetchTokenPromise.reject("Fetching token timed out")),t.tokenFetchTimeout),o=await this._fetchTokenPromise;return clearTimeout(n),o}}})(),(()=>{const{$ai:e,$env:t,$offscreen:a,$mobx:o,$settings:r,$chat:i,$utils:s}=n;e.controller={init(){this._presetConnectionPromise=null,e.api.init(),e.arkoseController.init(),this._syncConnectionId()},countTokens:async n=>2===t.manifestVersion?await e.tokenizer.countTokens(n):3===t.manifestVersion?await a.controller.send("countTokens",n):void 0,async presetConnection(){e.proxy.presetConnectionDone||(this._presetConnectionPromise=s.createPromise(),await(async()=>{try{if(await e.api.checkOpenaiSessionAuth())return}catch{}try{await e.api.bard.ask("hi"),r.proxy.connectionId="bard-session",i.proxy.forEachChat((e=>e.connectionId="bard-session"))}catch{}})(),e.proxy.update({presetConnectionDone:!0}),this._presetConnectionPromise.resolve())},async waitPresetConnection(){if(!e.proxy.presetConnectionDone&&this._presetConnectionPromise)return this._presetConnectionPromise},_syncConnectionId(){o.reaction((()=>r.proxy.connectionId),(t=>{t||(t=e.proxy.connections[0].id),i.proxy.forEachChat((e=>e.connectionId=t))}))}}})(),(()=>{const{$ai:e,$nanoid:t,$utils:a}=n;e.tokenizer={async countTokens(e){const n=this._ensureWorker(),a=t();return await new Promise(((t,o)=>{const r=e=>{a===e.data?.requestId&&(n.removeEventListener("message",r),t(e.data.tokens))};n.addEventListener("message",r),n.addEventListener("error",(e=>o(e))),n.postMessage({requestId:a,text:e})}))},_ensureWorker(){return this._worker||(this._worker=new Worker("/gpt-encoder.js")),a.chrome.alarms.off(this._workerTerminateAlarm),this._workerTerminateAlarm=a.chrome.alarms.run((()=>{this._worker&&(this._worker.terminate(),this._worker=null)}),{name:"openai.terminateWorker",delayInMinutes:10}),this._worker}}})(),(()=>{const{$ai:e,$store:t}=n;e.connectionAdapter=t.adapter.create((t=>({get:e=>e.ai.connections.find((e=>e.id===t)),get maxTokens(){if("openai-session"===this.type)return this.$maxTokens;if("openai-license"===this.type){return(e.proxy.openaiLicenseModels[this.slug]||e.proxy.openaiLicenseDefaultModel).maxTokens}return"bard-session"===this.type?1e4:void 0},get maxRequestTokens(){if("bard-session"===this.type)return this.maxTokens;return Math.round(.7*this.maxTokens)},async countTokens(t){return"bard-session"===this.type?t.length:await e.controller.countTokens(t)}})))})(),(()=>{const{$ai:e,$store:t}=n;e.proxy=t.adapter.create({get:e=>e.ai,connection(t=null){return t||(t=this.connections[0].id),e.connectionAdapter(t)},applyOpenaiSessionModels(e=[]){0!==e.length&&t.transaction((t=>{let n=t.ai.connections.filter((e=>"openai-session"===e.type));for(const t of e){const e=n.find((e=>e.slug===t.slug));e?(e.title=t.title,e.maxTokens=t.maxTokens,e.description=t.description):n.push({id:`openai-session:${t.slug}`,type:"openai-session",slug:t.slug,title:t.title,maxTokens:t.maxTokens,description:t.description})}n=n.filter((t=>e.some((e=>e.slug===t.slug)))),t.ai.connections=[...n,...t.ai.connections.filter((e=>"openai-session"!==e.type))],t.ai.connections.find((e=>e.id===t.settings.connectionId))||(t.settings.connectionId=t.ai.connections[0].id);for(const e of t.chats){t.ai.connections.some((t=>t.id===e.connectionId))||(e.connectionId=t.ai.connections[0].id)}}))},get openaiLicenseModels(){const e={"gpt-3.5-turbo":{description:"Most capable GPT-3.5 model and optimized for chat at 1/10th the cost of text-davinci-003.",maxTokens:4096},"gpt-3.5-turbo-16k":{description:"Same capabilities as the standard gpt-3.5-turbo model but with 4 times the context.",maxTokens:16384},"gpt-3.5-turbo-0613":{description:"Snapshot of gpt-3.5-turbo from June 13th 2023 with function calling data. Unlike gpt-3.5-turbo, this model will not receive updates, and will be deprecated 3 months after a new version is released.",maxTokens:4096},"gpt-3.5-turbo-16k-0613":{description:"Snapshot of gpt-3.5-turbo-16k from June 13th 2023. Unlike gpt-3.5-turbo-16k, this model will not receive updates, and will be deprecated 3 months after a new version is released.",maxTokens:16384},"text-davinci-003":{description:"Can do any language task with better quality, longer output, and consistent instruction-following than the curie, babbage, or ada models. Also supports some additional features such as inserting text.",maxTokens:4096},"text-davinci-002":{description:"Similar capabilities to text-davinci-003 but trained with supervised fine-tuning instead of reinforcement learning.",maxTokens:4096},"code-davinci-002":{description:"Optimized for code-completion tasks.",maxTokens:8001},"gpt-4":{description:"More capable than any GPT-3.5 model, able to do more complex tasks, and optimized for chat. Will be updated with our latest model iteration 2 weeks after it is released.",maxTokens:8192},"gpt-4-0613":{description:"Snapshot of gpt-4 from June 13th 2023 with function calling data. Unlike gpt-4, this model will not receive updates, and will be deprecated 3 months after a new version is released.",maxTokens:8192},"gpt-4-32k":{description:"Same capabilities as the base gpt-4 mode but with 4x the context length. Will be updated with our latest model iteration.",maxTokens:32768},"gpt-4-32k-0613":{description:"Snapshot of gpt-4-32 from June 13th 2023. Unlike gpt-4-32k, this model will not receive updates, and will be deprecated 3 months after a new version is released.",maxTokens:32768}};for(const t in e)e[t].slug=t;return e},get openaiLicenseDefaultModel(){return this.openaiLicenseModels["gpt-3.5-turbo"]}})})(),(()=>{const{$startup:e,$shortcut:t,$feature:a,$creator:o,$billing:r,$browser:i,$badge:s,$dialog:l,$store:c,$idb:u,$env:d,$task:p,$runner:h,$library:m,$dashboard:g,$dev:f,$bus:y,$shell:b,$timer:w,$chromeApi:v,$logger:k,$journal:_,$sandbox:x,$install:T,$uninstall:A,$chrome:I,$netRules:S,$welcome:C,$hframe:P,$engine:E,$ai:$,$tabs:O,$offscreen:R}=n;e.controller={ready:!1,async init(){this._skipWaitingSw(),I.controller.init(),y.controller.init(),y.on("bg.isReady",(()=>this.ready)),w.controller.init(),await this._ifDesktop((()=>v.controller.init())),await S.controller.init(),await u.controller.init(),await c.controller.init(),await p.controller.init(),await h.controller.init(),await E.controller.init(),t.controller.init(),a.controller.init(),s.controller.init(),m.controller.init(),i.controller.init(),g.controller.init(),o.controller.init(),l.controller.init(),_.controller.init(),C.controller.init(),P.controller.init(),r.controller.init(),O.controller.init(),R.controller.init(),$.controller.init(),f.controller.init(),await this._ifDevelopment((()=>{x.controller&&x.controller.init()})),await this._ifDesktop((()=>{b.controller&&b.controller.init()})),T.controller.init(),A.controller.init(),this.ready=!0,k.dev("[$startup] bg ready")},_skipWaitingSw(){3===d.manifestVersion&&globalThis.addEventListener("install",(()=>{console.clear(),globalThis.skipWaiting()}))},async _ifDesktop(e){d.is.desktop&&await e()},async _ifDevelopment(e){d.is.development&&await e()}},d.is.test||e.controller.init()})()})();