(()=>{const t=!1,e="_actors_ifdt";let n=globalThis[e];(()=>{if(n)return;const i={};n=function e(n){const o={},r=new Proxy(n,{get:(s,a)=>"assign"===a?t=>{Object.assign(r,t)}:(a in n||(n[a]={},o[a]=e(n[a]),n===i&&t&&(globalThis[a]=n[a])),a in o?o[a]:n[a]),set:(e,r,s)=>(n[r]=s,o[r]=s,n===i&&t&&(globalThis[r]=n[r]),!0)});return r}(i),globalThis[e]=n,t&&(globalThis.app=i)})(),(()=>{const{$shortcut:t,$bus:e}=n;t.listener=t=>{const n=async i=>{const o=t.config;if(o&&o.code&&o.enabled&&o.code===i.keyCode&&Boolean(o.altKey)===Boolean(i.altKey)&&Boolean(o.ctrlKey)===Boolean(i.ctrlKey)&&Boolean(o.metaKey)===Boolean(i.metaKey)){i.preventDefault();try{await e.send("browser.toggleFrame",{preferClose:!i.shiftKey}),t.onShortcutPress&&t.onShortcutPress()}catch(i){i.message?.startsWith("Extension context invalidated")||window.removeEventListener("keydown",n)}}};window.addEventListener("keydown",n)}})(),(()=>{const{$shortcut:t,$bus:e}=n;t.interceptor={async init(){await this.handleConfigUpdate(),this.listenForShortcut(),this.handleShortcutIcon(),this.trackLastActiveInput()},get isTopFrame(){return window.top===window},async handleConfigUpdate(){this.config=await e.send("shortcut.getConfig"),e.on("shortcut.updateConfig",(t=>{this.config=t,this.container&&(this.hideContainer(),this.container=null)}))},listenForShortcut(){t.listener(this)},openedPopupNode(){const t=document.documentElement.children[0];return t?"__HRP__"!==t.tagName?null:t.children[1]?.classList.contains("__hrp-frame_open")?t:null:null},handleShortcutIcon(){this.isTopFrame&&(this.container=null,this.shown=!1,document.addEventListener("selectionchange",(()=>{if(!this.config?.hint)return;document.getSelection().toString().trim().length>0&&!this.openedPopupNode()?this.showContainer():this.hideContainer()})))},showContainer(){this.shown||(this.shown=!0,this.createContainer(),this.container&&(document.documentElement!==this.container.parentNode&&document.documentElement.appendChild(this.container),this.container.style.opacity=1))},hideContainer(){if(!this.shown)return;this.shown=!1;const t=this.container;t&&(t.style.opacity=0,clearTimeout(this.iconTimeout),this.iconTimeout=setTimeout((()=>{document.documentElement===t.parentNode&&document.documentElement.removeChild(t)}),50))},createContainer(){if(!this.container&&"text/html"===document.contentType){this.container=document.createElement("__hrp-shortcut__"),this.container.classList.add("hrp-container"),this.container.addEventListener("mousedown",(()=>{document.addEventListener("blur",(t=>{t.preventDefault(),t.stopPropagation()}),{once:!0,capture:!0})}));{const t=document.createElement("style"),e=[".hrp-container{position:fixed;bottom:24px;right:24px;z-index:2147483646;opacity:0;height:30px;box-shadow:0 3px 6px rgba(0,0,0,0.16);border-radius:4px;background-color:#fff;display:flex;flex-direction:row;align-items:center;transition:opacity 0.150s ease-in-out;transition:box-shadow 0.150s ease-in-out;box-sizing:border-box;}",".hrp-container:hover{box-shadow:0 6px 12px rgba(0,0,0,0.20)}",'.hrp-button{position:relative;height:100%;color:#2B3338;font-weight:600;font-size:13px;line-height:19px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";text-align:center;cursor:pointer;box-sizing:border-box;}',".hrp-button_favourite{cursor:default}",".hrp-button_favourite>.hrp-menu{max-height:calc(100vh - 90px);overflow:auto;}",".hrp-button_first{border-top-left-radius:4px;border-bottom-left-radius:4px}",".hrp-button_last{border-top-right-radius:4px;border-bottom-right-radius:4px;max-width:66px;width:66px;padding-top:6px;}",".hrp-button:hover{background-color:#E8E8E8}",".hrp-button:hover>.hrp-tooltip{display:block}",".hrp-button:hover>.hrp-triangle{display:block}",".hrp-button:hover>.hrp-bridge{display:block}",".hrp-button:hover>.hrp-menu{display:block}",".hrp-tooltip{position:absolute;z-index:2;left:50%;transform:translate(-50%, 0);white-space:nowrap;background-color:#2A3338;color:white;border-radius:4px;padding:4px 8px 5px 8px;top:-36px;display:none;font-weight:500;box-sizing:border-box;}",".hrp-triangle{position:absolute;left:50%;top:-9px;display:none;transform:translate(-50%, 0);width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid #2A3338}",".hrp-button_menu>.hrp-tooltip{width:168px;border-top-left-radius:0px;border-top-right-radius:0px}",".hrp-bridge{position:absolute;z-index:1;width:168px;height:9px;bottom:30px;left:50%;transform:translate(-50%, 0);display:none}",".hrp-menu{position:absolute;z-index:1;width:168px;bottom:39px;left:50%;transform:translate(-50%, 0);background-color:white;border-radius:4px;padding:4px 0px 32px 0px;box-shadow:0 3px 6px rgba(0,0,0,0.16);font-weight:400;display:none;box-sizing:border-box;}",".hrp-menu_empty{padding-left:8px;padding-right:8px}",".hrp-menu-item{word-break:break-word;text-align:left;padding:4px 12px;cursor:pointer;box-sizing:border-box;}",".hrp-menu-item:hover{background-color:#E8E8E8}"].join(" ");t.innerHTML=e,this.container.appendChild(t)}this.config.commands.forEach(((t,n)=>{const i=document.createElement("div");i.classList.add("hrp-button"),0===n&&i.classList.add("hrp-button_first"),"favourites"===t.id&&i.classList.add("hrp-button_favourite"),i.addEventListener("click",(async()=>{"favourites"!==t.id&&(this.hideContainer(),await e.send("browser.toggleFrame"),await e.send("shortcut.executeCommand",t.id))}));const o=document.createElement("div");o.classList.add("hrp-tooltip"),o.innerText=t.label,i.appendChild(o);const r=document.createElement("div");r.classList.add("hrp-triangle"),i.appendChild(r);const s=document.createElement("img");try{s.src=chrome.runtime.getURL(`/img/commands/${t.id}.svg`)}catch{return}if(i.appendChild(s),"favourites"===t.id){const t=document.createElement("div");t.classList.add("hrp-bridge"),i.appendChild(t);const n=document.createElement("div");n.classList.add("hrp-menu"),0===this.config.myCommands.length&&(n.innerText="Favourite commands will be listed here",n.classList.add("hrp-menu_empty")),this.config.myCommands.forEach((t=>{const i=document.createElement("div");i.innerText=t.title||"Custom command",i.classList.add("hrp-menu-item"),i.addEventListener("click",(async n=>{n.stopImmediatePropagation(),this.hideContainer(),await e.send("browser.toggleFrame"),await e.send("shortcut.executeCommand",t.name)})),n.appendChild(i)})),i.appendChild(n),i.classList.add("hrp-button_menu")}this.container.appendChild(i)}));{const t=document.createElement("div");t.innerText=this.config.enabled?this.config.label:"MORE",t.classList.add("hrp-button"),t.classList.add("hrp-button_last"),0===this.config.commands.length&&t.classList.add("hrp-button_first"),t.addEventListener("click",(()=>{e.send("browser.toggleFrame"),this.hideContainer()})),this.container.appendChild(t)}}},onShortcutPress(){this.hideContainer()},trackLastActiveInput(){const t=["[contenteditable]","input:not([type]):not(:disabled)",'input[type="text"]:not(:disabled)','input[type="search"]:not([disabled])',"textarea:not([disabled])"].join(", ");document.addEventListener("focus",(e=>{if(!e.target.matches(t))return;const n=document.querySelector("[data-last-active-input]");n&&n!==e.target&&n.removeAttribute("data-last-active-input"),e.target.setAttribute("data-last-active-input","")}),!0)}}})(),(()=>{const{$engine:t,$utils:e}=n;t.controller={init(){const n="engine-0.1.0",i=document.querySelector("__hrp__");if(i){if(!i.parentElement)return location.reload();i.parentElement.removeChild(i)}this.connectionPromise=e.createPromise();let o=null;const r=window.frameElement?.getAttribute("__hrp")||window.location.href?.match(/[?&#]__hrp=(?<name>([a-zA-Z\d\-._]*:?){6})/)?.groups?.name||window.name,s=e=>{o||(o=t.injector().inject(e))};(()=>{window.top===window&&chrome.runtime.onMessage.addListener((async(t,e,n)=>{if("request"===t.type){if("ping"===t.command)return n("pong"),!0;if("connect"===t.command)return o?(await this.connectionPromise,void top.postMessage({type:"connected",frameName:o.config.frameName},"*")):void s(t.config);await this.connectionPromise,o&&t.frameName===o.config.frameName&&window.postMessage(t,"*")}}))})();let a=null;try{a=JSON.parse(atob(r))}catch{}(t=>!!t?.frameName?.startsWith(n))(a)?s(a):chrome.runtime.sendMessage({type:"should-connect",engineName:n},(t=>{!chrome.runtime.lastError&&t&&s(t)}))}}})(),(()=>{const{$engine:t,$startup:e}=n;t.injector=()=>({inject(t){if(this.config=this._parseConfig(t),this.config&&this.config.frameName){this._root=this._ensureRootElement();try{localStorage.setItem("__hrp.config",JSON.stringify(this.config))}catch{}return this._propagateEvents(this.config),this.config.noPatches||(this._insertStealth(this.config),this._insertPatches(this.config)),this._insertInjection(),this}},_parseConfig(t){try{return t={beforeLoad:["patch-console","no-content-visibility","no-prompt","no-notification","no-request-fullscreen","force-visible","shim-raf","no-transitions","patch-intersection-observer"],afterLoad:[],stealth:!0,waitForDocumentBody:!0,waitForDocumentReady:!0,...t,configString:btoa(JSON.stringify(t))},this._constructNavigator(t),t}catch(t){return console.error(t),null}},_constructNavigator(t){if(t.vua){const e={"macbook-13.4":{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36",platform:"MacIntel"},"windows-pc":{userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36",platform:"Win32"},"galaxy-s5":{userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Mobile Safari/537.36",platform:"Android"},"iphone-x":{userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.5 Mobile/15E148 Safari/604.1",platform:"iPhone",vendor:"Apple Computer, Inc."}}[t.vua];e&&(t.navigator={...e,appVersion:e.userAgent.substr(8),vendor:e.vendor||"Google Inc.",webdriver:!1,productSub:"20030107"})}if(t.vlang){const e=t.vlang.replace("_","-");t.navigator={...t.navigator,language:e,languages:[e]},e.includes("-")&&t.navigator.languages.push(e.split("-")[1])}},_ensureRootElement(){return this._root||(this._root=document.createElement("__hrp__"),this._root.setAttribute("data-ext-id",chrome.runtime.id),document.documentElement.prepend(this._root)),this._root},_propagateEvents(e){const n=({data:i})=>{if(this._root?.isConnected){if(i){if(i.frameName===e.frameName&&"connected"===i.type&&t.controller.connectionPromise.resolve(),i.frameName!==e.frameName||"execute"!==i.type)return i.frameName!==e.frameName||"request"===i.type||void chrome.runtime.sendMessage(i);this._executeJs(i.js)}}else window.removeEventListener("message",n)};window.addEventListener("message",n)},_insertStealth(t){t.stealth&&"function"==typeof n.$stealth&&this._executeJs(`(${n.$stealth.toString()})()`)},_insertPatches(t){const e=`(${(()=>{const t=CONFIG_PLACEHOLDER;navigator.config=t;const e=document.__lookupGetter__("visibilityState").bind(document),n=(t,e,n)=>{try{Object.defineProperty(t,e,n)}catch{}},i=t=>{const e=document.createElement("style");e.textContent=t;document.querySelector("__hrp__").append(e)},o={"patch-console"(){window.log=console.log},"no-content-visibility"(){i("* { content-visibility: visible !important; }")},"no-transitions"(){i("body, body * { transition-duration: 0s !important; transition-delay: 0s !important; animation-duration: 0s !important; animation-delay: 0s !important; }")},"no-prompt"(){window.prompt=()=>{}},"no-notification"(){"Notification"in window&&(n(window.Notification,"permission",{get:()=>"denied"}),n(window.Notification,"requestPermission",{value:t=>(t&&t("denied"),Promise.resolve("denied"))}))},"force-visible"(){const t=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()},e=(t=!1)=>({get:()=>t});n(document,"visibilityState",e("visible")),n(document,"hidden",e(!1)),n(document,"webkitHidden",e(!1)),document.__proto__.hasFocus=()=>!0,document.addEventListener("blur",t,!0),window.addEventListener("blur",t,!0),window.addEventListener("pagehide",t,!0),window.addEventListener("load",(()=>{document.body.focus(),document.dispatchEvent(new Event("visibilitychange"))}))},"shim-raf"(){let t=0;window.requestAnimationFrame=e=>{const n=window.performance.now(),i=Math.max(t+16,n);return setTimeout((()=>{e(t=i)}),i-n)},window.cancelAnimationFrame=t=>clearTimeout(t)},"no-request-fullscreen"(){window.addEventListener("DOMContentLoaded",(()=>{document.body.requestFullscreen=()=>{}}))},"patch-intersection-observer"(){if("visible"===e())return;let t=!0;document.addEventListener("visibilitychange",(()=>{t="hidden"===e()})),window.IntersectionObserver=class extends IntersectionObserver{constructor(...t){super(...t),this._cb=t[0].bind(this),this._timer=null,this._entries=[],this._viewport={x:0,y:0,top:0,left:0,right:window.innerWidth,width:window.innerWidth,bottom:Math.max(2100,window.innerHeight),height:Math.max(2100,window.innerHeight)}}observe(e){if(!t)return super.observe(...arguments);const n=e.getBoundingClientRect();this._entries.push({time:1e3,target:e,rootBounds:this._viewport,intersectionRect:n,boundingClientRect:n,isVisible:!0,intersectionRatio:1,isIntersecting:n.left<this._viewport.right&&n.right>this._viewport.left&&n.top<this._viewport.bottom&&n.bottom>this._viewport.top}),clearTimeout(this._timer),this._timer=setTimeout((()=>{this._cb(this._entries,this),this._entries=[]}),500)}unobserve(){if(!t)return super.unobserve(...arguments)}}}},r=t=>{for(const e of t){const t=o[e];t&&t()}};(()=>{if(t.navigator)for(const e in t.navigator){if(navigator[e]===t.navigator[e])continue;const n={get:()=>t.navigator[e]};try{Object.defineProperty(navigator,e,n)}catch(t){globalThis.navigator=Object.create(navigator,{[e]:n})}}})(),r(t.beforeLoad),window.onload=()=>r(t.afterLoad)}).toString()})()`.replace("CONFIG_PLACEHOLDER",JSON.stringify(t));this._executeJs(e)},_insertInjection(){e.controller.insertScript("/nj-engine.js")},_executeJs(t){const e=document.createElement("div");e.setAttribute("onreset",t),e.dispatchEvent(new Event("reset"))}})})(),(()=>{const{$bus:t}=n;t.controller={init(){t.on=this._on.bind(this),t.off=this._off.bind(this),t.send=this._send.bind(this),t.getSender=()=>this._sender,this._sender=null,this._handlers=[]},_on(t,e,n=null){n&&(e=e.bind(n));const i=(n,i,o)=>{if("object"==typeof n&&"$bus"===n.type&&n.name===t)return this._sender=i,(async()=>{const t=n.args,i=await e(...t);o(i)})(),!0};this._handlers.push({name:t,fn:e,listener:i}),chrome.runtime.onMessage.addListener(i)},_off(t,e=null){this._handlers=this._handlers.filter((n=>!!(n.name!==t||e&&n.fn!==e)||(chrome.runtime.onMessage.removeListener(n.listener),!1)))},_send:async(t,...e)=>new Promise((n=>{chrome.runtime.sendMessage({type:"$bus",name:t,args:e},(t=>n(chrome.runtime.lastError?void 0:t)))}))}})(),(()=>{const{$utils:t}=n;t.createPromise=()=>{let t=null,e=null;const n=new Promise(((n,i)=>{t=n,e=i}));return n.__defineGetter__("resolve",(()=>t)),n.__defineGetter__("reject",(()=>e)),n}})(),(()=>{const{$startup:t,$shortcut:e,$engine:i,$bus:o}=n;t.controller={init(){this._scripts=new Set,o.controller.init(),i.controller.init(),e.interceptor.init()},async insertScript(t){if(this._scripts.has(t))return;this._scripts.add(t);const e=document.createElement("script");e.src=chrome.runtime.getURL(t),e.onload=()=>e.remove(),document.documentElement.insertAdjacentElement("afterbegin",e)}},t.controller.init()})()})();