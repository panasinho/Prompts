(()=>{const e=!1,t="_actors_ifdt";let s=globalThis[t];(()=>{if(s)return;const i={};s=function t(s){const r={},a=new Proxy(s,{get:(n,o)=>"assign"===o?e=>{Object.assign(a,e)}:(o in s||(s[o]={},r[o]=t(s[o]),s===i&&e&&(globalThis[o]=s[o])),o in r?r[o]:s[o]),set:(t,a,n)=>(s[a]=n,r[a]=n,s===i&&e&&(globalThis[a]=s[a]),!0)});return a}(i),globalThis[t]=s,e&&(globalThis.app=i)})(),(()=>{const{$utils:e}=s;e.createPromise=()=>{let e=null,t=null;const s=new Promise(((s,i)=>{e=s,t=i}));return s.__defineGetter__("resolve",(()=>e)),s.__defineGetter__("reject",(()=>t)),s}})(),(()=>{const{$critical:e}=s;e.isAutomatable=e=>{try{const t=new URL(e.url);return!!["http:","https:"].includes(t.protocol)&&(!["chrome.google.com"].includes(t.host)&&!t.href.startsWith("https://harpa.ai/automation"))}catch(e){return!1}}})(),(()=>{const{$critical:e}=s;e.proxy={get pageType(){return void 0!==this._pageType||(this._pageType="chrome-extension:"!==location.protocol?null:location.search.includes("?sandbox")?"sandbox":location.search.includes("?popup")?"popup":location.search.includes("?offscreen")?"offscreen":location.search.includes("?shell-header")?"shell-header":location.search.includes("?shell-error")?"shell-error":location.search.includes("?shell-new-tab")?"shell-new-tab":location.search.includes("?shell-omnibox")?"shell-omnibox":location.search.includes("?shell-find")?"shell-find":location.search.includes("?")?null:"main"),this._pageType},get tabId(){return this._chromeTabId||null},set tabId(e){this._chromeTabId=e},get taskId(){return new URLSearchParams(location.search).get("task-id")}}})(),(()=>{const{$critical:e,$utils:t}=s;e.controller={async init(){this._readyPromise=t.createPromise(),this.setupCriticalStyles(),this.updatePageTitle(),this.updateFavicon(),await this.updateTabId(),this._readyPromise.resolve()},async waitForReady(){await this._readyPromise},get pageType(){return e.proxy.pageType},shouldUseSystemTheme(){return"shell-find"===this.pageType||"shell-header"===this.pageType||"shell-omnibox"===this.pageType},setupCriticalStyles(){const e=new URL(location.href).searchParams.get("bgColor");if(e)this.addStyle(`html { background: ${e} !important; }`);else{const e=this.getTheme();e&&document.querySelector("html").classList.add(`theme-${e}`)}},updatePageTitle(){document.title=this.getPageTitle()},updateFavicon(){const e=this.getFavicon();document.querySelector('link[rel="icon"]').setAttribute("href",e)},async updateTabId(){if("offscreen"!==this.pageType)return new Promise((t=>{chrome.tabs.getCurrent((s=>(s=>{e.proxy.tabId=s.id,t()})(s)))}))},getPageTitle(){return"sandbox"===this.pageType?"HARPA AI | Sandbox":"shell-new-tab"===this.pageType?"New Tab":"HARPA AI | Browser's Mind"},getFavicon(){if("sandbox"===this.pageType)return"/img/misc/sandbox.png";if("shell-new-tab"===this.pageType){return`/img/icons/icon-128-${"night"===this.getSystemTheme()?"light":"dark"}.png`}return"/img/icons/icon-128.png"},addStyle(e){const t=document.createElement("style");t.setAttribute("critical",""),t.textContent=e,document.head.insertAdjacentElement("afterbegin",t)},getTheme(){if(this.shouldUseSystemTheme())return this.getSystemTheme();try{return localStorage.getItem("ui-theme")}catch(e){return this.getSystemTheme()}},getSystemTheme(){const e=window?.matchMedia;return e&&e("(prefers-color-scheme: dark)").matches?"night":"day"}}})(),(()=>{const{$startup:e,$critical:t}=s;e.criticalController={init(){t.controller.init()}},e.criticalController.init()})()})();